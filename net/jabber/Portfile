# $Id: Portfile,v 1.13 2004/07/14 16:46:16 ssen Exp $

PortSystem 1.0
name		jabber
version		1.4.2
revision	4
categories	net
maintainers	darwinports@opendarwin.org
description	Online presence and instant messaging server
long_description	The Jabber server (jabberd) is a daemon for Jabber clients to connect and communicate with.
platforms	darwin
master_sites	http://jabberd.jabberstudio.org/downloads/
checksums	md5 10780dbdb93926ea5bb360e1186b939c
depends_lib	lib:libiconv:libiconv lib:libexpat.0:expat \
	lib:libintl.3:gettext lib:libpth.a:pth
configure.env	CPPFLAGS=-no-cpp-precomp
build.type  gnu

platform darwin {
	configure.env	CFLAGS="-DBIND_8_COMPAT=1"
}

platform darwin 6 {
	configure.env   CPPFLAGS=-no-cpp-precomp
}

destroot {
	file mkdir ${destroot}${prefix}/etc
	file mkdir ${destroot}${prefix}/lib
	file mkdir ${destroot}${prefix}/sbin
	file mkdir ${destroot}${prefix}/share/man
	system "install -o root -m 755 ${worksrcpath}/jabberd/jabberd ${destroot}${prefix}/sbin"
		
	system "install -o root -m 755 -d ${destroot}${prefix}/lib/jabber/pthsock"
	system "install -o root -m 755 ${worksrcpath}/pthsock/pthsock_client.so ${destroot}${prefix}/lib/jabber/pthsock"
	
	system "install -o root -m 755 -d ${destroot}${prefix}/lib/jabber/dialback"
	system "install -o root -m 755 ${worksrcpath}/dialback/dialback.so ${destroot}${prefix}/lib/jabber/dialback"
	
	system "install -o root -m 755 -d ${destroot}${prefix}/lib/jabber/dnsrv"
	system "install -o root -m 755 ${worksrcpath}/dnsrv/dnsrv.so ${destroot}${prefix}/lib/jabber/dnsrv"
	
	system "install -o root -m 755 -d ${destroot}${prefix}/lib/jabber/xdb_file"
	system "install -o root -m 755 ${worksrcpath}/xdb_file/xdb_file.so ${destroot}${prefix}/lib/jabber/xdb_file"
	
	system "install -o root -m 755 -d ${destroot}${prefix}/lib/jabber/jsm"
	system "install -o root -m 755 ${worksrcpath}/jsm/jsm.so ${destroot}${prefix}/lib/jabber/jsm"
		
	system "install -o root -m 755 -d ${destroot}${prefix}/etc/jabber/"
	system "install -o root -m 755 ${worksrcpath}/jabber.xml ${destroot}${prefix}/etc/jabber"
	
	system "install -o root -m 755 -d ${destroot}${prefix}/var/lib/jabber/"
	system "touch ${destroot}${prefix}/var/lib/jabber/.turd"
	system "install -o root -m 755 -d ${destroot}${prefix}/var/run/jabber/"
	system "touch ${destroot}${prefix}/var/run/jabber/.turd"
	system "install -o root -m 755 -d ${destroot}${prefix}/var/log/jabber/"
	system "touch ${destroot}${prefix}/var/log/jabber/.turd"
	system "install -o root -m 755 -d ${destroot}${prefix}/var/spool/jabber/"	
	system "touch ${destroot}${prefix}/var/spool/jabber/.turd"

	file copy -force ${destroot}${prefix}/etc/jabber/jabber.xml ${destroot}${prefix}/etc/jabber/jabber.xml.default
}

variant ssl {
	depends_lib-append	lib:libssl.0.9:openssl
	configure.args	--enable-ssl
}
