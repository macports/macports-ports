# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4

PortSystem      1.0
PortGroup       github 1.0
PortGroup       xcode 1.0

github.setup    transmission transmission 4.0.1
categories      net aqua
maintainers     {khindenburg @kurthindenburg} openmaintainer
license         MIT GPL-2

description     Lightweight BitTorrent client
long_description \
    Transmission is a free, lightweight BitTorrent client. \
    It features a simple, intuitive interface on top of an \
    efficient, cross-platform back-end. Transmission is open \
    source (MIT license) and runs on Mac OS X (Cocoa interface), \
    Linux/NetBSD/FreeBSD/OpenBSD (GTK+ interface) and BeOS \
    (native interface). This is the Cocoa version.

homepage        https://transmissionbt.com

github.tarball_from \
                releases
use_xz          yes

checksums       rmd160  c943bf1b81f4b4f796d4e32c8ad90cc1f23e0c02 \
                sha256  8fc5aef23638c983406f6a3ee9918369e4cdc84e3228bd2fb3d01dd55cdad900 \
                size    10434832

platforms       macosx

xcode.target            Transmission
xcode.configuration     Release

variant daemon description {Builds headless daemon} {
    xcode.target-append transmission-daemon
    xcode.target-append transmission-remote
}

variant edit description {Builds .torrent file utils} {
    xcode.target-append transmission-create
    xcode.target-append transmission-edit
    xcode.target-append transmission-show
}

destroot {
    system -W ${worksrcpath}/build/Release "/usr/bin/codesign --deep --force --sign - Transmission.app"
    file copy ${worksrcpath}/build/${xcode.configuration}/Transmission.app \
        ${destroot}${applications_dir}/Transmission.app

    if {[variant_isset daemon]} {
        xinstall -m 755 -W ${worksrcpath}/build/${xcode.configuration} \
        transmission-daemon transmission-remote \
        ${destroot}${prefix}/bin

        xinstall -m 644 -W ${worksrcpath}/daemon \
        transmission-daemon.1 \
        ${destroot}${prefix}/share/man/man1
        
        xinstall -m 644 -W ${worksrcpath}/utils \
        transmission-remote.1 \
        ${destroot}${prefix}/share/man/man1
   }
   
   if {[variant_isset edit]} {
        xinstall -m 755 -W ${worksrcpath}/build/${xcode.configuration} \
        transmission-create transmission-edit transmission-show \
        ${destroot}${prefix}/bin

        xinstall -m 644 -W ${worksrcpath}/utils \
        transmission-create.1 \
        ${destroot}${prefix}/share/man/man1
        
        xinstall -m 644 -W ${worksrcpath}/utils \
        transmission-edit.1 \
        ${destroot}${prefix}/share/man/man1
        
        xinstall -m 644 -W ${worksrcpath}/utils \
        transmission-show.1 \
        ${destroot}${prefix}/share/man/man1
    }
}

set minxcodever 10.0
set minosver 10.10
if {([vercmp $xcodeversion ${minxcodever}] < 0) || ([vercmp ${macosx_deployment_target} ${minosver}] < 0)} {
    known_fail yes
    pre-fetch {
        ui_error "${name} ${version} requires Xcode ${minxcodever} or greater to build and macOS ${minosver} to run."
        ui_error "Consider installing transmission-x11 instead."
        return -code error "incompatible OS X version"
    }
}

# Ignore betas - can't use extract.suffix
livecheck.regex     (\[0-9.\]+).tar
