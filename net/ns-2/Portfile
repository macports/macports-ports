# $Id$

PortSystem		1.0

name			ns-2
version			20050728
categories		net
platforms		darwin
maintainers		nomaintainer
description		The Network Simulator
long_description	Ns is a discrete event simulator targeted \
			at networking research
homepage		http://www.isi.edu/nsnam/ns/
master_sites		http://www.opendarwin.org/~ben/

checksums		md5 b9db3ebbd912bd23c397ed9cca179078

depends_build		port:autoconf \
			port:automake

depends_lib		port:tclcl

patchfiles              conf_configure.in.fns.patch \
			emulate_net-pcap.cc.patch

pre-configure		{
			system "cd ${worksrcpath} && aclocal && autoconf"
}

configure.args          --with-tcl=${prefix} --with-tcl-ver=8.4 \
                        --with-tk=${prefix} --with-tk-ver=8.4 \
                        --with-otcl=${prefix} \
                        --with-tclcl=${prefix} \
                        --with-perl=${prefix}/bin \
                        --prefix=${prefix} \
			CPPFLAGS='-I${x11prefix}/include' \
			LDFLAGS='-L${x11prefix}/lib'

post-configure		{
			reinplace "s|-lXext|-L${x11prefix}/lib -lXext -L/usr/lib -lSystemStubs|g" \
				${worksrcpath}/Makefile
}

destroot		{
			xinstall -m 755 ${worksrcpath}/ns ${destroot}${prefix}/bin
			xinstall -d -m 755 ${destroot}${prefix}/man/man1
			xinstall -m 644 ${worksrcpath}/ns.1 ${destroot}${prefix}/man/man1
			xinstall -m 755 ${worksrcpath}/indep-utils/cmu-scen-gen/setdest/setdest \
			    ${destroot}${prefix}/bin
			xinstall -m 755 ${worksrcpath}/indep-utils/cmu-scen-gen/setdest/calcdest \
			    ${destroot}${prefix}/bin
			xinstall -m 755 ${worksrcpath}/indep-utils/webtrace-conv/dec/dec-tr-stat \
			    ${destroot}${prefix}/bin
			xinstall -m 755 ${worksrcpath}/indep-utils/webtrace-conv/epa/epa-tr-stat \
			    ${destroot}${prefix}/bin
			xinstall -m 755 ${worksrcpath}/indep-utils/webtrace-conv/nlanr/nlanr-tr-stat \
			    ${destroot}${prefix}/bin
			xinstall -m 755 ${worksrcpath}/indep-utils/webtrace-conv/ucb/ucb-tr-stat \
			    ${destroot}${prefix}/bin
}
