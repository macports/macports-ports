#!/bin/sh

NEFU=@PREFIX@/bin/nefu
NEFUHOME=@PREFIX@/share/nefu
NEFUHTML=@PREFIX@/share/nefu/public_html
NEFUSHELL=@PREFIX@/share/nefu/shelltests
NEFUCONF=@PREFIX@/etc/nefu.conf

checkinstall() 
{
	# test if conf file is present
	if [ ! -f "${NEFUCONF}" ]; then
		echo "Error: ${NEFUCONF} is missing!"
		echo "Try copying ${NEFUCONF}.sample to ${NEFUCONF}"
		exit 1
	fi

	# test if output directories are present, if not we create them
	if [ ! -d "${NEFUHOME}" ]; then
		mkdir -p ${NEFUHOME}
		chown nefu ${NEFUHOME}
		chgrp nefu ${NEFUHOME}
	fi

	if [ ! -d "${NEFUHTML}" ]; then
		mkdir -p ${NEFUHTML}
		chown nefu ${NEFUHTML}
		chgrp nefu ${NEFUHTML}
	fi

	if [ ! -d "${NEFUSHELL}" ]; then
		mkdir -p ${NEFUSHELL}
		chown nefu ${NEFUSHELL}
		chgrp nefu ${NEFUSHELL}
	fi
}

case "$1" in
start)
	checkinstall
	@PREFIX@/bin/nefu -f ${NEFUCONF} -H
	;;
stop)
	/usr/bin/killall -SIGUSR1 nefu
	;;
restart)
	$0 stop
	$0 start
	;;
*)
	echo "Usage: `basename $0` {start|stop|restart}" >&2
	;;
esac

exit 0

