# $Id: Portfile,v 1.3 2004/11/29 22:48:02 toby Exp $

PortSystem      1.0
name            netperf
version         2.2pl4
revision	1
categories	net
platforms	darwin freebsd
maintainers	digdog@opendarwin.org
description	a network performance benchmark
long_description 	Netperf is a benchmark that can be used to measure \
			various aspects of networking performance. Currently, \
			its focus is on bulk data  transfer and \
			request/response performance using either TCP or UDP, \
			and the Berkeley Sockets interface. In addition, tests \
			for DLPI, the Fore ATM API, Unix Domain Sockets, and \
			HP HiPPI LLA may be conditionally compiled-in.
homepage	http://www.netperf.org/
master_sites	ftp://ftp.cup.hp.com/dist/networking/benchmarks/netperf/archive
checksums       md5 0ba938bc65dac4989639a40fdf892952

fetch.args		--disable-epsv

patch	{
	reinplace "s|/opt/netperf|${destroot}${prefix}/bin|g" \
		${worksrcpath}/makefile
	reinplace "s|-D\$(LOG_FILE) -DNEED_MAKEFILE_EDIT|-D\$(LOG_FILE)|g" \
	  	${worksrcpath}/makefile
	reinplace "s|NETHOME=\".\"|NETHOME=\"${prefix}/bin\"|" \
		${worksrcpath}/snapshot_script ${worksrcpath}/tcp_range_script \
		${worksrcpath}/tcp_rr_script ${worksrcpath}/tcp_stream_script \
		${worksrcpath}/udp_rr_script ${worksrcpath}/udp_stream_script 
}

use_configure	no

post-destroot	{
	xinstall -m 444 ${worksrcpath}/netperf.man \
		${destroot}${prefix}/share/man/man1/netperf.1
	xinstall -m 444 ${worksrcpath}/netserver.man \
		${destroot}${prefix}/share/man/man1/netserver.1 
}
