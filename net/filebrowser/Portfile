# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           golang 1.0

go.setup            github.com/filebrowser/filebrowser 2.23.0 v
set git-commit      02db83c
# This line is for displaying commit in CLI only
revision            0
categories          net sysutils
maintainers         {i0ntempest @i0ntempest} openmaintainer
license             Apache-2

description         Web File Browser
long_description    filebrowser provides a file managing interface within a specified directory\
                    and it can be used to upload, delete, preview, rename and edit your files.\
                    It allows the creation of multiple users and each user can have its own directory.\
                    It can be used as a standalone app or as a middleware.

homepage            https://filebrowser.org

checksums           ${distname}${extract.suffix} \
                        rmd160  8b4950096f17e7d373d8c2b0576669330526f11c \
                        sha256  3a460242733be4db8305b284f4abad4873dd189e62dfb18b97a8f48fc9161544 \
                        size    3977208

go.vendors          gopkg.in/yaml.v3 \
                        lock    496545a6307b \
                        rmd160  16a43936d8ae6243895e23465132977d3a1193c2 \
                        sha256  333e78b3b9cb73b3572d62f692d32426a8554b86c93025ea032f779395869e84 \
                        size    90145 \
                    gopkg.in/yaml.v2 \
                        lock    v2.4.0 \
                        rmd160  66e9feb7944b3804efa63155ed9b618717b8955c \
                        sha256  72812077e7f20278003de6ab0d85053d89131d64c443f39115a022114fd032b6 \
                        size    73231 \
                    gopkg.in/natefinch/lumberjack.v2 \
                        lock    v2.0.0 \
                        rmd160  931b7db0e3893f0f6515a8113e7c35aa3e45c9da \
                        sha256  1f7796430424a4dd4c74f73929e7e82384672f6c2c311c5b671e6c36353780f3 \
                        size    12640 \
                    gopkg.in/ini.v1 \
                        lock    v1.66.4 \
                        rmd160  a03f51c928405d6f87ee1b853f1079eee7c9daac \
                        sha256  1db7c426199e23a2980bbc1dd62b25f1fe494484d716111f9559c11210eaafb1 \
                        size    53336 \
                    gopkg.in/check.v1 \
                        lock    41f04d3bba15 \
                        rmd160  1e5543a8e6a3159296ee63e28cbde9931a04f6b3 \
                        sha256  c41575a73d10809f89b05ef9e783f2d53facdc6573697770d30efb05a9d2dc28 \
                        size    31612 \
                    google.golang.org/protobuf \
                        repo    github.com/protocolbuffers/protobuf-go \
                        lock    v1.28.0 \
                        rmd160  076cb79b7651b0fdc12168a43cdc613d111fb371 \
                        sha256  7efea04ee3dd363a74c04a25473bcc2361d669011086c85a8b04e0c0639ad432 \
                        size    1280082 \
                    google.golang.org/appengine \
                        repo    github.com/golang/appengine \
                        lock    v1.6.7 \
                        rmd160  32e6de431630b8126df1d04e36eba2abb57626f1 \
                        sha256  3669d59598e4bd657ec079f151fab47b3aa130adfec35daeb05e079220970cd2 \
                        size    333026 \
                    golang.org/x/text \
                        lock    v0.4.0 \
                        rmd160  a3215f5c266b2d6cc0ae945858b543031fcb5a54 \
                        sha256  c4e794a9e732f422df4e005f87ddba1e640b5bb7d6ce10ad56e40fa8c7d56ee2 \
                        size    8359157 \
                    golang.org/x/sys \
                        lock    8c9f86f7a55f \
                        rmd160  b71df2dedbfd04a9aecaee5e6a3351b621322114 \
                        sha256  2c2126ac6c857ea6f3a2be1daa859c7e1b1252b946445836a86545ff60f83055 \
                        size    1337107 \
                    golang.org/x/net \
                        lock    290c469a71a5 \
                        rmd160  e11deb5668ec06a94ecda8c6fc3f7a373ebb35b2 \
                        sha256  d51af4b91585ee62500a81f634b4060c1d9bc90cf08b5e6e3d1f06f26fe13da1 \
                        size    1229690 \
                    golang.org/x/image \
                        lock    70e8d0d3baa9 \
                        rmd160  582dbbe16a598a940a641440807628e80fa2c70b \
                        sha256  7929529681833c39710e55f35e536301ee4f830d96c447f0e1b267dd45cbe73d \
                        size    4903299 \
                    golang.org/x/crypto \
                        lock    eb4f295cb31f \
                        rmd160  509c8d91023c14e1ed773318c12cc4816ea66145 \
                        sha256  f807a028d6003d7ee4e1d7ee9485fae50a5bf280a81bd4a7a18e64b32c065ff9 \
                        size    1631462 \
                    go.etcd.io/bbolt \
                        repo    github.com/etcd-io/bbolt \
                        lock    v1.3.6 \
                        rmd160  934af729b47e620f5cd9dc35df49aa25ee1d4132 \
                        sha256  9a4df17332a1e279b44a288d33dfbdb151ecf5be825ce5075fa97d7d7e930ec6 \
                        size    98074 \
                    github.com/yusufpapurcu/wmi \
                        lock    v1.2.2 \
                        rmd160  a59c86f02e341e78531a93586b1b1aabe2b34b34 \
                        sha256  a090de0b7270f350b40c857173b0c8a958605bb7807b34d30d504ad72981d123 \
                        size    12462 \
                    github.com/xi2/xz \
                        lock    48954b6210f8 \
                        rmd160  80381ccf17a6eddadd49295e261f99955444f73e \
                        sha256  1019ea65e973ae91d42d31b00514c727bb2057ecae021bf24ac8014465af8b8f \
                        size    1135341 \
                    github.com/vmihailenco/msgpack \
                        lock    v4.0.4 \
                        rmd160  89df770ec853d2f63af382d7ebb109ad43a694cd \
                        sha256  fc5a47cf9572def5c376f25f031722819a218db68dc2c015bcda2398a29dc9a9 \
                        size    26969 \
                    github.com/ulikunitz/xz \
                        lock    v0.5.9 \
                        rmd160  6df470100684d9c1ed3021e183b4b0d50a4c4920 \
                        sha256  c67593500935231d98bfab45278f1df8e58bfbed093094d3d3c6ecefd448ac02 \
                        size    478035 \
                    github.com/tomasen/realip \
                        lock    f0c99a92ddce \
                        rmd160  9647d37dc83d15756eb5b168b44370311bea8e69 \
                        sha256  9e8bc86441796fe16edf2a271f5cdc6a561c633644efb6d326d65d8aadee29cc \
                        size    3125 \
                    github.com/subosito/gotenv \
                        lock    v1.2.0 \
                        rmd160  359083733ab5db2a09169c8d6d070b03463aef60 \
                        sha256  01fc25c8959371d006a0460132b72710ac120d5400fceebbc1d321d2e9bcd4a0 \
                        size    7375 \
                    github.com/stretchr/testify \
                        lock    v1.7.1 \
                        rmd160  9e07f7d6890b8598706260ece5db26a7b12b5b2a \
                        sha256  27cabaf81344157a188083266cf8ccc19d04c43d9a34b6276b760514b9c880a3 \
                        size    94020 \
                    github.com/spf13/viper \
                        lock    v1.12.0 \
                        rmd160  e3c9ae7e01ac0bae6e613a8cb96e00101a7af271 \
                        sha256  cea82cde9d294e7a3714f6d4169370e8c5672da8c67b5dcd2c0d16b39c58e7dc \
                        size    114634 \
                    github.com/spf13/pflag \
                        lock    v1.0.5 \
                        rmd160  2ce81608a38c6f383a35bccd24d64361df5828c9 \
                        sha256  7f41acdcba65b1fab5b9b633947a139f9915b60f94bdab486cdbe9d90c54f61e \
                        size    50815 \
                    github.com/spf13/jwalterweatherman \
                        lock    v1.1.0 \
                        rmd160  390db06ec6993dd9479d7fbfeaff1144d4fbc6e9 \
                        sha256  b75cd39c9d41c3f7e147225b3dbcb077d5e7a5688dc441ec15179bb1a4c6b941 \
                        size    6870 \
                    github.com/spf13/cobra \
                        lock    v1.4.0 \
                        rmd160  ea96b88322059844913843eaa69706c803ee3342 \
                        sha256  25ba6ae9400f887d94d8019df69e6b47bbedfc9a1fd00225d8b22cfc3df52421 \
                        size    94575 \
                    github.com/spf13/cast \
                        lock    v1.4.1 \
                        rmd160  cb1d2c13bdd8a4aafd7c4e768554bab0a65c5759 \
                        sha256  9e7890d9db7948b57974a86df8a23f235327990227c7d8f200fd1d114fa9ad07 \
                        size    13391 \
                    github.com/spf13/afero \
                        lock    v1.8.2 \
                        rmd160  6e6760129ba31901a1b38f23d7bfd715f87a0908 \
                        sha256  a4866d20ed035994665dd114ecdfd7dc50e58574076a2ae0b5076eb987a32f87 \
                        size    91582 \
                    github.com/shirou/gopsutil \
                        lock    v3.22.5 \
                        rmd160  69ba5488d0d04f529b8ac5a6f552b5a8db3c1d5e \
                        sha256  1c14fc0a857bb5b8e1a7a6cc42c3209ce8a024e467a3bb00409f62348e44ddae \
                        size    168784 \
                    github.com/power-devops/perfstat \
                        lock    5aafc221ea8c \
                        rmd160  1c4f659015f1a59d261a493397534436ccb6a608 \
                        sha256  617a974b1f9c38ac9fd958a8cc80c14aaf083906691dda43d642c0ef12611047 \
                        size    36009 \
                    github.com/pmezard/go-difflib \
                        lock    v1.0.0 \
                        rmd160  fc879bfbdef9e3ff50844def58404e2b5a613ab8 \
                        sha256  7cd492737641847266115f3060489a67f63581e521a8ec51efbc280c33fc991f \
                        size    11409 \
                    github.com/pierrec/lz4 \
                        lock    v4.1.2 \
                        rmd160  31607159a890c87c3f985780047fcc2563f09f03 \
                        sha256  1f159cb5841e9c34e5d110f66659fe3992bb160d20b08c9f916344e567e2638e \
                        size    38700779 \
                    github.com/pelletier/go-toml \
                        lock    v2.0.0 \
                        rmd160  5ef4f0ec302506d0f9e88958ef58d6745b3a5db7 \
                        sha256  2659f1d917fd653d63aef9454ce59351c44bde7319da86b437f0eaf9addc1218 \
                        size    887396 \
                    github.com/nwaples/rardecode \
                        lock    v1.1.0 \
                        rmd160  05e3639922ce8dd50c5277b699f20684d5cde7f9 \
                        sha256  2609395e5571926e9d990ec71a6e32ab65530a3b792e42e86590e90d83c1d417 \
                        size    34399 \
                    github.com/mitchellh/mapstructure \
                        lock    v1.4.3 \
                        rmd160  0d356c5704da36a626d37a592924b44d283f4096 \
                        sha256  ec44b30992a4bc81e7141cfe24521538aa693f0b99ff97868b5aa1e8370b49cc \
                        size    28434 \
                    github.com/mitchellh/go-homedir \
                        lock    v1.1.0 \
                        rmd160  44b3985e40e5bbb22d11f8622c340f9ed727ea91 \
                        sha256  024c8a57316c7fbc0eb23cdbfd57f72a74b51beb83d714034d67ee9aba48100c \
                        size    3366 \
                    github.com/mholt/archiver \
                        lock    v3.5.1 \
                        rmd160  a0d40489e1a0f84e76b68728ef1ab92db1c24013 \
                        sha256  1523c183b6cc2a8e97b529c5ddf1493b285847afb5fc4332f3e088d706288d07 \
                        size    64217 \
                    github.com/marusama/semaphore \
                        lock    v2.5.0 \
                        rmd160  9335f483b0ea9582971a2ab5c962bc5f222c6e6b \
                        sha256  ef9e467334fbd0aa5411f6c193c855e25335b4abd34648fde67348171b68a4c0 \
                        size    6840 \
                    github.com/maruel/natural \
                        lock    v1.0.0 \
                        rmd160  7f0cc09807644189897cfb12e2690671744796e8 \
                        sha256  1470f1eeb2a5af3b7a0b5cf944a2b02e8a55ef24a945b04b80c1df4be9c79f37 \
                        size    6236 \
                    github.com/magiconair/properties \
                        lock    v1.8.6 \
                        rmd160  ad470d8183d5c506315eae81288aadb4b2ca4bcf \
                        sha256  587312d396b70df86cbff51fb17720ede404ff019f8af3422121ce90259b0c50 \
                        size    30237 \
                    github.com/kr/text \
                        lock    v0.1.0 \
                        rmd160  0b3c78459e227170a3b80a0103d87a3eef77ed88 \
                        sha256  5ed970aad0da3cba3cffacdb4d154a162a8968655ee6d6f7b627e71b869efaf6 \
                        size    8691 \
                    github.com/kr/pretty \
                        lock    v0.1.0 \
                        rmd160  9aa7a5aad4c48840eecfd0f80186d1fb5ded0fd6 \
                        sha256  f6c3f89667c63e5b7f1fc6ee2c06b6a6bfdce88f3a965ccd395b64c6f95c9a47 \
                        size    8553 \
                    github.com/klauspost/pgzip \
                        lock    v1.2.5 \
                        rmd160  6fe0c7919ab2e059d204500b2b2b97061fa65d77 \
                        sha256  d7a8b291e14bb9a7a1b45b7e83cfbae89933295a47516473d77dced37558ceb2 \
                        size    125942 \
                    github.com/klauspost/compress \
                        lock    v1.11.4 \
                        rmd160  a5394fbd74971308acec69a8b07b8cca25b5a06b \
                        sha256  94b8378e74ee3c6beaa6342595d42dd69640182de5e51c0b8b0321711583ce6d \
                        size    17445879 \
                    github.com/inconshreveable/mousetrap \
                        lock    v1.0.0 \
                        rmd160  5c617a09f1432fc543672a0e0c1e13d3752030c2 \
                        sha256  0e6bae2849f13d12fe361ecac087728e4e97f3482f4cec44f6e7a2c53bb9cd0c \
                        size    2291 \
                    github.com/hashicorp/hcl \
                        lock    v1.0.0 \
                        rmd160  ad8d0b523bb708fd6ae77df8bb414c103a75aa92 \
                        sha256  4fc0e87ac9d3d6cd042f044df2db2703bed569051fb8c179d505edeb4433e96e \
                        size    70636 \
                    github.com/gorilla/websocket \
                        lock    v1.5.0 \
                        rmd160  ff5a4278af87e04d06521f4cf1db6fd48c0403b2 \
                        sha256  e26e73242d694a6a43458bec8d7e32f6a3d355539484eeb04c5b0c182dc79d9f \
                        size    54163 \
                    github.com/gorilla/mux \
                        lock    v1.8.0 \
                        rmd160  0671fd049b24cb4c682168aef4e176793dd624a7 \
                        sha256  b94c995107eaf9f5bcaa0a29629fb6c23bab9ec0606071c09070e143fdf323fa \
                        size    45524 \
                    github.com/golang/snappy \
                        lock    v0.0.2 \
                        rmd160  4bd12ef3068855410e2c6549ae45b1e1cb828ffd \
                        sha256  89bf1f28e7f031a29e454ccbf90c07c90bbb499decdb66cd1fe67b898720c7ef \
                        size    65982 \
                    github.com/golang/protobuf \
                        lock    v1.5.2 \
                        rmd160  9924f66e6525b49769f4ef61f7196387185b2f9b \
                        sha256  d7b5f7c44e324b3f510fec1b79de20bd8d7537229b23ad7236769cf3974ce0c7 \
                        size    171736 \
                    github.com/golang/geo \
                        lock    673a6f80352d \
                        rmd160  807722be6f541789039a52ac9ff720ee979c9c06 \
                        sha256  89044cb458bbddeea88f71a8f2e366adb39326239bce160e77698dbd0763825a \
                        size    367519 \
                    github.com/golang-jwt/jwt \
                        lock    v4.4.1 \
                        rmd160  5819762e88fb8ab81ccba25a2d063b3fa4dd7e5d \
                        sha256  5311969eb89f74ef856ac8ba8dd11cb1c358112b404917b74abcb797830f9561 \
                        size    50358 \
                    github.com/go-ole/go-ole \
                        lock    v1.2.6 \
                        rmd160  70350a72faa92597facb55379e481ea049bb57da \
                        sha256  d818d3dab064c4f8f2be9460353318207f58d562f874d06c0bff91cd423dc2af \
                        size    52614 \
                    github.com/go-errors/errors \
                        lock    v1.1.1 \
                        rmd160  e5347710bd07ef59f4877070fe27b7d959b3a014 \
                        sha256  3c4bf9b862e447a39c8d99f7b53420132c56306afc04830d3f66e33a015807cf \
                        size    9337 \
                    github.com/fsnotify/fsnotify \
                        lock    v1.5.1 \
                        rmd160  c99fbad44a371ce38eb2bd5c6ef70fb4537952e3 \
                        sha256  699405dfda2fe02a305bee66f58046adb43f426ac905f85d80710e36846b3768 \
                        size    32714 \
                    github.com/flynn/go-shlex \
                        lock    3f9db97f8568 \
                        rmd160  ec42eaffe2cf17a46e12c7c2a7d436c0f68ba655 \
                        sha256  b4205ec400df652238f7ed287c4b77b5f17a17d5793cd5371b7cc5e0f07dfeed \
                        size    7690 \
                    github.com/dsoprea/go-utility \
                        lock    2fccff4aa15e \
                        rmd160  2947b0bd26ede51826af5d68b96a321ad7f9036a \
                        sha256  782fe3c07c910ef0d76b7fe2647ed6a410e657605c4ec543fe8313d7ed3931ec \
                        size    53114 \
                    github.com/dsoprea/go-logging \
                        lock    a10564966e9d \
                        rmd160  ba9725e0d4ea03d935f73a14fcec41360d5375ec \
                        sha256  4df16d855e071a736c1736efc3f90f85ff401db3f9bed8dcd8125356179443b5 \
                        size    11173 \
                    github.com/dsoprea/go-exif \
                        lock    db167117f483 \
                        rmd160  2f28b938c1712b05793fe29a4cbe70348f09581d \
                        sha256  a916db4ad16eb3693942be20524c0e6dd7849089c10599bc5bbeaf7361f34e98 \
                        size    28369564 \
                    github.com/dsnet/compress \
                        lock    f66993602bf5 \
                        rmd160  e07dbed76bace1b36938f3e3cf8c9c4d9ea7ab28 \
                        sha256  b90094fda68da2ed7a28ab7de9670c15366b48269112ed26bf8322f8836e1a48 \
                        size    9963932 \
                    github.com/disintegration/imaging \
                        lock    v1.6.2 \
                        rmd160  eb7fc30603404bee955019c2a1a5f717bc784f89 \
                        sha256  69d5d90553fd187844d8ef4a8d89da9a6c9c1ec29402b44521aaa85640d0b83f \
                        size    2212673 \
                    github.com/davecgh/go-spew \
                        lock    v1.1.1 \
                        rmd160  7c02883aa81f81aca14e13a27fdca9e7fbc136f7 \
                        sha256  e85d6afa83e64962e0d63dd4812971eccf2b9b5445eda93f46a4406f0c177d5f \
                        size    42171 \
                    github.com/asdine/storm \
                        lock    v3.2.1 \
                        rmd160  47eaabb9d1c7327074b06f42d7ea73b91f4e2dcf \
                        sha256  440de0ffdfd90c4234ebcb3a4bbf402311c353b7a8bdda5c58b7505f711bb299 \
                        size    47935 \
                    github.com/andybalholm/brotli \
                        lock    v1.0.1 \
                        rmd160  f6dc10e7cf5cb26d928c66f5e5e10951cca0a61b \
                        sha256  165f621a41695089b61b28b92ffce5a9e20fb59c9f5de51029f4dfe2beeb78fe \
                        size    593402 \
                    github.com/Sereal/Sereal \
                        lock    0b8ac451a863 \
                        rmd160  30ae87dc25e4976aabc8dc8ce74dc2fa6023aed3 \
                        sha256  829b952da1331c06fa7dabb6f26739d8d573e48bf687a59c17bfae42aabd2298 \
                        size    2408929 \
                    github.com/DataDog/zstd \
                        lock    v1.4.1 \
                        rmd160  86c75e5feafd8e615a7eea3b97680c0543a95380 \
                        sha256  f62a03934f91b063545ce33c40526d33d52fb07dbfbced5dd5b531295b37af4c \
                        size    498943 \
                    github.com/BurntSushi/toml \
                        lock    v0.3.1 \
                        rmd160  fb9650e2d16525153645e5547626f242f3800149 \
                        sha256  8cc9e5dc68e247554227973d0b4e023b27bbd9ba5a26e4fb40f44743afcb35f1 \
                        size    42087

# Notes for updating this port:
# Replace go.googlesource.com/protobuf with github.com/protocolbuffers/protobuf-go
# github.com/spf13/viper v1.11.0 may not work. Manually upgrade to v1.12.0
# Remember to update git commit hash

depends_build-append \
                     path:bin/node:nodejs16 \
                     path:bin/npm:npm8

platform darwin {
    if {${os.major} < 13} {
        depends_build-replace \
                     path:bin/node:nodejs16 \
                     path:bin/node:nodejs14
    }
}

pre-build {
    set nodesslver [exec ${prefix}/bin/node -e "console.log(process.versions.openssl)" | /usr/bin/grep -e "\\d.\\d*.\\d*" -o]
    ui_debug "Installed Node.js linked OpenSSL ${nodesslver}"
    if {[vercmp ${nodesslver} 3] < 0} {
        system -W ${worksrcpath}/frontend "${prefix}/bin/npm --verbose ci && \
                                           ${prefix}/bin/npm --verbose run build"
    } else {
        system -W ${worksrcpath}/frontend "NODE_OPTIONS=--openssl-legacy-provider ${prefix}/bin/npm --verbose ci && \
                                           NODE_OPTIONS=--openssl-legacy-provider ${prefix}/bin/npm --verbose run build"
    }
}

build.args-append   -ldflags=\"-X 'github.com/filebrowser/filebrowser/version.Version=${version}' -X 'github.com/filebrowser/filebrowser/version.CommitSHA=${git-commit}'\"

destroot {
    xinstall -m 0755 ${worksrcpath}/${name} ${destroot}${prefix}/bin/
    file mkdir ${destroot}${prefix}/etc/filebrowser/
    copy ${filespath}/config.json ${destroot}${prefix}/etc/filebrowser/config.json.example
    reinplace "s|@@PREFIX@@|${prefix}|g" ${destroot}${prefix}/etc/filebrowser/config.json.example
}

post-activate {
    if {![file exists ${prefix}/etc/filebrowser/config.json]} {
        copy ${prefix}/etc/filebrowser/config.json.example ${prefix}/etc/filebrowser/config.json
    }
}

startupitem.create          yes
startupitem.executable      ${prefix}/bin/filebrowser --config ${prefix}/etc/filebrowser/config.json

notes-append "
    The example config file is copied to ${prefix}/etc/filebrowser/config.json and its content\
    will be preserved across upgrades and reinstalls. This config file configures filebrowser\
    to use /var/empty as root by default for safety reasons, so modify it before using. The\
    startup item will use this config file by default.\
    
    The default login and password for the Web UI is admin and admin. Change this as soon as\
    you can.
    
"
