# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           golang 1.0

go.setup            github.com/mr-karan/doggo 1.1.2 v
go.offline_build    no
revision            0

description         Command-line DNS Client for Humans

long_description    doggo is a modern command-line DNS client (like dig) \
                    written in Golang. It outputs information in a neat \
                    concise manner and supports protocols like DoH, DoT and \
                    DNSCrypt as well. It supports DNS over HTTP, DNS over \
                    TLS, DNS over TCP/UDP, DNS over DNSCrypt, as well as JSON \
                    output.

categories          net sysutils
installs_libs       no
license             GPL-3
maintainers         {gmail.com:herby.gillot @herbygillot} \
                    openmaintainer

checksums           rmd160  d62e278123bf985747c8a24e92b5bb9aef250255 \
                    sha256  bb66deafb34547c4e2735908ba5c42c6a0c5f30fb2b62dc5f9ff7a11fbe15d3e \
                    size    2454685

build.cmd           make
build.pre_args      VERSION=${version}
build.args          build-cli

post-build {
    file mkdir ${worksrcpath}/completions

    foreach _shell {bash fish zsh} {
        system -W ${worksrcpath}/completions \
            "sh -c '../bin/${name}.bin completions ${_shell} > ${name}.${_shell}'"
    }
}

destroot {
    xinstall -m 0755 \
        ${worksrcpath}/bin/${name}.bin \
        ${destroot}${prefix}/bin/${name}

    xinstall -d ${destroot}${prefix}/share/bash-completion/completions
    xinstall -m 0644 ${worksrcpath}/completions/${name}.bash \
        ${destroot}${prefix}/share/bash-completion/completions/${name}

    xinstall -d -m 0644 ${destroot}${prefix}/share/zsh/site-functions
    xinstall -m 0644 ${worksrcpath}/completions/${name}.zsh \
        ${destroot}${prefix}/share/zsh/site-functions/_${name}

    xinstall -d -m 0644 ${destroot}${prefix}/share/fish/vendor_completions.d
    xinstall -m 0644 ${worksrcpath}/completions/${name}.fish \
        ${destroot}${prefix}/share/fish/vendor_completions.d/

    xinstall -d ${destroot}${prefix}/share/${name}/examples
    copy ${worksrcpath}/config-api-sample.toml \
        ${destroot}${prefix}/share/${name}/examples/
}
