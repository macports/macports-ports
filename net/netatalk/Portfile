# $Id: Portfile,v 1.2 2004/10/11 19:44:43 mww Exp $

PortSystem 1.0

name			netatalk
version			2.0.0
categories		net
platforms		darwin
maintainers		mww@opendarwin.org
description		file and printer server for Apple Macintosh clients
long_description	netatalk is a daemon which provides POSIX-compliant \
					Unix/BSD systems with the ability to share files and \
					printers with Apple Macintosh computers.

homepage		http://netatalk.sourceforge.net/
master_sites	sourceforge
checksums		md5 5df89a9d1ff617e9e46b296db661288f
use_bzip2		yes

depends_lib		lib:db-4:db4 \
				lib:libssl:openssl \
				bin:perl:perl5.8
depends_build	path:${prefix}/include/cups/cups.h:cups-headers

post-patch	{
	reinplace "s|/var/run/|${prefix}/var/run/netatalk/|g" \
		${worksrcpath}/include/atalk/paths.h
}

configure.args	--with-bdb=${prefix} \
				--mandir=${prefix}/share/man \
				--with-logfile=${prefix}/var/log/netatalk.log \
				--with-spooldir=${prefix}/var/spool/netatalk \
				--enable-a2boot
configure.env	CFLAGS=-I${prefix}/include \
				LDFLAGS=-L${prefix}/lib

post-destroot	{
	file delete -force ${destroot}${prefix}/sbin/atalkd \
		${destroot}${prefix}/share/netatalk ${destroot}/etc
	xinstall -m 755 -d ${destroot}${prefix}/var/log/ \
		${destroot}${prefix}/var/run/netatalk \
		${destroot}${prefix}/var/spool/netatalk
	system "touch ${destroot}${prefix}/var/log/netatalk.log"
	system "touch ${destroot}${prefix}/var/run/netatalk/afpd"
	system "touch ${destroot}${prefix}/var/spool/netatalk/.turd"
}
