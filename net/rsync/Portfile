# $Id$

PortSystem          1.0

name                rsync
version             3.0.3
revision            1
categories          net
platforms           darwin freebsd sunos
maintainers         simon openmaintainer
description         Tool that provides fast incremental file transfer.
long_description    rsync is an open source utility that provides fast \
                    incremental file transfer. rsync is freely available \
                    under the GNU General Public License and is currently \
                    being maintained by Wayne Davison. \
                    \
                    Rsync version 3.0.3 has been released. This is a \
                    security release that fixes a potential buffer-overflow \
                    issue. Related pages: \
                    http://rsync.samba.org/ftp/rsync/rsync-${version}-NEWS

homepage            http://samba.org/rsync/
master_sites        http://rsync.samba.org/ftp/rsync/ \
                    http://rsync.samba.org/ftp/rsync/src/
checksums           ${distname}${extract.suffix} \
                        md5 16d41aab9ece435198af222c5415a304 \
                        sha1 c12668eb888e386511299616f6972bec300ed346 \
                        rmd160 9997a18cb5577bb127b26bcc55e50382b6e9f68d \
                    fileflags.diff \
                        md5 201757ade9b8d8077f6aaa348f579d5a \
                        sha1 ad6ff8da7c1466564ec793f0fd9c8ac1d67a0c8a \
                        rmd160 c99605939aa36663c73a6e7a07fa2f751235239b \
                    crtimes.diff \
                        md5 7941d2487b12fda621794ddae687e115 \
                        sha1 19ea5a3a14373839776c58aba6c6b21ca0b7c816 \
                        rmd160 70c0a00a15fbf2d64bd7b0a406119fec976dc7ca
distname            rsync-${version}

depends_lib         port:popt port:libiconv

patch_sites         http://rsync.samba.org/ftp/rsync/patches/
patchfiles          fileflags.diff \
                    crtimes.diff
patch.pre_args      -p1

configure.args      --mandir=${prefix}/share/man \
                    --with-rsyncd-conf=${prefix}/etc/rsyncd.conf \
                    --enable-ipv6 \
                    --enable-xattr-support
configure.cflags   "-Os -I${prefix}/include"

pre-configure {
    system "cd ${worksrcpath}; ./prepare-source"
}

post-destroot {
    xinstall -m 755 -d ${destroot}${prefix}/share/doc/${name}
    xinstall -m 644 -W ${worksrcpath} \
                    COPYING INSTALL NEWS OLDNEWS TODO README doc/README-SGML \
                    doc/profile.txt doc/rsync.sgml \
                    ${destroot}${prefix}/share/doc/${name}
}

livecheck.check     regex
livecheck.regex     "Rsync version (\\d+(?:\\.\\d+)*) released"

variant no_macosx_metadata description {Don't preserve Mac OS X file \
                                        flags and creation times} {
    patchfiles-delete   fileflags.diff \
                        crtimes.diff
}
