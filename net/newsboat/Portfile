# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           cxx11 1.1

name                newsboat
version             2.11.1
categories          net www
platforms           darwin
license             MIT
maintainers         {en.sent.com:macports @Raimondi} openmaintainer
description         a fork of Newsbeuter, an RSS/Atom feed reader for the text console
long_description    Newsboat is ${description}. The only difference is that \
                    Newsboat is actively maintained while Newsbeuter isn't.
homepage            https://newsboat.org/
master_sites        https://newsboat.org/releases/${version}/

use_xz              yes

checksums           rmd160  e1f342f3d430c1b496296fa150c7272342e981f0 \
                    sha256  aab67dcd386a3512812e1af0fddb8e1f4dce08d2a106946fe5ad405210ed37cf

depends_build       port:asciidoc \
                    port:docbook-xsl-nons \
                    port:pkgconfig

depends_lib         port:curl \
                    port:gettext \
                    port:json-c \
                    port:libxml2 \
                    port:ncurses \
                    port:sqlite3 \
                    port:stfl

post-extract {
    # Fix permissions
    fs-traverse f ${worksrcpath} {
        if {[file isdirectory ${f}]} {
            file attributes ${f} -permissions o+rx
        } else {
            file attributes ${f} -permissions o+r
        }
    }
}

patchfiles          patch-Makefile.diff

use_configure       no

# universal variant needs to be defined for [get_canonical_archflags] to work
variant universal {}

build.args-append   prefix=${prefix} \
                    CXX=${configure.cxx}
build.target-append doc
build.env-append    CXXFLAGS="${configure.cxxflags} [get_canonical_archflags cxx]" \
                    LDFLAGS="${configure.ldflags} [get_canonical_archflags ld]"

destroot.args-append \
                    prefix=${prefix}

post-destroot {
    xinstall -d ${destroot}${prefix}/share/${name}
    copy ${worksrcpath}/contrib ${destroot}${prefix}/share/${name}/contrib
}

livecheck.type      regex
livecheck.url       ${homepage}
livecheck.regex     {The current version is (\d+(?:\.\d+)*),}
