# $Id$

PortSystem          1.0

name                ejabberd
version             2.0.2
categories          net
platforms           darwin
maintainers         simon openmaintainer
description         ejabberd is an XMPP application server.
long_description    ${description} ejabberd stands for "Erlang Jabber Daemon"

homepage            http://www.process-one.net/en/ejabberd/
master_sites        http://www.process-one.net/downloads/ejabberd/${version}/
checksums           md5 eef7ab12fc1e3ed34669bb2d5e1d0448 \
                    sha1 7c82082b941277fe18aac25ca9b2016f25dc8472 \
                    rmd160 b24c1c2d6ce8c56fd26f28a98b89d99890dbad72
worksrcdir          ${worksrcdir}/src

depends_lib         port:erlang \
                    port:expat \
                    port:openssl \
                    port:libiconv \
                    port:zlib

configure.args      --with-expat=${prefix} \
                    --with-zlib=${prefix} \
                    --with-openssl=${prefix}

# All ejabberd configuration files.
set conf_files      {ejabberd.cfg ejabberdctl.cfg inetrc}

destroot.keepdirs   ${destroot}${prefix}/var/log/ejabberd/

post-destroot {
    # Create sample configuration files so they don't get overwritten by an
    # update.
    set etc ${destroot}${prefix}/etc/ejabberd
    foreach file ${conf_files} {
        file rename ${etc}/${file} ${etc}/${file}.sample
    }

    # Install documentation.
    set doc ${destroot}${prefix}/share/doc
    xinstall -d ${doc}
    file copy ${worksrcpath}/../doc ${doc}/${name}-${version}
}

post-install {
    ui_msg "****************************************************************"
    ui_msg "*                                                              *"
    ui_msg "* If you run ejabberd for the first time, then you must rename *"
    ui_msg "* the following configuration files by removing the .sample    *"
    ui_msg "* extension:                                                   *"
    ui_msg "*                                                              *"
    ui_msg "* cd ${prefix}/etc/ejabberd/                                  *"
    foreach file ${conf_files} {
        ui_msg "* mv ${file}.sample ${file}"
    }
    ui_msg "*                                                              *"
    ui_msg "****************************************************************"
}

livecheck.check     regex
livecheck.url       ${homepage}release_notes
livecheck.regex     "${name} (\\d+(?:\\.\\d+)*)"
