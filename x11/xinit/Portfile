# $Id$

PortSystem          1.0

name                xinit
version             1.1.0
revision            2
categories          x11
platforms           darwin
maintainers         jeremyhu
description         X11 startup script processor
long_description    xinit is responsible for configuring the initial environment \
		    when X11 starts up.

homepage            http://www.x.org
master_sites        ${homepage}/pub/individual/app/

checksums           md5     9144097186c3d2454beffe8ac3b53c6e \
                    sha1    c4d3d8314ddd94c4950349d23a3e387af65186da \
                    rmd160  d2631bd7eea0ce702b2b4d380e28365dab4fef83
use_bzip2	    yes
use_parallel_build  yes

depends_build       port:pkgconfig \
                    port:xorg-util-macros \
                    port:libtool \
                    port:autoconf \
                    port:automake

depends_lib         lib:libX11.6:xorg-libX11

configure.pkg_config_path ${x11prefix}/lib/pkgconfig

patchfiles          tiger_support.patch

use_autoconf yes
autoconf.cmd autoreconf
autoconf.args -fvi

pre-configure {
	reinplace "s|org.x|org.macports|" ${worksrcpath}/privileged_startx/org.x.privileged_startx.plist.cpp
	reinplace "s|org.x|org.macports|" ${worksrcpath}/privileged_startx/privileged_startx_types.h
	reinplace "s|org.x|org.macports|" ${worksrcpath}/privileged_startx/server.c
	reinplace "s|org.x|org.macports|" ${worksrcpath}/startx.cpp
}

post-destroot {
	file delete -force ${destroot}/Library/LaunchAgents/org.x.startx.plist
	move ${destroot}/Library/LaunchDaemons/org.x.privileged_startx.plist ${destroot}/Library/LaunchDaemons/org.macports.privileged_startx.plist

	xinstall -d ${destroot}${prefix}/lib/X11/xinit/xinitrc.d
	eval xinstall -m 755 [glob ${filespath}/xinitrc.d/*.sh] ${destroot}${prefix}/lib/X11/xinit/xinitrc.d

	xinstall -m 755 ${filespath}/font_cache.sh ${destroot}${prefix}/bin/font_cache
	reinplace "s|^X11DIR=.*$|X11DIR=${prefix}|" ${destroot}${prefix}/bin/font_cache
}
