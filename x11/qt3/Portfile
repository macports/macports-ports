# $Id: Portfile,v 1.44 2006/03/01 07:18:16 takanori Exp $

PortSystem 1.0
name		qt3
version		3.3.5
categories	x11
maintainers	ben@opendarwin.org takanori@opendarwin.org
description	Qt Tool Kit
long_description Qt 3 is a multiplatform C++ application development framework.
homepage	http://www.trolltech.com/products/qt/index.html
platforms	darwin
master_sites	ftp://ftp.trolltech.com/qt/source/
distname	qt-x11-free-${portversion}
use_bzip2	yes

depends_lib	lib:libGL.1:XFree86 \
		port:cups-headers \
		port:freetype \
		port:libpng \
		port:jpeg \
		port:perl5.8 \
		port:xrender \
		port:Xft2 \
		port:zlib

checksums	md5 05d04688c0c0230ed54e89102d689ca4

platform i386 {
		patchfiles-delete qt3.patch
		patchfiles-append qt3-intel.patch
}

platform darwin 8 {
post-patch	{
		reinplace "s|#define QT_AOUT_UNDERSCORE||g" \
			  ${worksrcpath}/mkspecs/darwin-g++/qplatformdefs.h
}
}

platform darwin 7 {
post-patch	{
		reinplace "s|#define QT_AOUT_UNDERSCORE||g" \
			  ${worksrcpath}/mkspecs/darwin-g++/qplatformdefs.h
}
}

platform darwin 6 {
	 	depends_lib-append lib:libdl:dlcompat
		configure.args-delete -lresolv
}

variant mysql {
		depends_lib-append lib:libmysqlclient.10:mysql
		configure.args-append -qt-sql-mysql -L${prefix}/lib/mysql \
			-I${prefix}/include/mysql -plugin-sql-mysql
}

variant odbc {
		depends_lib-append lib:libodbc.1:unixODBC
		configure.args-append -qt-sql-odbc -L${prefix}/lib \
			-I${prefix}/include -plugin-sql-odbc
}

variant psql {
		depends_lib-append lib:libpq.2:postgresql
		configure.args-append -qt-sql-psql -plugin-sql-psql
}

patch.args      -p1
patchfiles      qt3.patch

post-patch	{
		reinplace "s|@PREFIX@|${prefix}|g" \
		${worksrcpath}/mkspecs/darwin-g++/qmake.conf
}

configure.env	DYLD_LIBRARY_PATH='${worksrcpath}/lib' \
		INSTALL_ROOT='' \
		QMAKESPEC='${worksrcpath}/mkspecs/darwin-g++' \
		QTDIR='${worksrcpath}' \
		PREFIX='${prefix}' \
		NAME=qt3

configure.pre_args  {}

configure.cmd   export DYLD_FALLBACK_LIBRARY_PATH INSTALL_ROOT QMAKESPEC \
		QTDIR PREFIX NAME && cd ${worksrcpath} && \
		echo yes | sh ./configure

configure.args  -L${prefix}/lib -L/usr/X11R6/lib -L${worksrcpath}/lib \
		-I${prefix}/include -I/usr/X11R6/include -I${worksrcpath}/include \
		-buildkey qt3-jaguar \
		-platform darwin-g++ -xplatform darwin-g++ \
                -translationdir ${prefix}/share/qt3/translations \
		-prefix ${prefix} -bindir ${prefix}/bin \
		-libdir ${prefix}/lib -docdir ${prefix}/share/doc/qt3 \
		-datadir ${prefix}/share/qt3 -headerdir ${prefix}/include/qt3 \
		-plugindir ${prefix}/lib/qt3-plugins \
                -release -shared -no-exceptions -thread -stl \
		-qt-gif -plugin-imgfmt-png \
                -plugin-imgfmt-jpeg -plugin-imgfmt-mng \
		-system-libpng -system-libjpeg -system-zlib \
		-largefile -sm -xinerama -xrender -xft -xkb \
		-lresolv -cups

build.env       ${configure.env}

build.cmd	export DYLD_FALLBACK_LIBRARY_PATH INSTALL_ROOT QMAKESPEC \
		QTDIR PREFIX NAME && cd ${worksrcpath} && make 

build.target	symlinks src-qmake src-moc sub-src sub-tools

build.args	{}

destroot.env    PREFIX='${destroot}${prefix}' \
		VERSION='${version}' \
		WORKSRCPATH=${worksrcpath}
destroot.cmd	sh ${portpath}/${filesdir}/qt-install.sh
destroot.args	 {}
destroot.destdir {}
destroot.target  {}
