PortSystem 1.0
name		qt3
version		3.0.5
revision	1
categories	x11
maintainers	ranger@befunk.com
description	Qt Tool Kit
platforms	darwin
master_sites	ftp://ftp.trolltech.com/qt/source/
distname	qt-x11-free-${portversion}
extract.sufx	.tar.bz2
use_bzip2	yes
patchfiles	patch-qt-3.0.5-darwin patch-qt-3.0.5-iaccept
depends_lib	lib:libdl.1:dlcompat lib:libGL.1:XFree86 lib:libX11.6:Xfree86 \
		lib:libfreetype.6:XFree86 lib:libpng.2:libpng lib:libjpeg.9:jpeg
checksums	qt-x11-free-3.0.5.tar.bz2 md5 3c937bf8f39a29af0a17b2a2b156790e

# FIXME: add xft2 variant support when variant requires are implemented
#default_variants +xft2
#variant xft2 requires lib:libXft.2 { patchfiles-append patch-qt-3.0.5-xft2 }

variant mysql {
		depends_lib-append lib:libmysqlclient.10:mysql
		configure.args-append -qt-sql-mysql -plugin-sql-mysql
}
variant psql {
		depends_lib-append lib:libpq.2:postgresql
		configure.args-append -qt-sql-psql -plugin-sql-psql
}

patch {
		foreach patch $patchfiles {
			system "cd '${workpath}/${distname}' && \
			sed -e 's#@PREFIX@#${prefix}#g' '${portpath}/${filedir}/${patch}' | patch -p1"
		}
}

configure.env	CPPFLAGS='-I${prefix}/include' QTDIR='${worksrcpath}' \
		QMAKESPEC='${worksrcpath}/mkspecs/darwin-g++' \
		LDFLAGS='-L. -L${worksrcpath}/lib -L${prefix}/lib' \
		DYLD_LIBRARY_PATH='${worksrcpath}/lib'

configure.args	-prefix '${prefix}' -bindir '${prefix}/bin' \
		-docdir '${prefix}/share/doc/${portname}/html' \
		-datadir '${prefix}/share/qt3' -headerdir '${prefix}/include/qt3' \
		-libdir '${prefix}/lib' -plugindir '${prefix}/lib/qt3-plugins' \
		-system-zlib -system-libpng -system-libjpeg -qt-gif \
		-plugin-imgfmt-png -qt-imgfmt-png -plugin-imgfmt-jpeg \
		-qt-imgfmt-jpeg -plugin-imgfmt-mng -qt-imgfmt-mng \
		-no-g++-exceptions -stl -thread -shared -sm -xft -xrender \
		-xkb -xinerama -platform darwin-g++ -xplatform darwin-g++ \
		-buildkey qt3-jaguar

build.env	${configure.env}
install.target	"install INSTALLPREFIX=${prefix}"

include         contents

long_description This is Qt, TrollTech's C++ toolkit for writing \
cross-platform GUI applications.
