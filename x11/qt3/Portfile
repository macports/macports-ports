PortSystem 1.0
name		qt3
version		3.1.1
revision	1
categories	x11
maintainers	ranger@befunk.com, leimy@opendarwin.org
description	Qt Tool Kit
platforms	darwin
master_sites	ftp://ftp.trolltech.com/qt/source/
distname	qt-x11-free-${portversion}
extract.sufx	.tar.bz2
use_bzip2	yes
patchfiles	patch-qt-3.1.1-3.darwin
depends_lib	lib:libdl.1:dlcompat lib:libGL.1:XFree86 lib:libX11.6:Xfree86 \
		lib:libfreetype.6:XFree86 lib:libpng.2:libpng lib:libjpeg.9:jpeg
checksums	qt-x11-free-3.1.1.tar.bz2 md5 977b9f59eed14f33343a797544b5418a

variant mysql {
		depends_lib-append lib:libmysqlclient.10:mysql
		configure.args-append -qt-sql-mysql -plugin-sql-mysql
}
variant psql {
		depends_lib-append lib:libpq.2:postgresql
		configure.args-append -qt-sql-psql -plugin-sql-psql
}

#variant cups {
#		depends_lib-append lib:cups-headers
#		configure.args-append -cups
#}

patch {
		foreach patch $patchfiles {
			system "cd '${workpath}/${distname}' && \
			sed -e 's#@PREFIX@#${prefix}#g' '${portpath}/${filedir}/${patch}' | patch -p1"
		}
}

configure.cmd   echo "yes" | ./configure

configure.env	\
		CFLAGS='-I${prefix}/include' \
		CPPFLAGS='-I${prefix}/include' \
		DYLD_LIBRARY_PATH='${worksrcpath}/lib:${prefix}/lib' \
		INSTALL_ROOT='' \
		INSTALLPREFIX='${prefix}' \
		LDFLAGS='-L. -L${worksrcpath}/lib -L${prefix}/lib' \
		QMAKESPEC='${worksrcpath}/mkspecs/darwin-g++' \
		QTDIR='${worksrcpath}' \

configure.args	-I'${worksrcpath}/include' -I'${prefix}/include' -I'/usr/X11R6/include/freetype2' \
		-L'${prefix}/lib' -buildkey qt3-jaguar -platform darwin-g++ -xplatform darwin-g++ \
		-prefix '${prefix}' -bindir '${prefix}/bin' -libdir '${prefix}/lib' \
		-docdir '${prefix}/share/doc/${portname}/html' -datadir '${prefix}/share/qt3' \
		-headerdir '${prefix}/include/qt3' -plugindir '${prefix}/lib/qt3-plugins' \
		-release -shared -fast -no-exceptions -thread -stl -qt-gif -plugin-imgfmt-png \
		-plugin-imgfmt-jpeg -plugin-imgfmt-mng -system-libpng -system-libjpeg \
		-system-zlib -largefile -sm -xinerama -xrender -xft -xkb \
		-DQ_OS_DARWIN -DQ_OS_FREEBSD

build.env	${configure.env}
build.target	INSTALLPREFIX="${prefix}" symlinks src-qmake src-moc sub-src sub-tools
install.cmd	sh ${portpath}/${filedir}/qt-install.sh
install.args	PREFIX="${prefix}" VERSION="${version}"
install.destroot	DESTROOT="${destroot}"
install.target

long_description This is Qt, TrollTech's C++ toolkit for writing \
cross-platform GUI applications.
