# $Id: Portfile,v 1.1 2005/08/14 13:17:02 yves Exp $

PortSystem   1.0
name         gnustep-back
version      0.10.0

description  A back-end component for the GNUstep GUI Library.
long_description \
    The implementation of the GNUstep GUI Library is designed \
    in two parts.  The first part is the front-end component \
    which is independent of platform and display system.  \
    This front-end is combined with a back-end component \
    which handles all of the display system dependent \
    such as specific calls to the X Window System.

platforms     darwin
categories    x11 gnustep devel cross
maintainers   yves@opendarwin.org
homepage      http://www.gnustep.org/
master_sites  http://ftp.easynet.nl/mirror/GNUstep/pub/gnustep/core/ \
              ftp://ftp.easynet.nl/mirror/GNUstep/pub/gnustep/core/ \
              http://www.peanuts.org/peanuts/Mirrors/GNUstep/gnustep/core/ \
              http://ftpmain.gnustep.org/pub/gnustep/core/ \
              ftp://ftp.gnustep.org/pub/gnustep/core/ \
              http://archive.progeny.com/gnustep/core/ \
              ftp://archive.progeny.com/gnustep/core/ \
              http://w1.423.telia.com/~u42308495/alex/backart/:fonts
distfiles     ${distname}.tar.gz \
              ArtResources-0.1.2.tar.bz2:fonts
checksums     ${distname}.tar.gz md5 8031e2d93b4d3359e167be620d1925fb \
              ArtResources-0.1.2.tar.bz2 md5 4a30d1f3b05d73d13e10264df62ae982

extract {
    system "cd ${workpath} &&
        gzip -dc ${distpath}/${distname}.tar.gz | gnutar --no-same-owner -xf - &&
        bzip2 -dc ${distpath}/ArtResources-0.1.2.tar.bz2 | gnutar --no-same-owner -xf -"
}
depends_lib   lib:libX11.6:xorg port:gnustep-gui port:libart_lgpl

patchfiles    patch-Source-GNUmakefile.preamble

configure.args   --enable-graphics=art CC=gcc-dp-4.0
configure {
    system ". ${prefix}/GNUstep/System/Library/Makefiles/GNUstep.sh &&
        cd ${worksrcpath} &&
        ./configure ${configure.pre_args} ${configure.args}"
}

build.args    messages=yes
build {
    system ". ${prefix}/GNUstep/System/Library/Makefiles/GNUstep.sh &&
        cd ${worksrcpath} &&
        ${build.cmd} ${build.args}"
}

destroot.args messages=yes \
              GNUSTEP_INSTALLATION_DIR=${destroot}${prefix}/GNUstep/System
destroot {
    system ". ${prefix}/GNUstep/System/Library/Makefiles/GNUstep.sh &&
        cd ${worksrcpath} &&
        ${destroot.cmd} ${destroot.target} ${destroot.args}"
}
post-destroot {
	cd ${workpath}
	system "make install \
	    FONT_DEST=${destroot}${prefix}/GNUstep/System/Library/Fonts \
	    GNUSTEP_INSTALLATION_DIR=${destroot}${prefix}/GNUstep/System"
    file delete -force ${destroot}${prefix}/share/man
	file rename \
	    ${destroot}${prefix}/GNUstep/System/Library/Documentation/man \
	    ${destroot}${prefix}/share
}

post-install {
	ui_msg "\n\
	        In order to have a working GNUstep environment,\n\
	        copy these lines at the top of your ~/.xinitrc file :\n\n\
	        . ${prefix}/GNUstep/System/Library/Makefiles/GNUstep.sh\n\
            opentool gdnc &\n\
            opentool gpbs &\n"
}
