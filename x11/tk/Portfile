# $Id$

PortSystem      1.0
name            tk
version         8.4.14
revision        1
categories      x11
maintainers     nomaintainer@macports.org
description     Tcl Tool Kit
long_description    This is Tk version ${version}, a GUI toolkit for Tcl. \
            The best way to get started with Tcl is to read \
            ``Tcl and the Tk Toolkit'' by John K. Ousterhout, \
            Addison-Wesley, ISBN 0-201-63337-X. 
platforms       darwin
master_sites    sourceforge:tcl
dist_subdir     tcltk
distname        ${name}${version}-src
worksrcdir      ${name}${version}/unix
checksums       ${distname}${extract.suffix} md5 d12f591f5689f95c82bfb9c1015407bb \
                sha1 d3a8d1240fe37408a3d39613cb1d845764b7a5b1 \
                rmd160 055ea75b91fe0e33ac9d96bd3b9099622008820e
# suck in Tcl as well so we can use it internally.
distfiles-append    tcl${version}-src${extract.suffix}
checksums-append    tcl${version}-src${extract.suffix} md5 51c6bf74d3ffdb0bd866ecdac6ff6460 \
                    sha1 d7af7e0c7ed563e2344dda04bbe49961589244dd \
                    rmd160 392a4f4617ee77cfdae10b24e9ccbe84afed0a40
destroot.destdir    INSTALL_ROOT=${destroot}
configure.args      --mandir=${prefix}/share/man --with-tcl=${prefix}/lib
# force usage of DP Tcl
depends_lib         port:tcl lib:libX11.6:XFree86

configure.env       CFLAGS=-I${worksrcpath}/../../tcl${version}/generic

variant aqua {
    configure.args-append   --enable-aqua
}

post-patch {
    reinplace s|@TCL_SRC_DIR@|${worksrcpath}/../../tcl${version}/|g ${worksrcpath}/Makefile.in
}

post-destroot {
    cd ${destroot}${prefix}/bin
    system "ln -s ${prefix}/bin/wish8.4 wish"
    cd ${destroot}${prefix}/lib
    system "ln -s ${prefix}/lib/libtk8.4.dylib libtk.dylib"
    
    # For some reason the aqua variant installs old X11 headers -> delete
    if {[variant_isset aqua]} {
        delete ${destroot}${prefix}/include/X11
    }
}
