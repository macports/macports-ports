# $Id$

PortSystem      1.0
name            tk
version         8.4.15
categories      x11
maintainers     nomaintainer@macports.org
description     Tcl Tool Kit
long_description \
  This is Tk version ${version}, a GUI toolkit for Tcl. The best way to get \
  started with Tcl is to read ``Tcl and the Tk Toolkit'' by John K.         \
  Ousterhout, Addison-Wesley, ISBN 0-201-63337-X. 

platforms       darwin
master_sites    sourceforge:tcl
dist_subdir     tcltk
distname        ${name}${version}-src
worksrcdir      ${name}${version}/unix
checksums \
  ${distname}${extract.suffix} \
    md5 68777568d818e1980dda4b6b02b92f1a \
    sha1 832b39fc3e64dcbbfff4fc192e33d3fc8ef76c43 \
    rmd160 8facb8033ce811097a3568373581687a749dda2d
# suck in Tcl as well so we can use it internally.
distfiles-append    tcl${version}-src${extract.suffix}
checksums-append \
  tcl${version}-src${extract.suffix} \
    md5 5e1b71eef1f75a294072aa3218f62b66 \
    sha1 fbfae3ca68633a10b3fe870018588ade0944caed \
    rmd160 b6b41cb5ae18744ba5aa7fdf3d64277d97d8546e

destroot.destdir    INSTALL_ROOT=${destroot}
configure.args      --mandir=${prefix}/share/man --with-tcl=${prefix}/lib
# force usage of DP Tcl
depends_lib         port:tcl lib:libX11.6:XFree86

configure.cppflags-append \
  -I${worksrcpath}/../../tcl${version}/generic

variant aqua {
    configure.args-append   --enable-aqua
}

post-patch {
    reinplace s|@TCL_SRC_DIR@|${worksrcpath}/../../tcl${version}/|g ${worksrcpath}/Makefile.in
}

post-destroot {
    cd ${destroot}${prefix}/bin
    ln -s ${prefix}/bin/wish8.4 wish
    cd ${destroot}${prefix}/lib
    ln -s ${prefix}/lib/libtk8.4.dylib libtk.dylib
    
    # For some reason the aqua variant installs old X11 headers -> delete
    if {[variant_isset aqua]} {
        delete ${destroot}${prefix}/include/X11
    }
}
