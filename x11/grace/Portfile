# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                grace
version             5.1.24
categories          x11 math science print
license             GPL-2+
platforms           darwin
maintainers         nomaintainer
description         WYSIWYG tool to make two-dimensional plots of numerical data
long_description    ${description}
use_parallel_build  yes

homepage            http://plasma-gate.weizmann.ac.il/Grace/
set sub             grace/src/stable/
master_sites        ftp://ftp.fu-berlin.de/unix/graphics/${sub} \
                    ftp://ftp.u-aizu.ac.jp/pub/SciEng/math/${sub}

checksums           rmd160  39ef831117ca4ebb0f7edfa1a32129a97f9b40c6 \
                    sha256  25767a0d465e2fe999c50b05001aef1f4bf99315c55fdaecf1c52cb0e9be5fec

depends_lib         lib:libXm:openmotif \
                    port:jpeg \
                    port:libpng \
                    port:pdflib \
                    port:xorg-libXmu \
                    port:xorg-libXp \
                    port:xpm \
                    port:zlib

depends_run         port:openbrowser

patchfiles          patch-configure.diff \
                    patch-doc-Makefile.diff

# The default optimization level apparently causes xmgrace to crash for some users.
configure.optflags  -O1
configure.pre_args  --prefix=${prefix}/lib
configure.args      --with-helpviewer="${prefix}/bin/openbrowser ${prefix}/share/doc/${name}/`basename %s`" \
                    --x-include=${prefix}/include --x-lib=${prefix}/lib

post-destroot {
    xinstall -m 755 -d ${destroot}${prefix}/share/doc
    file delete ${destroot}${prefix}/bin
    file rename ${destroot}${prefix}/lib/grace/bin ${destroot}${prefix}/bin
    file rename ${destroot}${prefix}/lib/grace/doc ${destroot}${prefix}/share/doc/${name}
    file rename ${destroot}${prefix}/lib/grace/examples ${destroot}${prefix}/share/doc/${name}/examples
    file rename ${destroot}${prefix}/lib/grace/include/grace_np.h ${destroot}${prefix}/include/grace_np.h
    file rename ${destroot}${prefix}/lib/grace/lib/libgrace_np.a ${destroot}${prefix}/lib/libgrace_np.a
    system "cd ${destroot}${prefix}/share/doc/${name} && ln -s . doc"
    system "cd ${destroot}${prefix}/share && mv doc/grace/*.1 man/man1/"
}

variant netcdf description {Support for NetCDF data files} {
  depends_lib-append        port:netcdf
  configure.args-append     --enable-netcdf
}

livecheck.type      regex
livecheck.url       [lindex ${master_sites} 0]
livecheck.regex     ${name}-(\[0-9.\]+)${extract.suffix}
