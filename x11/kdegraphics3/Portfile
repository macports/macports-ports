# $Id: Portfile,v 1.15 2005/04/04 10:08:40 jkh Exp $

PortSystem 1.0
name		kdegraphics3
version		3.1.2
revision	2
categories	x11
maintainers	darwinports@opendarwin.org
description	graphics manipulation programs

platforms	darwin
master_sites	kde:stable/${version}/src http://ranger.befunk.com/fink/:admin http://ranger.befunk.com/darwin/:darwin
extract.suffix	.tar.bz2
use_bzip2	yes
distname	kdegraphics-${version}
distfiles	${distname}.tar.bz2 kde-admindir-20030601.tar.bz2:admin detect-autoconf.tar.bz2:darwin
depends_lib	lib:libDCOP:kdelibs3 lib:libImlib:imlib lib:libart_lgpl_2:libart_lgpl \
		lib:libfreetype:freetype lib:libjpeg:jpeg lib:libkdecore.4:kdelibs3 \
		bin:startkde:kdebase3 lib:libpng.3:libpng lib:libtiff:tiff \
		lib:libqt-mt.3.1:qt3 lib:libX11.6:XFree86

checksums	kdegraphics-${version}.tar.bz2 md5 05a791e5b685e35d3e05d23d2d467678 \
		kde-admindir-20030601.tar.bz2 md5 6135f81de4b1561942be8fd31ae21297 \
		detect-autoconf.tar.bz2 md5 1f511627496be40174169dbab4d6d78a

set env(PATH) "/usr/X11R6/bin:$env(PATH):${prefix}/bin"

platform darwin 6 { depends_lib-append lib:libdl:dlcompat }

variant darwin {
		patchfiles \
			stable/patch-kdegraphics-kcoloredit-Makefile.am.diff \
			stable/patch-kdegraphics-kdvi-font.cpp.diff \
			stable/patch-kdegraphics-kghostview-kpswidget.cpp.diff \
			stable/patch-kdegraphics-kghostview-Makefile.am.diff \
			stable/patch-kdegraphics-kmrml-kmrml-Makefile.am.diff \
			stable/patch-kdegraphics-kmrml-kmrml-server-Makefile.am.diff \
			stable/patch-kdegraphics-kooka-configure.in.in.diff \
			stable/patch-kdegraphics-kpovmodeler-configure.in.in.diff \
			stable/patch-kdegraphics-kpovmodeler-Makefile.am.diff \
			stable/patch-kdegraphics-kruler-Makefile.am.diff \
			stable/patch-kdegraphics-ksnapshot-Makefile.am.diff \
			stable/patch-kdegraphics-kuickshow-configure.in.in.diff \
			stable/patch-kdegraphics-kuickshow-src-Makefile.am.diff \
			stable/patch-kdegraphics-kview-kviewviewer-Makefile.am.diff \
			stable/patch-kdegraphics-kview-Makefile.am.diff \
			stable/patch-kdegraphics-kviewshell-Makefile.am.diff
}

variant cvs {
		version 3.2
		revision 0

		##### THIS IS UNSUPPORTED, DO NOT USE THIS IN YOUR PORTS! #####
		cvs.root :pserver:anonymous@anoncvs.kde.org:/home/kde
		cvs.module kdegraphics
		pre-extract {
			cvsfetch
		}
		##### I MEAN IT, LANDONF WILL KILL YOU IF YOU DO THIS! #####

		distname kdegraphics
		distfiles kde-admindir-cvs-20030701.tar.bz2:admin
		checksums kde-admindir-cvs-20030701.tar.bz2 md5 b9bf2dc286d2e434c2cfdadc421c79b6

		patchfiles
}

patch {
		foreach patch $patchfiles {
			system "cd '${workpath}/${distname}' && \
			sed -e 's#@PREFIX@#${prefix}#g' '${portpath}/${filesdir}/${patch}' | patch -p0"
		}
}
post-patch      {
		system "cd '${worksrcpath}' && cp -Rf ../admin/ admin"
		system "cd '${worksrcpath}' && make -f admin/Makefile.common cvs"
}
configure.env	CPPFLAGS='-I/usr/X11R6/include -I${prefix}/include -I${prefix}/include/qt3 -no-cpp-precomp -fno-common' \
		LDFLAGS='-L/usr/X11R6/lib' LIBS='-L${prefix}/lib' DYLD_LIBRARY_PATH='${prefix}/lib'
configure.args	--prefix='${prefix}' --includedir='${prefix}/include' --libdir='${prefix}/lib' \
		--with-extra-includes='${prefix}/include' --with-extra-libs='${prefix}/lib' \
		--with-qt-dir='${prefix}' --with-qt-includes='${prefix}/include/qt3' \
		--enable-rpath --with-pic --enable-shared=yes --enable-static=no --enable-mt \
		--libexecdir='${prefix}/lib' --with-xinerama --with-pam --disable-final \
		--disable-dependency-tracking
build.env	${configure.env}
