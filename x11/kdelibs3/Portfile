# $Id: Portfile,v 1.28 2005/04/04 10:08:40 jkh Exp $

PortSystem 1.0
name		kdelibs3
version		3.1.2
revision	4
categories	x11
maintainers	darwinports@opendarwin.org
description	essential libraries for KDE applications

platforms	darwin
master_sites	\
		kde:Attic/${version}/src \
		http://ranger.befunk.com/fink/:admin \
		http://ranger.befunk.com/darwin/:darwin
extract.suffix	.tar.bz2
use_bzip2	yes
distname	kdelibs-${version}
distfiles	${distname}.tar.bz2 kde-admindir-20030601.tar.bz2:admin detect-autoconf.tar.bz2:darwin
depends_lib	lib:libart_lgpl_2:libart_lgpl lib:libartsflow.1:arts \
		lib:libaudiofile.0:audiofile lib:libbz2:bzip2 lib:libiconv.2:libiconv \
		lib:libjpeg.62:jpeg lib:libmad:mad lib:libogg:libogg lib:libpcre:pcre \
		lib:libpng.3:libpng lib:libtiff.3:tiff lib:libqt-mt.3:qt3 \
		lib:libvorbis.0:libvorbis lib:libxml2.2:libxml2 lib:libxslt:libxslt \
		lib:libX11.6:XFree86 lib:libintl.3:gettext

checksums	kdelibs-${version}.tar.bz2 md5 2b896ce9a6942e4cc4fe1758236bafa3 \
		kde-admindir-20030601.tar.bz2 md5 6135f81de4b1561942be8fd31ae21297 \
		detect-autoconf.tar.bz2 md5 1f511627496be40174169dbab4d6d78a

set env(PATH) "/usr/X11R6/bin:$env(PATH):${prefix}/bin"

platform darwin 6 {
		depends_lib-append	lib:libdl:dlcompat
		depends_lib-append	lib:libpoll:poll-emulator
}

platform darwin 7 {
		depends_lib-append	lib:libpoll:poll-emulator
}

variant darwin {
		depends_lib-append path:${prefix}/include/cups/cups.h:cups-headers
		patchfiles \
			stable/patch-kdelibs-arts-kde-mcop-dcop-kmcop.cpp.diff \
			stable/patch-kdelibs-arts-kde-mcop-dcop-kmcop_main.cpp.diff \
			stable/patch-kdelibs-arts-kde-mcop-dcop-Makefile.am.diff \
			stable/patch-kdelibs-arts-knotify-knotify.cpp.diff \
			stable/patch-kdelibs-arts-knotify-Makefile.am.diff \
			stable/patch-kdelibs-arts-knotify-stub_main.cpp.diff \
			stable/patch-kdelibs-dcop-dcopserver.cpp.diff \
			stable/patch-kdelibs-dcop-dcopserver_main.cpp.diff \
			stable/patch-kdelibs-dcop-Makefile.am.diff \
			stable/patch-kdelibs-interfaces-kmediaplayer-Makefile.am.diff \
			stable/patch-kdelibs-interfaces-kscript-Makefile.am.diff \
			stable/patch-kdelibs-interfaces-kscript-sample-Makefile.am.diff \
			stable/patch-kdelibs-interfaces-ktexteditor-Makefile.am.diff \
			stable/patch-kdelibs-kab-Makefile.am.diff \
			stable/patch-kdelibs-kabc-Makefile.am.diff \
			stable/patch-kdelibs-kabc-plugins-ldap-configure.in.in.diff \
			stable/patch-kdelibs-kabc-vcard-Makefile.am.diff \
			stable/patch-kdelibs-kate-interfaces-Makefile.am.diff \
			stable/patch-kdelibs-kcert-Makefile.am.diff \
			stable/patch-kdelibs-kconf_update-kconf_update.cpp.diff \
			stable/patch-kdelibs-kconf_update-kconf_update_main.cpp.diff \
			stable/patch-kdelibs-kconf_update-Makefile.am.diff \
			stable/patch-kdelibs-kdecore-kiconloader.cpp.diff \
			stable/patch-kdelibs-kdecore-kstandarddirs.cpp.diff \
			stable/patch-kdelibs-kdecore-Makefile.am.diff \
			stable/patch-kdelibs-kdecore-svgicons-Makefile.am.diff \
			stable/patch-kdelibs-kded-kbuildsycoca.cpp.diff \
			stable/patch-kdelibs-kded-kbuildsycoca_main.cpp.diff \
			stable/patch-kdelibs-kded-kded.cpp.diff \
			stable/patch-kdelibs-kded-kded_main.cpp.diff \
			stable/patch-kdelibs-kded-Makefile.am.diff \
			stable/patch-kdelibs-kdeprint-cups-cupsdconf2-main.cpp.diff \
			stable/patch-kdelibs-kdeprint-cups-cupsdconf2-Makefile.am.diff \
			stable/patch-kdelibs-kdeprint-cups-cupsdconf2-stub_main.cpp.diff \
			stable/patch-kdelibs-kdeprint-management-Makefile.am.diff \
			stable/patch-kdelibs-kdeui-kedittoolbar.cpp.diff \
			stable/patch-kdelibs-kdeui-kxmlguifactory.cpp.diff \
			stable/patch-kdelibs-kdeui-Makefile.am.diff \
			stable/patch-kdelibs-kdoctools-Makefile.am.diff \
			stable/patch-kdelibs-khtml-java-dummy-Makefile.am.diff \
			stable/patch-kdelibs-khtml-Makefile.am.diff \
			stable/patch-kdelibs-kimgio-Makefile.am.diff \
			stable/patch-kdelibs-kinit-kinit.cpp.diff \
			stable/patch-kdelibs-kinit-Makefile.am.diff \
			stable/patch-kdelibs-kinit-setproctitle.cpp.diff \
			stable/patch-kdelibs-kinit-wrapper.c.diff \
			stable/patch-kdelibs-kio-kio-kurlcompletion.cpp.diff \
			stable/patch-kdelibs-kio-kio-kurlcompletion.h.diff \
			stable/patch-kdelibs-kio-kio-lex.c.diff \
			stable/patch-kdelibs-kio-kssl-kopenssl.cc.diff \
			stable/patch-kdelibs-kio-misc-kio_uiserver_main.cpp.diff \
			stable/patch-kdelibs-kio-misc-kpac-kpac_dhcp_helper.c.diff \
			stable/patch-kdelibs-kio-misc-Makefile.am.diff \
			stable/patch-kdelibs-kio-misc-uiserver.cpp.diff \
			stable/patch-kdelibs-kioslave-file-Makefile.am.diff \
			stable/patch-kdelibs-kioslave-ftp-Makefile.am.diff \
			stable/patch-kdelibs-kioslave-http-http.cc.diff \
			stable/patch-kdelibs-kioslave-http-http_cache_cleaner.cpp.diff \
			stable/patch-kdelibs-kioslave-http-kcookiejar-Makefile.am.diff \
			stable/patch-kdelibs-kioslave-http-Makefile.am.diff \
			stable/patch-kdelibs-kioslave-http-stub_main.cpp.diff \
			stable/patch-kdelibs-kparts-Makefile.am.diff \
			stable/patch-kdelibs-kspell-Makefile.am.diff \
			stable/patch-kdelibs-libkmid-Makefile.am.diff \
			stable/patch-kdelibs-libkscreensaver-Makefile.am.diff \
			stable/patch-kdelibs-libltdl-ltdl.c.diff \
			stable/patch-kdelibs-libltdl-ltdl.m4.diff
}

variant cvs {
		version 3.2
		revision 0

		##### THIS IS UNSUPPORTED, DO NOT USE THIS IN YOUR PORTS! #####
		cvs.root :pserver:anonymous@anoncvs.kde.org:/home/kde
		cvs.module kdelibs
		pre-extract {
			cvsfetch
		}
		##### I MEAN IT, LANDONF WILL KILL YOU IF YOU DO THIS! #####

		distname kdelibs
		distfiles kde-libtool-20030815.tar.bz2:admin
		checksums kde-libtool-20030815.tar.bz2 md5 27a4e3456d9d0d0e34101b95d185df37

		patchfiles \
			current/kdelibs.diff
}

variant aqua {
		configure.args-append --enable-mac --without-arts
		depends_lib-delete lib:libX11.6:XFree86
		depends_lib-delete lib:libartsflow.1:arts
		depends_lib-delete lib:libqt-mt.3:qt3
		depends_lib lib:libqt-mt.3:qt3-mac
}

patch {
		foreach patch $patchfiles {
			system "cd '${workpath}/${distname}' && \
			sed -e 's#@PREFIX@#${prefix}#g' '${portpath}/${filesdir}/${patch}' | patch -p0"
		}
}
post-patch      {
		system "cd '${worksrcpath}' && if test -d ../admin; then cp -Rf ../admin/ admin; fi"
		system "cd '${worksrcpath}' && if test -d ../libltdl; then cp -Rf ../libltdl/ libltdl; fi"
		system "cd '${worksrcpath}' && make -f admin/Makefile.common cvs"
}
configure.env	CPPFLAGS='-I/usr/X11R6/include -I${prefix}/include -I${prefix}/include/qt3 -no-cpp-precomp -fno-common' \
		LDFLAGS="-L/usr/X11R6/lib" LIBS='-L${prefix}/lib' DYLD_LIBRARY_PATH='${prefix}/lib'
configure.args	--prefix='${prefix}' --includedir='${prefix}/include' --libdir='${prefix}/lib' \
		--with-extra-includes='${prefix}/include' --with-extra-libs='${prefix}/lib' \
		--with-qt-dir='${prefix}' --with-qt-includes='${prefix}/include/qt3' \
		--enable-rpath --with-pic --enable-shared=yes --enable-static=no --enable-mt \
		--libexecdir='${prefix}/lib' --with-xinerama --with-pam --disable-final \
		--disable-dependency-tracking --enable-cups --with-ldap
build.env	${configure.env}
build.target	all apidox
