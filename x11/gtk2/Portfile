# $Id: Portfile,v 1.39 2005/12/11 23:27:29 rhwood Exp $

PortSystem 1.0
name		gtk2
version		2.8.9
categories	x11
maintainers	mij@opendarwin.org
description	Gimp ToolKit version 2
homepage	http://www.gtk.org/
platforms	darwin

long_description This is GTK+ version 2.x.  GTK+, which stands for Gimp \
		 ToolKit, is a library for creating GUIs for the X \
		 Windows System.

master_sites	ftp://ftp.gtk.org/pub/gtk/v2.8 \
		gnome:sources/gtk+/2.8

distname	gtk+-${portversion}
checksums	md5 e7a94132ae6353106c80cd4a1106a368 \
		sha1 8560c2ac2275bca7b9fd7d00c41555f95c638b82 \
		rmd160 3c458a11d22c7d658fcc65b969bf61d875a7559b

use_bzip2	yes

depends_lib	lib:libglib.2:glib2 lib:libtiff.3:tiff lib:libpng12.0:libpng \
		lib:libatk-1:atk lib:libpango.1:pango lib:libintl.3:gettext \
		lib:libX11.6:XFree86 port:cairo

configure.env	LDFLAGS="-L${prefix}/lib -lpango-1.0" \
		CPPFLAGS="-I${prefix}/include -no-cpp-precomp -DX_LOCALE" \
		CFLAGS="-O3 -funroll-loops -fstrict-aliasing"

configure.args	--disable-shm --disable-gtk-doc --with-included-loaders \
		--mandir=${prefix}/share/man

build.args	CFLAGS+="-I${x11prefix}/include"

platform darwin 6 { patchfiles-append patch-gtk-xdgmime-xdgmimemagic.c }

platform darwin 8 { patchfiles-append patch-gtk-xdgmime-xdgmimecache.c \
		patch-gtk-gdk-x11-gdkspawn-x11.c }

post-patch	{ reinplace "s|xdg_data_dirs = \"/usr|xdg_data_dirs = \"${prefix}/share:/usr|g" ${worksrcpath}/gtk/xdgmime/xdgmime.c
		  reinplace "s|g_strdup (\"/usr|g_strdup (\"${prefix}|g" ${worksrcpath}/gtk/gtkicontheme.c }

post-destroot	{ system "install -d -m 755 ${destroot}${prefix}/etc/gtk-2.0"
		  system "cp ${filespath}/gdk-pixbuf.loaders ${destroot}${prefix}/etc/gtk-2.0/gdk-pixbuf.loaders"
		  reinplace "s|__PREFIX__|${prefix}|g" "${destroot}/${prefix}/etc/gtk-2.0/gdk-pixbuf.loaders"
		  system "env LANG=C DYLD_LIBRARY_PATH=${destroot}${prefix}/lib ${destroot}${prefix}/bin/gtk-query-immodules-2.0 > ${destroot}${prefix}/etc/gtk-2.0/gtk.immodules" }
