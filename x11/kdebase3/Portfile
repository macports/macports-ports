# $Id: Portfile,v 1.21 2004/12/17 13:45:29 toby Exp $

PortSystem 1.0
name		kdebase3
version		3.1.2
revision	3
categories	x11
maintainers	darwinports@opendarwin.org
description	base KDE programs

platforms	darwin
master_sites	\
		kde:stable/${version}/src \
		http://ranger.befunk.com/fink/:admin \
		http://ranger.befunk.com/darwin/:darwin
extract.suffix	.tar.bz2
use_bzip2	yes
distname	kdebase-${version}
distfiles	${distname}.tar.bz2 kde-admindir-20030601.tar.bz2:admin detect-autoconf.tar.bz2:darwin
depends_lib	lib:libart_lgpl_2:libart_lgpl lib:libartsflow.1:arts \
		lib:libaudiofile.0:audiofile lib:libfreetype.6:XFree86 lib:libjpeg.62:jpeg \
		lib:libkdecore.4:kdelibs3 lib:libmad:mad lib:libogg:libogg lib:libpng.3:libpng \
		lib:libqt-mt.3.1:qt3 lib:libvorbis.0:libvorbis lib:libxml2.2:libxml2 \
		lib:libX11.6:XFree86 lib:libXm.2:lesstif

checksums	kdebase-${version}.tar.bz2 md5 a90feb5273e9f524a2b19d9021ece7a6 \
		kde-admindir-20030601.tar.bz2 md5 6135f81de4b1561942be8fd31ae21297 \
		detect-autoconf.tar.bz2 md5 1f511627496be40174169dbab4d6d78a

set env(PATH) "/usr/X11R6/bin:$env(PATH):${prefix}/bin"

variant darwin {
		depends_lib-append lib:libdl:dlcompat lib:libpoll.1:poll-emulator
		patchfiles \
			stable/patch-kdebase-kate-app-kwrite_main.cpp.diff \
			stable/patch-kdebase-kate-app-kwritemain.cpp.diff \
			stable/patch-kdebase-kate-app-Makefile.am.diff \
			stable/patch-kdebase-kate-lib-Makefile.am.diff \
			stable/patch-kdebase-kcheckpass-checkpass_pam.c.diff \
			stable/patch-kdebase-kcontrol-access-Makefile.am.diff \
			stable/patch-kdebase-kcontrol-info-info.cpp.diff \
			stable/patch-kdebase-kcontrol-info-info_osx.cpp.diff \
			stable/patch-kdebase-kcontrol-info-Makefile.am.diff \
			stable/patch-kdebase-kcontrol-info-memory.cpp.diff \
			stable/patch-kdebase-kcontrol-info-memory_osx.cpp.diff \
			stable/patch-kdebase-kcontrol-kcontrol-kcminit.cpp.diff \
			stable/patch-kdebase-kcontrol-kcontrol-kcmshell.cpp.diff \
			stable/patch-kdebase-kcontrol-kcontrol-main.cpp.diff \
			stable/patch-kdebase-kcontrol-kcontrol-Makefile.am.diff \
			stable/patch-kdebase-kcontrol-kcontrol-stub_main.cpp.diff \
			stable/patch-kdebase-kcontrol-kfontinst-configure.in.in.diff \
			stable/patch-kdebase-kcontrol-kfontinst-kfontinst-FontEngine.cpp.diff \
			stable/patch-kdebase-kdeprint-kjobviewer-Makefile.am.diff \
			stable/patch-kdebase-kdeprint-kprinter-Makefile.am.diff \
			stable/patch-kdebase-kdesktop-main.cc.diff \
			stable/patch-kdebase-kdesktop-Makefile.am.diff \
			stable/patch-kdebase-kdesktop-stub_main.cpp.diff \
			stable/patch-kdebase-kdm-backend-client.c.diff \
			stable/patch-kdebase-kdm-backend-dm.h.diff \
			stable/patch-kdebase-kdm-kfrontend-liloinfo.h.diff \
			stable/patch-kdebase-kdm-kfrontend-Makefile.am.diff \
			stable/patch-kdebase-kfind-Makefile.am.diff \
			stable/patch-kdebase-khotkeys-khotkeys-main.cpp.diff \
			stable/patch-kdebase-khotkeys-khotkeys-Makefile.am.diff \
			stable/patch-kdebase-khotkeys-khotkeys-stub_main.cpp.diff \
			stable/patch-kdebase-kicker-applets-launcher-Makefile.am.diff \
			stable/patch-kdebase-kicker-applets-lockout-Makefile.am.diff \
			stable/patch-kdebase-kicker-extensions-childpanel-Makefile.am.diff \
			stable/patch-kdebase-kicker-Makefile.am.diff \
			stable/patch-kdebase-kicker-menuext-kdeprint-Makefile.am.diff \
			stable/patch-kdebase-kicker-menuext-konsole-Makefile.am.diff \
			stable/patch-kdebase-kicker-menuext-prefmenu-Makefile.am.diff \
			stable/patch-kdebase-kicker-menuext-recentdocs-Makefile.am.diff \
			stable/patch-kdebase-kicker-proxy-appletproxy.cpp.diff \
			stable/patch-kdebase-kicker-proxy-extensionproxy.cpp.diff \
			stable/patch-kdebase-kicker-proxy-Makefile.am.diff \
			stable/patch-kdebase-kicker-proxy-stub_main.cpp.diff \
			stable/patch-kdebase-kicker-share-Makefile.am.diff \
			stable/patch-kdebase-kicker-taskmanager-Makefile.am.diff \
			stable/patch-kdebase-kioslave-devices-configure.in.in.diff \
			stable/patch-kdebase-kioslave-devices-kdedmodule-Makefile.am.diff \
			stable/patch-kdebase-kioslave-ldap-configure.in.in.diff \
			stable/patch-kdebase-kioslave-Makefile.am.diff \
			stable/patch-kdebase-kioslave-nfs-configure.in.in.diff \
			stable/patch-kdebase-kioslave-nfs-README.diff \
			stable/patch-kdebase-klipper-Makefile.am.diff \
			stable/patch-kdebase-kmenuedit-Makefile.am.diff \
			stable/patch-kdebase-konqueror-client-kfmclient.cc.diff \
			stable/patch-kdebase-konqueror-client-Makefile.am.diff \
			stable/patch-kdebase-konqueror-client-stub_main.cpp.diff \
			stable/patch-kdebase-konqueror-keditbookmarks-main.cpp.diff \
			stable/patch-kdebase-konqueror-keditbookmarks-Makefile.am.diff \
			stable/patch-kdebase-konqueror-keditbookmarks-stub_main.cpp.diff \
			stable/patch-kdebase-konqueror-Makefile.am.diff \
			stable/patch-kdebase-konqueror-shellcmdplugin-Makefile.am.diff \
			stable/patch-kdebase-konqueror-sidebar-Makefile.am.diff \
			stable/patch-kdebase-konqueror-sidebar-trees-bookmark_module-Makefile.am.diff \
			stable/patch-kdebase-konqueror-sidebar-trees-dirtree_module-Makefile.am.diff \
			stable/patch-kdebase-konqueror-sidebar-trees-history_module-history_module.h.diff \
			stable/patch-kdebase-konqueror-sidebar-trees-history_module-Makefile.am.diff \
			stable/patch-kdebase-konqueror-sidebar-trees-Makefile.am.diff \
			stable/patch-kdebase-konsole-konsole-konsole_grantpty.c.diff \
			stable/patch-kdebase-konsole-konsole-kwrited.cpp.diff \
			stable/patch-kdebase-konsole-konsole-main.cpp.diff \
			stable/patch-kdebase-konsole-konsole-Makefile.am.diff \
			stable/patch-kdebase-konsole-konsole-stub_main.cpp.diff \
			stable/patch-kdebase-ksmserver-main.cpp.diff \
			stable/patch-kdebase-ksmserver-Makefile.am.diff \
			stable/patch-kdebase-ksmserver-stub_main.cpp.diff \
			stable/patch-kdebase-ksysguard-configure.in.in.diff \
			stable/patch-kdebase-ktip-tips.diff \
			stable/patch-kdebase-kwin-clients-b2-Makefile.am.diff \
			stable/patch-kdebase-kwin-clients-default-Makefile.am.diff \
			stable/patch-kdebase-kwin-clients-icewm-Makefile.am.diff \
			stable/patch-kdebase-kwin-clients-kde1-Makefile.am.diff \
			stable/patch-kdebase-kwin-clients-keramik-Makefile.am.diff \
			stable/patch-kdebase-kwin-clients-kstep-Makefile.am.diff \
			stable/patch-kdebase-kwin-clients-kwmtheme-Makefile.am.diff \
			stable/patch-kdebase-kwin-clients-laptop-Makefile.am.diff \
			stable/patch-kdebase-kwin-clients-modernsystem-Makefile.am.diff \
			stable/patch-kdebase-kwin-clients-quartz-Makefile.am.diff \
			stable/patch-kdebase-kwin-clients-redmond-Makefile.am.diff \
			stable/patch-kdebase-kwin-clients-riscos-Makefile.am.diff \
			stable/patch-kdebase-kwin-clients-system-Makefile.am.diff \
			stable/patch-kdebase-kwin-clients-web-Makefile.am.diff \
			stable/patch-kdebase-kwin-kcmkwin-kwindecoration-Makefile.am.diff \
			stable/patch-kdebase-kwin-kcmkwin-kwinoptions-Makefile.am.diff \
			stable/patch-kdebase-kwin-Makefile.am.diff \
			stable/patch-kdebase-kxkb-kxkb.cpp.diff \
			stable/patch-kdebase-kxkb-Makefile.am.diff \
			stable/patch-kdebase-kxkb-stub_main.cpp.diff \
			stable/patch-kdebase-libkonq-favicons-Makefile.am.diff \
			stable/patch-kdebase-libkonq-Makefile.am.diff \
			stable/patch-kdebase-nsplugins-Makefile.am.diff \
			stable/patch-kdebase-nsplugins-pluginscan.cpp.diff \
			stable/patch-kdebase-startkde.diff
}

variant cvs {
		version 3.2
		revision 0

		##### THIS IS UNSUPPORTED, DO NOT USE THIS IN YOUR PORTS! #####
		cvs.root :pserver:anonymous@anoncvs.kde.org:/home/kde
		cvs.module kdebase
		pre-extract cvsfetch
		##### I MEAN IT, LANDONF WILL KILL YOU IF YOU DO THIS! #####

		distname kdebase
		distfiles kde-admindir-cvs-20030701.tar.bz2:admin
		checksums kde-admindir-cvs-20030701.tar.bz2 md5 b9bf2dc286d2e434c2cfdadc421c79b6
		patchfiles current/patch-kdebase.diff
}

patch {
		foreach patch $patchfiles {
			system "cd '${workpath}/${distname}' && \
			sed -e 's#@PREFIX@#${prefix}#g' '${portpath}/${filesdir}/${patch}' | patch -p0"
		}
}
post-patch      {
		system "cd '${worksrcpath}' && cp -Rf ../admin/ admin"
		system "cd '${worksrcpath}' && make -f admin/Makefile.common cvs"
}
configure.env	CPPFLAGS='-I/usr/X11R6/include -I${prefix}/include -I${prefix}/include/qt3 -no-cpp-precomp -fno-common' \
		LDFLAGS='-L/usr/X11R6/lib' LIBS='-L${prefix}/lib' DYLD_LIBRARY_PATH='${prefix}/lib'
configure.args	--prefix='${prefix}' --includedir='${prefix}/include' --libdir='${prefix}/lib' \
		--with-extra-includes='${prefix}/include' --with-extra-libs='${prefix}/lib' \
		--with-qt-dir='${prefix}' --with-qt-includes='${prefix}/include/qt3' \
		--enable-rpath --with-pic --enable-shared=yes --enable-static=no --enable-mt \
		--libexecdir='${prefix}/lib' --with-xinerama --disable-final \
		--disable-dependency-tracking --without-nfs --with-ldap --with-pam
build.env	${configure.env}
build.target	all apidox
post-destroot	{
		system "install -d -m 755 ${destroot}/private/etc/pam.d"
		system "cd '${worksrcpath}' && install -c -m 444 /etc/pam.d/login  ${destroot}/private/etc/pam.d/kde"
		system "cd '${worksrcpath}' && install -c -m 444 /etc/pam.d/login  ${destroot}/private/etc/pam.d/kdm"
		system "cd '${worksrcpath}' && install -c -m 444 /etc/pam.d/login  ${destroot}/private/etc/pam.d/kcheckpass"
		system "cd '${worksrcpath}' && install -c -m 444 /etc/pam.d/login  ${destroot}/private/etc/pam.d/kscreensaver"
}
