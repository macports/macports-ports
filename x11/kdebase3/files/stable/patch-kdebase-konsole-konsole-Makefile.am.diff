--- konsole/konsole/Makefile.am	6 May 2003 17:53:37 -0000	1.1.1.6
+++ konsole/konsole/Makefile.am	1 Jun 2003 14:31:56 -0000	1.9
@@ -12,13 +12,12 @@
 
 # you can add here more. This one gets installed
 bin_PROGRAMS = 	konsole konsole_grantpty kwrited #kcmkonsole
-lib_LTLIBRARIES = kwrited.la konsole.la
+lib_LTLIBRARIES = libkonsolepart_shared.la libkonsolepart.la libkwrited_main.la kwrited.la libkonsole_main.la konsole.la
 
 # libkonsolepart is a part, but konsole.la links directly to it, so we can't
 # install it under kde_module
 
-kde_module_LTLIBRARIES = libkonsolepart.la
-libkonsolepart_la_SOURCES = TEPty.cpp BlockArray.cpp konsole_part.cpp \
+libkonsolepart_shared_la_SOURCES = TEPty.cpp BlockArray.cpp konsole_part.cpp \
 	schema.cpp \
 	session.cpp \
 	TEWidget.cpp \
@@ -29,33 +28,58 @@
 	keytrans.cpp \
 	konsoleiface.skel \
         sessioniface.skel
+libkonsolepart_shared_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -avoid-version -no-undefined
+libkonsolepart_shared_la_LIBADD = $(LIBUTIL) $(XTESTLIB) $(LIB_KPARTS) $(LIB_QT) -lkdecore -lDCOP -lkdeui -lkio
 
-libkonsolepart_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
-libkonsolepart_la_LIBADD = $(LIBUTIL) $(XTESTLIB) $(LIB_KPARTS)
+libkonsolepart_la_SOURCES = dummy.cpp
+libkonsolepart_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
+libkonsolepart_la_LIBADD  = libkonsolepart_shared.la
+
+dummy.cpp:
+	echo > dummy.cpp
 
 # kwrited kdeinit module
-kwrited_la_SOURCES = kwrited.cpp
-kwrited_la_LIBADD  = libkonsolepart.la
-kwrited_la_LDFLAGS = $(all_libraries) -module -avoid-version
+libkwrited_main_la_SOURCES = kwrited.cpp
+libkwrited_main_la_LDFLAGS = $(all_libraries) -avoid-version -no-undefined
+libkwrited_main_la_LIBADD = $(LIB_KPARTS) $(LIB_QT) -lkdecore -lDCOP libkonsolepart_shared.la
+
+kwrited_la_SOURCES = kwrited_la_main.cpp
+kwrited_la_LDFLAGS = $(all_libraries) -avoid-version -module
+kwrited_la_LIBADD  = libkwrited_main.la
+
+kwrited_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kwrited_la_main.cpp
 
 # kwrited executable
-kwrited_SOURCES	= dummy.cpp
-kwrited_LDADD   = kwrited.la 
+kwrited_SOURCES	= kwrited_main.cpp
+kwrited_LDADD   = libkwrited_main.la
 kwrited_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
+kwrited_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kwrited_main.cpp
 
 # konsole kdeinit module
-konsole_la_SOURCES = TEPty.cpp BlockArray.cpp main.cpp konsole.cpp schema.cpp session.cpp TEWidget.cpp TEmuVt102.cpp \
+libkonsole_main_la_SOURCES = TEPty.cpp BlockArray.cpp main.cpp konsole.cpp schema.cpp session.cpp TEWidget.cpp TEmuVt102.cpp \
      TEScreen.cpp TEmulation.cpp TEHistory.cpp keytrans.cpp konsoleiface.skel sessioniface.skel \
      konsole_wcwidth.cpp konsolebookmarkhandler.cpp konsolebookmarkmenu.cpp konsole_child.cpp
-konsole_la_LDFLAGS = $(all_libraries) -module -avoid-version
-konsole_la_LIBADD = $(LIB_KDEPRINT) $(LIBUTIL) $(XTESTLIB)
+libkonsole_main_la_LDFLAGS = $(all_libraries) -avoid-version -no-undefined
+libkonsole_main_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_KDEPRINT) $(XTESTLIB) $(LIBUTIL) $(XTESTLIB) $(LIB_QT) -lkdecore -lDCOP
+
+konsole_la_SOURCES = konsole_la_main.cpp
+konsole_la_LDFLAGS = $(all_libraries) -avoid-version -module
+konsole_la_LIBADD  = libkonsole_main.la
+
+konsole_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > konsole_la_main.cpp
 
 # konsole executable
-konsole_SOURCES = dummy.cpp
-konsole_LDADD = konsole.la $(LIB_KDEPRINT)
+konsole_SOURCES = konsole_main.cpp
+konsole_LDADD = libkonsole_main.la $(LIB_KDEPRINT)
 konsole_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
+konsole_main.cpp: stub_main.cpp
+	cat stub_main.cpp > konsole_main.cpp
+
 # kcmkonsole_SOURCES = kcmkonsole.cpp schema.cpp
 # kcmkonsole_LDADD   = $(LIB_KDEUI)
 # kcmkonsole_LDFLAGS = $(all_libraries) $(KDE_RPATH)
@@ -97,9 +121,6 @@
 	$(XGETTEXT) rc.cpp *.cpp -o $(podir)/konsole.pot
 	rm -f schemas.cpp
 	rm -f tips.cpp
-
-dummy.cpp:
-	echo > dummy.cpp
 
 # setting up x-application/konsole as a special mimetype
 mimedir = $(kde_mimedir)/application
