# $Id$

PortSystem 1.0

name               grads
version            1.9b4
revision           1
platforms          darwin 
maintainers        takeshi@macports.org
categories         science
description        interactive visualization tool for earth science data
master_sites       ftp://grads.iges.org/grads/1.9/:src \
                   ftp://grads.iges.org/grads/:data
set gradssrc       ${name}-src-${version}${extract.suffix}
set gradsdata      data.tar.Z
distfiles          ${gradssrc}:src ${gradsdata}:data
checksums          ${gradssrc}  sha1 839e32693602e2695825d4d5a1a8ae7e1672c3a5 \
                   ${gradsdata} sha1 6a3e997868b358ecf71ea618c27ad10f28183f5e
homepage           http://www.iges.org/grads/grads.html
long_description   \
    The Grid Analysis and Display System (GrADS) is an interactive \
    desktop tool that is used for easy access, manipulation, and \
    visualization of earth science data. The format of the data may \
    be either binary, GRIB, NetCDF, or HDF-SDS (Scientific Data Sets). \
    GrADS has been implemented worldwide on a variety of commonly used \
    operating systems and is freely distributed over the Internet.

depends_build      port:libwww port:readline port:rx \
                   port:netcdf port:udunits port:libdap port:libnc-dap

patchfiles         patch-configure patch-grads.h patch-wgrib.c \
                   patch-bufrscan.c patch-gacfg.c

configure.cppflags	"-I/usr/include -I${prefix}/include"
configure.ldflags	"-L/usr/lib -L${prefix}/lib"
configure.env	LIBS="-lwmf" SUPPLIBS=${prefix}
configure.args     --prefix=${prefix} --with-lats --with-x

pre-build {
  reinplace "s|libwww.a|libwwwcore.a|g" ${worksrcpath}/src/Makefile
  reinplace "s|\$(supp_lib_dir)/inst.o| |g" ${worksrcpath}/src/Makefile
}

post-destroot {
    xinstall -d -m 755 ${destroot}${prefix}/share/${name}/
    foreach file [glob -directory ${workpath} *.dat *res] {
        file rename ${file} ${destroot}${prefix}/share/${name}/
    }
    system "ln -s ${prefix}/bin/${name}dods ${destroot}${prefix}/bin/${name}"
}

variant printim {
    depends_build-append    port:jpeg port:libpng port:gd2 port:libwmf
    configure.args-append   --with-printim
}
