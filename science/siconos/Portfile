# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           cmake 1.1


# Require C++11
compiler.cxx_standard 2011

# some older Clang say they support C++11 when they don't 
# this is the same blacklisting as for jsoncpp, on which vtk depends. 
compiler.blacklist-append {clang < 900} 

name                siconos
version             4.3.0
revision            1
categories          science
platforms           darwin
license             Apache

set branch          [join [lrange [split ${version} .] 0 1] .]

maintainers         {vacary @vacary} {vacary.acary@gmail.com} openmaintainer

description         Siconos

long_description    Siconos. Simulation, Analysis and Control of Nonsmooth dynamical systems

homepage            http://siconos.gforge.inria.fr
master_sites        https://github.com/siconos/siconos/archive/

distname            ${version}

checksums           rmd160  283266cfeadc51c8bdd0abca2eef5cc4ec9b6e71 \
                    sha256  031dbb37504beb707b163284760e4eeeea6c8631b3eab868f81d3e93e47be324 \
                    size    23732526


depends_lib-append \
    port:boost \
    port:python38 \
    port:gcc9



configure.pre_args-delete \
                    -DCMAKE_BUILD_WITH_INSTALL_RPATH:BOOL=ON

configure.args-append \
                    ../${distname}/ \
                    -DBUILD_SHARED_LIBS=ON 



# Supported pythons
set python_versions {36 37 38}

foreach pyver ${python_versions} {
    # Conflicting python versions
    set other_python_versions {}
    foreach other_pyver ${python_versions} {
        if {${other_pyver} ne ${pyver}} {
            if {${other_pyver} ni ${other_python_versions}} {
                lappend other_python_versions python${other_pyver}
                }
            }
    }

    # Get python branch
    set python_branch  "[string range ${pyver} 0 end-1].[string index ${pyver} end]"

    variant python${pyver} conflicts {*}${other_python_versions} description "Add Python ${python_branch} support" "
            depends_lib-append  port:python${pyver}
            configure.args-delete \
                -DVTK_WRAP_PYTHON:BOOL=OFF

            configure.args-append \
                -DVTK_WRAP_PYTHON:BOOL=ON \
                -DPYTHON_EXECUTABLE:STRING=${prefix}/bin/python${python_branch} \
                -DPYTHON_INCLUDE_DIR=${frameworks_dir}/Python.framework/Versions/${python_branch}/Headers/ \
                -DPYTHON_LIBRARY=${frameworks_dir}/Python.framework/Versions/${python_branch}/lib/libpython${python_branch}.dylib \
                -DVTK_INSTALL_PYTHON_MODULES_DIR=${frameworks_dir}/Python.framework/Versions/${python_branch}/lib/python${python_branch}/site-packages \

    "
}



livecheck.type      regex
livecheck.url       http://siconos.gforge.inria.fr
livecheck.regex     {[sS][iconos]-(\d+(?:\.\d+)*)\.[tar.gz]}