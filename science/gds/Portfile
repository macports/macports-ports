# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem    1.0
PortGroup     conflicts_build 1.0
PortGroup     active_variants 1.1
PortGroup     python 1.0

name          gds
version       2.18.3
categories    science
platforms     darwin
maintainers   ligo.org:ed.maros
license       GPL

description   LSC Algorithm Library
long_description \
  LIGO Scientific Collaboration Algorithm Library containing core \
  routines for gravitational wave data analysis.

homepage      https://www.lsc-group.phys.uwm.edu/daswg/projects/lalsuite.html
master_sites  http://software.ligo.org/lscsoft/source/

checksums     rmd160 1bc9d3388b5d0672a4486b4070419400df67c7a9 \
              sha256 25e28755ea6af84a5d0dcb5d0d0207f61111b9ef00d7491a0de6fa07fb6d538a

patchfiles    patch-Monitors-PulsarMon-PulsarMon.cc.diff

depends_build-append port:pkgconfig \
              port:swig \
              port:swig-python

depends_lib   port:python27 \
              port:py27-numpy \
              port:curl \
              port:expat \
              port:fftw-3 \
              port:fftw-3-single \
              port:hdf5 \
              port:jsoncpp \
              port:ldas-tools-framecpp \
              port:root5 \
              port:metaio

require_active_variants port:root5 python27

#------------------------------------------------------------------------
# Fix things after PortGroup python
#------------------------------------------------------------------------
use_configure      yes
use_parallel_build yes
build.cmd          make
build.target       all
destroot.cmd       ${build.cmd}
destroot.target    install
destroot.destdir   DESTDIR=${destroot}
destroot.args      " "
destroot.pre_args      ${destroot.target}
destroot.post_args      ${destroot.destdir}

configure.python ${prefix}/bin/python2.7
configure.args --enable-online \
               --enable-dtt \
               --enable-python \
               --enable-root-objects \
               --with-jsoncpp=${prefix}

destroot.args-append \
              pythondir="${python.pkgd}" \
              pyexecdir="${python.pkgd}" \
              pkgpythondir="${python.pkgd}/${name}" \
              pkgpyexecdir="${python.pkgd}/${name}"

#
# The macports version of sasl2 leads to a 5 minute latency for each
# socket connection.
conflicts_build  cyrus-sasl2

livecheck.type   regex
livecheck.url    ${master_sites}
livecheck.regex  {gds-(\d+(?:\.\d+)*).tar.gz}
