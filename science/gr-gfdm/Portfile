# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0
PortGroup           gnuradio 1.0

name                gr-gfdm
maintainers         {michaelld @michaelld} openmaintainer
description         Provides augmented functionality for GNU Radio: Generalized Frequency Division Multiplexing.
long_description    ${description}
license             GPL-3

if {${subport} eq ${name}} {

    github.setup    jdemel gr-gfdm 4b71a69d0b48f862632282aec7badb3ca4093e02
    version         20220509-[string range ${github.version} 0 7]
    checksums       rmd160  d7ef950949c1b1749f13d57502fad8d4e1a19cba \
                    sha256  3ca5dd595c33701d2618c058dc16c7c78b6a57caa051c90e3bca8a1d7104d5bc \
                    size    204615
    revision        0

    conflicts       gr37-gfdm

    depends_lib-append \
        port:libfmt

    patchfiles-append \
        lib_short_burst_shaper_impl.h_310.patch

}

subport gr37-gfdm {

    name            gr37-gfdm

    github.setup    jdemel gr-gfdm 4cc5b5c4f3814f9e6a32c5f732412b70393127c6
    git.branch      maint-3.7
    version         20190416-[string range ${github.version} 0 7]
    revision        4

    conflicts       gr-gfdm

    patchfiles-append \
        patch-fix_build37.diff

    # Fetch from git instead of distfile because it needs submodules
    fetch.type git

    post-fetch {
        system -W "${worksrcpath}" "git submodule update --init --recursive"
    }

}


depends_lib-append \
    port:py${active_python_version_no_dot}-pybind11

# unfortunately, for the moment it needs internal pybind11
# too much effort to move out only avoid installation
configure.args-append \
    -DPYBIND11_INSTALL=OFF \
    -DPYBIND11_TEST=OFF

# documentation - fail -> disable
default_variants-append \
    -docs
