# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

# I (Jochen KÃ¼pper) got explicit permission to distribute molden as a
# MacPorts port, given that the source-code is always downloaded from
# the authors webpage and we add a banner asking users to register at
# the following web-page: http://www.cmbi.ru.nl/molden/form.html
#
# Feel free to update checksums whenever a stealth upgrade of molden is out...

PortSystem 1.0
PortGroup xcodeversion 1.0

name                molden
version             5.1-20140214085900
set version_number  [lindex [split ${version} -] 0]
set branch          [join [lrange [split ${version_number} .] 0 1] .]
categories          science graphics chemistry
license             Restrictive Noncommercial
maintainers         openmaintainer jochen
homepage            http://www.cmbi.ru.nl/molden/molden.html
distname            ${name}${version_number}
worksrcdir          ${name}${branch}
dist_subdir         ${name}/${version}
master_sites        ftp://ftp.cmbi.ru.nl/pub/molgraph/molden/

checksums           rmd160  60b8270b96f04625ce409eef1706f0fdbad3b9fc \
                    sha256  499dda72075f0e4ab0306d1a0834fdd26edcc8ed7a2562fdf741bb2fc8787261

description         Molecular graphics visualisation tool
long_description    Molden is a package for displaying Molecular Density from \
                    the Ab Initio packages GAMESS-UK , GAMESS-US and \
                    GAUSSIAN and the Semi-Empirical packages Mopac/Ampac, it \
                    also supports a number of other programs via the Molden Format. \
                    In order to keep up support for Molden, proof that \
                    it is being used outside the CMBI is required. \
                    Please register your copy of molden at: \
                    http://www.cmbi.ru.nl/molden/form.html

notes "
                    In order to keep up support for Molden, proof that\
                    it is being used outside the CMBI is required.\
                    Please register your copy of molden at:\
                    \n\nhttp://www.cmbi.ru.nl/molden/form.html
"

platforms           darwin
depends_build       port:gmake
depends_lib         port:xorg-libX11
patchfiles          patch-makefile.diff
post-patch {
    reinplace "s|@PREFIX@|${prefix}|g" ${worksrcpath}/makefile
}

minimum_xcodeversions {9 3.1}
use_parallel_build  yes
use_configure       no
build.target        molden
build.cmd           gmake
pre-build {
    build.args      CC=${configure.cc} \
                    FC=${configure.fc}
}

destroot {
    xinstall -W ${worksrcpath} molden ${destroot}${prefix}/bin
    set docdir ${destroot}${prefix}/share/doc/molden
    xinstall -m 755 -d ${docdir}
    xinstall -W ${worksrcpath} \
        COMMERCIAL_LICENSE \
        CopyRight \
        HISTORY \
        README \
        REGISTER \
        ${docdir}
}

variant gcc44 conflicts gcc45 gcc46 gcc47 gcc48 description {Build using gcc44} {
    configure.compiler      macports-gcc-4.4
}

variant gcc45 conflicts gcc44 gcc46 gcc47 gcc48 description {Build using gcc45} {
    configure.compiler      macports-gcc-4.5
}

variant gcc46 conflicts gcc44 gcc45 gcc47 gcc48 description {Build using gcc46} {
    configure.compiler      macports-gcc-4.6
}

variant gcc47 conflicts gcc44 gcc45 gcc46 gcc48 description {Build using gcc47} {
    configure.compiler      macports-gcc-4.7
}

variant gcc48 conflicts gcc44 gcc45 gcc46 gcc47 description {Build using gcc48} {
    configure.compiler      macports-gcc-4.8
}

if {![variant_isset gcc44] && ![variant_isset gcc45] && ![variant_isset gcc46] && ![variant_isset gcc47] && ![variant_isset gcc48]} {
    default_variants +gcc48
}

variant opengl description "Install moldenogl OpenGL helper program" {
    depends_lib-append      port:freeglut \
                            port:mesa
    build.target-append     moldenogl
    post-destroot {
        xinstall -W ${worksrcpath} moldenogl ${destroot}${prefix}/bin
    }
}

livecheck.type      regex
livecheck.url       http://www.ryandesign.com/macports/version.php/${name}
livecheck.regex     {^(.+)$}
