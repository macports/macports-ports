# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem                  1.0

name                        netcdf
version                     4.0.1
revision                    7
maintainers                 takeshi openmaintainer
platforms                   darwin
categories                  science

description                 NetCDF - Network Common Data Form
long_description \
    NetCDF is an interface \
    for array-oriented data access and a library that \
    provides an implementation of the interface. The \
    netCDF library also defines a machine-independent \
    format for representing scientific data. Together, \
    the interface, library, and format support the \
    creation, access, and sharing of scientific data. \
    The netCDF software was developed at the Unidata \
    Program Center in Boulder, Colorado.

homepage                    http://unidata.ucar.edu/packages/netcdf/

master_sites                ftp://ftp.unidata.ucar.edu/pub/netcdf/ \
                            http://www.gfd-dennou.org/arch/netcdf/unidata-mirror/ \
                            ftp://www.gfd-dennou.org/arch/netcdf/unidata-mirror/

checksums                   md5     a251453c5477599f050fa4e593295186 \
                            sha1    96b361de72bcf68eaba42e7e5cf0f92c33d288e9 \
                            rmd160  ba74363bbc4c76fc1bbac578ba4c2af4739b4958

configure.cppflags-append   -DNDEBUG
configure.cxxflags-append   -fno-common
configure.cflags-append     -fno-common
configure.args              --enable-shared \
                            --disable-fortran-compiler-check \
                            --disable-f77 --disable-f90

test.run                    yes
test.target                 check

destroot.destdir            prefix=${destroot}${prefix} \
                            MANDIR=\\\${prefix}/share/man

post-destroot {
    file delete -force ${destroot}${prefix}/share/man/whatis.db
}

variant gcc43 description conflicts g95 description {Enable Fortran support with gfortran} {
    depends_lib-append      port:gcc43
    configure.args-delete   --disable-fortran-compiler-check --disable-f77 --disable-f90
    configure.cppflags-append -DpgiFortran
    configure.compiler      macports-gcc-4.3
}

variant g95 description conflicts gcc43 description {Enable Fortran support with g95} {
    depends_lib-append      port:g95
    configure.args-delete   --disable-fortran-compiler-check --disable-f77 --disable-f90
    #-lfg95 required or the tests fail
    configure.ldflags-append    -lf95
    configure.fc            ${prefix}/bin/g95
    configure.f77           ${configure.fc}
}

variant openmpi conflicts mpich2 description {compile with openmpi} {
    depends_lib-append      port:openmpi
    configure.fc            openmpif77
    configure.cc            openmpicc
    configure.cxx           openmpicxx
}

variant mpich2 conflicts openmpi description {compile with mpich2} {
    depends_lib-append      port:mpich2
    configure.fc            mpif90
    configure.cc            mpicc
    configure.cxx           mpicxx
}

variant dap description {enable dap} {
    depends_lib-append      port:curl
    configure.args-append   --enable-dap
}

variant netcdf4 description {compile with hdf5} {
    configure.env-append    LDFLAGS=-L${prefix}/lib LIBS="-lhdf5 -lhdf5_hl"
    configure.args-append   --enable-netcdf-4 \
                            --enable-ncgen4 \
                            --with-hdf5=${prefix} \
                            --with-szlib=${prefix}
    depends_lib-append      port:szip \
                            port:hdf5-18
}

variant static description {build static libraries} {
    configure.args-delete  --enable-shared
}

variant docs description {install documentation} {
    configure.args-append   -enable-docs-install
}
