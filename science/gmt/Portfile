# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem                  1.0

name                        gmt
version                     4.5.1
categories                  science
maintainers                 takeshi
license                     GPLv2
description                 the generic mapping tools
long_description an open source collection of ~60 tools         \
    for manipulating geographic and Cartesian data sets and     \
    producing Encapsulated PostScript File (EPS) illustrations  \
    ranging from simple x-y plots via contour maps to           \
    artificially illuminated surfaces and 3-D perspective views.
homepage                    http://gmt.soest.hawaii.edu/
revision                    1
platforms                   darwin
master_sites                ftp://ftp.soest.hawaii.edu/gmt          \
                            ftp://ibis.grdl.noaa.gov/pub/gmt        \
                            ftp://ftp.iris.washington.edu/pub/gmt   \
                            ftp://ftp.iag.usp.br/pub/gmt            \
                            ftp://ftp.geologi.uio.no/pub/gmt        \
                            ftp://gd.tuwien.ac.at/pub/gmt           \
                            ftp://ftp.scc.u-tokai.ac.jp/pub/gmt     \
                            ftp://mirror.geosci.usyd.edu.au/pub/gmt \
                            ftp://gmt.mirror.ac.za/pub/gmt
use_bzip2                   yes
set gshhsversion            2.0.1
set gmtsrc                  GMT${version}_src.tar.bz2
set gmtshare                GMT${version}_share.tar.bz2
set gmtsuppl                GMT${version}_suppl.tar.bz2
set gshhslow                GSHHS${gshhsversion}_coast.tar.bz2
distfiles                   ${gmtsrc} ${gmtshare} ${gmtsuppl} ${gshhslow}
checksums                   ${gmtsrc}   md5     a0e7b410e8470d6c47bd56830fd1158f \
                            ${gmtsrc}   sha1    337348417b66d7627dc3edd572a239f83d6e16c0 \
                            ${gmtsrc}   rmd160  6a39988ef079ba521df585a77705467a507b0efd \
                            ${gmtshare} md5     1380a82348b9fdd0c32474787a90a95f \
                            ${gmtshare} sha1    b2fa798747eba1244aff4b7888f41494b2e4ee38 \
                            ${gmtshare} rmd160  65e730cf15e09f0bf793d5e96f29f4838167ec30 \
                            ${gmtsuppl} md5     c771a72a7eed44678134ae0b51edd606 \
                            ${gmtsuppl} sha1    4a8604479863cfeb3d9a0234aa26e442f7d2fc49 \
                            ${gmtsuppl} rmd160  e909e9628848e09e35e54b116ce6bec7d5d96669 \
                            ${gshhslow} md5     75a1e1e04b473699eee3a31c89b8dbfa \
                            ${gshhslow} sha1    5caf807149973612e7a89953471cebc4007317c1 \
                            ${gshhslow} rmd160  c0c2c0efc56e80fe1b2b2dc4193c0569a8eaa3f7
worksrcdir                  GMT${version}
configure.args              --mandir=${prefix}/share/man \
                            --datadir=${prefix}/share/${name} \
                            --enable-netcdf=${prefix} \
                            --enable-shared \
                            --disable-xgrid \
                            --disable-rpath
configure.cflags-append     -std=c99
use_parallel_build          yes
destroot.target             install-all
destroot.destdir            prefix=${destroot}${prefix}
pre-configure {
    reinplace "s|-flat_namespace -undefined suppress||" ${worksrcpath}/configure
}

post-destroot {
    xinstall -m 755 -d ${destroot}${prefix}/share/${name}
    eval xinstall -m 644 [glob ${workpath}/share/coast/*] \
    ${destroot}${prefix}/share/${name}
}

if {[variant_isset universal]} {
    configure.universal_args-delete --disable-dependency-tracking
    patch {
        reinplace "s|\$(AR) cvur \$@ \$?|if \[ -f \$@ \]; then \$(RM) \$@; fi;\$(AR) cvur \$@ \$?|" ${worksrcpath}/src/Makefile
        reinplace "s|-dynamiclib|-dynamiclib ${configure.universal_ldflags}|" ${worksrcpath}/configure
    }
}

variant gshhs description {installs high and full resolution GSHHS coast line data} {
    set gshhshigh GSHHS${gshhsversion}_high.tar.bz2
    set gshhsfull GSHHS${gshhsversion}_full.tar.bz2
    distfiles-append        ${gshhshigh} ${gshhsfull}
    checksums-append        ${gshhshigh} md5     0e1855e73bb079ab1879dd24895e99e9 \
                            ${gshhshigh} sha1    08bdc581d65ebbad990bad6bad85e2ecb0bae05e \
                            ${gshhshigh} rmd160  79815ee8bb90e43cfee0b2e34bf528c1650cb2db \
                            ${gshhsfull} md5     dbffea06d9ccf2899a9788dfac99c387 \
                            ${gshhsfull} sha1    d5a099073ba98fc0de77d14cd8a44485e1b70520 \
                            ${gshhsfull} rmd160  3e48f5ab576c5559af736d0fb46e0bf1e69b4993
}

variant doc description {installs documentation, examples and tutorial} {
    set gmtdoc GMT${version}_doc.tar.bz2
    distfiles-append        ${gmtdoc}
    checksums-append        ${gmtdoc}   md5     124b2206be03e0d4d8c2bed582a30187 \
                            ${gmtdoc}   sha1    a7265d9485df112786e8ff102fed4c2c0d3fe994 \
                            ${gmtdoc}   rmd160  3de1f0315d6d19fdbeaac1c12333b7c6297608be
}

variant octave description {compiles Octave interface} {
    depends_lib-append port:octave
    configure.args-append --enable-octave
    configure.args-delete --disable-mex
}

variant triangle description {use J. Shewchuk's fast, non-GPL triangulation routine} {
    set gmttri GMT${version}_triangle.tar.bz2
    distfiles-append        ${gmttri}
    checksums-append        ${gmttri} md5     d71fc58ee47240afd2a3494341eb5ad8 \
                            ${gmttri} sha1    7d909e125f5e71cbda73e4165a2b251b77547151 \
                            ${gmttri} rmd160  08ea125a0c6d1ead2d96e553e3201435263e6ca1
    configure.args-append   --enable-triangle
}

livecheck.type              regex
livecheck.url               http://gmt.soest.hawaii.edu/gmt/gmt_home.html
livecheck.regex             {Current version is ([0-9]+.[0-9]+.[0-9]+.)}
