# $Id: Portfile,v 1.21 2004/04/22 18:36:48 rshaw Exp $
PortSystem 1.0

name			ruby
version			1.8.1
revision		5
categories		lang ruby
maintainers		rshaw@opendarwin.org
description		Powerful and clean object-oriented scripting language
long_description	Ruby is the interpreted scripting language for quick \
					and easy object-oriented programming. It has many \
					features to process text files and to do system \
					management tasks (as in Perl). It is simple, \
					straight-forward, extensible, and portable.
homepage		http://www.ruby-lang.org/
master_sites	ruby:1.8
dist_subdir		ruby
checksums		md5 5d52c7d0e6a6eb6e3bc68d77e794898e
platforms		darwin

depends_lib		lib:libiconv.2:libiconv \
				lib:libreadline.4.3:readline \
				lib:libssl.0.9:openssl \
				lib:libz.1:zlib

patchfiles		patch-Makefile.in \
				patch-configure.in \
				patch-instruby.rb \
				patch-mkconfig.rb \
				patch-mkmf.rb \
				patch-ruby.c \
				patch-sprintf.c

use_autoconf	yes

configure.args	--enable-shared \
				--mandir="${prefix}/share/man"
configure.env	CFLAGS="-O -pipe -I${prefix}/include" \
				CPPFLAGS="-O -pipe -I${prefix}/include" \
				LDFLAGS="-L${prefix}/lib"

post-destroot {
	foreach type {site vendor} {
		set libdir ${destroot}${prefix}/lib/ruby/${type}_ruby
		# special file for installation control of modules
		xinstall -m 0644 ${filespath}/${type}-specific.rb ${libdir}
		# prevent empty site/vendor directories from being pruned
		foreach subdir [exec find ${libdir} -type d -empty] {
			system "touch ${subdir}/.turd"
		}
	}
}

variant cvs {
	version			[clock format [clock seconds] -format %Y%m%d]
	distname		${name}-${version}

	fetch.type		cvs
	cvs.root		:pserver:anonymous@cvs.ruby-lang.org:/src
	cvs.password	anonymous
	cvs.module		${name}
	cvs.args		-d ${distname}

	patchfiles-delete	patch-instruby.rb \
						patch-mkconfig.rb \
						patch-sprintf.c
	patchfiles-append	patch-instruby.rb-cvs \
						patch-mkconfig.rb-cvs
}

variant snapshot {
	version			1.8.1-snapshot
	master_sites	ruby:.
	distname		stable-snapshot
	checksums
	checksum {
		ui_warn "Skipping checksum(s) for snapshot variant of ${name}!"
		ui_warn "The snapshot variant is for development purposes only!"
		ui_warn "Use with extreme caution!"
	}
	worksrcdir		ruby
	patchfiles-delete	patch-instruby.rb \
						patch-sprintf.c
	patchfiles-append	patch-instruby.rb-cvs
}

