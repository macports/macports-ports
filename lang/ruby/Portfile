# $Id$
PortSystem		1.0

name			ruby
version			1.8.5
revision		1

categories		lang ruby
maintainers		pguyot@kallisys.net

description		Powerful and clean object-oriented scripting language
long_description	Ruby is the interpreted scripting language for quick \
					and easy object-oriented programming. It has many \
					features to process text files and to do system \
					management tasks (as in Perl). It is simple, \
					straight-forward, extensible, and portable.
homepage		http://www.ruby-lang.org/
master_sites	ruby:1.8
dist_subdir		ruby
checksums		ruby-1.8.5.tar.gz \
					md5 3fbb02294a8ca33d4684055adba5ed6f \
					sha1 0638ea26e1088fc9f4237abde8c85331689ce77c \
					rmd160 991899146c23c9ea30ac09f41b7077fa0c8686b6 \
				ruby-1.8.5-cgi-dos-1.patch \
					md5 9d25f59d1c33a0b215f6c25260dcb536 \
					sha1 52f4f5aa5289cbb177853ece3cd55bf63abbc277 \
					rmd160 fc51bba300ca0b653a5cc960c98d7be972c4bd47

platforms		darwin

depends_lib		port:libiconv \
				port:readline \
				port:openssl \
				port:zlib \
				port:ncurses
				
patchfiles		patch-Makefile.in \
				patch-configure.in \
				patch-instruby.rb \
				patch-mkconfig.rb \
				patch-mkmf.rb \
				patch-ruby.c \
				ruby-1.8.5-cgi-dos-1.patch
patch_sites		http://ftp.ruby-lang.org/pub/ruby/1.8/

use_autoconf	yes

configure.args	--enable-shared \
				--mandir="${prefix}/share/man" \
				--enable-pthread \
				--without-tk
configure.env	CFLAGS="-O -pipe -I${prefix}/include" \
				CPPFLAGS="-O -pipe -I${prefix}/include" \
				LDFLAGS="-L${prefix}/lib"

destroot.target	install install-doc
post-destroot {
	foreach type {site vendor} {
		set libdir ${destroot}${prefix}/lib/ruby/${type}_ruby
		xinstall -m 0755 -d ${libdir}
		
		# special file for installation control of modules
		xinstall -m 0644 ${filespath}/${type}-specific.rb ${libdir}
		
		# prevent empty site/vendor directories from being pruned
		foreach subdir [exec find ${libdir} -type d -empty] {
			destroot.keepdirs-append ${subdir}
		}
	}
}

platform darwin {
	# for proper rdoc/ri creation, make sure to link to destroot libruby.dylib
	destroot.env	DYLD_LIBRARY_PATH=${destroot}${prefix}/lib
}

variant tk {
	configure.args-delete	--without-tk 
	configure.args-append	--with-tk 
	depends_lib-append		port:tcl port:tk 
} 
