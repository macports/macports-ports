# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           compiler_blacklist_versions 1.0
PortGroup           github 1.0
PortGroup           legacysupport 1.1
PortGroup           makefile 1.0

# strndup
legacysupport.newest_darwin_requires_legacy 10

github.setup        CodethinkLabs ofc b69ad37be62d580eabeb081e64b43afe3c0b3384
version             2023.02.06
revision            0
categories          lang fortran
license             Apache-2
maintainers         {@barracuda156 gmail.com:vital.had} openmaintainer
description         Open Fortran Compiler
long_description    Currently OFC is a Fortran front-end capable of parsing and performing semantic analysis \
                    on Fortran. Weâ€™re targeting legacy Fortran first, and can currently parse and semantically analyse \
                    most F77 and earlier, providing syntax and semantic warnings and errors.
checksums           rmd160  64d56a24c41295fd0f29aac144b790531e15db41 \
                    sha256  55a66c5d9cf51843bde6fc0442a9cbc66e6c5ff700bfe52cfb840ef998803767 \
                    size    199538
github.tarball_from archive
installs_libs       no

compiler.blacklist  *gcc-4.* {clang < 421}

post-patch {
    reinplace "s|/usr/local|${prefix}|" ${worksrcpath}/Makefile

    # https://github.com/CodethinkLabs/ofc/issues/46
    # https://github.com/CodethinkLabs/ofc/issues/49
    reinplace "s|-Werror||g" ${worksrcpath}/Makefile

    if {${os.platform} eq "darwin" && ${os.major} < 11} {
        reinplace "s|LDFLAGS = -lm|LDFLAGS = -lm -lMacportsLegacySupport|" ${worksrcpath}/Makefile
    }
}
