# $Id$

PortSystem 1.0

name			spidermonkey
version			1.7.0
categories		lang
platforms		darwin
maintainers		akira openmaintainer
description		JavaScript-C Engine
long_description	${description}

homepage		http://www.mozilla.org/js/spidermonkey/
master_sites		http://ftp.mozilla.org/pub/mozilla.org/js/ \
			ftp://ftp.mozilla.org/pub/mozilla.org/js/ \
			http://ftp.mozilla.org/pub/mozilla.org/js/older-packages/ \
			ftp://ftp.mozilla.org/pub/mozilla.org/js/older-packages/
distname		js-${version}
checksums		md5 5571134c3863686b623ebe4e6b1f6fe6 \
			sha1 1a99e8e10cb6600a03ea98895583a8ed42136d1f \
			rmd160 6eadf1ac7c10a13b3db3d499856c9e18ddbcdfdb

depends_build		port:readline \
			port:nspr
worksrcdir		js/src

patchfiles		spidermonkey-1.5-build.patch \
			spidermonkey-1.5-threadsafe.diff \
			spidermonkey-1.5-header.diff \
			patch-config-Darwin.mk

post-patch {
	reinplace "s|__PREFIX__|${prefix}|g" \
		${worksrcpath}/Makefile.ref
	reinplace "s|__USER__|${install.user}|g" \
		${worksrcpath}/Makefile.ref
	reinplace "s|__GROUP__|${install.group}|g" \
		${worksrcpath}/Makefile.ref
}

use_configure	no

build.args              -f Makefile.ref LIBDIR="/lib" SO_SUFFIX=dylib JS_THREADSAFE=1

post-build {
	system "ranlib ${worksrcpath}/Darwin_OPT.OBJ/libjs.a"
}

destroot.args           -f Makefile.ref LIBDIR="/lib" SO_SUFFIX=dylib
