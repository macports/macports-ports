# $Id: Portfile,v 1.7 2004/01/06 07:18:01 jkh Exp $

PortSystem 1.0
name		guile
version		1.6.4
categories	lang
maintainers	gwright@comcast.net
platforms	darwin
description	GNU's Ubiquitous Intelligent Language for Extension (guile)
long_description	\
		Guile is an interpreter for the Scheme programming language, \
		packaged for use in a wide variety of environments.  \
		Guile implements Scheme as described in the Revised^5 Report \
		on the Algorithmic Language Scheme (usually known as R5RS), \
		providing clean and general data and control structures.  \
		Guile goes beyond the rather austere language presented \
		in R5RS, extending it with a module system, full access to \
		POSIX system calls, networking support, multiple threads, \
		dynamic linking, a foreign function call interface, \
		powerful string processing, and many other features needed \
		for programming in the real world.

#bugs		On Apple's darwin, the putenv library function acts \
#		differently than the GNU version. The patch to \
#		libguile/posix.c fixes this, so the guile 'putenv' \
#		function doesn't throw a system error. \
#							\
#		The libtool madness below ('pre_install') is nothing \
#		to be proud of, but gets around a hard to fix libtool \
#		bug involving installing to destroot and dependencies \
#		that span directories.

#user_notes	Set DLYD_LIBRARY_PATH to /opt/local/lib (or wherever \
#		the guile libraries have been installed) if you intend \
#		to load guile modules.

homepage	http://www.gnu.org/software/guile/guile.html
master_sites	ftp://ftp.gnu.org/gnu/guile/

checksums	md5 a4aceb5f185878c1de4e8aa7c38b6d1d

depends_lib	lib:libreadline.4.3:readline lib:libdl:dlcompat

patchfiles	patch-scmsigs.c patch-configure patch-guile-readline-configure \
		patch-ltmain.sh patch-posix.c

configure.args	CPPFLAGS="-no-cpp-precomp -I/opt/local/include" \
		CFLAGS="-no-cpp-precomp -Dmacosx" \
		LDFLAGS=-L/opt/local/lib

pre-destroot	{ cd ${workpath}/${worksrcdir}/libguile-ltdl
		  system "../libtool install -c libguile-ltdl.la \
			  ${prefix}/lib/libguile-ltdl.la"
		  cd ${workpath}/${worksrcdir}/libguile
		  system "../libtool install -c libguile.la \
			  ${prefix}/lib/libguile.la"
		  cd ${workpath}/${worksrcdir}/guile-readline
		  system "../libtool install -c libguilereadline-v-12.la \
			  ${prefix}/lib/libguilereadline-v-12.la"
		  cd ${workpath}/${worksrcdir}/srfi
		  system "../libtool install -c libguile-srfi-srfi-4-v-1.la \
			  ${prefix}/lib/libguile-srfi-srfi-4-v-1.la"
		  system "../libtool install -c libguile-srfi-srfi-13-14-v-1.la \
			  ${prefix}/lib/libguile-srfi-srfi-13-14-v-1.la"
		}

