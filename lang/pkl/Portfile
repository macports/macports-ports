# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               java 1.0
PortGroup               github 1.0

github.setup            apple pkl 0.29.1
github.tarball_from     archive
revision                0

java.version            21+
java.fallback           openjdk21

categories              lang
maintainers             {sub-pop.net:link @subpop} openmaintainer

license                 Apache-2

description             A configuration as code language with rich validation and tooling
long_description        Pkl (pronounced Pickle) is an embeddable configuration \
                        language which provides rich support for data templating \
                        and validation. It can be used from the command line, \
                        integrated in a build pipeline, or embedded in a program. \
                        Pkl scales from small to large, simple to complex, ad-hoc \
                        to repetitive configuration tasks.

checksums               rmd160  a449cb64b30f5fdb93019e3e65ae72076127467f \
                        sha256  cafda453d8cd0e7783bd48c7b7d6d1b43b527d163f87bd7a852c71233ec873c9 \
                        size    3103347

use_configure           no

supported_archs         arm64 x86_64

build.cmd               ./gradlew --info --stacktrace
if {${configure.build_arch} eq "arm64"} {
    build.target            pkl-cli:macExecutableAarch64
    set arch_name           aarch64
} else {
    build.target            pkl-cli:macExecutableAmd64
    set arch_name           amd64
}
build.post_args         -DreleaseBuild=true \
                        --no-daemon
build.env-append        GRADLE_USER_HOME=${workpath}/gradle \
                        GRAALVM_HOME=${workpath}/graalvm
                        _JAVA_OPTIONS=-Duser.home=${workpath}/home

destroot {
    xinstall -m 0755 ${worksrcpath}/pkl-cli/build/executable/pkl-macos-${arch_name} ${destroot}${prefix}/bin/pkl
}
