# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem			1.0

name				dragonegg-devel
version				3.0-r137552
revision                        1
categories			lang
platforms			darwin
maintainers			nomaintainer
license				BSD

description			Dragonegg is a LLVM plug-in for GCC 4.5 or +
long_description	Dragonegg replaces GCC optimizers and code generators \
					by the LLVM optimizing infrastructure. It supersedes \
					llvm-gcc.

homepage			http://dragonegg.llvm.org/

depends_build		port:llvm-devel

pre-fetch {
	ui_msg			"Please remember to keep dragonegg and llvm \
					in phase by updating llvm-devel first."
}

fetch.type			svn
svn.url				http://llvm.org/svn/llvm-project/dragonegg/trunk
svn.revision		137552

worksrcdir			trunk

use_configure		no

variant gcc45 conflicts gcc46 description {use Dragonegg with gcc45} {
	build.env-append GCC=${prefix}/bin/gcc-mp-4.5
	global			gcc_version
	set				gcc_version 45
}

variant gcc46 conflicts gcc45 description {use Dragonegg with gcc46} {
	build.env-append GCC=${prefix}/bin/gcc-mp-4.6
	global			gcc_version
	set				gcc_version 46
}

if {![variant_isset gcc46]} {
    default_variants +gcc45
}

build.target

destroot {
	xinstall -m 755 -d ${destroot}${prefix}/lib
	xinstall -m 755 ${worksrcpath}/dragonegg.so \
					${destroot}${prefix}/lib/dragonegg${gcc_version}.so
}
