From 51d53157fb6af25c9085cfeff1e959742f5407bd Mon Sep 17 00:00:00 2001
From: barracuda156 <vital.had@gmail.com>
Date: Mon, 5 Jun 2023 22:29:05 +0800
Subject: [PATCH] ppc/Darwin: Config.ppc: use right compiler and deployment
 target

---
 src/runtime/Config.ppc-darwin | 18 ++++++++++++++----
 1 file changed, 14 insertions(+), 4 deletions(-)

diff --git src/runtime/Config.ppc-darwin src/runtime/Config.ppc-darwin
index b34a07236..34376a0a6 100644
--- src/runtime/Config.ppc-darwin
+++ src/runtime/Config.ppc-darwin
@@ -9,8 +9,20 @@
 # provided with absolutely no warranty. See the COPYING and CREDITS
 # files for more information.
 
-CFLAGS = -g -Wall -O2 -fdollars-in-identifiers -mmacosx-version-min=10.4
-LINKFLAGS += -mmacosx-version-min=10.4
+CFLAGS = -g -Wall -O2 -fdollars-in-identifiers
+
+ifdef SBCL_MACOSX_VERSION_MIN
+  CFLAGS += -mmacosx-version-min=$(SBCL_MACOSX_VERSION_MIN)
+  LINKFLAGS += -mmacosx-version-min=$(SBCL_MACOSX_VERSION_MIN)
+else
+  ifdef LISP_FEATURE_DARWIN9_OR_BETTER
+    CFLAGS += -mmacosx-version-min=10.5
+    LINKFLAGS += -mmacosx-version-min=10.5
+  else
+    CFLAGS += -mmacosx-version-min=10.4
+    LINKFLAGS += -mmacosx-version-min=10.4
+  endif
+endif
 
 OS_SRC = bsd-os.c darwin-os.c ppc-darwin-os.c
 
@@ -19,8 +31,6 @@ ifdef LISP_FEATURE_SB_CORE_COMPRESSION
   OS_LIBS += -lz
 endif
 
-CC = gcc
-
 ASSEM_SRC = ppc-assem.S
 ARCH_SRC = ppc-arch.c
 
-- 
2.41.0

