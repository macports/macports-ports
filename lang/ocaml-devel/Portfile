# $Id$

PortSystem        1.0

name                ocaml-devel
conflicts           ocaml
version             4.00.0+beta2
set major_vers      4.00
platforms           darwin
maintainers         mww openmaintainer
categories          lang ml
description         Objective Caml is an implementation of the ML language, BETA development version
license             {QPL LGPL}
homepage            http://www.ocaml.org/
master_sites        http://caml.inria.fr/pub/distrib/ocaml-${major_vers}/ \
                    ftp://ftp.inria.fr/INRIA/Projects/cristal/ocaml/ocaml-${major_vers}
checksums           rmd160  345a2ce3a3f163aac402d4e6b56d4f07e70f39d4 \
                    sha256  dde859f626ab62104e7238a882be8866c31a943c4f548bbebce14f16a1b20663

long_description \
            Objective Caml is an implementation of the ML language, based on \
            the Caml Light dialect extended with a complete class-based object \
            system    and a powerful module system in the style of Standard ML.

use_bzip2           yes
distname            ocaml-${version}

depends_lib         port:ncurses

use_parallel_build  no
universal_variant   no

set docdir          ${prefix}/share/doc/${name}

# http://caml.inria.fr/mantis/view.php?id=5643
if {${configure.compiler} == "clang"} {
    configure.compiler llvm-gcc-4.2
}

# Configure.
configure.pre_args  -prefix ${prefix}
configure.args      -no-tk -cc ${configure.cc} -aspp \"${configure.cc} -c\"

# Building.
build.target        world.opt
build.cmd           "unset LD_PREBIND LD_PREBIND_ALLOW_OVERLAP && ${build.cmd}"

# Install.
destroot.target     install
destroot.destdir    BINDIR=${destroot}${prefix}/bin \
                    LIBDIR=${destroot}${prefix}/lib/ocaml \
                    MANDIR=${destroot}${prefix}/share/man

post-destroot {
    # Change "ld.conf" to remove ${destroot} in paths.
    reinplace "s:${destroot}::g" ${destroot}${prefix}/lib/ocaml/ld.conf
    xinstall -d ${destroot}${docdir}
    xinstall -m 0644 -W ${worksrcpath} Changes LICENSE README ${destroot}${docdir}
}

# Variants.
variant profile description {Enable profiling} {
    configure.env-append CC="gcc -pg"
}

variant labltk description {Include TK bindings and ocamlbrowser} {
    depends_lib-append    port:tcl port:tk
    configure.args-delete     -no-tk
}

livecheck.type      regex
livecheck.url       http://caml.inria.fr/download.en.html
livecheck.regex     "ocaml-\[0-9\.]+/ocaml-(\[0-9\.\]+).tar"
