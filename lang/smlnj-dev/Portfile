# $Id: Portfile 28446 2007-08-31 12:34:39Z mww@macports.org $

PortSystem 1.0
name             smlnj-dev
version          110.65
categories       lang ml
maintainers      bfulgham@macports.org
description      Standard ML of New Jersey (Development Branch)
long_description \
	Standard ML of New Jersey (abbreviated SML/NJ) is a \
	compiler for the Standard ML '97 programming language \
	with associated libraries, tools, and documentation. \
	SML/NJ is free, open source software.
homepage         http://www.smlnj.org/
platforms        darwin

set svn_site     svn://smlnj-gforge.cs.uchicago.edu/smlnj

fetch {
	cd ${workpath}
	system "svn co ${svn_site}/admin"
	system "admin/checkout-all.sh smlnj"
}

post-fetch {
	cd ${workpath}/smlnj
	touch ml-yacc/src/yacc.grm.sig
	touch ml-yacc/src/yacc.grm.sml
}

extract  {
	system "mv ${workpath}/smlnj ${workpath}/${name}-${version}"
}

checksum { }
configure {}


### build ###
build.cmd            ${worksrcpath}/config/install.sh
build.target

### destroot ###
destroot {
	set smlnj_home ${prefix}/share/${name}

	file mkdir ${destroot}${smlnj_home}
	file copy ${worksrcpath}/bin ${destroot}${smlnj_home}
	file copy ${worksrcpath}/lib ${destroot}${smlnj_home}

	xinstall -m 555 ${filespath}/sml.sh ${destroot}${prefix}/bin/sml
	reinplace "s|__SMLNJ_HOME__|${smlnj_home}|g" \
		${destroot}${prefix}/bin/sml

	foreach prog [glob -directory ${worksrcpath}/bin *] {
		set progname [file tail $prog]
		if {![string equal $progname sml]} {
			system "ln -s sml ${destroot}${prefix}/bin/${progname}"
		}
	}
}
