# $Id: Portfile,v 1.21 2004/12/01 15:46:38 pguyot Exp $

PortSystem			1.0
name				ocaml
version				3.08.2
categories			lang
maintainers			pguyot@kallisys.net
description			Latest implementation of the Caml dialect of ML
long_description	\
	The main novelties compared with its ancestor, Caml Light, are: \
	1) Full support for objects and classes -- here combined for the \
	first time with ML-style type reconstruction. \
	2) A powerful module calculus in the style of Standard ML (but \
	retaining separate compilation). \
	3) A high-performance native code compiler (in addition to a Caml \
	Light-style bytecode compiler).
homepage			http://caml.inria.fr/ocaml
platforms			darwin freebsd
master_sites		http://caml.inria.fr/distrib/${name}-3.08/
checksums			md5 b79358a09884f5e679433cce284de43e
patchfiles			patch-Makefile \
					patch-asmrun-Makefile \
					patch-byterun-Makefile \
					patch-camlp4-Makefile \
					patch-camlp4-camlp4-Makefile \
					patch-camlp4-compile-Makefile \
					patch-camlp4-config-configure_batch \
					patch-camlp4-etc-Makefile \
					patch-camlp4-lib-Makefile \
					patch-camlp4-man-Makefile \
					patch-camlp4-meta-Makefile \
					patch-camlp4-ocaml_src-camlp4-Makefile \
					patch-camlp4-ocaml_src-lib-Makefile \
					patch-camlp4-ocaml_src-meta-Makefile \
					patch-camlp4-ocaml_src-odyl-Makefile \
					patch-camlp4-ocpp-Makefile \
					patch-camlp4-odyl-Makefile \
					patch-camlp4-top-Makefile \
					patch-configure \
					patch-debugger-Makefile \
					patch-emacs-Makefile \
					patch-man-Makefile \
					patch-ocamldoc-Makefile \
					patch-otherlibs-bigarray-Makefile \
					patch-otherlibs-dbm-Makefile \
					patch-otherlibs-dynlink-Makefile \
					patch-otherlibs-graph-Makefile \
					patch-otherlibs-labltk-browser-Makefile \
					patch-otherlibs-labltk-camltk-Makefile \
					patch-otherlibs-labltk-compiler-Makefile \
					patch-otherlibs-labltk-frx-Makefile \
					patch-otherlibs-labltk-jpf-Makefile \
					patch-otherlibs-labltk-labltk-Makefile \
					patch-otherlibs-labltk-lib-Makefile \
					patch-otherlibs-labltk-support-Makefile \
					patch-otherlibs-labltk-tkanim-Makefile \
					patch-otherlibs-num-Makefile \
					patch-otherlibs-str-Makefile \
					patch-otherlibs-systhreads-Makefile \
					patch-otherlibs-threads-Makefile \
					patch-otherlibs-unix-Makefile \
					patch-stdlib-Makefile \
					patch-tools-Makefile
distfiles			${name}-${version}${extract.suffix}

post-patch {
	reinplace "s|__PREFIX|${prefix}|g" ${worksrcpath}/configure
}

configure.env		CFLAGS=-no-cpp-precomp
configure.pre_args	--prefix ${prefix}
configure.args		--no-tk \
					--tk-no-x11 \
					--bindir ${prefix}/bin \
					--libdir ${prefix}/lib/ocaml \
					--mandir ${prefix}/share/man \
					--destroot ${destroot}

build.type			gnu
build.target		world.opt

# Variant with LablTk (tcl & tk bindings)
variant labltk	{
	depends_lib			lib:tcl8.4:tcl \
						lib:tk8.4:tk
	configure.args-delete	--no-tk \
							--tk-no-x11
}

# Unsupported variant: cvs
variant cvs {
	version		[clock format [clock seconds] -format %Y%m%d]
	distname	${name}-${version}

	fetch.type	cvs
	cvs.root	:pserver:anoncvs@camlcvs.inria.fr:/caml
	cvs.module	${name}
	cvs.args	-d ${distname}
	patchfiles-delete	patch-configure
	patchfiles-append	patch-configure-cvs
}
