# $Id$

PortSystem		1.0

name 			ocaml
version			3.12.0
# When updating ocaml, also update camlp5 to a compatible version (c.f. #26769, #20219, #18292)
set major_vers	[join [lrange [split ${version} .] 0 1] .]
platforms		darwin
maintainers		mww openmaintainer
categories		lang ml
description		Objective Caml is an implementation of the ML language
homepage		http://www.ocaml.org/
master_sites	http://caml.inria.fr/pub/distrib/ocaml-${major_vers}/ \
                ftp://ftp.inria.fr/INRIA/Projects/cristal/ocaml/ocaml-${major_vers}
checksums           md5     bd92c8970767f412bc1e9a6c625b5ccf \
                    sha1    33ebbfb1115806f117808f37e40d206c8994943d \
                    rmd160  3d10d5f7431d8200688fa74122e7ed528126a0fa

long_description \
			Objective Caml is an implementation of the ML language, based on \
			the Caml Light dialect extended with a complete class-based object \
			system	and a powerful module system in the style of Standard ML.

use_bzip2           yes
use_parallel_build  no
universal_variant   no

set docdir          ${prefix}/share/doc/${name}-${version}

# Configure.
configure.pre_args	-prefix ${prefix}
configure.args		-no-tk -cc ${configure.cc} -aspp \"${configure.cc} -c\"

# Building.
build.target		world.opt
build.cmd           "unset LD_PREBIND LD_PREBIND_ALLOW_OVERLAP && ${build.cmd}"

# Install.
destroot.target		install
destroot.destdir	BINDIR=${destroot}${prefix}/bin \
					LIBDIR=${destroot}${prefix}/lib/ocaml \
					MANDIR=${destroot}${prefix}/share/man

post-destroot {
    # Change "ld.conf" to remove ${destroot} in paths.
    reinplace "s:${destroot}::g" ${destroot}${prefix}/lib/ocaml/ld.conf
    xinstall -d ${destroot}${docdir}
    xinstall -m 0644 -W ${worksrcpath} Changes LICENSE README ${destroot}${docdir}
}

# Variants.
variant profile description {Enable profiling} {
	configure.env-append CC="gcc -pg"
}

variant labltk description {Include TK bindings and ocamlbrowser} {
	depends_lib		lib:tcl8.4:tcl lib:tk8.4:tk
	configure.args-delete 	-no-tk
}

livecheck.type	regex
livecheck.url	http://caml.inria.fr/news.en.rss
livecheck.regex	"<title>Objective Caml (.*) released"
