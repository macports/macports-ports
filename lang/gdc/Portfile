# $Id: Portfile,v 1.2 2005/11/22 13:26:51 mww Exp $

PortSystem 1.0

name			gdc
version			0.16
set gccversion	3.3.6
categories		lang
platforms		darwin
maintainers		mww@opendarwin.org
description		D language compiler
long_description	gcc 3.3 with D language frontend

homepage		http://www.digitalmars.com/d/
master_sites	http://home.earthlink.net/~dvdfrdmn/d/:gdc \
				gnu:/gcc/gcc-${gccversion}:gcc
distfiles		gdc-${version}.tar.bz2:gdc \
				gcc-core-${gccversion}.tar.bz2:gcc \
				gcc-g++-${gccversion}.tar.bz2:gcc
checksums		gdc-${version}.tar.bz2 md5 8591f5244088825573bbcff9aea1e1f3 \
				gcc-core-${gccversion}.tar.bz2 md5 18c52e6fb8966b7700665dca289d077f \
				gcc-g++-${gccversion}.tar.bz2 md5 6b3d00b8d079805be1b895f7f6ce47a0
use_bzip2		yes
dist_subdir		gcc33

depends_lib		port:libiconv

set bindir		${prefix}/lib/${name}/bin
worksrcdir		build

post-extract {
	file mkdir ${worksrcpath}
	system "ln -s ${workpath}/d ${workpath}/gcc-${gccversion}/gcc/d"
}

platform darwin 8 {
	configure.env CC=/usr/bin/gcc-3.3 CPP=/usr/bin/cpp-3.3 CXX=/usr/bin/g++-3.3
}

post-patch {
	system "cd ${workpath}/gcc-${gccversion}/ && gcc/d/setup-gcc.sh"
}

configure.cmd	${workpath}/gcc-${gccversion}/configure
configure.args	--enable-languages=d,c,c++ \
				--bindir=${bindir} \
				--libdir=${prefix}/lib/${name} \
				--includedir=${prefix}/include/${name} \
				--with-gxx-include-dir=${prefix}/include/${name} \
				--infodir=${prefix}/share/info \
				--mandir=${prefix}/share/man \
				--libexecdir=${prefix}/libexec/${name} \
				--with-system-zlib \
				--disable-nls \
				--with-local-prefix=${prefix}

build.target	bootstrap-lean

post-destroot {
	system "cd ${destroot}${prefix}/bin && \
		ln -sf ${bindir}/gdc && ln -sf ${bindir}/gdmd"
	foreach man1page {cpp gcc gcov g++} {
		file delete ${destroot}${prefix}/share/man/man1/${man1page}.1
	}
	file delete -force ${destroot}${prefix}/share/man/man7 \
		${destroot}${prefix}/share/info
}

