# $Id: Portfile,v 1.3 2005/01/31 05:49:29 waqar Exp $

PortSystem 1.0
name		gcl
version		2.6.6
revision	0
categories	lang
maintainers	waqar@opendarwin.org
description	GNU Common Lisp
long_description	\
	GCL is the official Common Lisp for the GNU project. Its design \
	makes use of the system's C compiler to compile to native 	\
	object code, providing for both good performance and facile 	\
	portability. On most platforms, GCL can load native object code \
	modules directly into its lisp core, where they are preserved 	\
	in any custom lisp images produced via the save-system call.
platforms	darwin
homepage       	http://www.gnu.org/software/gcl
master_sites	gnu
checksums	md5 45d67331b29cafc3e9b1eacb488044ec			\
		sha1 dd40a0afec1b6d13e99d7a931fd8e4f3f6816529
depends_lib	lib:libintl.3:gettext

patch 		{
	reinplace "s|/sw|${prefix}|g" 			\
			${worksrcpath}/h/powerpc-macosx.defs
	reinplace "s|/usr/local/lib|${prefix}/share|g"	\
			${worksrcpath}/info/makefile
	reinplace "s|/usr/share|${prefix}/share|g" 	\
			${worksrcpath}/configure
}

configure.env	CFLAGS="-no-cpp-precomp"

configure.args  --enable-machine=powerpc-macosx	\
		--prefix=${prefix}		\
		--enable-ansi			\
		--disable-statsysbfd 		\
		--disable-locbfd 		\
		--enable-custreloc 		\
		--enable-notify=no		\
		--mandir=${prefix}/share/man 	\
		--infodir=${prefix}/share/info	\
		--enable-infodir=${prefix}/share/info \
		--enable-emacsdir=${prefix}/share/emacs/site-lisp/gcl \
		--enable-readline 		\
		--without-x

post-configure	{
	reinplace "s|./default.el|${prefix}/etc/default.el|g" \
		${worksrcpath}/makedefs \
		${worksrcpath}/makedefc
	reinplace "s|/usr/share|${prefix}/share|g" \
		${worksrcpath}/makedefs \
		${worksrcpath}/makedefc
}

destroot.destdir       DESTDIR=${destroot}

variant x11	{
	configure.args-delete --without-x
	configure.args-append --with-x
}
