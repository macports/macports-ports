# $Id$

PortSystem          1.0

name                clojure
conflicts           clojure-devel
version             1.1.0
epoch               20091231
categories          lang java
maintainers         gmail.com:mdippery
description         The Clojure programming language
long_description    Clojure is a dynamic programming language for the JVM. \
                    It is interactive, yet compiled, with a robust \
                    infrastructure for concurrency. It is a functional \
                    dialect of Lisp, with a rich set of immutable, \
                    persistent data structures and a macro system.
homepage            http://clojure.org/
platforms           darwin
master_sites        googlecode:clojure

checksums           md5 9c9e92f85351721b76f40578f5c1a94a \
                    sha1 c253dd52734a008321a1db34439744a6d02587ea \
                    rmd160 8cb486181edf2a8e8d9ea061602d396304e503c4

use_zip             yes

use_configure       no
build               {}

variant readline conflicts rlwrap description {Use readline support} {
    depends_run-append port:jline
}

variant rlwrap conflicts readline description {Use rlwrap support for tab completion, parenthesis matching} {
    depends_run-append port:rlwrap
}

destroot {
    set javadir ${prefix}/share/java
    set clojuredir ${javadir}/clojure
    set clojurelibdir ${clojuredir}/lib
    set clojurebindir ${clojuredir}/bin
    set clojurebin ${clojurebindir}/clj
    set clojuresh clj.sh
    
    if {[variant_isset readline]} {
        set clojuresh clj-jline.sh
    }
    
    if {[variant_isset rlwrap]} {
        set clojuresh clj-rlwrap.sh
    }
    
    xinstall -m 0755 -d ${destroot}${javadir}
    xinstall -m 0755 -d ${destroot}${clojuredir}
    xinstall -m 0755 -d ${destroot}${clojurelibdir}
    xinstall -m 0755 -d ${destroot}${clojurebindir}
    xinstall -m 0644 -W ${workpath} clojure-${version}/clojure.jar ${destroot}${clojurelibdir}/clojure.jar
    xinstall -m 0755 -W ${filespath} ${clojuresh} ${destroot}${clojurebin}
    
    if {[variant_isset rlwrap]} {
        xinstall -m 0644 -W ${filespath} .clj_completions  ${destroot}${clojuredir}/.clj_completions
    }
    
    ln -s ${clojurebin} ${destroot}${prefix}/bin/clj
}
