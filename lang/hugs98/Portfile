# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0

name                hugs98
version             plus-Sep2006
revision            3
categories          lang
maintainers         nomaintainer
license             BSD
description         The HUGS Haskell Interpreter
long_description    Hugs 98 is a functional programming system based \
                    on Haskell 98, the de facto standard for non-strict \
                    functional programming languages. Hugs 98 provides \
                    an almost complete implementation of Haskell 98.

homepage            http://www.haskell.org/hugs/
master_sites        http://cvs.haskell.org/Hugs/downloads/2006-09/

checksums           rmd160  4a7e744360a29fbf94f5ac86ea559e80f12205a5 \
                    sha256  aafaca9ca544572ebef70bbe86b5eb0abaa5d7c11c0b766d7db72a46b022bed5 \
                    size    5322244

# Both FreeBSD and NetBSD add Bison dependency:
# https://github.com/NetBSD/pkgsrc/commit/edf0a1a8e9d42bc00117f4e31e4d85cefb64e0b0
depends_build       port:bison \
                    port:gmake
depends_lib         port:libedit \
                    port:xorg-libX11

patchfiles          patch-configure.ac.diff \
                    patch-O1.diff \
                    patch-gcc-inline.diff \
                    patch-GLUT.diff

# https://svnweb.freebsd.org/ports/head/lang/hugs/Makefile?revision=530719&view=co&pathrev=534092
# This is untested though; on PPC -O0 breaks the build.
if {${build_arch} eq "i386"} {
    patchfiles-replace \
                    patch-O1.diff patch-O0.diff
}

if {${os.platform} eq "darwin" && ${os.major} >= 10} {
    # This fixes the 'Undefined symbols: "_environ"' error
    patchfiles-append patch-environ.diff
    # This fixes the 'Undefined symbols: "renameFile_17' and 'readdir_40' errors
    patchfiles-append patch-libraries-tools-make-bootlib.diff
}

# Build has been failing with Clang in Macports previously.
# Nevertheless, it may be possible: https://github.com/NetBSD/pkgsrc/commit/69085621a4c0c14a468490f8c5760649975e80fa
compiler.blacklist  *clang*

use_autoconf        yes

use_parallel_build  no

build.cmd           ${prefix}/bin/gmake

platform darwin 10 powerpc {
    # We ought to convince Rosetta to build for the right arch
    configure.args-append CC="${configure.cc} -arch ppc" \
                          --build=powerpc-apple-darwin${os.major} \
                          --target=powerpc-apple-darwin${os.major}
}

livecheck.type      none
#livecheck.type      regex
#livecheck.url       ${master_sites}
#livecheck.regex     hugs98-\(plus-\[A-Za-z\]+200\[6-9\]\)\.tar.gz
