# $Id$

PortSystem 1.0
name			parrot
version			0.4.0
categories		lang devel
maintainers		bfulgham coleda.com:will
description		Open source virtual machine (for Perl and Python)
long_description	\
 	Parrot is the new interpreter being designed from scratch to support \
	the upcoming Perl 6 language.  It is being designed as a standalone \
	virtual machine that can be used to execute bytecode-compiled \
	dynamic languages such as Perl 6, Perl 5, Python, etc.

platforms		darwin
homepage		http://www.parrotcode.org/
master_sites		ftp://ftp.cpan.org/pub/CPAN/authors/id/L/LT/LTOETSCH/

checksums		md5 d8c3ff4f2dd9fd46867a9dcaf5cd0ed5

depends_build		bin:perl:perl5.8
depends_lib			port:gmp port:icu

configure.cmd		perl Configure.pl
configure.pre_args	--prefix=${prefix}/lib/parrot
configure.args		--jitcapable --optimize


build.type		gnu
build.target		

test.run		yes
test.target		test

destroot.destdir	 PREFIX=${destroot}${prefix}/lib/parrot

post-destroot {
	set bindir	${destroot}${prefix}/bin
	set docdir      ${destroot}${prefix}/share/doc/${name}
	set parrotpath	${destroot}${prefix}/lib/parrot
	system "cd ${bindir} && ln -sf ${prefix}/lib/parrot/bin/parrot"

	xinstall -m 755 -d ${docdir}

	foreach f { LICENSES NEWS PBC_COMPAT PLATFORMS RESPONSIBLE_PARTIES TODO } {
		file rename ${parrotpath}/${f} ${docdir}/${f}
	}
	system "cd ${parrotpath} && mv README* ${docdir}"
	system "cd ${parrotpath} && mv VERSION ${docdir}"
	system "cd ${parrotpath} && mv examples ${docdir}"

	system "cd ${parrotpath}/include && mv parrot ${destroot}${prefix}/include"
}

platform darwin 8 {
	configure.args-append --cc=/usr/bin/gcc-4.0 --link=/usr/bin/gcc-4.0 \
		--ld=/usr/bin/gcc-4.0 --cxx=/usr/bin/g++-4.0
}

