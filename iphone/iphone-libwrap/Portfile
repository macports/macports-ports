# $Id$

PortSystem	1.0
name		iphone-libwrap
version		7.6
categories	net
maintainers	nomaintainer
description	libwrap TCP Wrapper functionality for the iPhone.
long_description \
	libwrap implements generic TCP Wrapper functionality.

homepage	ftp://ftp.porcupine.org/pub/security/
master_sites	${homepage}

platforms	darwin
checksums	md5 e6fa25f71226d090f34de3f6b122fb5a

distname	tcp_wrappers_${version}

worksrcdir	${distname}

set iphone_prefix ${prefix}/arm-apple-darwin

use_configure	no

build.args	prefix=${prefix} CC=arm-apple-darwin-cc REAL_DAEMON_DIR=${prefix}/libexec
build.target	freebsd

post-extract {
	system "chmod -R u+w ${worksrcpath}"
	set files { 
		Makefile hosts_access.3 hosts_access.5 hosts_access.c \
		tcpd.8 tcpdchk.8 tcpdmatch.8
	}
	foreach file $files {
		reinplace s|/etc/hosts.\[allow|deny\]|${prefix}&|g ${worksrcpath}/$file
	}
}

destroot {
	global iphone_prefix
	set iphone_destdir_prefix ${destroot}/${iphone_prefix}/root${prefix}

	# Install binaries for phone access
	xinstall -m 755 -d ${iphone_destdir_prefix}
	xinstall -m 755 -d ${iphone_destdir_prefix}/sbin
	xinstall -m 755 -W ${worksrcpath} safe_finger tcpd tcpdchk tcpdmatch try-from ${iphone_destdir_prefix}/sbin

	# Install libraries/headers for cross-compilation
	xinstall -m 755 -d ${destroot}/${iphone_prefix}/lib
	xinstall -m 755 -d ${destroot}/${iphone_prefix}/include
	xinstall -m 644 ${worksrcpath}/libwrap.a ${destroot}/${iphone_prefix}/lib
	xinstall -m 644 ${worksrcpath}/tcpd.h ${destroot}/${iphone_prefix}/include

# Don't need man pages
#	xinstall -m 644 -W ${worksrcpath} hosts_access.3 \
#		${destdir}/share/man/man3

#	xinstall -m 644 -W ${worksrcpath} hosts_access.5 hosts_options.5 \
#		${destdir}/share/man/man5

#	xinstall -m 644 -W ${worksrcpath} tcpd.8 tcpdchk.8 tcpdmatch.8 \
#		${destdir}/share/man/man8
}
