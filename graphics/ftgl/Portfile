# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem                 1.0
PortGroup         github   1.0

github.setup      frankheckenbach ftgl 2.4.0 v
github.tarball_from archive
revision          2

categories        graphics
license           MIT
maintainers       nomaintainer

description       Freetype / OpenGL bridge
long_description  FTGL takes freetype fonts, decodes them, and generate an OpenGL \
                  object out of it.  It supports a lot of rendering modes.

checksums         rmd160  c904e2aa2e5dc5329867ce120f4b1ebe1910ff65 \
                  sha256  933a371dbb2f44c9fa3121484d46081b5f1ed08c18908ba49bff92811629aede \
                  size    630956

use_autoreconf              yes
autoreconf.env              LIBTOOLIZE=${prefix}/bin/glibtoolize
autoreconf.cmd              ./autogen.sh
autoreconf.args

depends_lib-append \
    port:freetype

depends_build-append \
    port:autoconf \
    port:automake \
    port:gsed \
    port:libtool \
    port:pkgconfig

patch.pre_args-replace      -p0 -p1

# These patch files are generated from `git format-patch v2.40.0..HEAD` and originally
# comprised 14 different patches. All patches have been modified to remove email address
# metadata.
#
# - Patches 1-5 and 7 do not relate to MacPorts and were omitted.
# - Patch 6 was modified to work after the removal of patch 3.
# - Patch 11 was folded into patch 10.
# - Patch 13 was folded into patch 12.
#
# Future revisions tracking this repository should only need to add new patch files using
# the same procedure.
patchfiles                  0006-use-GL_TEXTURE_BIT.patch \
                            0008-Use-AC_ARG_WITH-correctly.patch \
                            0009-Use-dylib_file-flag-correctly.patch \
                            0010-demo-support-latin1-keystrokes.patch \
                            0012-add-layout-height-width-and-depth-functions.patch \
                            0014-fix-type-error.patch

# Don't use MacPorts X11 since there doesn't seem to be a need to do so.
# Don't use MacPorts OpenGL (mesa) since that would bring in X11 deps.
configure.args-append       ac_cv_header_GL_gl_h=no \
                            ac_cv_header_GL_glu_h=no \
                            --with-gl-lib=/System/Library/Frameworks/OpenGL.framework/Libraries \
                            --with-glu-lib=/System/Library/Frameworks/OpenGL.framework/Libraries \
                            --without-x

# Skip building the example program by failing to find GLUT
configure.args-append       ac_cv_header_GL_glut_h=no \
                            ac_cv_header_GLUT_glut_h=no

# Build requires c++11 but does not seem to explicitly enable it...
configure.cxxflags-append -std=c++11
compiler.cxx_standard       2011

# Don't warn that OpenGL is deprecated in macOS; it clutters up the log.
configure.cflags-append     -DGL_SILENCE_DEPRECATION
configure.cxxflags-append   -DGL_SILENCE_DEPRECATION

# https://github.com/frankheckenbach/ftgl/issues/17
if {[string match *gcc* ${configure.compiler}]} {
    configure.cxxflags-append \
                            -fpermissive
}

variant doc description {build documentation} {
    depends_build-append    bin:doxygen:doxygen \
                            bin:dvips:texlive-basic \
                            bin:pdflatex:texlive-latex \
                            bin:epstopdf:texlive-fontutils \
                            bin:convert:ImageMagick
}

if {![variant_isset doc]} {
    configure.args-append   ac_cv_path_DOXYGEN=no \
                            ac_cv_path_DVIPS=no \
                            ac_cv_path_LATEX=no \
                            ac_cv_path_KPSEWHICH=no \
                            ac_cv_path_EPSTOPDF=no \
                            ac_cv_path_CONVERT=no
}
