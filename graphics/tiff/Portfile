# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           xcodeversion 1.0
PortGroup           muniversal 1.0

name                tiff
version             4.3.0
revision            1
checksums           rmd160  254477d12e79309cb82615eaad9946cc627a58f3 \
                    sha256  0e46e5acb087ce7d1ac53cf4f56a09b221537fc86dfc5daaad1c2e89e1b37ac8 \
                    size    2808254

categories          graphics
maintainers         {ryandesign @ryandesign} openmaintainer
license             BSD

description         Library and tools for dealing with Tag Image File Format
long_description    \
    This software provides support for the Tag Image File       \
    Format (TIFF), a widely used format for storing image       \
    data.  Included in this software distribution is a          \
    library, libtiff, for reading and writing TIFF, a small     \
    collection of tools for doing simple manipulations of       \
    TIFF images on UNIX systems, documentation on the library   \
    and tools.  A small assortment of TIFF-related software     \
    for UNIX that has been contributed by others is also        \
    included.  The library is capable of dealing with images    \
    that are written to follow the 5.0 or 6.0 TIFF spec.        \
    There is also considerable support for some of the more     \
    esoteric portions of the 6.0 TIFF spec.

homepage            http://simplesystems.org/libtiff/
master_sites        http://download.osgeo.org/libtiff/ \
                    freebsd

depends_lib         port:lerc \
                    path:include/turbojpeg.h:libjpeg-turbo \
                    port:xz \
                    port:zlib \
                    port:zstd

post-extract {
    # https://gitlab.com/libtiff/libtiff/-/issues/252
    move ${worksrcpath}/VERSION ${worksrcpath}/VERSION.txt
}

test.run            yes
test.target         check

compiler.c_standard 1999

patchfiles          allow-opengl-without-x11.patch \
                    dont-find-x11-opengl.patch \
                    rename-VERSION.patch

configure.args      --disable-jbig \
                    --disable-webp \
                    --with-x=no \
                    --with-docdir=${prefix}/share/doc/${name} \
                    --with-jpeg-include-dir=${prefix}/include \
                    --with-jpeg-lib-dir=${prefix}/lib \
                    --with-lerc-include-dir=${prefix}/include \
                    --with-lerc-lib-dir=${prefix}/lib \
                    --with-lzma-include-dir=${prefix}/include \
                    --with-lzma-lib-dir=${prefix}/lib \
                    --with-zlib-include-dir=${prefix}/include \
                    --with-zlib-lib-dir=${prefix}/lib \
                    --with-zstd-include-dir=${prefix}/include \
                    --with-zstd-lib-dir=${prefix}/lib

use_parallel_build  yes

minimum_xcodeversions {9 3.1}

post-destroot {
    # https://gitlab.com/libtiff/libtiff/-/issues/252
    move ${destroot}${prefix}/share/doc/${name}/VERSION.txt ${destroot}${prefix}/share/doc/${name}/VERSION
}

set merger_dont_diff ${prefix}/include/tiffconf.h

variant jbig description {Enable JBIG support} {
    depends_lib-append      port:jbigkit
    configure.args-replace  --disable-jbig --enable-jbig
    configure.args-append   --with-jbig-include-dir=${prefix}/include \
                            --with-jbig-lib-dir=${prefix}/lib
}

livecheck.type  regex
livecheck.url   [lindex ${master_sites} 0]
livecheck.regex "${name}-(\\d+(?:\\.\\d+)*)${extract.suffix}"
