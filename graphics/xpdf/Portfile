# $Id$
PortSystem 1.0
name         xpdf
version      3.01
revision     5
description  Xpdf is a viewer for PDF files.
long_description \
    Xpdf is a viewer for Portable Document Format \
    (PDF) files.  These are also sometimes also called \
    Acrobat files, from the name of Adobes PDF software.

maintainers    nomaintainer@macports.org
categories   graphics print
platforms    darwin 
homepage     http://www.foolabs.com/xpdf/

master_sites \
    ftp://ftp.foolabs.com/pub/xpdf/ \
    ftp://ftp.funet.fi/pub/TeX/CTAN/support/xpdf/ \
    ftp://ctan.unsw.edu.au/tex-archive/support/xpdf/ \
    ftp://ftp.tex.ac.uk/tex-archive/support/xpdf/ \
    ftp://ftp.kddlabs.co.jp/CTAN/support/xpdf/ \
    ftp://ftp.meiji.ac.jp/pub/TeX/CTAN/support/xpdf/ \
    ftp://ctan.tug.org/tex-archive/support/xpdf/ \
    ftp://ftp.dante.de/tex-archive/support/xpdf/ \
    ftp://gd.tuwien.ac.at/publishing/tex/CTAN/support/xpdf/ \
    ftp://ftp.ntnu.no/pub/tex/CTAN/support/xpdf/ \
    ftp://www.dnsbalance.ring.gr.jp/pub/text/CTAN/support/xpdf/ \
    http://www.t.ring.gr.jp/archives/text/CTAN/support/xpdf/ \
    ftp://ftp.chg.ru/pub/TeX/CTAN/support/xpdf/ \
    kde:security_patches/:kdesec
distfiles    ${distname}${extract.suffix} \
	     post-3.5.5-kdegraphics-CVE-2007-0104.diff:kdesec
checksums    ${distname}${extract.suffix} md5 e004c69c7dddef165d768b1362b44268 \
	     post-3.5.5-kdegraphics-CVE-2007-0104.diff md5 a690ce46117257609c2b43485ea4d0d7

depends_lib	 lib:libX11.6:XFree86 lib:libfreetype.6:freetype \
		     port:libpaper port:openmotif port:t1lib
depends_run  path:${prefix}/share/ghostscript/fonts:ghostscript

patchfiles      xpdf-3.01pl2.patch
patch.pre_args  -p1
post-patch {
    cd ${worksrcpath}
    reinplace "s|/usr/local|${prefix}|g" \
        doc/sample-xpdfrc xpdf/GlobalParams.cc
    system "patch -p2 < ${distpath}/post-3.5.5-kdegraphics-CVE-2007-0104.diff"
}

configure.args	\
    --with-x \
    --mandir=${prefix}/share/man \
    --with-appdef-dir=${prefix}/etc/X11/app-defaults \
    --with-Xp-library=${prefix}/lib \
    --with-Xp-includes=${prefix}/include \
    --with-Xt-library=${prefix}/lib \
    --with-Xt-includes=${prefix}/include \
    --with-Xm-library=${prefix}/lib \
    --with-Xm-includes=${prefix}/include \
    --with-t1-library=${prefix}/lib \
    --with-t1-includes=${prefix}/include \
    --with-libpaper-library=${prefix}/lib \
    --with-libpaper-includes=${prefix}/include \
    --with-freetype2-library=${prefix}/lib \
    --with-freetype2-includes=${prefix}/include/freetype2 \
    --enable-wordlist \
    --enable-opi
configure.env \
    CXXFLAGS="-I${prefix}/include/freetype2 -I${prefix}/include" \
    CFLAGS="-I/usr/X11R6/include" \
    CPPFLAGS="-I/usr/X11R6/include" \
    LDFLAGS="-lz"
    
variant a4 {
    configure.args-append --enable-a4-paper
}

platform puredarwin {
    depends_lib-delete port:openmotif
    depends_lib-append port:lesstif
    configure.args-delete \
        --with-Xp-library=${prefix}/lib \
        --with-Xp-includes=${prefix}/include \
        --with-Xt-library=${prefix}/lib \
        --with-Xt-includes=${prefix}/include \
        --with-Xm-library=${prefix}/lib \
        --with-Xm-includes=${prefix}/include
}

post-install {
    ui_msg " \
        Xpdf language support packages are also available at \
        http://www.foolabs.com/xpdf/download.html"
}        
        