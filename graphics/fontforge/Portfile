# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           cmake 1.1
PortGroup           github 1.0
PortGroup           compiler_blacklist_versions 1.0

github.setup        fontforge fontforge 3bba62de425c86d41937daf869c698fa04a1a223
version             20200202
# TODO: once the release gets out, we should put this back in place instead
# github.setup        fontforge fontforge 2020xxxx
# github.tarball_from releases

categories          graphics fonts
platforms           darwin
maintainers         nomaintainer
license             BSD
description         Outline and bitmap font editor/converter for many formats

long_description    FontForge allows you to edit outline and bitmap fonts.  You may create \
                    new ones or modify old ones.  It is also a format converter and can \
                    interconvert between PostScript (ascii & binary Type1, some Type3, \
                    some Type0), TrueType, OpenType (Type2), CID, SVG.  Previously known as \
                    pfaedit.

homepage            http://fontforge.github.io/

checksums           rmd160  91e30350c50a26ae42087f4c0d204d1d351f8bbc \
                    sha256  9f5f099fa71673cfa2b9be876ca76380f52a9e70db2c49eab0ca611fa7953e45 \
                    size    21806079

depends_build       port:pkgconfig

depends_lib         path:lib/pkgconfig/cairo.pc:cairo \
                    port:readline \
                    port:freetype \
                    port:gettext \
                    port:giflib \
                    port:jpeg \
                    port:libiconv \
                    port:libpng \
                    port:libspiro \
                    port:libuninameslist \
                    port:libxml2 \
                    path:lib/pkgconfig/pango.pc:pango \
                    port:potrace \
                    port:tiff \
                    port:woff2 \
                    port:zlib

cmake.generator     Ninja

# Needs C11
compiler.c_standard 2011
#compiler.blacklist  {clang < 500} *gcc-4.2 gcc-4.0 gcc-3.3
#configure.cflags-append -std=gnu11

configure.args      -DENABLE_GUI=OFF \
                    -DENABLE_LIBGIF=ON \
                    -DENABLE_LIBJPEG=ON \
                    -DENABLE_LIBPNG=ON \
                    -DENABLE_LIBREADLINE=ON \
                    -DENABLE_LIBSPIRO=ON \
                    -DENABLE_LIBTIFF=ON \
                    -DENABLE_LIBUNINAMESLIST=ON \
                    -DENABLE_PYTHON_EXTENSION=OFF \
                    -DENABLE_PYTHON_SCRIPTING=OFF \
                    -DENABLE_WOFF2=ON \
                    -DENABLE_WRITE_PFM=OFF \
                    -DENABLE_X11=OFF

# fix 32bit builds by masking an old Carbon call to GetTime
patchfiles-append   patch-fontforge-carbon-gettime-namecollision.diff

# use older noerr macros, and replace missing SRefCon definition
if {${os.platform} eq "darwin" && ${os.major} <= 9} {
    patchfiles-append \
                    patch-fontforge-startui-require-noerr-and-SRefCon-fix.diff \
}

# the date command on Tiger is too old for this port, use gnu coreutils dates instead
platform darwin 8 {
    depends_build-append port:coreutils
    configure.env-append PATH=${prefix}/libexec/gnubin/:$env(PATH)
}

variant python38 description {Enable Python support (Python 3.8)} {
    depends_lib-append      port:python38
    configure.python        ${prefix}/bin/python3.8
    configure.args-replace  -DENABLE_PYTHON_EXTENSION=OFF -DENABLE_PYTHON_EXTENSION=ON
    configure.args-replace  -DENABLE_PYTHON_SCRIPTING=OFF -DENABLE_PYTHON_SCRIPTING=ON
    # TODO: not sure what the correct location is
    configure.args-append   -DPYHOOK_INSTALL_DIR="${frameworks_dir}/Python.framework/Versions/3.8/lib/pkgconfig"
}

variant gui description {Enable GUI support} {
    PortGroup               app 1.0
    depends_lib-append      port:gtk3
    configure.args-replace  -DENABLE_GUI=OFF -DENABLE_GUI=ON
    app.name                FontForge
    app.icon                ${worksrcpath}/osx/FontForge.app/Contents/Resources/FontForge.icns
}

# TODO: any reason not to make these default?
default_variants    +python38 +gui
