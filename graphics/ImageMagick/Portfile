# $Id: Portfile,v 1.24 2005/10/19 08:10:08 blb Exp $

PortSystem			1.0
name				ImageMagick
version				6.2.4-3
revision			2
categories			graphics devel perl
maintainers			blb@opendarwin.org
description			Tools and libraries to manipulate images in many formats
long_description \
	A robust collection of tools and libraries to read, write, and \
	manipulate an image in many image formats (over 87 major formats) \
	including popular formats like TIFF, JPEG, PNG, PDF, PhotoCD, and GIF.  \
	With ImageMagick you can create images dynamically, making it suitable \
	for Web applications. You can also resize, rotate, sharpen, color \
	reduce, or add special effects to an image or image sequence and save \
	your completed work in the same or differing image format. Image \
	processing operations are available from the command line, as well as \
	through C, C++, Perl, or Java programming interfaces.

platforms			darwin

homepage			http://www.imagemagick.org/
master_sites		sourceforge:imagemagick \
					ftp://ftp.imagemagick.org/pub/${name}/ \
					ftp://ftp.imagemagick.net/pub/${name}/ \
					ftp://ftp.nluug.nl/pub/${name}/
use_bzip2			yes
checksums			md5 a5bbce232b53239de4b0236ed62ec436

worksrcdir			${name}-6.2.4

depends_lib			lib:libbz2:bzip2 lib:libjpeg:jpeg \
					lib:libpng:libpng lib:libtiff:tiff \
					lib:libz:zlib lib:libfreetype:freetype

platform darwin 6 {
	depends_lib-append	lib:libdl:dlcompat lib:libltdl:libtool
}

# patch-coders_dot.c is for graphviz 2.6 compatibility
patchfiles			patch-Makefile.in patch-coders_dot.c

configure.env		CPPFLAGS="-I${prefix}/include" LDFLAGS="-L${prefix}/lib"
configure.args		--enable-shared --disable-static --disable-ltdl-install \
					--with-dps --with-ttf --with-bzlib --with-jpeg \
					--with-png --with-tiff --with-zlib --with-modules \
					--without-x --without-perl --without-fpx \
					--without-gslib --without-jbig --without-jp2 \
					--without-lcms --without-wmf --without-xml \
					--without-gvc \
					--mandir=${prefix}/share/man

# Using gplghostscript instead of ghostscript as the former provides
# libgs and the latter appears not to at this time
variant gs {        
	depends_lib-append		lib:libgs:gplghostscript
	configure.args-delete	--without-gslib
	configure.args-append	--with-gslib 
}

variant lcms {
	depends_lib-append		lib:liblcms:lcms
	configure.args-delete	--without-lcms
	configure.args-append	--with-lcms
}

variant wmf {
	depends_lib-append		lib:libwmf:libwmf
	configure.args-delete	--without-wmf
	configure.args-append	--with-wmf
}

variant xml {
	depends_lib-append		lib:libxml:libxml2
	configure.args-delete	--without-xml
	configure.args-append	--with-xml
}

variant mpeg {
	depends_lib-append		bin:mpeg2encode:mpeg2vidcodec \
							bin:mpeg2decode:mpeg2vidcodec
}

variant jbig {
	depends_lib-append		lib:libjbig:jbigkit
	configure.args-delete	--without-jbig
	configure.args-append	--with-jbig
}

variant jpeg2 {
	depends_lib-append		lib:libjasper:jasper
	configure.args-delete	--without-jp2
	configure.args-append	--with-jp2
}

variant graphviz {
	depends_lib-append		lib:libgvc:graphviz
	configure.args-delete	--without-gvc
	configure.args-append	--with-gvc
}

variant perl {
	global perl5vlib
	set perl5bin			${prefix}/bin/perl
	set perl5vlib			${prefix}/lib/perl5/vendor_perl
	depends_lib-append		port:perl5.8
	configure.args-delete	--without-perl
	configure.args-append	--with-perl=${perl5bin} \
							--with-perl-options=INSTALLDIRS=vendor
	post-destroot {
		foreach packlist [exec find ${destroot}/${perl5vlib} -name .packlist] {
			ui_info "Fixing packlist ${packlist}"
			reinplace "s|${destroot}||" ${packlist}
		}
	}
}

variant x11 {
	depends_lib-append		lib:libX11.6:XFree86
	configure.args-delete	--without-x
	configure.args-append	--with-x
}

variant no-plus-plus {
	configure.args-append	--without-magick-plus-plus
}

