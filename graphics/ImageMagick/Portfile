# $Id$

PortSystem          1.0

name                ImageMagick
version             6.3.7-1
revision            1
homepage            http://www.imagemagick.org/
categories          graphics devel
maintainers         ryandesign
use_bzip2           yes
worksrcdir          ${name}-[lindex [split ${version} -] 0]
platforms           darwin

description \
	Tools and libraries to manipulate images in many formats

long_description \
	ImageMagick is a robust collection of tools and libraries to \
	create, edit and compose bitmap images in a wide variety of \
	formats. You can crop, resize, rotate, sharpen, color reduce or \
	add effects or text or straight or curved lines to an image or \
	image sequence and save your completed work in the same or \
	differing image format. You can even create images from scratch. \
	Image processing operations are available from the command line as \
	well as through C, Ch, C++, Java, Perl, PHP, Python, Ruby and Tcl/Tk \
	programming interfaces. Over 90 image formats are supported, \
	including GIF, JPEG, JPEG 2000, PNG, PDF, PhotoCD and TIFF.

master_sites \
	http://image_magick.veidrodis.com/image_magick/ \
	http://imagemagick.linux-mirror.org/download/ \
	http://ftp.surfnet.nl/pub/ImageMagick/ \
	sourceforge:imagemagick \
	ftp://ftp.imagemagick.net/pub/${name}/ \
	ftp://ftp.fifi.org/pub/ImageMagick/ \
	ftp://ftp.nluug.nl/pub/${name}/

checksums \
	md5 6c3522dc8c10405a06297fb671889098 \
	sha1 774de9d3a63cc58ad6891241b697918e19c57394 \
	rmd160 31f38a75ff8d3a07431e94e0598c6d0260c7ee3f

depends_lib \
	lib:libX11.6:XFree86 \
	port:bzip2 \
	port:jpeg \
	port:libpng \
	port:tiff \
	port:zlib \
	port:freetype \
	port:fontconfig \
	port:libiconv \
	port:expat \
	port:libxml2

depends_build \
	port:pkgconfig

configure.args \
	--enable-shared \
	--enable-static \
	--disable-ltdl-install \
	--with-dps \
	--with-ttf \
	--with-bzlib \
	--with-jpeg \
	--with-png \
	--with-tiff \
	--with-zlib \
	--with-modules \
	--with-xml \
	--with-x \
	--without-perl \
	--without-fpx \
	--without-gslib \
	--without-jbig \
	--without-jp2 \
	--without-lcms \
	--without-wmf \
	--without-gvc \
	--mandir=${prefix}/share/man

test.run            yes
test.target         check
test.env            DYLD_LIBRARY_PATH=${worksrcpath}/magick/.libs

variant perl {
	depends_lib-append \
		port:perl5.8
	configure.args-delete \
		--without-perl
	configure.args-append \
		--with-perl=${prefix}/bin/perl
}

variant gs {
	depends_lib-append \
		port:ghostscript
	configure.args-delete \
		--without-gslib
	configure.args-append \
		--with-gslib
}

variant lcms {
	depends_lib-append \
		port:lcms
	configure.args-delete \
		--without-lcms
	configure.args-append \
		--with-lcms
}

variant wmf {
	depends_lib-append \
		port:libwmf
	configure.args-delete \
		--without-wmf
	configure.args-append \
		--with-wmf
}

variant mpeg {
	depends_lib-append \
		port:mpeg2vidcodec
}

variant jbig {
	depends_lib-append \
		port:jbigkit
	configure.args-delete \
		--without-jbig
	configure.args-append \
		--with-jbig
}

variant jpeg2 {
	depends_lib-append \
		port:jasper
	configure.args-delete \
		--without-jp2
	configure.args-append \
		--with-jp2
}

variant graphviz {
	depends_lib-append \
		port:graphviz
	configure.args-delete \
		--without-gvc
	configure.args-append \
		--with-gvc
}

variant q8 conflicts q16 q32 description {Use 8 bits per pixel quantum} {
	configure.args-append --with-quantum-depth=8
}

variant q16 conflicts q8 q32 description {Use 16 bits per pixel quantum (default)} {
	configure.args-append --with-quantum-depth=16
}

variant q32 conflicts q8 q16 description {Use 32 bits per pixel quantum} {
	configure.args-append --with-quantum-depth=32
}

if {![variant_isset q8] && ![variant_isset q32]} {
	default_variants +q16
}

variant no_x11 {
	depends_lib-delete \
		lib:libX11.6:XFree86
	configure.args-delete \
		--with-x
	configure.args-append \
		--without-x
}

variant no_plus_plus {
	configure.args-append \
		--without-magick-plus-plus
}

platform darwin 6 {
	depends_lib-append \
		lib:libdl:dlcompat \
		lib:libltdl:libtool
}

platform darwin 8 {
	configure.compiler	gcc-4.0
}

livecheck.check     moddate
livecheck.url       ftp://ftp.imagemagick.net/pub/ImageMagick/SHA1SUM
