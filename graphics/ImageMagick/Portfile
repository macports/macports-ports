# $Id$

PortSystem          1.0

name                ImageMagick
set milestone       6.3.3
set patchlevel      7
version             ${milestone}-${patchlevel}
homepage            http://www.imagemagick.org/
categories          graphics devel
maintainers         ryandesign@macports.org
use_bzip2           yes
worksrcdir          ${name}-${milestone}
platforms           darwin

description \
	Tools and libraries to manipulate images in many formats

long_description \
	A robust collection of tools and libraries to read, write, and \
	manipulate an image in many image formats (over 87 major formats) \
	including popular formats like TIFF, JPEG, PNG, PDF, PhotoCD, and \
	GIF. With ImageMagick you can create images dynamically, making it \
	suitable for Web applications. You can also resize, rotate, sharpen, \
	color reduce, or add special effects to an image or image sequence \
	and save your completed work in the same or differing image format. \
	Image processing operations are available from the command line, as \
	well as through C, C++, Perl, or Java programming interfaces.

master_sites \
	http://imagemagick.linux-mirror.org/download/ \
	http://ftp.surfnet.nl/pub/ImageMagick/ \
	sourceforge:imagemagick \
	ftp://ftp.imagemagick.net/pub/${name}/ \
	ftp://ftp.fifi.org/pub/ImageMagick/ \
	ftp://ftp.nluug.nl/pub/${name}/

checksums \
	md5 54431ebe89d3dfeb8e70b8130686b3bb \
	sha1 edc2580526bd1992ff3ba50c0d39da28d596f299 \
	rmd160 de2e018002bd54846f68ce9b2a858c62d8d4d5d5

depends_lib \
	lib:libX11.6:XFree86 \
	port:bzip2 \
	port:jpeg \
	port:libpng \
	port:tiff \
	port:zlib \
	port:freetype \
	port:libxml2

configure.env	CPPFLAGS="-I${prefix}/include" LDFLAGS="-L${prefix}/lib"

configure.args \
	--enable-shared \
	--disable-static \
	--disable-ltdl-install \
	--with-dps \
	--with-ttf \
	--with-bzlib \
	--with-jpeg \
	--with-png \
	--with-tiff \
	--with-zlib \
	--with-modules \
	--with-xml \
	--with-x \
	--without-perl \
	--without-fpx \
	--without-gslib \
	--without-jbig \
	--without-jp2 \
	--without-lcms \
	--without-wmf \
	--without-gvc \
	--mandir=${prefix}/share/man

test.run            yes
test.target         check
test.env            DYLD_LIBRARY_PATH=${worksrcpath}/magick/.libs

variant perl {
	depends_lib-append \
		port:perl5.8
	configure.args-delete \
		--without-perl
	configure.args-append \
		--with-perl=${prefix}/bin/perl
}

# Using gplghostscript instead of ghostscript as the former provides
# libgs and the latter appears not to at this time
variant gs {
	depends_lib-append \
		port:gplghostscript
	configure.args-delete \
		--without-gslib
	configure.args-append \
		--with-gslib
}

variant lcms {
	depends_lib-append \
		port:lcms
	configure.args-delete \
		--without-lcms
	configure.args-append \
		--with-lcms
}

variant wmf {
	depends_lib-append \
		port:libwmf
	configure.args-delete \
		--without-wmf
	configure.args-append \
		--with-wmf
}

variant mpeg {
	depends_lib-append \
		port:mpeg2vidcodec
}

variant jbig {
	depends_lib-append \
		port:jbigkit
	configure.args-delete \
		--without-jbig
	configure.args-append \
		--with-jbig
}

variant jpeg2 {
	depends_lib-append \
		port:jasper
	configure.args-delete \
		--without-jp2
	configure.args-append \
		--with-jp2
}

variant graphviz {
	depends_lib-append \
		port:graphviz
	configure.args-delete \
		--without-gvc
	configure.args-append \
		--with-gvc
}

variant nox11 {
	depends_lib-delete \
		lib:libX11.6:XFree86
	configure.args-delete \
		--with-x
	configure.args-append \
		--without-x
}

variant no-plus-plus {
	configure.args-append \
		--without-magick-plus-plus
}

platform darwin 6 {
	depends_lib-append \
		lib:libdl:dlcompat \
		lib:libltdl:libtool
}

platform darwin 8 {
	configure.env-append \
		CC=/usr/bin/gcc-4.0 CPP=/usr/bin/cpp-4.0 CXX=/usr/bin/g++-4.0
}
