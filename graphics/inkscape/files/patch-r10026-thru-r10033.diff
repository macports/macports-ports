=== added file 'build-x64.xml'
--- build-x64.xml	1970-01-01 00:00:00 +0000
+++ build-x64.xml	2014-06-03 18:43:53 +0000
@@ -0,0 +1,1005 @@
+<!--
+ * Inkscape build file.
+ *
+ * See buildtool.cpp for use.
+ *
+ * Authors:
+ *   Bob Jamison
+ *   Others 
+ *
+ * Copyright (C) 2006-2008 Inkscape.org
+ *
+ *  This library is free software; you can redistribute it and/or
+ *  modify it under the terms of the GNU Lesser General Public
+ *  License as published by the Free Software Foundation; either
+ *  version 2.1 of the License, or (at your option) any later version.
+ *
+ *  This library is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *  Lesser General Public License for more details.
+ *
+ *  You should have received a copy of the GNU Lesser General Public
+ *  License along with this library; if not, write to the Free Software
+ *  Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+-->
+
+
+
+<!--
+########################################################################
+## P R O J E C T   :   I N K S C A P E
+########################################################################
+-->
+<project name="Inkscape" default="dist-all" basedir=".">
+    <description>
+        Build file for the Inkscape SVG editor.  This file
+        was written for GTK-2.10 on Win64, but it should work
+        well for other types of builds with only minor adjustments.
+        Note that the default target is 'dist-all'.  You can execute other
+        targets instead, by "btool {target}",  like  "btool compile", if
+        you want to save time, or "dist-inkscape" if you don't want inkview.
+    </description>
+
+  <!-- set global properties for this build -->
+  <property name="version"       value="0.48.5_64bit"/>
+  <property name="src"           location="src"/>
+  <property name="lib"           location="lib"/>
+  <property name="build"         location="build"/>
+  <property name="dist"          location="inkscape"/>
+
+  <!-- Use these settings for the native compiler -->  
+  <!-- -->
+  <property name="arch"          value="x86_64-w64-mingw32-"/>
+  <property name="archutil"      value=""/>
+  <property name="devlibs"       location="${env.DEVLIBS_PATH}"/>
+  <property name="mingw"         location="${env.MINGW_PATH}"/>
+  <property name="mingw_bin"     location="${env.MINGW_PATH}/bin"/>
+  <property name="cxxtest"       location="cxxtest"/>
+  <property name="python"        location="${devlibs}/python/python.exe"/>
+  <!-- -->
+
+  <!-- Use these settings for the cross compiler -->  
+  <!--
+  <property name="arch"          value="i686-pc-mingw32-"/>
+  <property name="archutil"      value="${arch}"/>
+  <property name="devlibs"       location="/target"/>
+  <property name="mingw_bin"     location="${env.MINGW_BIN}"/>
+  <property name="cxxtest"       location="cxxtest"/>
+  <property name="python"        location="python"/>
+  -->
+
+  <!-- Extra properties -->  
+  <property name="refresh"       value="false"/>
+
+  <!--
+    This is for package-config.  With these two settings, pkg-config
+    queries can be as simple as ${pcc.packageName} for cflags, and
+    ${pcl.packageName} for libs.  Dependencies are calculated automatically.
+  -->
+  <property name="pkg-config-path"   location="${devlibs}/lib/pkgconfig"/>
+  <property name="pkg-config-prefix" location="${devlibs}"/>
+
+
+  <!--
+  ########################################################################
+  ## T A R G E T    :    I N I T
+  ########################################################################
+  -->
+  <target name="init"
+      description=
+      "Do all preparatory tasks, like make directories and copy files">
+
+
+    <mkdir dir="${build}"/>
+    <mkdir dir="${build}/java"/>
+    <mkdir dir="${build}/java/classes"/>
+    <mkdir dir="${build}/java/lib"/>
+    <mkdir dir="${dist}"/>
+    
+    <copy file="${src}/helper/sp-marshal.h.mingw"
+          tofile="${src}/helper/sp-marshal.h"/>
+    <copy file="${src}/helper/sp-marshal.cpp.mingw"
+          tofile="${src}/helper/sp-marshal.cpp"/>
+          
+    <!--makefile file="${src}/inkscape-version.cpp">
+        namespace Inkscape {
+            char const *version_string = "${version}";
+        }
+    </makefile-->
+    <makefile file="${src}/inkscape-version.cpp">
+        namespace Inkscape {
+            char const *version_string = "${version} ${bzr.revision}";
+        }
+    </makefile>
+    <makefile file="config.h">
+        #ifndef _CONFIG_H_
+        #define _CONFIG_H_
+
+        #ifndef WIN32
+        #define WIN32
+        #endif
+
+        /*######################################
+        ## This is for require-config.h, whose
+        ## purpose I cannot fathom.
+        ######################################*/
+        
+        #define PACKAGE_TARNAME
+
+        /*######################################
+        #### RESOURCE DIRECTORIES
+        ######################################*/
+
+        #define INKSCAPE_DATADIR       "."
+        #define PACKAGE_LOCALE_DIR     "locale"
+
+
+        /*######################################
+        #### OTHER DEFINITIONS
+        ######################################*/
+
+        #define GETTEXT_PACKAGE "inkscape"
+
+        #define PACKAGE_STRING                VERSION
+
+        #define HAVE_GETOPT_H                 1
+        #define HAVE_STRING_H                 1
+        #define HAVE_LIBINTL_H                1
+        #define HAVE_MALLOC_H                 1
+        #define HAVE_STDLIB_H                 1
+        #define HAVE_SYS_STAT_H               1
+        #define HAVE_INTTYPES_H               1
+        #define HAVE_OPENMP                   1
+        #define HAVE_TR1_UNORDERED_SET        1
+
+        #define HAVE_LIBLCMS2                 1
+
+        #define WITH_GTKMM_2_24               1
+
+        #define ENABLE_NLS                    1
+        #define HAVE_BIND_TEXTDOMAIN_CODESET  1
+
+        /* keep binreloc off */
+        #define BR_PTHREADS 0
+        #undef ENABLE_BINRELOC
+
+        /* CairoPDF options */
+        #define HAVE_CAIRO_PDF                1
+        #define PANGO_ENABLE_ENGINE           1
+        #define RENDER_WITH_PANGO_CAIRO       1
+
+        #define HAVE_GTK_WINDOW_FULLSCREEN    1
+        
+        /* internal interpreter */
+        #define WITH_PYTHON                   1
+
+        /* shared whiteboard */
+        #undef WITH_INKBOARD
+        #undef HAVE_SSL
+        
+        /* use poppler for pdf import? */
+        #define HAVE_POPPLER                  1
+        #define HAVE_POPPLER_GLIB             1
+        #define HAVE_POPPLER_CAIRO            1
+        #define POPPLER_NEW_ERRORAPI          1 <!-- poppler changed the error api >= 0.20.0 -->
+        #define POPPLER_NEW_GFXPATCH          1
+        #define POPPLER_NEW_GFXFONT           1 <!-- poppler changed the api for 0.8.3 -->
+
+        /* do we want bitmap manipulation? */
+        #define WITH_IMAGE_MAGICK             1
+
+        /* Allow reading WordPerfect? */
+        #define WITH_LIBWPG                   1
+
+        /* Default  to libwpg 0.2.x */
+        #define WITH_LIBWPG02                 1
+
+        /* Do we support SVG Fonts? */
+        #define ENABLE_SVG_FONTS              1
+
+        /* Do we want experimental, unsupported, unguaranteed, etc., LivePathEffects enabled? */
+        //#define LPE_ENABLE_TEST_EFFECTS    1
+
+        //#define HAVE_ASPELL                   1
+
+        #endif /* _CONFIG_H_ */
+    </makefile>
+  </target>
+
+  <!--
+  ########################################################################
+  ## T A R G E T    :    C X X T E S T
+  ########################################################################
+  -->
+  <target name="cxxtest" depends="init"
+        description="generate test files" >
+
+    <!-- Generate CxxTest files -->
+    <cxxtestpart command="${python} ${cxxtest}/cxxtestgen.py --have-eh"
+                 out="${src}/test-src.cpp">
+        <fileset dir="${src}">
+            <include name="attributes-test.h"/>
+            <include name="color-profile-test.h"/>
+            <include name="dir-util-test.h"/>
+            <include name="extract-uri-test.h"/>
+            <include name="marker-test.h"/>
+            <include name="mod360-test.h"/>
+            <include name="preferences-test.h"/>
+            <include name="round-test.h"/>
+            <include name="sp-gradient-test.h"/>
+            <include name="sp-style-elem-test.h"/>
+            <include name="syle-test.h"/>
+            <include name="test-helpers.h"/>
+            <include name="verbs-test.h"/>
+        </fileset>
+    </cxxtestpart>
+    <cxxtestpart command="${python} ${cxxtest}/cxxtestgen.py --have-eh"
+                 out="${src}/display/test-display.cpp">
+        <fileset dir="${src}/display">
+            <include name="curve-test.h"/>
+        </fileset>
+    </cxxtestpart>
+    <cxxtestpart command="${python} ${cxxtest}/cxxtestgen.py --have-eh"
+                 out="${src}/helper/test-helper.cpp">
+        <fileset dir="${src}/helper">
+            <include name="units-test.h"/>
+        </fileset>
+    </cxxtestpart>
+    <cxxtestpart command="${python} ${cxxtest}/cxxtestgen.py --have-eh"
+                 out="${src}/libnr/test-nr.cpp">
+        <fileset dir="${src}/libnr">
+            <include name="nr-compose-test.h"/>
+            <include name="nr-types-test.h"/>
+            <include name="nr-translate-test.h"/>
+            <include name="nr-rotate-test.h"/>
+            <include name="nr-scale-test.h"/>
+            <include name="nr-point-fns-test.h"/>
+            <include name="nr-rotate-fns-test.h"/>
+            <include name="in-svg-plane-test.h"/>
+            <include name="nr-matrix-test.h"/>
+        </fileset>
+    </cxxtestpart>
+    <cxxtestpart command="${python} ${cxxtest}/cxxtestgen.py --have-eh"
+                 out="${src}/svg/test-svg.cpp">
+        <fileset dir="${src}/svg">
+            <include name="css-ostringstream-test.h"/>
+            <include name="stringstream-test.h"/>
+            <include name="svg-affine-test.h"/>
+            <include name="svg-color-test.h"/>
+            <include name="svg-length-test.h"/>
+            <include name="svg-path-geom-test.h"/>
+        </fileset>
+    </cxxtestpart>
+    <cxxtestpart command="${python} ${cxxtest}/cxxtestgen.py --have-eh"
+                 out="${src}/util/test-util.cpp">
+        <fileset dir="${src}/util">
+            <include name="list-container-test.h"/>
+        </fileset>
+    </cxxtestpart>
+    <cxxtestpart command="${python} ${cxxtest}/cxxtestgen.py --have-eh"
+                 out="${src}/xml/test-xml.cpp">
+        <fileset dir="${src}/xml">
+            <include name="repr-action-test.h"/>
+            <include name="quote-test.h"/>
+        </fileset>
+    </cxxtestpart>
+    <cxxtestroot command="${python} ${cxxtest}/cxxtestgen.py" 
+                 out="${src}/test-main.cpp"
+                 template="${src}/cxxtest-template.tpl">
+        <fileset dir="${src}">
+            <include name="MultiPrinter.h"/>
+            <include name="PylogFormatter.h"/>
+            <include name="TRPIFormatter.h"/>
+        </fileset>
+    </cxxtestroot>
+  </target>
+
+
+  <!--
+  ########################################################################
+  ## T A R G E T    :    C O M P I L E
+  ########################################################################
+  -->
+  <target name="compile" depends="cxxtest"
+        description="compile the source to .o" >
+
+    <!-- Compile from source to build -->
+    <cc cc="${arch}gcc" cxx="${arch}g++"
+             destdir="${build}/obj"
+             continueOnError="true"
+             refreshCache="${refresh}">
+        <fileset dir="${src}">
+            <!-- THINGS TO EXCLUDE -->
+            <exclude name="2geom/chebyshev.cpp"/>
+            <exclude name="ast/.*"/>
+            <exclude name="bonobo/.*"/>
+            <exclude name="deptool.cpp"/>
+            <exclude name="cxxtests.cpp"/>
+            <!--<exclude name="test-main.cpp"/>-->
+            <!--<exclude name="test-src.cpp"/>-->
+            <exclude name="display/test-display.cpp"/>
+            <exclude name="display/testnr.cpp"/>
+            <exclude name="dom/work/.*"/>
+            <exclude name="dom/odf/SvgOdg.cpp"/>
+            <exclude name="extension/api.cpp"/>
+            <exclude name="extension/dxf2svg/.*"/>
+            <exclude name="extension/implementation/plugin.cpp"/>
+            <exclude name="extension/script/bindtest.cpp"/>
+            <exclude name="extension/script/cpptest.cpp"/>
+            <exclude name="extension/plugin/.*"/>
+            <exclude name="extract-uri-test.cpp"/>
+            <exclude name="helper/units-test.cpp"/>
+            <!-- exclude name="inkview.cpp"/-->
+            <!--<exclude name="libnr/test-nr.cpp"/>-->
+            <exclude name="libnr/test-nr-main.cpp"/>
+            <exclude name="libnr/testnr.cpp"/>
+            <exclude name="libnr/in-svg-plane-test.cpp"/>
+            <exclude name="libnr/nr-matrix-test.cpp"/>
+            <exclude name="libnr/nr-point-fns-test.cpp"/>
+            <exclude name="libnr/nr-rotate-fns-test.cpp"/>
+            <exclude name="libnr/nr-rotate-test.cpp"/>
+            <exclude name="libnr/nr-scale-test.cpp"/>
+            <exclude name="libnr/nr-translate-test.cpp"/>
+            <exclude name="libnr/nr-types-test.cpp"/>
+            <exclude name="livarot/Path-test.cpp"/>
+            <exclude name="mod360-test.cpp"/>
+            <exclude name="trace/potrace/potest.cpp"/>
+            <exclude name="round-test.cpp"/>
+            <exclude name="sp-gradient-test.cpp"/>
+            <exclude name="style-test.cpp"/>
+            <exclude name="svg/ftos.cpp"/>
+            <!--<exclude name="svg/test-svg.cpp"/>-->
+            <exclude name="svg/test-svg-main.cpp"/>
+            <exclude name="util/list-container-test.cpp"/>
+            <exclude name="widgets/test-widgets.cpp"/>
+            <exclude name="xml/quote-test.cpp"/>
+            <exclude name="xml/repr-action-test.cpp"/>
+            <exclude name="xml/test-xml.cpp"/>
+            <!--<exclude name="xml/test-xml-main.cpp"/>-->
+            <exclude name="io/streamtest.cpp"/>
+            <!--JABBER-->
+            <exclude name="pedro/pedromain.cpp"/>
+            <exclude name="pedro/pedrogui.cpp"/>
+            <exclude name="pedro/pedrogui.h"/>
+            <exclude name="pedro/work/.*"/>
+            <!--WHITEBOARD-->
+            <exclude name="ui/dialog/session-player.cpp"/>
+            <exclude name="ui/dialog/whiteboard-connect.cpp"/>
+            <exclude name="ui/dialog/whiteboard-sharewithchat.cpp"/>
+            <exclude name="ui/dialog/whiteboard-sharewithuser.cpp"/>
+            <exclude name="dialogs/whiteboard-connect-dialog.cpp"/>
+            <exclude name="dialogs/whiteboard-common-dialog.cpp"/>
+            <exclude name="dialogs/whiteboard-sharewithchat-dialog.cpp"/>
+            <exclude name="dialogs/whiteboard-sharewithuser-dialog.cpp"/>
+            <exclude name="jabber_whiteboard/node-tracker.cpp"/>
+            <exclude name="jabber_whiteboard/node-utilities.cpp"/>
+            <!--OVERLAP-->
+            <exclude name="removeoverlap/placement_SolveVPSC.cpp"/>
+            <exclude name="removeoverlap/placement_SolveVPSC.h"/>
+            <exclude name="removeoverlap/test.cpp"/>
+            <exclude name="removeoverlap/remove_rectangle_overlap-test.cpp"/>
+            <exclude name="removeoverlap/remove_rectangle_overlap-test.h"/>
+        </fileset>
+        <excludeinc dir="${src}">
+            <file name="extension/param"/>
+        </excludeinc>
+        <flags>
+            -Wall -Wformat -Werror=format-security -W -Wpointer-arith -Wcast-align -Wsign-compare -Wswitch
+            -O2
+            -mms-bitfields
+            -fopenmp
+        </flags>
+        <cxxflags>
+            -std=gnu++0x -DCPP11  
+            -Woverloaded-virtual
+            -Wno-unused-local-typedefs
+        </cxxflags>
+        <defines>
+            -DVERSION=\"${version}\"
+            -DHAVE_CONFIG_H
+            -D_INTL_REDIRECT_INLINE
+            -DRELAYTOOL_SSL="static const int libssl_is_present=1; static int __attribute__((unused)) libssl_symbol_is_present(char *s){ return 1; }" <!-- inkboard -->
+        </defines>
+        <includes>
+            -I${devlibs}/include
+            <!-- GTK / GTKMM -->
+            ${pcc.gtkmm-2.4}
+            ${pcc.glibmm-2.4}
+            ${pcc.gtk+-2.0}
+            ${pcc.gdkmm-2.4}
+            ${pcc.pangomm-1.4}
+            ${pcc.cairomm-1.0}
+            <!-- OTHER -->
+      			${pcc.Magick++}
+			      ${pcc.libxml-2.0}
+            ${pcc.freetype2}
+            ${pcc.cairo}
+            ${pcc.poppler}
+            -I${devlibs}/include/gc
+            ${pcc.libwpg-0.2}
+            -I${cxxtest}
+            <!-- PERL -->
+            <!-- -Wno-comment -I${devlibs}/perl/lib/CORE -->
+            <!-- PYTHON -->
+            -I${devlibs}/python/include
+            <!-- JAVA -->
+            -I${src}/bind/javainc -I${src}/bind/javainc/win32
+        </includes>
+    </cc>
+  </target>
+  
+
+  <!--
+  ########################################################################
+  ## T A R G E T    :    L I B
+  ########################################################################
+  -->
+  <target name="lib" depends="compile"
+      description="create a static library">
+    <staticlib command="${archutil}ar crsv"
+           file="${build}/libinkscape.a">
+       <fileset dir="${build}/obj">
+           <exclude name="main.o"/>
+           <exclude name="winmain.o"/>
+           <exclude name="inkview.o"/>
+           <!-- CxxTest -->
+           <exclude name="test-main.o"/>
+           <exclude name="test-src.o"/>
+           <exclude name="display/test-display.o"/>
+           <exclude name="helper/test-helper.o"/>
+           <exclude name="libnr/nr-compose-reference.o"/>
+           <exclude name="libnr/test-nr.o"/>
+           <exclude name="svg/test-svg.o"/>
+           <exclude name="util/test-util.o"/>
+           <exclude name="xml/test-xml.o"/>
+       </fileset>
+    </staticlib>
+  </target>
+
+
+
+  <!--
+  ########################################################################
+  ## T A R G E T    :    I 1 8 N
+  ########################################################################
+  -->
+  <target name="i18n" depends="compile"
+      description="compile gettext .po files to .mo">
+
+    <msgfmt todir="${build}/locale" owndir="true"
+         out="LC_MESSAGES/inkscape.mo">
+       <fileset dir="po">
+       </fileset>
+    </msgfmt>
+  </target>
+
+
+
+
+
+  <!--
+  ########################################################################
+  ## T A R G E T    :    L I N K
+  ########################################################################
+  -->
+  <target name="link" depends="lib"
+      description="link objects and library to create executable">
+
+    <rc command="${archutil}windres" 
+        file="${src}/inkscape-x64.rc"
+        out="${build}/inkres.o">
+        <flags>
+        --include-dir=${src}
+        </flags>
+    </rc>
+    <link command="${arch}g++" out="${build}/inkscape.exe"
+              strip="true" symfile="${build}/inkscape.dbg"
+              stripcommand="${archutil}strip"
+              objcopycommand="${archutil}objcopy">
+       <flags>
+           -mwindows -m64
+           -mthreads
+       </flags>
+       <fileset dir="${build}">
+           <include name="inkres.o"/>
+           <include name="obj/main.o"/>
+           <include name="obj/winmain.o"/>
+           <include name="libinkscape.a"/>
+       </fileset>
+       <!-- WARNING: If you change these libraries, don't forget to change them for inkview and cxxtests below as well! -->
+       <libs>
+           -L${devlibs}/lib
+           ${pcl.poppler-cairo} ${pcl.poppler-glib} ${pcl.poppler} 
+           ${pcl.gtkmm-2.4}  ${pcl.pangoft2} ${pcl.gthread-2.0}
+           ${devlibs}/bin/libxml2-2.dll
+           ${devlibs}/bin/libxslt-1.dll
+           ${devlibs}/bin/libexslt-0.dll
+           ${pcl.cairo} ${pcl.cairomm-1.0}
+           ${pcl.libwpg-0.2}
+           ${pcl.glibmm-2.4}
+           ${pcl.gtk+-2.0}
+           ${pcl.gdkmm-2.4}
+           ${pcl.pangomm-1.4}
+           ${pcl.cairomm-1.0}
+           -liconv
+           ${pcl.Magick++}
+           ${pcl.fontconfig} ${pcl.freetype2}
+           ${pcl.lcms2}
+           ${pcl.gsl}
+           -lpng -ljpeg -ltiff -lpopt -lz
+           -lgc
+           -lws2_32 -lintl -lgdi32 -lcomdlg32 -lm
+           -lgomp -lwinpthread-1 
+           <!-- -laspell -->
+           -lmscms  <!-- required for color profiles -->
+       </libs>
+    </link>
+  </target>
+  
+<!--
+  ########################################################################
+  ## T A R G E T    :    L I N K C O N S O L E
+  ########################################################################
+  -->
+  <target name="linkconsole" depends="compile"
+        description="link console helper">
+
+    <link command="${arch}g++" out="${build}/inkscape-console.exe"
+              strip="true" stripcommand="${archutil}strip">
+       <flags>
+           -mwindows
+           -mthreads
+       </flags>
+       <fileset dir="${build}">
+           <include name="obj/winconsole.o"/>
+       </fileset>
+       <libs></libs>
+    </link>
+  </target>
+
+  <!--
+  ########################################################################
+  ## T A R G E T    :    L I N K I N K V I E W
+  ########################################################################
+  -->
+  <target name="linkinkview" depends="lib"
+        description="link objects and library to create Inkview executable">
+
+    <rc command="${archutil}windres" 
+        file="${src}/inkview-x64.rc"
+        out="${build}/inkviewres.o">
+        <flags>
+        --include-dir=${src}
+        </flags>
+    </rc>
+    <link command="${arch}g++" out="${build}/inkview.exe"
+              strip="true" symfile="${build}/inkview.dbg"
+              stripcommand="${archutil}strip"
+              objcopycommand="${archutil}objcopy">
+       <flags>
+           -mwindows -m64
+           -mthreads
+       </flags>
+       <fileset dir="${build}">
+           <include name="inkviewres.o"/>
+           <include name="obj/inkview.o"/>
+           <include name="libinkscape.a"/>
+       </fileset>
+       <libs>
+           -L${devlibs}/lib
+           ${pcl.poppler-cairo} ${pcl.poppler-glib} ${pcl.poppler} 
+           ${pcl.gtkmm-2.4}  ${pcl.pangoft2} ${pcl.gthread-2.0}
+           ${devlibs}/bin/libxml2-2.dll
+           ${devlibs}/bin/libxslt-1.dll
+           ${devlibs}/bin/libexslt-0.dll
+           ${pcl.cairo} ${pcl.cairomm-1.0}
+           ${pcl.libwpg-0.2}
+           ${pcl.glibmm-2.4}
+           ${pcl.gtk+-2.0}
+           ${pcl.gdkmm-2.4}
+           ${pcl.pangomm-1.4}
+           ${pcl.cairomm-1.0}
+           -liconv
+           ${pcl.Magick++}
+           ${pcl.fontconfig} ${pcl.freetype2}
+           ${pcl.lcms2}
+           ${pcl.gsl}
+           -lpng -ljpeg -ltiff -lpopt -lz
+           -lgc
+           -lws2_32 -lintl -lgdi32 -lcomdlg32 -lm
+           -lgomp -lwinpthread-1 
+           <!-- -laspell -->
+           -lmscms  <!-- required for color profiles -->
+       </libs>
+    </link>
+  </target>
+
+
+
+  <!--
+  ########################################################################
+  ## T A R G E T    :    L I N K C X X T E S T S
+  ########################################################################
+  -->
+  <target name="linkcxxtests" depends="lib"
+      description="link objects and library to create executable">
+
+    <link command="${arch}g++" out="${build}/cxxtests.exe"
+              strip="true" symfile="${build}/cxxtests.dbg"
+              stripcommand="${archutil}strip"
+              objcopycommand="${archutil}objcopy">
+       <flags>
+           -mthreads
+       </flags>
+       <fileset dir="${build}">
+           <include name="obj/test-main.o"/>
+           <include name="obj/test-src.o"/>
+           <include name="obj/display/test-display.o"/>
+           <include name="obj/helper/test-helper.o"/>
+           <include name="obj/libnr/nr-compose-reference.o"/>
+           <include name="obj/libnr/test-nr.o"/>
+           <include name="obj/svg/test-svg.o"/>
+           <include name="obj/util/test-util.o"/>
+           <include name="obj/xml/test-xml.o"/>
+           <include name="libinkscape.a"/>
+       </fileset>
+       <libs>
+           -L${devlibs}/lib
+           ${pcl.poppler-cairo} ${pcl.poppler-glib} ${pcl.poppler} 
+           ${pcl.gtkmm-2.4}  ${pcl.pangoft2} ${pcl.gthread-2.0}
+           ${devlibs}/bin/libxml2-2.dll
+           ${devlibs}/bin/libxslt-1.dll
+           ${devlibs}/bin/libexslt-0.dll
+           ${pcl.cairo} ${pcl.cairomm-1.0}
+           ${pcl.libwpg-0.2}
+           ${pcl.glibmm-2.4}
+           ${pcl.gtk+-2.0}
+           ${pcl.gdkmm-2.4}
+           ${pcl.pangomm-1.4}
+           ${pcl.cairomm-1.0}
+           -liconv
+           ${pcl.Magick++}
+           ${pcl.fontconfig} ${pcl.freetype2}
+           ${pcl.lcms2}
+           ${pcl.gsl}
+           -lpng -ljpeg -ltiff -lpopt -lz
+           -lgc
+           -lws2_32 -lintl -lgdi32 -lcomdlg32 -lm
+           -lgomp -lwinpthread-1 
+           <!-- -laspell -->
+           -lmscms  <!-- required for color profiles -->
+       </libs>
+    </link>
+  </target>
+
+
+  <!--
+  ########################################################################
+  ## T A R G E T    :    D I S T B A S E
+  ########################################################################
+  -->
+  <target name="distbase" depends="i18n"
+      description="generate the distribution directory with all needed files">
+
+    <!-- Create the distribution directory -->
+    <copy todir="${dist}" file="AUTHORS"/>
+    <copy todir="${dist}" file="COPYING"/>
+    <copy todir="${dist}" file="COPYING.LIB"/>
+    <copy todir="${dist}" file="NEWS"/>
+    <copy todir="${dist}" file="README"/>
+    <copy todir="${dist}" file="TRANSLATORS"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libatkmm-1.6-1.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libglibmm-2.4-1.dll"/>
+	<copy todir="${dist}" file="${devlibs}/bin/libgiomm-2.4-1.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libgtkmm-2.4-1.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libgdkmm-2.4-1.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libpangomm-1.4-1.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libcairomm-1.0-1.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libsigc-2.0-0.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libfreetype-6.dll"/>
+
+    <copy todir="${dist}" file="${devlibs}/bin/libffi-6.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libgc-1.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libgsl-0.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libgslcblas-0.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libharfbuzz-0.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/liblzma-5.dll"/>
+
+    <copy todir="${dist}" file="${devlibs}/bin/libatk-1.0-0.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libgdk-win32-2.0-0.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libgdk_pixbuf-2.0-0.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libglib-2.0-0.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libgmodule-2.0-0.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libgobject-2.0-0.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libgtk-win32-2.0-0.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libgthread-2.0-0.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libgio-2.0-0.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libcairo-2.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libpixman-1-0.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libpoppler-43.dll"/>
+	  <copy todir="${dist}" file="${devlibs}/bin/libpoppler-glib-8.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libpangocairo-1.0-0.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libpango-1.0-0.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libpangoft2-1.0-0.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libpangowin32-1.0-0.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libfontconfig-1.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libxml2-2.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libxslt-1.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libexslt-0.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libwpg-0.2.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libwpd-0.9.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libwpd-stream-0.9.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libjpeg-9.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libpng16-16.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libtiff-5.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/msvcr70.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/msvcr71.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/zlib1.dll"/>
+	  <copy todir="${dist}" file="${devlibs}/bin/bz2-1.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libiconv-2.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libpopt-0.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/liblcms2-2.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libMagick++-6.Q16-3.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libMagickCore-6.Q16-2.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libMagickWand-6.Q16-2.dll"/>
+    <copy todir="${dist}" file="${devlibs}/bin/libintl-8.dll"/>
+    <!-- MINGW support DLLs -->
+    <copy todir="${dist}" file="${mingw_bin}/libstdc++-6.dll"/>
+    <copy todir="${dist}" file="${mingw_bin}/libwinpthread-1.dll"/>
+    <copy todir="${dist}" file="${mingw_bin}/libgcc_s_sjlj-1.dll"/>
+    <!-- MINGW support DLLs needed for openmp support  -->
+    <copy todir="${dist}" file="${mingw_bin}/libgomp-1.dll"/>
+
+    <!-- MSGFMT files -->
+    <copy todir="${dist}">
+        <fileset dir="${build}/locale">
+          <exclude name=".*\.am"/>
+        </fileset>
+    </copy>
+
+    <mkdir dir="${dist}/data"/>
+    <mkdir dir="${dist}/locale"/>
+    <mkdir dir="${dist}/modules"/>
+    <mkdir dir="${dist}/plugins"/>
+
+    <!-- GTK -->
+    <copy todir="${dist}">     <fileset dir="${devlibs}/etc"/> </copy>
+    <copy todir="${dist}/lib"> <fileset dir="${devlibs}/lib/gtk-2.0"/> </copy>
+    <copy todir="${dist}/lib"> <fileset dir="${devlibs}/lib/glib-2.0"/> </copy>
+    <copy todir="${dist}">
+        <fileset dir="share">
+          <exclude name=".*\.am"/>
+          <exclude name=".*\.in"/>
+          <exclude name=".*\.sh"/>
+        </fileset>
+    </copy>
+    <copy todir="${dist}/share"> <fileset dir="${devlibs}/share/locale"/> </copy>
+    <copy todir="${dist}/share"> <fileset dir="${devlibs}/share/themes"/> </copy>
+    <copy todir="${dist}/lib">
+        <fileset dir="${devlibs}/lib/gdk-pixbuf-2.0">
+          <exclude name=".*\.la"/>
+          <exclude name=".*\.dll.a"/>
+        </fileset>
+    </copy>
+
+    <!-- <copy todir="${dist}/share"> <fileset dir="${devlibs}/share/poppler"/> </copy> -->
+    <!-- <copy todir="${dist}" file="${mingw_bin}/gdb.exe"/> -->
+    <!-- Quick fix for the following problem: having the hicolor folder there with empty index file bugs booting inkscape... -->
+    <delete dir="${dist}/share/icons/hicolor"/>
+    <!-- Aspell dictionaries -->
+    <!-- <copy todir="${dist}/lib"> <fileset dir="${devlibs}/lib/aspell-0.60"/> </copy> -->
+
+    <!-- Necessary to run extensions on windows if it is not in the path -->
+    <copy todir="${dist}" file="${devlibs}/bin/gspawn-win64-helper.exe"/>
+    <copy todir="${dist}" file="${devlibs}/bin/gspawn-win64-helper-console.exe"/>
+
+    <!-- PERL -->
+    <copy todir="${dist}" file="${devlibs}/perl/bin/perl58.dll"/>
+
+    <!-- PYTHON -->
+    <copy todir="${dist}" file="${devlibs}/python/python26.dll"/>
+    <copy todir="${dist}/python" file="${devlibs}/python/python.exe" />
+    <copy todir="${dist}/python" file="${devlibs}/python/pythonw.exe"/>
+    <copy todir="${dist}/python"> <fileset dir="${devlibs}/python/Lib"/> </copy>
+    <copy todir="${dist}/python"> <fileset dir="${devlibs}/python/DLLs"/> </copy>
+    <!-- <copy todir="${dist}/python"> <fileset dir="${devlibs}/python/Scripts"/> </copy> -->
+
+    <!--<copy file="${devlibs}/share/themes/MS-Windows/gtk-2.0/gtkrc" todir="${dist}/etc/gtk-2.0"/>-->
+    <makefile file="${dist}/etc/gtk-2.0/gtkrc">
+    gtk-icon-sizes = "gtk-menu=16,16:gtk-small-toolbar=16,16:gtk-large-toolbar=24,24:gtk-dnd=32,32:inkscape-decoration=16,16"
+    gtk-toolbar-icon-size = small-toolbar
+
+    # disable images in buttons. i've only seen ugly delphi apps use this feature.
+    gtk-button-images = 0
+    
+    # disable the annoying beep in editable controls
+    gtk-error-bell = 0
+
+    # enable/disable images in menus. most "stock" microsoft apps don't use these, except sparingly.
+    # the office apps use them heavily, though.
+    gtk-menu-images = 1
+
+    # use the win32 button ordering instead of the GNOME HIG one, where applicable
+    gtk-alternative-button-order = 1
+
+    style "msw-default"
+    {
+      GtkWidget::interior-focus = 1
+      GtkOptionMenu::indicator-size = { 9, 5 }
+      GtkOptionMenu::indicator-spacing = { 7, 5, 2, 2 }
+      GtkSpinButton::shadow-type = in
+
+      # Owen and I disagree that these should be themable
+      #GtkUIManager::add-tearoffs = 0
+      #GtkComboBox::add-tearoffs = 0
+
+      GtkComboBox::appears-as-list = 1
+      GtkComboBox::focus-on-click = 0
+
+      GOComboBox::add_tearoffs = 0
+
+      GtkTreeView::allow-rules = 0
+      GtkTreeView::expander-size = 12
+
+      GtkExpander::expander-size = 12
+
+      GtkScrolledWindow::scrollbar_spacing = 1
+
+      GtkSeparatorMenuItem::horizontal-padding = 2
+
+      engine "wimp"
+      {
+      }
+    }
+    class "*" style "msw-default"
+    </makefile>
+
+  </target>
+
+
+  <!--
+  ########################################################################
+  ## T A R G E T    :    D I S T - I N K S C A P E
+  ########################################################################
+  -->
+  <target name="dist-inkscape" depends="link,linkconsole,distbase"
+      description="copy inkscape to the distribution directory">
+
+    <!-- Create the distribution directory -->
+    <copy todir="${dist}" file="${build}/inkscape.exe"/>
+    <copy todir="${dist}" file="${build}/inkscape.dbg"/>
+    <copy file="${build}/inkscape-console.exe" tofile="${dist}/inkscape.com"/>
+  </target>
+
+
+  <!--
+  ########################################################################
+  ## T A R G E T    :    D I S T - I N K V I E W
+  ########################################################################
+  -->
+  <target name="dist-inkview" depends="linkinkview,distbase"
+      description="copy inkview to the distribution directory">
+
+    <!-- Create the distribution directory -->
+    <copy todir="${dist}" file="${build}/inkview.exe"/>
+    <copy todir="${dist}" file="${build}/inkview.dbg"/>
+  </target>
+
+
+  <!--
+  ########################################################################
+  ## T A R G E T    :    C H E C K
+  ########################################################################
+  -->
+  <target name="check" depends="linkcxxtests,distbase"
+      description="perform unit tests">
+    <cxxtestrun command="${build}/cxxtests" workingdir="${dist}" />
+  </target>
+
+
+  <!--
+  ########################################################################
+  ## T A R G E T    :    JAVAC
+  ########################################################################
+  -->
+  <target name="javac" depends="init"
+      description="compile java binding classes">
+    <javac srcdir="${src}/bind/java" destdir="${build}/java/classes"/>
+  </target>
+
+
+  <!--
+  ########################################################################
+  ## T A R G E T    :    JAR
+  ########################################################################
+  -->
+  <target name="jar" depends="javac"
+      description="pack java classes and resources into a jar file">
+    <copy todir="${build}/java/classes"> <fileset dir="${devlibs}/bind/data"/> </copy>
+    <jar basedir="${build}/java/classes" destfile="${build}/java/lib/inkscape.jar"/>
+  </target>
+
+  <!--
+  ########################################################################
+  ## T A R G E T    :    BINDDIST
+  ########################################################################
+  -->
+  <target name="binddist" depends="jar"
+      description="pack java classes and resources into a jar file">
+    <copy todir="${dist}/share/bind"> <fileset dir="${devlibs}/bind/java"/> </copy>
+    <copy todir="${dist}/share/bind/java"> <fileset dir="${build}/java/lib"/> </copy>
+
+  </target>
+
+  <!--
+  ########################################################################
+  ## T A R G E T    :    BINDCLEAN
+  ########################################################################
+  -->
+  <target name="bindclean" depends=""
+      description="clean up java binding classes">
+        <delete dir="${build}/java"/>
+  </target>
+
+
+
+
+  <!--
+  ########################################################################
+  ## T A R G E T    :    D I S T - A L L
+  ########################################################################
+  -->
+  <target name="dist-all" depends="dist-inkscape,dist-inkview"
+        description="generate the distribution, along with inkview" >
+  </target>
+
+
+
+
+  <!--
+  ########################################################################
+  ## T A R G E T    :    D I S T - A L L - C H E C K
+  ########################################################################
+  -->
+  <target name="dist-all-check" depends="dist-all,check"
+        description="generate the distribution, along with inkview and run cxxtests" >
+  </target>
+
+
+
+
+
+  <!--
+  ########################################################################
+  ## T A R G E T    :    C L E A N
+  ########################################################################
+  -->
+  <target name="clean" depends="bindclean"
+        description="clean up.  deleting build and distro dirs" >
+
+    <delete dir="${build}"/>
+    <delete dir="${dist}"/>
+    <delete file="build.dep"/>
+    <delete file="config.h"/>
+    <delete file="${src}/inkscape-version.cpp"/>
+    <delete file="${src}/test-main.cpp"/>
+    <delete file="${src}/test-src.cpp"/>
+    <delete file="${src}/display/test-display.cpp"/>
+    <delete file="${src}/helper/test-helper.cpp"/>
+    <delete file="${src}/libnr/test-nr.cpp"/>
+    <delete file="${src}/svg/test-svg.cpp"/>
+    <delete file="${src}/util/test-util.cpp"/>
+    <delete file="${src}/xml/test-xml.cpp"/>
+
+  </target>
+
+
+
+</project>
+<!--
+########################################################################
+## E N D
+########################################################################
+-->
+

=== modified file 'configure.ac'
--- configure.ac	2013-11-02 17:43:31.000000000 -0700
+++ configure.ac	2014-06-03 11:43:53.000000000 -0700
@@ -588,6 +588,11 @@
 	AC_MSG_RESULT(no)
 fi
 
+PKG_CHECK_MODULES(POPPLER_EVEN_NEWER_COLOR_SPACE_API, poppler >= 0.26.0, popplernewercolorspaceapi=yes, popplernewercolorspaceapi=no)
+if test "x$popplernewercolorspaceapi" = "xyes"; then
+	AC_DEFINE(POPPLER_EVEN_NEWER_COLOR_SPACE_API, 1, [Use even newer color space API from Poppler >= 0.26.0])
+fi
+
 # Poppler's b604a008 commit changes this
 AC_MSG_CHECKING([whether Poppler's GfxPatch no longer uses GfxColor])
 popplergfxcolor="no"
=== modified file 'share/extensions/inkscape_help_reportabug.inx'
--- share/extensions/inkscape_help_reportabug.inx	2008-04-30 06:37:58.000000000 -0700
+++ share/extensions/inkscape_help_reportabug.inx	2014-06-03 11:43:53.000000000 -0700
@@ -3,7 +3,7 @@
     <_name>Report a Bug</_name>
     <id>org.inkscape.help.reportabug</id>
 	<dependency type="executable" location="extensions">launch_webbrowser.py</dependency>
-	<param name="url" gui-hidden="true" type="string">http://inkscape.org/report_bugs.php</param>
+	<param name="url" gui-hidden="true" type="string">http://inkscape.org/contribute/report-bugs/</param>
     <effect needs-document="false">
 		<object-type>all</object-type>
 		<effects-menu hidden="true"/>
=== modified file 'share/extensions/scour.py'
--- share/extensions/scour.py	2010-05-20 10:47:48.000000000 -0700
+++ share/extensions/scour.py	2014-06-03 11:43:53.000000000 -0700
@@ -7,11 +7,14 @@
 #
 #  This file is part of Scour, http://www.codedread.com/scour/
 #
-#   Licensed under the Apache License, Version 2.0 (the "License");
-#   you may not use this file except in compliance with the License.
-#   You may obtain a copy of the License at
+#   This library is free software; you can redistribute it and/or modify
+#   it either under the terms of the Apache License, Version 2.0, or, at
+#   your option, under the terms and conditions of the GNU General
+#   Public License, Version 2 or newer as published by the Free Software
+#   Foundation.  You may obtain a copy of these Licenses at:
 #
 #       http://www.apache.org/licenses/LICENSE-2.0
+#       https://www.gnu.org/licenses/old-licenses/gpl-2.0.html
 #
 #   Unless required by applicable law or agreed to in writing, software
 #   distributed under the License is distributed on an "AS IS" BASIS,
=== modified file 'share/extensions/yocto_css.py'
--- share/extensions/yocto_css.py	2011-09-11 09:41:22.000000000 -0700
+++ share/extensions/yocto_css.py	2014-06-03 11:43:53.000000000 -0700
@@ -7,11 +7,14 @@
 #
 #  This file is part of Scour, http://www.codedread.com/scour/
 #
-#   Licensed under the Apache License, Version 2.0 (the "License");
-#   you may not use this file except in compliance with the License.
-#   You may obtain a copy of the License at
+#   This library is free software; you can redistribute it and/or modify
+#   it either under the terms of the Apache License, Version 2.0, or, at
+#   your option, under the terms and conditions of the GNU General
+#   Public License, Version 2 or newer as published by the Free Software
+#   Foundation.  You may obtain a copy of these Licenses at:
 #
 #       http://www.apache.org/licenses/LICENSE-2.0
+#       https://www.gnu.org/licenses/old-licenses/gpl-2.0.html
 #
 #   Unless required by applicable law or agreed to in writing, software
 #   distributed under the License is distributed on an "AS IS" BASIS,
=== modified file 'share/keys/right-handed-illustration.xml'
--- share/keys/right-handed-illustration.xml	2007-12-23 13:49:49.000000000 -0800
+++ share/keys/right-handed-illustration.xml	2014-06-03 11:43:53.000000000 -0700
@@ -540,7 +540,6 @@
 
 <!-- Help -->
 
-  <bind action="HelpKeys" />
   <bind action="HelpAboutExtensions" />
   <bind action="HelpAboutMemory" />
   <bind action="HelpAbout" />
=== modified file 'share/keys/xara.xml'
--- share/keys/xara.xml	2007-12-23 13:49:49.000000000 -0800
+++ share/keys/xara.xml	2014-06-03 11:43:53.000000000 -0700
@@ -543,7 +543,6 @@
 
 <!-- Help -->
 
-  <bind key="F1" action="HelpKeys" />
   <bind action="HelpAboutExtensions" />
   <bind action="HelpAboutMemory" />
   <bind action="HelpAbout" />
=== modified file 'src/extension/internal/pdfinput/pdf-parser.cpp'
--- src/extension/internal/pdfinput/pdf-parser.cpp	2014-03-12 17:27:46.000000000 -0700
+++ src/extension/internal/pdfinput/pdf-parser.cpp	2014-06-03 11:43:53.000000000 -0700
@@ -860,7 +860,9 @@
 	  blendingColorSpace = NULL;
 	  isolated = knockout = gFalse;
 	  if (!obj4.dictLookup(const_cast<char*>("CS"), &obj5)->isNull()) {
-#if defined(POPPLER_NEW_COLOR_SPACE_API) || defined(POPPLER_NEW_ERRORAPI)
+#if defined(POPPLER_EVEN_NEWER_COLOR_SPACE_API)
+	    blendingColorSpace = GfxColorSpace::parse(&obj5, NULL, NULL);
+#elif defined(POPPLER_NEW_COLOR_SPACE_API) || defined(POPPLER_NEW_ERRORAPI)
 	    blendingColorSpace = GfxColorSpace::parse(&obj5, NULL);
 #else
 	    blendingColorSpace = GfxColorSpace::parse(&obj5);
@@ -1083,7 +1085,13 @@
 
   state->setFillPattern(NULL);
   res->lookupColorSpace(args[0].getName(), &obj);
-#if defined(POPPLER_NEW_COLOR_SPACE_API) || defined(POPPLER_NEW_ERRORAPI)
+#if defined(POPPLER_EVEN_NEWER_COLOR_SPACE_API)
+  if (obj.isNull()) {
+    colorSpace = GfxColorSpace::parse(&args[0], NULL, NULL);
+  } else {
+    colorSpace = GfxColorSpace::parse(&obj, NULL, NULL);
+  }
+#elif defined(POPPLER_NEW_COLOR_SPACE_API) || defined(POPPLER_NEW_ERRORAPI)
   if (obj.isNull()) {
     colorSpace = GfxColorSpace::parse(&args[0], NULL);
   } else {
@@ -1118,7 +1126,13 @@
 
   state->setStrokePattern(NULL);
   res->lookupColorSpace(args[0].getName(), &obj);
-#if defined(POPPLER_NEW_COLOR_SPACE_API) || defined(POPPLER_NEW_ERRORAPI)
+#if defined(POPPLER_EVEN_NEWER_COLOR_SPACE_API)
+  if (obj.isNull()) {
+    colorSpace = GfxColorSpace::parse(&args[0], NULL, NULL);
+  } else {
+    colorSpace = GfxColorSpace::parse(&obj, NULL, NULL);
+  }
+#elif defined(POPPLER_NEW_COLOR_SPACE_API) || defined(POPPLER_NEW_ERRORAPI)
   if (obj.isNull()) {
     colorSpace = GfxColorSpace::parse(&args[0], NULL);
   } else {
@@ -1211,7 +1225,13 @@
       state->setFillColor(&color);
       builder->updateStyle(state);
     }
-#if defined(POPPLER_NEW_COLOR_SPACE_API) || defined(POPPLER_NEW_ERRORAPI)
+#if defined(POPPLER_EVEN_NEWER_COLOR_SPACE_API)
+    if (args[numArgs-1].isName() &&
+	(pattern = res->lookupPattern(args[numArgs-1].getName(), NULL, NULL))) {
+      state->setFillPattern(pattern);
+      builder->updateStyle(state);
+    }
+#elif defined(POPPLER_NEW_COLOR_SPACE_API) || defined(POPPLER_NEW_ERRORAPI)
     if (args[numArgs-1].isName() &&
 	(pattern = res->lookupPattern(args[numArgs-1].getName(), NULL))) {
       state->setFillPattern(pattern);
@@ -1271,7 +1291,13 @@
       state->setStrokeColor(&color);
       builder->updateStyle(state);
     }
-#if defined(POPPLER_NEW_COLOR_SPACE_API) || defined(POPPLER_NEW_ERRORAPI)
+#if defined(POPPLER_EVEN_NEWER_COLOR_SPACE_API)
+    if (args[numArgs-1].isName() &&
+	(pattern = res->lookupPattern(args[numArgs-1].getName(), NULL, NULL))) {
+      state->setStrokePattern(pattern);
+      builder->updateStyle(state);
+    }
+#elif defined(POPPLER_NEW_COLOR_SPACE_API) || defined(POPPLER_NEW_ERRORAPI)
     if (args[numArgs-1].isName() &&
 	(pattern = res->lookupPattern(args[numArgs-1].getName(), NULL))) {
       state->setStrokePattern(pattern);
@@ -1710,7 +1736,11 @@
   double *matrix = NULL;
   GBool savedState = gFalse;
 
-#if defined(POPPLER_NEW_COLOR_SPACE_API) || defined(POPPLER_NEW_ERRORAPI)
+#if defined(POPPLER_EVEN_NEWER_COLOR_SPACE_API)
+  if (!(shading = res->lookupShading(args[0].getName(), NULL, NULL))) {
+    return;
+  }
+#elif defined(POPPLER_NEW_COLOR_SPACE_API) || defined(POPPLER_NEW_ERRORAPI)
   if (!(shading = res->lookupShading(args[0].getName(), NULL))) {
     return;
   }
@@ -2726,7 +2756,9 @@
       }
     }
     if (!obj1.isNull()) {
-#if defined(POPPLER_NEW_COLOR_SPACE_API) || defined(POPPLER_NEW_ERRORAPI)
+#if defined(POPPLER_EVEN_NEWER_COLOR_SPACE_API)
+            colorSpace = GfxColorSpace::parse(&obj1, NULL, NULL);
+#elif defined(POPPLER_NEW_COLOR_SPACE_API) || defined(POPPLER_NEW_ERRORAPI)
       colorSpace = GfxColorSpace::parse(&obj1, NULL);
 #else
       colorSpace = GfxColorSpace::parse(&obj1);
@@ -2815,7 +2847,9 @@
 	  obj2.free();
 	}
       }
-#if defined(POPPLER_NEW_COLOR_SPACE_API) || defined(POPPLER_NEW_ERRORAPI)
+#if defined(POPPLER_EVEN_NEWER_COLOR_SPACE_API)
+            GfxColorSpace *maskColorSpace = GfxColorSpace::parse(&obj1, NULL, NULL);
+#elif defined(POPPLER_NEW_COLOR_SPACE_API) || defined(POPPLER_NEW_ERRORAPI)
       maskColorSpace = GfxColorSpace::parse(&obj1, NULL);
 #else
       maskColorSpace = GfxColorSpace::parse(&obj1);
@@ -3006,7 +3040,9 @@
     if (obj1.dictLookup(const_cast<char*>("S"), &obj2)->isName(const_cast<char*>("Transparency"))) {
       transpGroup = gTrue;
       if (!obj1.dictLookup(const_cast<char*>("CS"), &obj3)->isNull()) {
-#if defined(POPPLER_NEW_COLOR_SPACE_API) || defined(POPPLER_NEW_ERRORAPI)
+#if defined(POPPLER_EVEN_NEWER_COLOR_SPACE_API)
+	blendingColorSpace = GfxColorSpace::parse(&obj3, NULL, NULL);
+#elif defined(POPPLER_NEW_COLOR_SPACE_API) || defined(POPPLER_NEW_ERRORAPI)
 	blendingColorSpace = GfxColorSpace::parse(&obj3, NULL);
 #else
 	blendingColorSpace = GfxColorSpace::parse(&obj3);
=== modified file 'src/extension/internal/pdfinput/svg-builder.cpp'
--- src/extension/internal/pdfinput/svg-builder.cpp	2014-03-12 17:31:54.000000000 -0700
+++ src/extension/internal/pdfinput/svg-builder.cpp	2014-06-03 11:43:53.000000000 -0700
@@ -19,7 +19,6 @@
 #ifdef HAVE_POPPLER
 
 #include "svg-builder.h"
-#include "pdf-parser.h"
 
 #include <png.h>
 
@@ -47,6 +46,8 @@
 #include "UnicodeMap.h"
 #include "GlobalParams.h"
 
+#include "pdf-parser.h"
+ 
 namespace Inkscape {
 namespace Extension {
 namespace Internal {
=== added file 'src/inkscape-manifest-x64.xml'
--- src/inkscape-manifest-x64.xml	1970-01-01 00:00:00 +0000
+++ src/inkscape-manifest-x64.xml	2014-06-03 18:43:53 +0000
@@ -0,0 +1,10 @@
+<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
+<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
+<dependency>
+<dependentAssembly>
+<assemblyIdentity type="win32" name="Microsoft.Windows.Common-Controls"
+    version="6.0.0.0" processorArchitecture="amd64"
+    publicKeyToken="6595b64144ccf1df" language="*"/>
+</dependentAssembly>
+</dependency>
+</assembly>
\ No newline at end of file

=== added file 'src/inkscape-x64.rc'
--- src/inkscape-x64.rc	1970-01-01 00:00:00 +0000
+++ src/inkscape-x64.rc	2014-06-03 18:43:53 +0000
@@ -0,0 +1,30 @@
+
+APPLICATION_ICON    ICON          DISCARDABLE     "../inkscape.ico"
+1                   24            DISCARDABLE     "./inkscape-manifest-x64.xml"
+
+1 VERSIONINFO
+    FILEVERSION     0,48,0,9
+    PRODUCTVERSION  0,48,0,9
+BEGIN
+    BLOCK "StringFileInfo"
+    BEGIN
+        BLOCK "040901b5"
+        BEGIN
+            VALUE "Comments", "Published under the GNU GPL"
+            VALUE "CompanyName", "inkscape.org"
+            VALUE "FileDescription", "Inkscape"
+            VALUE "FileVersion", "0.48+devel"
+            VALUE "InternalName", "Inkscape"
+            VALUE "LegalCopyright", " 2014 Inkscape"
+            VALUE "ProductName", "Inkscape"
+            VALUE "ProductVersion", "0.48+devel"
+        END
+    END
+    BLOCK "VarFileInfo"
+    BEGIN
+        VALUE "Translation", 1033, 437
+    END
+END
+
+1000		BITMAP	"./show-preview.bmp"
+

=== added file 'src/inkview-manifest-x64.xml'
--- src/inkview-manifest-x64.xml	1970-01-01 00:00:00 +0000
+++ src/inkview-manifest-x64.xml	2014-06-03 18:43:53 +0000
@@ -0,0 +1,10 @@
+<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
+<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
+<dependency>
+<dependentAssembly>
+<assemblyIdentity type="win32" name="Microsoft.Windows.Common-Controls"
+    version="6.0.0.0" processorArchitecture="amd64"
+    publicKeyToken="6595b64144ccf1df" language="*"/>
+</dependentAssembly>
+</dependency>
+</assembly>
\ No newline at end of file

=== added file 'src/inkview-x64.rc'
--- src/inkview-x64.rc	1970-01-01 00:00:00 +0000
+++ src/inkview-x64.rc	2014-06-03 18:43:53 +0000
@@ -0,0 +1,29 @@
+
+APPLICATION_ICON    ICON          DISCARDABLE     "../inkscape.ico"
+1                   24            DISCARDABLE     "./inkview-manifest-x64.xml"
+
+1 VERSIONINFO
+    FILEVERSION     0,48,0,9
+    PRODUCTVERSION  0,48,0,9
+BEGIN
+    BLOCK "StringFileInfo"
+    BEGIN
+        BLOCK "040901b5"
+        BEGIN
+            VALUE "Comments", "Published under the GNU GPL"
+            VALUE "CompanyName", "inkscape.org"
+            VALUE "FileDescription", "Inkview"
+            VALUE "FileVersion", "0.48+devel"
+            VALUE "InternalName", "Inkview"
+            VALUE "LegalCopyright", " 2014 Inkscape"
+            VALUE "ProductName", "Inkview"
+            VALUE "ProductVersion", "0.48+devel"
+        END
+    END
+    BLOCK "VarFileInfo"
+    BEGIN
+        VALUE "Translation", 1033, 437
+    END
+END
+
+1000		BITMAP	"./show-preview.bmp"

=== modified file 'src/io/inkscapestream.h'
--- src/io/inkscapestream.h	2009-02-26 13:28:12.000000000 -0800
+++ src/io/inkscapestream.h	2014-06-03 11:43:53.000000000 -0700
@@ -14,6 +14,7 @@
 
 #include <cstdio>
 #include <glibmm.h>
+#include <glibmm/thread.h>
 
 namespace Inkscape
 {
=== modified file 'src/libgdl/gdl-dock-object.c'
--- src/libgdl/gdl-dock-object.c	2007-08-29 14:27:07.000000000 -0700
+++ src/libgdl/gdl-dock-object.c	2014-06-03 11:43:53.000000000 -0700
@@ -879,7 +879,7 @@
     g_relation_insert (dock_register, "placeholder", (gpointer) GDL_TYPE_DOCK_PLACEHOLDER);
 }
 
-G_CONST_RETURN gchar *
+const gchar *
 gdl_dock_object_nick_from_type (GType type)
 {
     GTuples *tuples;
=== modified file 'src/libgdl/gdl-dock-object.h'
--- src/libgdl/gdl-dock-object.h	2013-11-12 12:38:53.000000000 -0800
+++ src/libgdl/gdl-dock-object.h	2014-06-03 11:43:53.000000000 -0700
@@ -204,7 +204,7 @@
 GType gdl_dock_param_get_type (void);
 
 /* functions for setting/retrieving nick names for serializing GdlDockObject types */
-G_CONST_RETURN gchar *gdl_dock_object_nick_from_type    (GType        type);
+const gchar          *gdl_dock_object_nick_from_type    (GType        type);
 GType                 gdl_dock_object_type_from_nick    (const gchar *nick);
 GType                 gdl_dock_object_set_type_for_nick (const gchar *nick,
                                                          GType        type);
=== modified file 'src/prefix.cpp'
--- src/prefix.cpp	2010-04-02 16:47:43.000000000 -0700
+++ src/prefix.cpp	2014-06-03 11:43:53.000000000 -0700
@@ -44,9 +44,6 @@
 #endif /* __cplusplus */
 
 
-#undef NULL
-#define NULL ((void *) 0)
-
 #ifdef __GNUC__
     #define br_return_val_if_fail(expr,val) if (!(expr)) {fprintf (stderr, "** BinReloc (%s): assertion %s failed\n", __PRETTY_FUNCTION__, #expr); return val;}
 #else
=== modified file 'src/trace/siox.cpp'
--- src/trace/siox.cpp	2013-11-12 12:52:11.000000000 -0800
+++ src/trace/siox.cpp	2014-06-03 11:43:53.000000000 -0700
@@ -2,18 +2,8 @@
    Copyright 2005, 2006 by Gerald Friedland, Kristian Jantz and Lars Knipping
 
    Conversion to C++ for Inkscape by Bob Jamison
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-   you may not use this file except in compliance with the License.
-   You may obtain a copy of the License at
-
-   http://www.apache.org/licenses/LICENSE-2.0
-
-   Unless required by applicable law or agreed to in writing, software
-   distributed under the License is distributed on an "AS IS" BASIS,
-   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-   See the License for the specific language governing permissions and
-   limitations under the License.
+   
+   Released under GNU GPL, read the file 'COPYING' for more information
  */
 #include "siox.h"
 
=== modified file 'src/trace/siox.h'
--- src/trace/siox.h	2009-01-23 13:55:34.000000000 -0800
+++ src/trace/siox.h	2014-06-03 11:43:53.000000000 -0700
@@ -5,17 +5,7 @@
  *
  *  Conversion to C++ for Inkscape by Bob Jamison
  *
- *  Licensed under the Apache License, Version 2.0 (the "License");
- *  you may not use this file except in compliance with the License.
- *  You may obtain a copy of the License at
- *
- *  http://www.apache.org/licenses/LICENSE-2.0
- *
- *  Unless required by applicable law or agreed to in writing, software
- *  distributed under the License is distributed on an "AS IS" BASIS,
- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- *  See the License for the specific language governing permissions and
- *  limitations under the License.
+ *  Released under GNU GPL, read the file 'COPYING' for more information
  */
 
 /**
=== modified file 'src/ui/dialog/filedialogimpl-win32.cpp'
--- src/ui/dialog/filedialogimpl-win32.cpp	2013-11-12 13:25:55.000000000 -0800
+++ src/ui/dialog/filedialogimpl-win32.cpp	2014-06-03 11:43:53.000000000 -0700
@@ -15,6 +15,7 @@
 # include <config.h>
 #endif
 
+
 //General includes
 #include <cmath>
 #include <list>
@@ -22,7 +23,6 @@
 #include <sys/stat.h>
 #include <errno.h>
 #include <set>
-#include <gdk/gdkwin32.h>
 #include <glib/gstdio.h>
 #include <glibmm/i18n.h>
 #include <gtkmm/window.h>
@@ -42,12 +42,14 @@
 #include "display/canvas-arena.h"
 
 #include "filedialog.h"
-#include "filedialogimpl-win32.h"
 
 #include <zlib.h>
 #include <cairomm/win32_surface.h>
 #include <cairomm/context.h>
 
+#include <gdk/gdkwin32.h>
+#include "filedialogimpl-win32.h"
+ 
 using namespace std;
 using namespace Glib;
 using namespace Cairo;
@@ -70,12 +72,6 @@
 
 #define IDC_SHOW_PREVIEW    1000
 
-// Windows 2000 version of OPENFILENAMEW
-struct OPENFILENAMEEXW : public OPENFILENAMEW {
-  void *        pvReserved;
-  DWORD         dwReserved;
-  DWORD         FlagsEx;
-};
 
 struct Filter
 {
@@ -377,7 +373,7 @@
 
 void FileOpenDialogImplWin32::GetOpenFileName_thread()
 {
-    OPENFILENAMEEXW ofn;
+    OPENFILENAMEW ofn;
 
     g_assert(this != NULL);
 	g_assert(_mutex != NULL);
@@ -1632,7 +1628,7 @@
 
 void FileSaveDialogImplWin32::GetSaveFileName_thread()
 {
-    OPENFILENAMEEXW ofn;
+    OPENFILENAMEW ofn;
 
     g_assert(this != NULL);
     g_assert(_main_loop != NULL);
=== modified file 'src/ui/dialog/filedialogimpl-win32.h'
--- src/ui/dialog/filedialogimpl-win32.h	2009-08-09 18:27:02.000000000 -0700
+++ src/ui/dialog/filedialogimpl-win32.h	2014-06-03 11:43:53.000000000 -0700
@@ -10,10 +10,22 @@
  * Released under GNU GPL, read the file 'COPYING' for more information
  */
 
+#if HAVE_CONFIG_H
+# include "config.h"
+#endif
+
+#include <glibmm.h>
+
 #ifdef WIN32
 
 #include "gc-core.h"
+
+ // define WINVER high enough so we get the correct OPENFILENAMEW size
+#ifndef WINVER
+#define WINVER 0x0500 
+#endif
 #include <windows.h>
+#include "filedialogimpl-gtkmm.h"
 
 namespace Inkscape
 {
=== modified file 'src/ui/dialog/print.cpp'
--- src/ui/dialog/print.cpp	2013-09-21 15:20:09.000000000 -0700
+++ src/ui/dialog/print.cpp	2014-06-03 11:43:53.000000000 -0700
@@ -13,6 +13,7 @@
 #endif
 #ifdef WIN32
 #include <io.h>
+ #define WIN32_LEAN_AND_MEAN
 #include <windows.h>
 #endif
 
=== modified file 'src/widgets/ege-paint-def.cpp'
--- src/widgets/ege-paint-def.cpp	2010-11-25 13:00:47.000000000 -0800
+++ src/widgets/ege-paint-def.cpp	2014-06-03 11:43:53.000000000 -0700
@@ -47,7 +47,7 @@
 #include <string>
 #include <iostream>
 #include <sstream>
-#include <stdlib.h>
+//#include <stdlib.h>
 #include <string.h>
 #include <stdio.h>
 #include <glibmm/stringutils.h>
