# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem 1.0

name            gimp-gap
version         2.4.0
set branch      [join [lrange [split ${version} .] 0 1] .]
categories      graphics
maintainers     devans

description     The Gimp Animation Package.

long_description \
                GIMP-GAP, the GIMP Animation Package, is a collection of plug-ins to \
                extend GIMP with capabilities to edit and create animations as \
                sequences of single frames.

homepage        http://www.gimp.org/
platforms       darwin
master_sites    ftp://ftp.gimp.org/pub/gimp/plug-ins/v${branch}/gap/ \
                ftp://ftp.gtk.org/pub/gimp/plug-ins/v${branch}/gap/ \
                http://ftp.gtk.org/pub/gimp/plug-ins/v${branch}/gap/ \
                ftp://ftp.mirrorservice.org/sites/ftp.gimp.org/pub/gimp/plug-ins/v${branch}/gap/ \
                http://www.mirrorservice.org/sites/ftp.gimp.org/pub/gimp/plug-ins/v${branch}/gap/ \
                http://gimp.mirrors.hoobly.com/gimp/plug-ins/v${branch}/gap/ \
                http://gimp.site2nd.org/plug-ins/v${branch}/gap/ \
                http://mirror.umoss.org/gimp/gimp/plug-ins/v${branch}/gap/ \
                ftp://gd.tuwien.ac.at/graphics/gimp/gimp/plug-ins/v${branch}/gap/ \
                ftp://ftp.funet.fi/pub/sci/graphics/packages/gimp/plug-ins/v${branch}/gap/ \
                http://ftp.iut-bm.univ-fcomte.fr/gimp/gimp/plug-ins/v${branch}/gap/ \
                http://gimp.krecio.pl/gimp/plug-ins/v${branch}/gap/ \
                ftp://ftp.gwdg.de/pub/misc/grafik/gimp/gimp/plug-ins/v${branch}/gap/ \
                http://ftp.gwdg.de/pub/misc/grafik/gimp/gimp/plug-ins/v${branch}/gap/ \
                http://mirrors.zerg.biz/gimp/plug-ins/v${branch}/gap/ \
                ftp://ftp.esat.net/mirrors/ftp.gimp.org/pub/gimp/plug-ins/v${branch}/gap/ \
                http://ftp.esat.net/mirrors/ftp.gimp.org/pub/gimp/plug-ins/v${branch}/gap/ \
                ftp://ftp.heanet.ie/mirrors/ftp.gimp.org/pub/gimp/gimp/plug-ins/v${branch}/gap/ \
                http://ftp.heanet.ie/mirrors/ftp.gimp.org/pub/gimp/gimp/plug-ins/v${branch}/gap/ \
                ftp://ftp.u-aizu.ac.jp/pub/graphics/tools/gimp/gimp/plug-ins/v${branch}/gap/ \
                ftp://ftp.ring.gr.jp/pub/graphics/gimp/plug-ins/v${branch}/gap/ \
                http://www.ring.gr.jp/pub/graphics/gimp/plug-ins/v${branch}/gap/ \
                ftp://ftp.snt.utwente.nl/pub/software/gimp/gimp/plug-ins/v${branch}/gap/ \
                http://ftp.snt.utwente.nl/pub/software/gimp/gimp/plug-ins/v${branch}/gap/ \
                ftp://sunsite.uio.no/pub/gimp/plug-ins/v${branch}/gap/ \
                ftp://sunsite.icm.edu.pl/pub/graphics/gimp/plug-ins/v${branch}/gap/ \
                ftp://ftp.piotrkosoft.net/pub/mirrors/ftp.gimp.org/pub/gimp/plug-ins/v${branch}/gap/ \
                http://piotrkosoft.net/pub/mirrors/ftp.gimp.org/pub/gimp/plug-ins/v${branch}/gap/ \
                ftp://ftp.iasi.roedu.net/pub/mirrors/ftp.gimp.org/plug-ins/v${branch}/gap/ \
                http://ftp.iasi.roedu.net/mirrors/ftp.gimp.org/plug-ins/v${branch}/gap/ \
                ftp://ftp.sai.msu.su/pub/unix/graphics/gimp/mirror/gimp/plug-ins/v${branch}/gap/ \
                ftp://ftp.is.co.za/mirror/ftp.gimp.org/gimp/plug-ins/v${branch}/gap/ \
                http://sunsite.rediris.es/mirror/gimp/plug-ins/v${branch}/gap/ \
                ftp://ftp.rediris.es/mirror/gimp/plug-ins/v${branch}/gap/ \
                ftp://ftp.acc.umu.se/pub/gimp/gimp/plug-ins/v${branch}/gap/ \
                ftp://ftp.sunet.se/pub/gnu/gimp/plug-ins/v${branch}/gap/ \
                http://ftp.sunet.se/pub/gnu/gimp/plug-ins/v${branch}/gap/

checksums       md5     b3e8eb56cc3d94325a81266a2d95fa39 \
                sha1    bbbc5b115b4815726bca9d962ae0a7ca1c2e07e8 \
                rmd160  7a2a4c8935560a7b95575b9479af2cc7fee9e0a4

use_bzip2       yes

depends_lib     port:gimp2 \
                port:XviD

depends_run     port:MPlayer

patchfiles      patch-gap-gap_dbbrowser_utils.c.diff

post-patch {
    reinplace "s|enable-shared|prefix=${prefix} --enable-shared|" \
       ${worksrcpath}/extern_libs/configure_options_ffmpeg.txt
}

configure.args  --disable-audio-support \
                --disable-libmpeg3 \
                --enable-gdkpixbuf-pview

post-configure {
    reinplace "s|-Wl,-d|-Wl|g" \
        ${worksrcpath}/extern_libs/ffmpeg/config.mak
    reinplace "s|no-cpp-precomp|no-cpp-precomp -DHAVE_LRINTF -fno-common|g" \
        ${worksrcpath}/extern_libs/ffmpeg/config.mak
    reinplace "s|APPLE|NOTHANKS|" \
        ${worksrcpath}/extern_libs/ffmpeg/libavformat/tcp.c
}

post-destroot {
    foreach dir {howto reference} {
        xinstall -d ${destroot}${prefix}/share/${name}/$dir
        foreach txt [glob -d ${worksrcpath}/docs/$dir/txt *.txt] {
            xinstall -m 644 $txt ${destroot}${prefix}/share/${name}/$dir
        }
    }
}

livecheck.check regex
livecheck.url   ftp://ftp.gimp.org/pub/gimp/plug-ins/v${branch}/gap/
livecheck.regex "${name}-(\\d+(?:\\.\\d+)*)${extract.suffix}"
