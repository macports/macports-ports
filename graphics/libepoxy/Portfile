# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           github 1.0

github.setup        anholt libepoxy 1.3.1 v
license             MIT permissive
categories          graphics
maintainers         devans openmaintainer
platforms           darwin

description         Epoxy is a library for handling OpenGL function \
                    pointer management for you

long_description    ${description}

checksums           rmd160  fc67ebfc18fe1209d23d8ef315cc9ab387731563 \
                    sha256  2c8155016e6bcf2ad604094ba84f0404edda3278dea851d6ce44830291eb885b

depends_build       port:pkgconfig \
                    port:autoconf \
                    port:automake \
                    port:libtool \
                    port:xorg-util-macros

depends_lib         port:mesa \
                    port:xorg-libX11

patchfiles          patch-configure.ac.diff

# turn on support for glx that was disabled in v1.3
#     see https://github.com/anholt/libepoxy/commit/e3051481cc9f5b7b36b317aff1454ee16ea9cdb9
#     see https://github.com/anholt/libepoxy/releases/tag/v1.3
patchfiles-append   patch-glx.diff

post-patch {
    reinplace "s|@PREFIX@|${prefix}|g" ${worksrcpath}/src/dispatch_common.c
}

configure.cmd       ./autogen.sh

configure.args      --disable-silent-rules

variant python27 conflicts python34 python35 description {build with python 2.7} {
    depends_lib-append      port:python27
    configure.python        ${prefix}/bin/python2.7
}

variant python34 conflicts python27 python35 description {build with python 3.4} {
    depends_lib-append      port:python34
    configure.python        ${prefix}/bin/python3.4
}

variant python35 conflicts python27 python34 description {build with python 3.5} {
    depends_lib-append      port:python35
    configure.python        ${prefix}/bin/python3.5
}

if {![variant_isset python27] && ![variant_isset python34] && ![variant_isset python35]} {
    default_variants +python34
}
