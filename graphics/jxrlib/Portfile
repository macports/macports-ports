# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           cmake 1.1

name                jxrlib
set version_name    1.2~git20170615.f752187
# version looks like `1.2_git20170615-f752187`
regsub              {^((?:\d+\.?)+)~git((?:\d+\.?)+)\.([A-Fa-f\d]+)} \
                    $version_name \
                    {\1_git\2-\3} \
                    version
revision            0
categories          graphics
license             BSD
maintainers         nomaintainer

description         Microsoft JPEG XR Image Codec reference implementation library

long_description    {*}${description}

homepage            https://tracker.debian.org/pkg/${name}

use_xz              yes

master_sites        https://deb.debian.org/debian/pool/main/j/${name}:deb

distfiles           ${name}_${version_name}.orig${extract.suffix}:deb

checksums           [lindex [split [lindex ${distfiles} 0] :] 0] \
                    rmd160  69e482bf74adf2ae93833d8259b537d7fb6bd3d4 \
                    sha256  3e3c9d3752b0bbf018ed9ce01b43dcd4be866521dc2370dc9221520b5bd440d4 \
                    size    201236

worksrcdir          ${name}-${version_name}

# "Handle cmake support more cleanly" -- cloned from:
# https://github.com/Gcenx/macports-wine/commit/1b310a17497f9a49cc82789cc5afa2d22bb67c0c

patchfiles-append   0001-Add-ability-to-build-using-cmake.patch

patch.pre_args-replace \
                    -p0 \
                    -p1

post-patch {
    reinplace       s|@VERSION@|${version}|g \
                    ${worksrcpath}/CMakeLists.txt
}

livecheck.url       https://deb.debian.org/debian/pool/main/j/${name}
livecheck.version   ${version_name}
livecheck.regex     "${name}_(\[^\"\]+).orig${extract.suffix}"
