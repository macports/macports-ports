# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem 1.0

name		glut
version		3.7
revision	1
description	The OpenGL Utility Toolkit (GLUT)
long_description An indispensible toolkit for OpenGL programmers, this provides many of the windowing and input management primitives that OpenGL itself does not deal with.
maintainers    nomaintainer
categories	graphics x11
platforms	darwin
master_sites	http://www.opengl.org/resources/libraries/glut/
homepage	http://www.opengl.org/resources/libraries/glut.html
checksums	md5 dc932666e2a1c8a0b148a4c32d111ef3
patchfiles	patch-glutbitmap.h patch-round_cap.c patch-segment.c

depends_lib	lib:libGL.1:XFree86 lib:libX11.6:XFree86
depends_build  port:imake

configure {
    # adapted from ${worksrcpath}/mkmkfiles.imake
    system "cd ${worksrcpath} && mv -f Makefile Makefile.bak >& /dev/null"
    system "cd ${worksrcpath} && ${prefix}/bin/imake -DUseInstalled -I${prefix}/lib/X11/config -DTOPDIR=. && make Makefiles && make SUBDIRS=man Makefiles && make depend"
}

pre-build {
	system "cp ${worksrcpath}/include/GL/glut.h ${worksrcpath}/lib/glut"
}

build {
	system "cd ${worksrcpath}/lib/glut && xmkmf && make"
	system "cd ${worksrcpath}/lib/glut && /usr/bin/c++ -dynamiclib -o libglut.3.7.dylib -install_name ${prefix}/lib/libglut.3.dylib -compatibility_version 3.7 -current_version 3.7 -all_load libglut.a -L/usr/X11R6/lib -lGL -lGLU -lX11 -lXmu -lXi -lXext -lXt -lICE -lSM"
}

destroot {
	xinstall -d -m 755 ${destroot}${prefix}/include/GL
	xinstall -m 644 -c ${worksrcpath}/include/GL/glut.h ${destroot}${prefix}/include/GL
	xinstall -m 644 -c ${worksrcpath}/lib/glut/libglut.a ${destroot}${prefix}/lib
	system "/usr/bin/ranlib ${destroot}${prefix}/lib/libglut.a"
	xinstall -m 644 -c ${worksrcpath}/lib/glut/libglut.3.7.dylib ${destroot}${prefix}/lib
	ln -s libglut.3.7.dylib ${destroot}${prefix}/lib/libglut.3.dylib
	ln -s libglut.3.7.dylib ${destroot}${prefix}/lib/libglut.dylib
}

platform darwin 9 {
build {
	system "cd ${worksrcpath}/lib/glut && xmkmf && make"
	system "cd ${worksrcpath}/lib/glut && /usr/bin/c++ -dynamiclib -o libglut.3.7.dylib -install_name ${prefix}/lib/libglut.3.dylib -compatibility_version 3.7 -current_version 3.7 -all_load libglut.a -L${x11prefix}/lib -lGL -lGLU -lX11 -lXmu -lXi -lXext -lXt -lICE -lSM -dylib_file /System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib:/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib"
}
}

livecheck.check regex
livecheck.url   ${master_sites}
livecheck.regex {current source code distribution is GLUT (\d+(?:\.\d+)*)}
