# -*- coding: utf-8; mode: tcl; tab-width: 4; truncate-lines: t; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

# See dports/_resources/port1.0/group/kde4-1.1.tcl for more info.
PortGroup           kde4    1.1

name                kmymoney4
version             4.5

categories          kde finance
maintainers         mk pixilla.com:brad

description         kmymoney version 4
long_description    KMyMoney is the personal finance manager for KDE.
platforms           darwin

homepage            http://kmymoney2.sourceforge.net/index-home.html
master_sites        sourceforge:kmymoney2

livecheck.type      regex
livecheck.url       http://sourceforge.net/projects/kmymoney2/files/
livecheck.regex     "kmymoney-(4\\.\\d+)\\.tar"

distname            kmymoney-${version}
use_bzip2           yes
checksums           md5     a764fe259c7885f22a10049cef68398e \
                    sha1    eb313afaf4f1fd406c1cbf8b80a1804bb505fc5a \
                    rmd160  7e785192ce2b77bc4d1716c79993c5df13931bcc


depends_lib-append  port:libofx \
                    port:gwenhywfar4 \
                    port:aqbanking5 \
                    port:kdepimlibs4
# Actually, we don't need this port anymore, since kmymoney v. 4.5 ships with an icns
#                    port:makeicns

pre-fetch {
	ui_msg \
"  ============================================== \n \
This port is still EXPERIMENTAL.               \n \
============================================== \n \
Up to now it builds successfully with KDE 4.5, \n \
but there is some stuff related to kdepimlibs  \n \
temporally removed until the latter has been   \n \
updated to 4.5 as well.                        \n \
---------------------------------------------- \n \
                                               \n \
So far known problems are:                     \n \
 - oxygen icon theme is not found by the app   \n \
 - reports let the app hang                    \n \
 - some fonts seem to be missing, since        \n \
   layout looks inhomogenious                  \n \
                                               \n \
Untested is:                                   \n \
 - whether kmm_banking plugin works            \n \
   (i.e. transaction download questionble)     \n \
                                               \n \
============================================== \n \
"
}

patch.dir           ${workpath}/${distname}
patch.pre_args      -p1

post-patch {
   # remove KDE 4.5 holiday stuff until kdepimlibs is up-to-date
   reinplace "s/KDE_IS_VERSION(4,5,0)/0/g" ${worksrcpath}/kmymoney/kmymoney.cpp
}

#configure.args-append   --disable-kbanking-plugin

