# $Id$

PortSystem          1.0

name                kdelibs4
version             4.1.3
revision            3
categories          kde kde4
maintainers         illogic-al@macports.org openmaintainer
description         KDE4 core libraries
long_description    Core libraries for KDE4 applications to function
platforms           darwin
homepage            http://www.kde.org
master_sites        http://ftp.kde.org/stable/${version}/src/
use_bzip2           yes
distname            kdelibs-${version}
checksums           md5 562090d3c1d891081bc4a392e0b513ac

depends_lib         port:qt4-mac port:phonon \
    	            port:strigi port:gettext \
                    port:aspell port:enchant \
                    port:bzip2 port:zlib \
                    port:pcre port:shared-mime-info \
                    port:jpeg port:libpng \
                    lib:libgif:giflib port:tiff \
                    port:jasper port:openexr \
                    port:openssl

depends_build       port:cmake \
                    port:automoc

use_parallel_build  yes
worksrcdir          build
pre-configure       { file mkdir ${worksrcpath} }

configure.cmd       cmake
configure.ccache    no
configure.compiler  gcc-4.2
configure.env-append  QTDIR=${prefix}/libexec/qt4-mac
configure.args	../${distname} -DBUILD_SHARED_LIBS=ON \
		-DCMAKE_BUILD_WITH_INSTALL_RPATH=ON \
		-DCMAKE_VERBOSE_MAKEFILE=ON \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_SYSTEM_PREFIX_PATH=\"${prefix}\;/usr\" \
		-DCMAKE_INSTALL_PREFIX=${prefix} \
		-DPHONON_INCLUDE_DIR=${prefix}/include \
		-DPHONON_LIBRARY=${prefix}/lib/libphonon.dylib \
		-DCMAKE_OSX_SYSROOT=${universal_sysroot} \
		-DQT_QMAKE_EXECUTABLE=${prefix}/libexec/qt4-mac/bin/qmake \
		-Wno-dev

#post-configure {
#    reinplace "s|#define   HAVE_BACKTRACE 1||" ${workpath}/build/config.h
#}
# Need to test if this is still necessary

variant universal {
    configure.universal_args-delete  --disable-dependency-tracking
    configure.args-append	-DCMAKE_OSX_ARCHITECTURES=\"[strsed ${configure.universal_archs} "g| |;|"]\"
}

variant debug description "Enable debug binaries" {
	configure.args-delete		-DCMAKE_BUILD_TYPE=Release
	configure.args-append		-DCMAKE_BUILD_TYPE=debugFull

}

variant soprano description "Enable support for nepomuk semantic desktop" {
    depends_lib-append		port:soprano
}
