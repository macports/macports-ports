--- setup.py.orig	2025-06-21 23:32:16.000000000 +0200
+++ setup.py	2025-08-07 13:14:03.000000000 +0200
@@ -1,20 +1,9 @@
-import os.path
 import sys
+from os import environ
 
 import setuptools
 from wheel.bdist_wheel import bdist_wheel
 
-extra_compile_args = []
-include_dirs = [
-    os.path.join("vendor", "ls-qpack"),
-    os.path.join("vendor", "ls-qpack", "deps", "xxhash"),
-]
-if sys.platform == "win32":
-    include_dirs.append(os.path.join("vendor", "ls-qpack", "wincompat"))
-else:
-    extra_compile_args = ["-std=c99"]
-
-
 class bdist_wheel_abi3(bdist_wheel):
     def get_tag(self):
         python, abi, plat = super().get_tag()
@@ -25,18 +14,18 @@
         return python, abi, plat
 
 
+prefix = environ.get("MP_PREFIX", "/opt/local")
 setuptools.setup(
     ext_modules=[
         setuptools.Extension(
             "pylsqpack._binding",
             define_macros=[("Py_LIMITED_API", "0x03080000")],
-            extra_compile_args=extra_compile_args,
-            include_dirs=include_dirs,
+            include_dirs=["%s/include" % prefix],
+            library_dirs=["%s/lib" % prefix],
+            libraries=["ls-qpack"],
             py_limited_api=True,
             sources=[
                 "src/pylsqpack/binding.c",
-                "vendor/ls-qpack/lsqpack.c",
-                "vendor/ls-qpack/deps/xxhash/xxhash.c",
             ],
         ),
     ],
