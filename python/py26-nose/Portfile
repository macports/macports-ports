# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id$

PortSystem			1.0
PortGroup  python26 1.0

set my_name         nose
name				py26-${my_name}
version				0.11.3
categories-append	www
maintainers			mcalhoun openmaintainer
description			A Python unittest extension.
long_description \
    A unittest extension offering automatic test \
    suite discovery, simplified test authoring, \
    and output capture. Nose provides an alternate \
    test discovery and running process for \
    unittest, one that is intended to mimic the \
    behavior of py.test as much as is reasonably \
    possible without resorting to magic.

platforms			darwin
if {[info exists supported_archs]} {
    supported_archs noarch
}

homepage			http://somethingaboutorange.com/mrl/projects/${my_name}/${version}
master_sites		${homepage}
distname			${my_name}-${version}

depends_lib			port:py26-distribute

checksums           md5     7f1dc53750811f78bedef9e14a4bc5a5 \
                    sha1    37c03a5b9738575e25ef99a5ca3b021f66c53421 \
                    rmd160  9f5e93d9bcfa2f294f97f6a5c31e462eb13e43e2

post-patch {
	reinplace "s|man/man|share/man/man|" ${worksrcpath}/setup.py

    # One of the tests fails if this directory does not exist
    file mkdir ${worksrcpath}/functional_tests/support/empty
}

post-destroot {
    ln -s ${python.prefix}/share/man/man1/nosetests.1 ${destroot}${prefix}/share/man/man1/nosetests${python.branch}.1

    xinstall -m 644 -W ${worksrcpath} \
        AUTHORS CHANGELOG NEWS README.txt \
		${destroot}${prefix}/share/doc/${name}

    file copy ${worksrcpath}/doc ${destroot}${prefix}/share/doc/${name}/html

    file delete ${destroot}${prefix}/share/doc/${name}/examples
    file copy ${worksrcpath}/examples ${destroot}${prefix}/share/doc/${name}
}

test.run  yes
test.cmd  ${python.bin} setup.py test

livecheck.type   regex
livecheck.url    ${homepage}
livecheck.regex     "${my_name}-(\\d+(?:\\.\\d+)*)${extract.suffix}"
