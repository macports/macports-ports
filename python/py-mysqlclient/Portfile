# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0
PortGroup           python 1.0

github.setup        PyMySQL mysqlclient-python 2.2.1 v
# Change github.tarball_from to 'releases' or 'archive' next update
github.tarball_from tarball
checksums           rmd160  4c4cf2e3c1264caae139d72bf93e4521bbf9deec \
                    sha256  aeceb10e5a056d76a9be2aef5cda4805a05cb5a8a7c039f64d728c3cbbe0f803 \
                    size    93928

name                py-mysqlclient

categories-append   devel databases
platforms           {darwin any}
license             GPL-2
maintainers         nomaintainer

description         Python3 interface to MySQL/MariaDB, fork of MySQL-python
long_description    {*}${description}

python.versions     39 310 311 312

if {${name} ne ${subport}} {
    set mysql_config {}

    depends_build-append \
                    port:pkgconfig \
                    port:py${python.version}-setuptools

    pre-configure {
        if {![variant_isset mysql57] &&
            ![variant_isset mysql8] &&
            ![variant_isset mariadb10_5] &&
            ![variant_isset mariadb10_6] &&
            ![variant_isset mariadb10_11] &&
            ![variant_isset mariadb11_4]} {
            return -code error "you must select either mysql{57,8}, mariadb10_{5,6,11}, or mariadb11_4"
        }
    }

    variant mysql57 conflicts mysql8 \
        mmariadb10_5 mariadb10_6 mariadb10_11 mariadb11_4 \
        description {Access mysql57} {
        depends_lib-append  port:mysql57
        build.env-append PKG_CONFIG_PATH=${prefix}/lib/mysql57/mysql/pkgconfig
    }

    variant mysql8 conflicts mysql57 \
        mariadb10_5 mariadb10_6 mariadb10_11 mariadb11_4 \
        description {Access mysql8} {
        depends_lib-append  port:mysql8
        build.env-append PKG_CONFIG_PATH=${prefix}/lib/mysql8/mysql/pkgconfig
    }

    # remove after 2026-04-02
    variant mariadb10_3 requires mariadb10_5 description "Legacy compatibility variant" {}
    variant mariadb10_4 requires mariadb10_5 description "Legacy compatibility variant" {}
    variant mariadb10_7 requires mariadb10_11 description "Legacy compatibility variant" {}
    variant mariadb10_8 requires mariadb10_11 description "Legacy compatibility variant" {}
    variant mariadb10_9 requires mariadb10_11 description "Legacy compatibility variant" {}
    variant mariadb10_10 requires mariadb10_11 description "Legacy compatibility variant" {}

    variant mariadb10_5 conflicts mysql57 mysql8 \
        mariadb10_6 mariadb10_11 mariadb11_4 \
        description {Access mariadb-10.5} {
        depends_lib-append  port:mariadb-10.5
        build.env-append PKG_CONFIG_PATH=${prefix}/lib/mariadb-10.5/mysql/pkgconfig
    }

    variant mariadb10_6 conflicts mysql57 mysql8 \
        mariadb10_5 mariadb10_11 mariadb11_4 \
        description {Access mariadb-10.6} {
        depends_lib-append  port:mariadb-10.6
        build.env-append PKG_CONFIG_PATH=${prefix}/lib/mariadb-10.6/mysql/pkgconfig
    }

    variant mariadb10_11 conflicts mysql57 mysql8 \
        mariadb10_5 mariadb10_6 mariadb11_4 \
        description {Access mariadb-10.11} {
        depends_lib-append  port:mariadb-10.11
        build.env-append PKG_CONFIG_PATH=${prefix}/lib/mariadb-10.11/mysql/pkgconfig
    }

    variant mariadb11_4 conflicts mysql57 mysql8 \
        mariadb10_5 mariadb10_6 mariadb10_11 \
        description {Access mariadb-11.4} {
        depends_lib-append  port:mariadb-11.4
        build.env-append PKG_CONFIG_PATH=${prefix}/lib/mariadb-11.4/mysql/pkgconfig
    }

#     variant percona55 conflicts mysql57 mysql8 \
#         mariadb10_3 mariadb10_4 mariadb10_5 mariadb10_6 mariadb10_7 mariadb10_8 mariadb10_9 mariadb10_10 mariadb10_11 \
#         description {Access percona} {
#         depends_lib-append  port:percona
#  XXX    set mysql_config lib/percona/bin/mysql_config
#     }

    if {![variant_isset mysql57] &&
            ![variant_isset mysql8] &&
            ![variant_isset mariadb10_5] &&
            ![variant_isset mariadb10_6] &&
            ![variant_isset mariadb10_11] &&
            ![variant_isset mariadb11_4] } {
        default_variants +mariadb10_11
    }
}
