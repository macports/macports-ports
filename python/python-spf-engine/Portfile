# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           python 1.0

set real_name       spf-engine
name                python-${real_name}
version             2.9.0
revision            0
categories-append   mail
license             Apache-2 GPL-2
maintainers         {@BjarneDMat mathiesen.info:macintosh} openmaintainer
description         SPF (Sender Policy Framework) processing engine for Postfix policy server and Milter implemented in Python.
long_description    ${description} \
    This is an external policy checker for the postfix mail server.  \
    It will use pyspf to check SPF records to determine if email should \
    be rejected or deferred by your server. \
    It requires Python3 (python3.3+). \
    Nothing is configured by default, so this will not interact with \
    Postfix until it has been set up.

platforms           darwin
supported_archs     noarch
homepage            https://launchpad.net/${real_name}
master_sites        pypi:[string index ${real_name} 0]/${real_name}
distname            ${real_name}-${version}

checksums           rmd160  5bb657e4ddc0ef9d637173a7a06bcf9c09f57f02 \
                    sha256  b2a7308837913940b1bcdaa9c9d931be17cb8273f3ec799bc288f6a24161571d \
                    size    52764

python.versions     37

patchfiles          patch-setup-py.diff

depends_build \
                    port:py${python.version}-pyspf \
                    port:py${python.version}-setuptools

depends_lib \
                    port:py${python.version}-authres \
                    port:py${python.version}-pymilter

add_users _pyspf-milter    group=_pyspf-milter    realname=pyspf-milter
add_users _pyspf-check     group=_pyspf-check     realname=pyspf-check

post-patch {
    reinplace "s|@@prefix@@|${prefix}|" ${worksrcpath}/setup.py
}

notes "
Two users have been created
    _pyspf-check
    _pyspf-milter
under which you can run the services.
see : man 1 policyd-spf 
"
