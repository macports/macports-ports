PortSystem 1.0
name		fortune
version		4.6.2-RELEASE
categories	games
maintainers	eric@opendarwin.org
description	Infamous electronic fortune-cookie generator
platforms	darwin
use_bzip2	yes
master_sites	http://www.opendarwin.org/projects/darwinports/distfiles/
checksums	md5 99166e1c47d4b60c865a31d59d359b16
depends_lib	lib:libcompat.1:libcompat
worksrcdir	${portname}
build.type	bsd
build.args	LDADD+=-L${prefix}/lib

configure	{ cd ${worksrcpath}
		  reinplace "s|/usr|${prefix}|" fortune/pathnames.h
		  reinplace "s|/usr/share|${prefix}/share|" fortune/fortune.6
		  reinplace "s|/usr/games/fortune|${prefix}/bin/fortune|" \
		    fortune/fortune.6
		  reinplace "s|XXPREFIX|${prefix}|" fortune/Makefile }

patchfiles	patch-fortune-Makefile patch-strfile-Makefile \
		patch-unstr-Makefile patch-datfiles-Makefile \
		patch-fortune.c patch-strfile.c

set datfiles	"fortunes fortunes.dat fortunes-o fortunes-o.dat fortunes2 \
		fortunes2.dat fortunes2-o fortunes2-o.dat limerick \
		limerick.dat murphy murphy.dat murphy-o murphy-o.dat \
		startrek startrek.dat zippy zippy.dat"

install		{ cd ${worksrcpath}
		  system "install -o root -m 755 -d ${destroot}${prefix}/bin"
		  system "install -o root -m 755 -d ${destroot}${prefix}/share/man/man6"
		  system "install -o root -m 755 -d ${destroot}${prefix}/share/man/man8"
		  system "install -o root -m 755 -d \
		    ${destroot}${prefix}/share/games/fortune"
		  system "install -o root -m 755 -c fortune/fortune \
		    ${destroot}${prefix}/bin"
		  system "install -o root -m 755 -c strfile/strfile \
		    ${destroot}${prefix}/bin"
		  system "install -o root -m 755 -c unstr/unstr \
		    ${destroot}${prefix}/bin"
		  system "install -o root -m 644 -c fortune/fortune.6.gz \
		    ${destroot}${prefix}/share/man/man6"
		  system "install -o root -m 644 -c strfile/strfile.8.gz \
		    ${destroot}${prefix}/share/man/man8"
		  system "install -o root -m 644 -c strfile/strfile.8.gz \
		    ${destroot}${prefix}/share/man/man8/unstr.8.gz"

		  cd datfiles
		  foreach datfile $datfiles {
		    system "install -o root -m 644 -c $datfile \
		      ${destroot}/${prefix}/share/games/fortune" } }
