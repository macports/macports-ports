# $Id: Portfile,v 1.20 2004/04/27 18:35:58 matt Exp $

PortSystem 1.0
name		nethack
version		3.4.1
revision	1
categories	games
maintainers	kevin@opendarwin.org
description	Classic dungeon adventure game.
platforms	darwin freebsd
master_sites     sourceforge
distname	${portname}-341
extract.suffix	.tgz
checksums	md5 aefcbeb20210b2d64511c84bd03c3e4e
patchfiles	patch-Makefile.top patch-Makefile.src
worksrcdir	${portname}-${portversion}
destroot.target	manpages install
destroot.args    PREFIX=${destroot}${prefix} MANDIR=${destroot}${prefix}/share/man/man6

post-patch {
    set path "${portpath}/${workdir}/${worksrcdir}"
    reinplace "s|= /usr|= ${prefix}|g" "${path}/sys/unix/Makefile.top"
	reinplace "s|/usr/man/man6|${prefix}/share/man/man6|g" "${path}/sys/unix/Makefile.doc"
    reinplace "s|/usr/games/lib/nethackdir|${prefix}/share/nethackdir|g" "${path}/sys/unix/Makefile.top"
    reinplace "s|/usr/games/lib/nethackdir|${prefix}/share/nethackdir|g" "${path}/sys/unix/nethack.sh"
    reinplace "s|/usr/games/lib/nethackdir|${prefix}/share/nethackdir|g" "${path}/include/config.h"
    system "cd \"${path}/sys/unix\" && sh \"${path}/sys/unix/setup.sh\""
}

configure {}

pre-destroot {
	system "mkdir -p -m 0755 \"${destroot}${prefix}/share/man/man6\""
}

variant x11 {
    patchfiles-append patch-x11-Makefile.top patch-x11-Makefile.src patch-x11-config.h
}
