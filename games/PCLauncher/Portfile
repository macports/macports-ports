# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem                  1.0
PortGroup                   xcode 1.0

name                        PCLauncher
version                     0.0.1-72305
categories                  games
maintainers                 ryandesign
homepage                    http://plasmaclient.servegame.org/

description                 launcher for PlasmaClient

long_description            ${name} verifies your Myst Online: URU Live again \
                            username and password, downloads the secure files \
                            if necessary, and then launches PlasmaClient.

fetch.type                  svn
svn.url                     http://svn.macosforge.org/repository/macports/users/ryandesign/${name}
svn.revision                [lindex [split ${version} -] 1]
worksrcdir                  ${name}

depends_run                 port:PlasmaClient \
                            port:Drizzle

post-extract {
    foreach app {PCDownloader PCExtractor} {
        copy ${filespath}/${app}.in ${worksrcpath}/${app}
    }
}

patchfiles                  patch-PCLauncher.applescript.diff

post-patch {
    reinplace "s|@PREFIX@|${prefix}|g" ${worksrcpath}/PCLauncher.applescript ${worksrcpath}/PCDownloader ${worksrcpath}/PCExtractor
}

post-destroot {
    fs-traverse dir ${destroot} {
        if {[file isdirectory ${dir}]} {
            file attributes ${dir} -permissions u+w
        }
    }
    foreach app {PCDownloader PCExtractor} {
        xinstall -d ${destroot}${applications_dir}/PCLauncher.app/Contents/Resources/${app}.app/Contents/MacOS
        xinstall ${worksrcpath}/${app} ${destroot}${applications_dir}/PCLauncher.app/Contents/Resources/${app}.app/Contents/MacOS/${app}
    }
    foreach app {PCAuthenticator PlasmaClient} {
        xinstall -d ${destroot}${applications_dir}/PCLauncher.app/Contents/Resources/${app}.app/Contents/MacOS
        ln -s ${prefix}/bin/PlasmaClient ${destroot}${applications_dir}/PCLauncher.app/Contents/Resources/${app}.app/Contents/MacOS/${app}
    }
}

notes "
To start PlasmaClient, run PCLauncher in ${applications_dir}

Instructions for using PlasmaClient are in the file ${prefix}/share/doc/PlasmaClient/readme.rtf

For more information, please visit the Guild of Writers' IRC channel at irc://irc.guildofwriters.com/#writers
"
