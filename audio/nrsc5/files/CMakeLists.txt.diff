--- CMakeLists.txt.orig
+++ CMakeLists.txt
@@ -84,7 +84,7 @@
 if (CMAKE_SYSTEM_PROCESSOR MATCHES "arm.*")
     if (USE_NEON)
-        set (CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -mcpu=cortex-a7 -mfloat-abi=hard -mfpu=neon-vfpv4")
+        set (CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -mcpu=apple-m1")
         add_definitions (-DHAVE_NEON)
     endif()
 endif()
 
@@ -276,7 +276,7 @@
     OUTPUT_STRIP_TRAILING_WHITESPACE
   )
-else()
+elseif(NOT DEFINED GIT_COMMIT_HASH)
   set(GIT_COMMIT_HASH "unknown")
 endif()
 add_definitions("-DGIT_COMMIT_HASH=\"${GIT_COMMIT_HASH}\"")
