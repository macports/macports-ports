# $Id$
# -*- Mode: Tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4
PortSystem       1.0
name             portaudio
version          19.061121
categories       audio devel
platforms        macosx
maintainers      themiwi@users.sourceforge.net
description      PortAudio is a free, cross platform, open-source, audio I/O library.
long_description PortAudio is a free, cross platform, open-source, audio I/O library. \
                 It lets you write simple audio programs in 'C' that will compile and \
                 run on many platforms including Windows, Macintosh (8,9,X), Unix (OSS), \
                 SGI, and BeOS. PortAudio is intended to promote the exchange of audio \
                 synthesis software between developers on different platforms. \
                 PortAudio provides a very simple API for recording and/or playing sound \
                 using a simple callback function.  Example programs are included that \
                 synthesize sine waves and pink noise, perform fuzz distortion on a guitar, \
                 list available audio devices, etc. 
master_sites     http://www.portaudio.com/archives
distname         pa_stable_v19_061121
checksums        md5 f2ceca92b3bfc206abccfb439c169a3c \
                 sha1 798fc900251e2df423ba9e60b832ca76f85c3ad0 \
                 rmd160 f7b6a83ad6b120b9c3b7736b86231e88d709ee7f

use_configure    no
worksrcdir       ${name}

pre-build {
  reinplace -E "s|/usr/local|${prefix}|g" ${worksrcpath}/Makefile.darwin
}

build.cmd        make -f Makefile.darwin -j3

post-build {
  copy ${worksrcpath}/portaudio-2.0.pc.in ${worksrcpath}/portaudio.pc
  reinplace -E "s|\@prefix\@|${prefix}|g" ${worksrcpath}/portaudio.pc
  reinplace -E "s|\@exec_prefix\@|${prefix}/bin|g" ${worksrcpath}/portaudio.pc
  reinplace -E "s|\@libdir\@|${prefix}/lib|g" ${worksrcpath}/portaudio.pc
  reinplace -E "s|\@includedir\@|${prefix}/include|g" ${worksrcpath}/portaudio.pc
  reinplace -E "s|\@LIBS\@|-framework CoreAudio -framework AudioToolbox -framework AudioUnit -framework -framework CoreServices|g" ${worksrcpath}/portaudio.pc
  reinplace -E "s|\@THREAD_CFLAGS\@||g" ${worksrcpath}/portaudio.pc
}

destroot {
  xinstall -c -m 644 ${worksrcpath}/include/portaudio.h ${destroot}/${prefix}/include
  xinstall -c -m 644 ${worksrcpath}/lib/libportaudio.a ${worksrcpath}/lib/libportaudio.0.0.19.dylib ${destroot}/${prefix}/lib
  system "(cd ${destroot}/${prefix}/lib && ln -s libportaudio.0.0.19.dylib libportaudio.dylib)"
  xinstall -c -d  ${destroot}/${prefix}/lib/pkgconfig
  xinstall -c -m 644 ${worksrcpath}/portaudio.pc ${destroot}/${prefix}/lib/pkgconfig
  xinstall -c -d  ${destroot}/${prefix}/share/doc/${name}
  xinstall -c -m 644 ${worksrcpath}/README.txt  \
                     ${worksrcpath}/COMPILING.DARWIN \
                     ${worksrcpath}/LICENSE.txt \
                     ${worksrcpath}/V19-devel-readme.txt \
                     ${destroot}/${prefix}/share/doc/${name}
}

