--- SConstruct.orig	2008-07-07 08:29:40.000000000 -0700
+++ SConstruct	2009-05-07 15:28:59.000000000 -0700
@@ -508,27 +508,27 @@
 #libraries['sndfile'].ParseConfig('pkg-config --cflags --libs sndfile')
 
 libraries['lrdf'] = LibraryInfo()
-libraries['lrdf'].ParseConfig('pkg-config --cflags --libs lrdf')
+libraries['lrdf'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs lrdf')
 
 libraries['raptor'] = LibraryInfo()
-libraries['raptor'].ParseConfig('pkg-config --cflags --libs raptor')
+libraries['raptor'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs raptor')
 
 libraries['samplerate'] = LibraryInfo()
-libraries['samplerate'].ParseConfig('pkg-config --cflags --libs samplerate')
+libraries['samplerate'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs samplerate')
 
 conf = env.Configure (custom_tests = { 'CheckPKGExists' : CheckPKGExists } )
 
 if conf.CheckPKGExists ('fftw3f'):
     libraries['fftw3f'] = LibraryInfo()
-    libraries['fftw3f'].ParseConfig('pkg-config --cflags --libs fftw3f')
+    libraries['fftw3f'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs fftw3f')
 
 if conf.CheckPKGExists ('fftw3'):
     libraries['fftw3'] = LibraryInfo()
-    libraries['fftw3'].ParseConfig('pkg-config --cflags --libs fftw3')
+    libraries['fftw3'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs fftw3')
 
 if conf.CheckPKGExists ('aubio'):
     libraries['aubio'] = LibraryInfo()
-    libraries['aubio'].ParseConfig('pkg-config --cflags --libs aubio')
+    libraries['aubio'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs aubio')
 
 env = conf.Finish ()
 
@@ -569,7 +569,7 @@
 		print ('Ardour cannot be compiled without the curl headers, which do not seem to be installed')
 		sys.exit (1)            
 	else:
-		libraries['curl'].ParseConfig('pkg-config --cflags --libs libcurl')
+		libraries['curl'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs libcurl')
 	conf.Finish()
 else:
 	print 'FREESOUND support is not enabled.  Build with \'scons FREESOUND=1\' to enable.'
@@ -579,7 +579,7 @@
 	
 	if conf.CheckPKGExists ('\"slv2 >= 0.6.0\"'):
 		libraries['slv2'] = LibraryInfo()
-		libraries['slv2'].ParseConfig('pkg-config --cflags --libs slv2')
+		libraries['slv2'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs slv2')
                 env.Append (CCFLAGS="-DHAVE_LV2")
 	else:
 		print 'Building Ardour with LV2 support requires SLV2 >= 0.6.0'
@@ -592,31 +592,31 @@
 	print 'LV2 support is not enabled.  Build with \'scons LV2=1\' to enable.'
 
 libraries['jack'] = LibraryInfo()
-libraries['jack'].ParseConfig('pkg-config --cflags --libs jack')
+libraries['jack'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs jack')
 
 libraries['xml'] = LibraryInfo()
-libraries['xml'].ParseConfig('pkg-config --cflags --libs libxml-2.0')
+libraries['xml'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs libxml-2.0')
 
 libraries['xslt'] = LibraryInfo()
-libraries['xslt'].ParseConfig('pkg-config --cflags --libs libxslt')
+libraries['xslt'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs libxslt')
 
 libraries['glib2'] = LibraryInfo()
-libraries['glib2'].ParseConfig ('pkg-config --cflags --libs glib-2.0')
-libraries['glib2'].ParseConfig ('pkg-config --cflags --libs gobject-2.0')
-libraries['glib2'].ParseConfig ('pkg-config --cflags --libs gmodule-2.0')
-libraries['glib2'].ParseConfig ('pkg-config --cflags --libs gthread-2.0')
+libraries['glib2'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs glib-2.0')
+libraries['glib2'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs gobject-2.0')
+libraries['glib2'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs gmodule-2.0')
+libraries['glib2'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs gthread-2.0')
 
 libraries['freetype2'] = LibraryInfo()
-libraries['freetype2'].ParseConfig ('pkg-config --cflags --libs freetype2')
+libraries['freetype2'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs freetype2')
 
 libraries['gtk2'] = LibraryInfo()
-libraries['gtk2'].ParseConfig ('pkg-config --cflags --libs gtk+-2.0')
+libraries['gtk2'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs gtk+-2.0')
 
 libraries['pango'] = LibraryInfo()
-libraries['pango'].ParseConfig ('pkg-config --cflags --libs pango')
+libraries['pango'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs pango')
 
 libraries['libgnomecanvas2'] = LibraryInfo()
-libraries['libgnomecanvas2'].ParseConfig ('pkg-config --cflags --libs libgnomecanvas-2.0')
+libraries['libgnomecanvas2'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs libgnomecanvas-2.0')
 
 #libraries['flowcanvas'] = LibraryInfo(LIBS='flowcanvas', LIBPATH='#/libs/flowcanvas', CPPPATH='#libs/flowcanvas')
 
@@ -846,8 +846,8 @@
 	if topenv['GTKOSX']:
 		libinfo.Append(CPPPATH="/opt/gtk/include", LIBPATH="/opt/gtk/lib")
 		libinfo.Append(CXXFLAGS="-I/opt/gtk/include", LINKFLAGS="-L/opt/gtk/lib")
-	libinfo.Append(CPPPATH="/opt/local/include", LIBPATH="/opt/local/lib")
-	libinfo.Append(CXXFLAGS="-I/opt/local/include", LINKFLAGS="-L/opt/local/lib")
+	libinfo.Append(CPPPATH="@MP_PREFIX@/include", LIBPATH="@MP_PREFIX@/lib")
+	libinfo.Append(CXXFLAGS="-I@MP_PREFIX@/include", LINKFLAGS="-L@MP_PREFIX@/lib")
 
 prep_libcheck(env, env)
 
@@ -867,7 +867,7 @@
 
 conf = Configure (env)
 
-if conf.CheckHeader ('fftw3.h'):
+if conf.CheckHeader ('@MP_PREFIX@/include/fftw3.h'):
     env['RUBBERBAND'] = True
     libraries['rubberband'] = LibraryInfo (LIBS='rubberband',
                                            LIBPATH='#libs/rubberband',
@@ -910,7 +910,7 @@
 
 libraries['flac'] = LibraryInfo ()
 prep_libcheck(env, libraries['flac'])
-libraries['flac'].Append(CPPPATH="/usr/local/include", LIBPATH="/usr/local/lib")
+libraries['flac'].Append(CPPPATH="@MP_PREFIX@/include", LIBPATH="@MP_PREFIX@/lib")
 
 #
 # june 1st 2007: look for a function that is in FLAC 1.1.2 and not in later versions
@@ -934,7 +934,7 @@
 
 libraries['boost'] = LibraryInfo ()
 prep_libcheck(env, libraries['boost'])
-libraries['boost'].Append(CPPPATH="/usr/local/include", LIBPATH="/usr/local/lib")
+libraries['boost'].Append(CPPPATH="@MP_PREFIX@/include", LIBPATH="@MP_PREFIX@/lib")
 conf = Configure (libraries['boost'])
 if conf.CheckHeader ('boost/shared_ptr.hpp', language='CXX') == False:
         print "Boost header files do not appear to be installed. You also might be running a buggy version of scons. Try scons 0.97 if you can."
@@ -948,6 +948,7 @@
 if env['LIBLO']:
     libraries['lo'] = LibraryInfo ()
     prep_libcheck(env, libraries['lo'])
+    libraries['lo'].Append(CPPPATH="@MP_PREFIX@/include", LIBPATH="@MP_PREFIX@/lib")
 
     conf = Configure (libraries['lo'])
     if conf.CheckLib ('lo', 'lo_server_new') == False:
@@ -1044,21 +1045,21 @@
     env = conf.Finish()
     
     libraries['sigc2'] = LibraryInfo()
-    libraries['sigc2'].ParseConfig('pkg-config --cflags --libs sigc++-2.0')
+    libraries['sigc2'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs sigc++-2.0')
     libraries['glibmm2'] = LibraryInfo()
-    libraries['glibmm2'].ParseConfig('pkg-config --cflags --libs glibmm-2.4')
+    libraries['glibmm2'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs glibmm-2.4')
     libraries['cairomm'] = LibraryInfo()
-    libraries['cairomm'].ParseConfig('pkg-config --cflags --libs cairomm-1.0')
+    libraries['cairomm'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs cairomm-1.0')
     libraries['gdkmm2'] = LibraryInfo()
-    libraries['gdkmm2'].ParseConfig ('pkg-config --cflags --libs gdkmm-2.4')
+    libraries['gdkmm2'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs gdkmm-2.4')
     libraries['gtkmm2'] = LibraryInfo()
-    libraries['gtkmm2'].ParseConfig ('pkg-config --cflags --libs gtkmm-2.4')
+    libraries['gtkmm2'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs gtkmm-2.4')
     libraries['atkmm'] = LibraryInfo()
-    libraries['atkmm'].ParseConfig ('pkg-config --cflags --libs atkmm-1.6')
+    libraries['atkmm'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs atkmm-1.6')
     libraries['pangomm'] = LibraryInfo()
-    libraries['pangomm'].ParseConfig ('pkg-config --cflags --libs pangomm-1.4')
+    libraries['pangomm'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs pangomm-1.4')
     libraries['libgnomecanvasmm'] = LibraryInfo()
-    libraries['libgnomecanvasmm'].ParseConfig ('pkg-config --cflags --libs libgnomecanvasmm-2.6')
+    libraries['libgnomecanvasmm'].ParseConfig('@MP_PREFIX@/bin/pkg-config --cflags --libs libgnomecanvasmm-2.6')
 
 #
 # cannot use system one for the time being
@@ -1272,7 +1273,7 @@
     else:
         print "Found msgmerge"
     
-    if not conf.CheckCHeader('libintl.h'):
+    if not conf.CheckCHeader('@MP_PREFIX@/include/libintl.h'):
         nls_error += ' No libintl.h.'
         env['NLS'] = 0
         
