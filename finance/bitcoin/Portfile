# $Id$

PortSystem          1.0
name                bitcoin
categories          finance crypto
version             0.3.19
platforms           darwin
license             MIT
maintainers         singingwolfboy openmaintainer
description         a peer-to-peer digital currency
long_description    \
    Bitcoin is a peer-to-peer digital currency. Peer-to-peer (P2P) means that \
    there is no central authority to issue new money or keep track of \
    transactions. Instead, these tasks are managed collectively by the nodes \
    of the network.

homepage            http://www.bitcoin.org/
master_sites        sourceforge
distname            ${name}-${version}-macosx
use_zip             yes
checksums           md5     0a6e6f0b351ca59a61a2d7de5b057464 \
                    sha1    415813cb46179b79fc278db42fd34027fff02b7b \
                    rmd160  959bf4c1b2706883e272147904045828fbd04ee1

depends_lib         port:boost \
                    port:openssl \
                    port:db48 \
                    port:wxWidgets-devel

worksrcdir          ${name}-${version}/src
set makefile ${worksrcpath}/makefile.osx
configure {
    reinplace "s|^DEPSDIR=.*$|DEPSDIR=${prefix}|" ${makefile}
    reinplace "s|\$\(DEPSDIR\)/bin/wx-config|${prefix}/lib/wx-devel/bin/wx-config|g" ${makefile}
    reinplace "s|-I\"\$\(DEPSDIR\)\/include\"|-I${prefix}/include -I${prefix}/include/db48|" ${makefile}
    reinplace "s|lib/libdb_cxx-4.8.a|lib/db48/libdb_cxx-4.8.dylib|" ${makefile}
    reinplace "s|lib/libboost_thread.a|lib/libboost_thread-mt.dylib|" ${makefile}
    reinplace "s|\\\.a|.dylib|" ${makefile}

    # The QuickTime framework isn't actually needed, and it doesn't exist for
    # x86_64, but wx-config --libs spits it out anyway, so we'll filter it out
    # with sed.
    reinplace "s|wx-config --libs --static|wx-config --libs \\\| sed -e \"s/-framework QuickTime//\"|g" ${makefile}

    # Building with i386 support seems to make everything explode, so we'll 
    # remove it.
    reinplace "s|-arch i386||" ${makefile}
}
build.args          -f ${makefile}
destroot {
    copy ${worksrcpath}/bitcoin ${destroot}${prefix}/bin

    set docdir ${destroot}${prefix}/share/doc/${name}
    xinstall -d ${docdir}
    copy ${worksrcpath}/../readme.txt ${docdir}
}

# Tweak the Sourceforge livechecking
livecheck.regex     {/bitcoin-(\d+(?:\.\w+)+)/README}
