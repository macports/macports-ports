# $Id: Portfile,v 1.32 2003/08/31 17:37:43 mij Exp $

PortSystem 1.0
name			mysql
version			3.23.57
categories		databases
maintainers		darwinports@opendarwin.org
description		Multithreaded SQL database server
homepage		http://www.mysql.com/
platforms		darwin sunos

long_description	MySQL is an open-source, multi-threaded SQL database \
			with a command syntax very similar to mSQL.

master_sites		ftp://ftp.sunet.se/pub/unix/databases/relational/mysql/Downloads/MySQL-3.23/ \
			ftp://ftp.FreeBSD.org/pub/FreeBSD/distfiles/ \
			http://distfiles.opendarwin.org/

checksums		md5 892f7d97af1ce7502e89d824031abd05

patchfiles		patch-libmysql-violite.c patch-sql-violite.c

set dbdir		${prefix}/var/db/mysql

configure.env		LDFLAGS="-L${prefix}/lib -lncurses" \
			CPPFLAGS="-I${prefix}/include"

configure.args		--localstatedir=${dbdir} --without-server \
			--sysconfdir=${prefix}/etc --without-bench

variant darwin	{ depends_lib lib:libdl.1:dlcompat }

variant sunos	{ configure.env LDFLAGS="-L${prefix}/lib" \
				CPPFLAGS="-I${prefix}/include" }

variant innodb	{ configure.args-append --with-innodb }

variant server	{
  depends_run path:/Library/StartupItems/DarwinPortsStartup:DarwinPortsStartup

  configure.args --localstatedir=${dbdir} --sysconfdir=${prefix} --without-bench

  pre-destroot { system "install -o mysql -g mysql -m 755 -d ${dbdir}" }

  post-destroot { addgroup mysql
		  set gid [existsgroup mysql]
		  adduser mysql gid=${gid} realname=MySQL\ Server
		  system "install -m 755 -d ${destroot}${prefix}/etc/rc.d"
		  system "install -m 755 ${workpath}/${worksrcdir}/support-files/mysql.server ${destroot}${prefix}/etc/rc.d/mysql-server.sh"
		  system "install -m 644 ${workpath}/${worksrcdir}/support-files/my-medium.cnf ${destroot}${prefix}/etc/my.cnf"
		  ui_msg "===============================================================================\n"
		  ui_msg "If this is a new installation of MySQL, you must run\n${prefix}/bin/mysql_install_db after installing this port!\n"
		  ui_msg "You must also run:\n\n	'chown -R mysql:mysql ${dbdir}'\n\nbefore starting the MySQL daemon.\n"
		  ui_msg "===============================================================================\n"
  }
}
