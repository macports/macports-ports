# $Id$

PortSystem 1.0

name		couchdb
version		0.8.1
revision        3

categories	databases
platforms	darwin

description	couchdb is a document database server
maintainers	jwa febeling
long_description	${description}

homepage	http://couchdb.apache.org/
master_sites	apache
master_sites.mirror_subdir	incubator/${name}/${version}-incubating/
distname	apache-${name}-${version}-incubating
checksums	md5 89e037b370bef33be93f0f317e07615f \
    sha1 1bbe4776a125577d89ae7b2622f406e59be9d119 \
    rmd160 2928eeb3e3816d5a3ae43b548cde96de289dddd5

depends_lib	port:automake \
    port:autoconf \
    port:libtool \
    port:help2man \
    port:icu \
    port:spidermonkey \
    port:erlang

patchfiles      patch-plist_redirects_to_devnull.diff

set dbgroup couchdb
set dbuser couchdb
set logdir ${prefix}/var/log/couchdb
set dbdir ${prefix}/var/lib/couchdb
set plistdir /Library/LaunchDaemons

post-destroot {
    addgroup ${dbgroup}
    adduser ${dbuser} gid=[existsgroup ${dbgroup}]
    xinstall -m 755 -o ${dbuser} -g ${dbgroup} -d \
	${destroot}${dbdir} \
	${destroot}${logdir} \
	${destroot}${plistdir}
    destroot.keepdirs-append \
        ${destroot}${dbdir} \
        ${destroot}${logdir}
    set plist org.apache.couchdb.plist
    ln -sf ${destroot}${prefix}${plistdir}/${plist} \
        ${destroot}${plistdir}/${plist}
}

livecheck.check	regex
livecheck.url	http://couchdb.apache.org/downloads.html
livecheck.regex	apache-${name}-(0.\[0-9\].\[0-9\])
