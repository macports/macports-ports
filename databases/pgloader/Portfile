# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0

name                pgloader
categories          databases
platforms           darwin
maintainers         @jrjsmrtn

description         Extract, transform and load data into PostgreSQL
long_description    pgloader imports data from different kind of sources \
                    and COPY it into PostgreSQL. \
                    \
                    The command language is described in the manual page \
                    and allows to describe where to find the data source, \
                    its format, and to describe data processing and \
                    transformation. \
                    \
                    Supported source formats include CSV, fixed width flat \
                    files, dBase3 files (DBF), and SQLite and MySQL \
                    databases. In most of those formats, pgloader is able \
                    to auto-discover the schema and create the tables and \
                    the indexes in PostgreSQL. In the MySQL case it's \
                    possible to edit CASTing rules from the pgloader \
                    command directly.

homepage            https://pgloader.io
github.setup        dimitri pgloader 3.6.1 v

checksums           rmd160  d3b8f68c54a750c495c11b71270eed6b384b682f \
                    sha256  3969ed5a362848ead94285943f06d99c913139a5b1d5dfed47127f8b8179e66c \
                    size    3691019

depends_lib         port:sbcl \
                    port:unzip \
                    port:sqlite3 \
                    port:curl \
                    port:gawk \
                    port:freetds \
                    port:libzip

set cffi_patchfile  ${filespath}/patch-cffi-0.20.0-darwin-fallback-library-path.diff
patchfiles          patch-makefile.diff

use_configure       no

pre-build {
    system -W ${worksrcpath} "make cffi"
    system -W ${worksrcpath} "patch -p0 < ${cffi_patchfile}"
}

destroot {
    set bindir ${destroot}${prefix}/bin
    xinstall -d ${bindir}
    xinstall -m 755 ${worksrcpath}/build/bin/pgloader ${bindir}
}
