# $Id$

PortSystem 1.0

name                couchdb-devel
version             0.9.0a-incubating
revision            2

categories          databases
platforms           darwin

description         couchdb is a document database server
maintainers         jwa febeling
long_description    ${description}
homepage            http://couchdb.apache.org/
master_sites        ${homepage}
checksums           sha1 bf6506dd200ea18ea1331391da7aaece1188208d

distname            couchdb-${version}
fetch.type          svn
svn.url             http://svn.apache.org/repos/asf/couchdb/trunk
svn.tag		719015
worksrcdir          trunk

depends_lib	port:automake \
    port:autoconf \
    port:libtool \
    port:help2man \
    port:icu \
    port:spidermonkey \
    port:erlang

patchfiles      patch-plist_stdout_stderr.diff

pre-configure {
    system "cd ${worksrcpath}; ./bootstrap"
}

set dbgroup couchdb
set dbuser couchdb
set logdir ${prefix}/var/log/couchdb
set dbdir ${prefix}/var/lib/couchdb
set plistdir /Library/LaunchDaemons

post-destroot {
    addgroup ${dbgroup}
    adduser ${dbuser} gid=[existsgroup ${dbgroup}]
    xinstall -m 755 -o ${dbuser} -g ${dbgroup} -d \
	${destroot}${dbdir} \
	${destroot}${logdir} \
	${destroot}${plistdir}
    destroot.keepdirs-append \
        ${destroot}${dbdir} \
        ${destroot}${logdir}
    set plist org.apache.couchdb.plist
    ln -sf ${destroot}${prefix}${plistdir}${plist} \
        ${destroot}${plistdir}/${plist}
}

livecheck.check	regex
livecheck.url	http://svn.apache.org/viewvc/couchdb/trunk/src/couchdb/
livecheck.version	${svn.tag}
livecheck.regex	 (\[0-9\]+)
