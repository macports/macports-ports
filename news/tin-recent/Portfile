# $Id$

# The Tin development model is based on patchsets, as indicated in
# the doc/CHANGES file.  There are:
#  * stable patches, numbered ddd (001, 002, and so on), which are
#    applied to the current stable branch, and in general, to the
#    unstable branch too (i.e. when this makes sense);
#  * unstable patches (new features), numbered Uddd (U001, U002,
#    and so on), which are applied to the unstable branch only.
# At some point, the unstable branch is regarded as stable, making
# a new stable release and a new stable branch.  Then this branch
# gets stable patches as usual (fixes, translation updates...).
# A new unstable branch is created (split from the current stable
# branch) as soon as the first unstable patch (U001) needs to be
# applied.

# Portfile update policy: Follow the development line as shown on
# <http://www.tin.org/history.html>, preferring unstable versions
# to stable ones when there is a split.
# The goal of this tin-recent port (as opposed to tin and tin-devel)
# is to have the highest upstream version (regarded as either stable
# or unstable), i.e. with the latest features, using a single port,
# thus benefiting from some port management features, such as those
# provided by "port outdated" and "port upgrade".

# Note: Portfile reformatted according to portstyle(7).

PortSystem 1.0

name                tin-recent
version             1.9.2
revision            1
categories          news
platforms           darwin
maintainers         vincent-opdarw@vinc17.org
homepage            http://www.tin.org/
description         A Usenet newsreader

long_description    TIN is a full-screen easy to use Usenet newsreader. \
                    It can read news locally or remotely via a NNTP \
                    server. It will automatically utilize NOV \
                    newsoverview style index files if available locally \
                    or via the NNTP (X)OVER command (RFC2980). \
                    Portfile update policy: follow the development line \
                    as shown on <http://www.tin.org/history.html>, \
                    preferring unstable versions at a split.

set tindir tin/v[strsed ${version} {/\.[0-9]*$//}]/
master_sites        ftp://ftp.tin.org/pub/news/clients/${tindir} \
                    ftp://ftp.cuhk.edu.hk/pub/packages/news/${tindir}

use_bzip2           yes
checksums           md5 251094ddf0e2b059227a4b02187c5f3e \
                    sha1 51ba9fbd3bd4413b2630e86ad2f864ce75bf52aa \
                    rmd160 e2171a6ac047eff79b07109db40022b047ee06ef

distname            tin-${version}

livecheck.check     regex
livecheck.url       ${homepage}
livecheck.regex     /tin-(\[0-9.\]+)\\.tar\\.gz

# The libraries libintl, libiconv and libpcre are needed by tin. If the
# MacPorts ones are not used, tin 1.9.1 crashes. I don't know which one is
# the culprit (the PCRE that comes with tin in known to be buggy, but it is
# the same as in MacPorts). However it is recommended to use the libraries
# from MacPorts anyway.
depends_lib         port:gettext port:libiconv port:ncurses port:pcre

# Do not use the --enable-debug option. See
#   From: Vincent Lefevre <vincent@vinc17.org>
#   Newsgroups: tin.bugs
#   Subject: BUG REPORT tin 1.9.1 release 20060409 ("Benmore") [UNIX]
#   Date: Mon,  6 Nov 2006 02:38:19 +0100 (CET)
#   Message-ID: <20061106012750$653a@prunille.vinc17.org>
configure.args      --enable-break-long-lines \
                    --enable-nntp \
                    --enable-mh-mail-handling \
                    --enable-included-msgs \
                    --with-coffee \
                    --mandir=${prefix}/share/man \
                    --infodir=${prefix}/share/info \
                    --datadir=${prefix}/share \
                    --sysconfdir=${prefix}/etc \
                    --disable-pgp-gpg \
                    --without-ispell \
                    --with-screen=ncurses

build.dir           "${worksrcpath}/src"

pre-destroot {
    xinstall -d "${destroot}${prefix}/share/doc/${name}"
    xinstall -d "${destroot}${prefix}/etc/tin"
    xinstall -m 644 -v -W "${worksrcpath}/doc" \
      auth.txt CHANGES config-anomalies filtering good-netkeeping-seal \
      iso2asc.txt keymap.sample mailcap.sample pgp.txt reading-mail.txt \
      TODO umlaute.txt umlauts.txt WHATSNEW \
      "${destroot}${prefix}/share/doc/${name}"
    file copy "${worksrcpath}/doc/tin.defaults" \
      "${destroot}${prefix}/etc/tin/tin.defaults-${version}"
}

post-destroot {
    xinstall -m 755 -v -W "${worksrcpath}/tools" \
      expiretover tinews.pl tinlock "${destroot}${prefix}/bin"
}

post-activate {
    set f "${prefix}/etc/tin/tin.defaults"
    if {![file exists ${f}]} {
      file copy ${f}-${version} ${f}
    }
}

variant ipv6 description {IPv6 support} {
    configure.args-append --enable-ipv6
}

variant gpg description {GnuPG support} {
    depends_run bin:gpg:gnupg
    configure.args-delete --disable-pgp-gpg
    configure.args-append --with-gpg=${prefix}/bin/gpg \
                          --without-pgp \
                          --without-pgpk
}

variant pgp5 description {PGPK support} {
    depends_run bin:pgpk:pgp
    configure.args-delete --disable-pgp-gpg
    configure.args-append --with-pgpk=${prefix}/bin/pgpk \
                          --without-gpg \
                          --without-pgp
}

variant ispell description {Ispell support} {
    depends_run bin:ispell:ispell
    configure.args-delete --without-ispell
    configure.args-append --with-ispell=${prefix}/bin/ispell
}
