# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           conflicts_build 1.0
PortGroup           github 1.0

github.setup        gpac gpac 0.7.1 v
categories          multimedia
platforms           darwin
maintainers         nomaintainer
license             LGPL-2+

description         multimedia framework for research and academic purposes
long_description    GPAC is an Open Source multimedia framework for \
                    research and academic purposes. The project \
                    covers different aspects of multimedia, with a \
                    focus on presentation technologies (graphics, \
                    animation and interactivity). Includes MP4Box and \
                    Osmo4.

homepage            http://gpac.wp.mines-telecom.fr/

checksums           rmd160  de5253598a319bd5c79ca1e91ee8aa6a2a4110fe \
                    sha256  966c590c79e5ad276f30a3b9ca0b61348e7a0b89b9ea0722a3ebef7c80d5ddb2 \
                    size    10655976

depends_build       port:pkgconfig \
                    port:zlib

depends_lib         port:a52dec \
                    port:faad2 \
                    path:lib/libavcodec.dylib:ffmpeg \
                    port:jpeg \
                    port:openjpeg15 \
                    port:libmad \
                    port:libogg \
                    port:libpng \
                    port:libsdl \
                    port:libtheora \
                    port:libvorbis \
                    port:openjpeg \
                    path:lib/libssl.dylib:openssl \
                    port:jack \
                    port:xvid \
                    port:libGLU \
                    port:mesa \
                    port:xorg-libXv

patchfiles          patch-configure.diff \
                    patch-ffmpeg-4.0.diff

post-patch {
    reinplace "s|@APPLICATIONS_DIR@|${applications_dir}|g" ${worksrcpath}/configure
}

# https://github.com/gpac/gpac/issues/432
conflicts_build     ${name}

# external spidermonkey (--use-js=no) is not recognized because it doesn't provide a pkg-config file and build fails with local copy
# pulseaudio is recognized if installed but build fails
# builds with openjpeg15 if include path is added, build fails using openjpeg 2.1

configure.args      --cc="${configure.cc}" \
                    --cxx="${configure.cxx}" \
                    --extra-cflags="-I${prefix}/include/openjpeg-1.5 ${configure.cc_archflags}" \
                    --extra-ldflags="${configure.ld_archflags}" \
                    --mandir=${prefix}/share/man \
                    --X11-path=${prefix} \
                    --disable-pulseaudio \
                    --use-js=no \
                    --verbose

# This project's build system detects CPU and endianness at configure time.
# muniversal is worth a try.
universal_variant   no
use_parallel_build  no
