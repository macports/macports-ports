# $Id: Portfile,v 1.8 2005/02/02 00:35:01 blb Exp $

PortSystem			1.0
name				MPlayer
version				1.0pre6
revision			2
categories			multimedia
maintainers			blb@pobox.com
description			The Unix movie player
long_description \
	MPlayer can play most standard video formats out of the box and almost \
	all others with the help of external codecs.  MPlayer currently works \
	best from the command line, but visual feedback for many functions is \
	available from its onscreen status display (OSD), which is also used for \
	displaying subtitles. MPlayer also has a GUI with skin support and \
	several unofficial alternative graphical frontends are available.

platforms			darwin

homepage			http://www.mplayerhq.hu/
master_sites		http://www1.mplayerhq.hu/MPlayer/releases/ \
					http://www2.mplayerhq.hu/MPlayer/releases/ \
					http://ftp3.mplayerhq.hu/MPlayer/releases/ \
					http://ftp5.mplayerhq.hu/MPlayer/releases/ \
					http://www1.mplayerhq.hu/MPlayer/releases/codecs/:codecs \
					http://www2.mplayerhq.hu/MPlayer/releases/codecs/:codecs
use_bzip2			yes

checksums			${distname}${extract.suffix} md5 \
						4a628f87a7070e10ffea04a1598979a9 \
					sha1 80f726c9c38df7d52ae26aeca65918169d2608dc

depends_lib			lib:libpng:libpng lib:libjpeg:jpeg

configure.args		--with-extraincdir=${prefix}/include \
					--with-extralibdir=${prefix}/lib \
					--mandir=${prefix}/share/man --disable-sdl --disable-x11 \
					--disable-freetype --disable-fontconfig --disable-inet6 \
					--disable-gif --enable-png --enable-jpeg \
					--disable-liblzo --disable-qtx --disable-vorbis \
					--disable-arts --disable-esd --disable-fribidi \
					--disable-mad --disable-mencoder

post-destroot {
	file mkdir ${destroot}/${prefix}/share/doc/${name}
	eval file copy [glob ${worksrcpath}/DOCS/*] \
		${destroot}/${prefix}/share/doc/${name}
}

variant real {
	global mplayerRP8 mplayerRP9 mplayerRP8file mplayerRP9file
	set mplayerRP8			rp8codecs-ppc-20050115
	set mplayerRP9			rp9codecs-macosx-20041107.pkg
	set mplayerRP8file		${mplayerRP8}.tar.bz2
	set mplayerRP9file		${mplayerRP9}.zip
	distfiles-append		${mplayerRP8file}:codecs ${mplayerRP9file}:codecs
	checksums-append		${mplayerRP8file} \
								md5 4cc9a6270f9aa834b4fef49d71b9faf9 \
								sha1 12ce04765bdf96e6ad386de1ef637b471d947796 \
							${mplayerRP9file} \
								md5 788cf4940280fd787c0a2141d88ce3c7 \
								sha1 18abd6d0424c4682815a13b34695d37d2fda2a73

	extract.only			${distname}${extract.suffix}

	post-extract {
		cd ${worksrcpath}
		system "bunzip2 -c ${distpath}/${mplayerRP8file} | tar xf -"
		system "unzip -q ${distpath}/${mplayerRP9file}"
	}

	configure.args-append	--with-reallibdir=${prefix}/share/${name}/codecs

	post-destroot {
		xinstall -m 755 -d ${destroot}/${prefix}/share/${name}/codecs
		eval file copy [glob ${worksrcpath}/${mplayerRP8}/*] \
			${destroot}/${prefix}/share/${name}/codecs
		cd ${destroot}/${prefix}/share/${name}/codecs
		system "gunzip -c \
			${worksrcpath}/${mplayerRP9}/Contents/Archive.pax.gz | pax -r"
	}
}

variant quicktime {
	configure.args-delete	--disable-qtx
	configure.args-append	--enable-qtx
}

variant x11 {
	ui_msg "Note, if you are running Mac OS X, you may find the sdl variant"
	ui_msg "a faster choice"
	depends_lib-append		lib:libX11.6:XFree86 lib:libfreetype:freetype \
							lib:libfontconfig:fontconfig
	configure.args-delete	--disable-x11 --disable-freetype \
							--disable-fontconfig
	configure.args-append	--enable-x11 --enable-freetype --enable-fontconfig
}

variant sdl {
	depends_lib-append		lib:libSDL:libsdl
	configure.args-delete	--disable-sdl
	configure.args-append	--enable-sdl
}

variant fontconfig {
	depends_lib-append		lib:libfontconfig:fontconfig
	configure.args-delete	--disable-fontconfig
	configure.args-append	--enable-fontconfig
}

variant freetype {
	depends_lib-append		lib:libfreetype:freetype
	configure.args-delete	--disable-freetype
	configure.args-append	--enable-freetype
}

variant inet6 {
	configure.args-delete	--disable-inet6
	configure.args-append	--enable-inet6
}

# configure doesn't pick up the right -l flag if we --enable-gif, so
# we let it autodetect this
variant gif {
	depends_lib-append		lib:libungif:libungif
	configure.args-delete	--disable-gif
}

variant lzo {
	depends_lib-append		lib:liblzo:lzo
	configure.args-delete	--disable-liblzo
	configure.args-append	--enable-liblzo
}

variant vorbis {
	depends_lib-append		lib:libvorbis:libvorbis
	configure.args-delete	--disable-vorbis
	configure.args-append	--enable-vorbis
}

variant arts {
	depends_lib-append		lib:libartsc:arts
	configure.args-delete	--disable-arts
	configure.args-append	--enable-arts
}

variant esd {
	depends_lib-append		lib:libesd:esound
	configure.args-delete	--disable-esd
	configure.args-append	--enable-esd
}

variant fribidi {
	depends_lib-append		lib:libfribidi:fribidi
	configure.args-delete	--disable-fribidi
	configure.args-append	--enable-fribidi
}

variant mad {
	depends_lib-append		lib:libmad:libmad
	configure.args-delete	--disable-mad
	configure.args-append	--enable-mad
}

variant mencoder {
	depends_lib-append		lib:libmp3lame:lame
	configure.args-delete	--disable-mencoder
	configure.args-append	--enable-mencoder
	pre-configure {
		reinplace "s|^#define USE_MP3LIB|/\*#define USE_MP3LIB\*/|" \
			${worksrcpath}/configure
	}
}

variant man_bg		{ configure.args-append --language=bg }
variant man_cz		{ configure.args-append --language=cz }
variant man_de		{ configure.args-append --language=de }
variant man_dk		{ configure.args-append --language=dk }
variant man_el		{ configure.args-append --language=el }
variant man_en		{ configure.args-append --language=en }
variant man_es		{ configure.args-append --language=es }
variant man_fr		{ configure.args-append --language=fr }
variant man_hu		{ configure.args-append --language=hu }
variant man_it		{ configure.args-append --language=it }
variant man_ko		{ configure.args-append --language=ko }
variant man_mk		{ configure.args-append --language=mk }
variant man_nl		{ configure.args-append --language=nl }
variant man_no		{ configure.args-append --language=no }
variant man_pl		{ configure.args-append --language=pl }
variant man_ro		{ configure.args-append --language=ro }
variant man_ru		{ configure.args-append --language=ru }
variant man_sk		{ configure.args-append --language=sk }
variant man_tr		{ configure.args-append --language=tr }
variant man_uk		{ configure.args-append --language=uk }
variant man_pt_BR	{ configure.args-append --language=pt_BR }
variant man_zh_CN	{ configure.args-append --language=zh_CN }
variant man_zh_TW	{ configure.args-append --language=zh_TW }
variant man_all		{ configure.args-append --language=all }

# GUI variant needs additional download of a skin
#variant gui {
#	depends_lib-append		lib:libgtk.1:gtk
#	configure.args-append	--enable-gui
#}

