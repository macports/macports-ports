# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           conflicts_build 1.0

name                audacious-core
set real_name       audacious

# Please keep audacious, audacious-core and audacious-plugins synchronized.
version             3.5.2
revision            0

license             BSD
categories          multimedia
platforms           darwin
maintainers         ionic
homepage            http://www.audacious-media-player.org/
description         Audacious is an advanced audio player.
long_description    ${description} It is free, lightweight, based on GTK3, \
                    runs on Linux and many other *nix platforms. The player focuses on audio quality \
                    and supports a wide range of audio codecs. \
                    Its advanced audio playback engine is considerably more powerful than GStreamer. \
                    Audacious is a fork of Beep Media Player (BMP), which itself forked from XMMS.

# Maintainer-only helper for testing changes quickly and easily.
#fetch.type          git
#git.url             git://github.com/Ionic/${real_name}
#git.branch          ${real_name}-${version}-buildfix

master_sites        http://distfiles.audacious-media-player.org
distname            ${real_name}-${version}
use_bzip2           yes
checksums           rmd160  dd41e56544d9563b47401a670d96a34d7be920b6 \
                    sha256  3915b9692ef8acb2588b0e26c2738e59e36766cfe83e7e52c0e601688e6c1956

conflicts_build     ${name}

patchfiles          patch-buildsys.diff

depends_build       path:bin/pkg-config:pkgconfig \
                    path:bin/aclocal:automake \
                    path:bin/autom4te:autoconf

depends_lib         port:libiconv \
                    port:gettext \
                    path:lib/pkgconfig/dbus-1.pc:dbus \
                    path:lib/pkgconfig/glib-2.0.pc:glib2 \
                    path:lib/pkgconfig/gtk-3.0.pc:gtk3

# Note: rpath is required on Mac OS X.
configure.args      --enable-nls \
                    --enable-rpath \
                    --enable-dbus \
                    --disable-chardet \
                    --disable-valgrind

use_autoreconf      yes
autoreconf.cmd      ./autogen.sh
autoreconf.args

platform darwin {
    if {${configure.cxx_stdlib} ne {} &&
        [string equal ${configure.cxx_stdlib} "libc++"]} {
        if {${os.major} > 10} {
            configure.ldflags-append  "-mmacosx-version-min=10.7"
        } else {
            ui_error "libc++ is only supported on OS X 10.7 and up for this port."
            error "libc++ supported on >= 10.7 only."
        }
    } else {
        configure.ldflags-append  "-mmacosx-version-min=10.5"
    }
}

post-destroot {
    xinstall -d -m 0755 ${destroot}${prefix}/share/doc/${real_name}
    move ${destroot}${prefix}/share/${real_name}/AUTHORS \
         ${destroot}${prefix}/share/${real_name}/COPYING \
         ${destroot}${prefix}/share/doc/${real_name}
}

# Needs libguess, which is currently not ported.
#variant chardet description {Try to handle non-UTF8 chinese/japanese/korean ID3 tags} {
#    configure.args-replace --disable-chardet \
#                           --enable-chardet
#}

livecheck.type      regex
livecheck.url       ${master_sites}
livecheck.regex     "${real_name}-(\\d+(?:\\.\\d+)*)${extract.suffix}"
