From 0583c3025306756fab4db7724e941e03285e175b Mon Sep 17 00:00:00 2001
From: "Matthias P. Braendli" <matthias.braendli@mpb.li>
Date: Fri, 13 Sep 2019 18:59:01 +0200
Subject: [PATCH] Set welle-io QT style at startup

---
 CMakeLists.txt              | 4 ++--
 src/input/soapy_sdr.cpp     | 2 +-
 src/welle-gui/main.cpp      | 3 +++
 src/welle-gui/welle-gui.pro | 2 +-
 4 files changed, 7 insertions(+), 4 deletions(-)

Index: welle.io-2.0~beta3/CMakeLists.txt
===================================================================
--- welle.io-2.0~beta3.orig/CMakeLists.txt
+++ welle.io-2.0~beta3/CMakeLists.txt
@@ -47,7 +47,7 @@ if(BUILD_WELLE_IO)
     set(CMAKE_AUTOMOC ON)
     set(CMAKE_AUTORCC ON)
 
-    find_package(Qt5 COMPONENTS Widgets Quick Multimedia Charts Qml REQUIRED)
+    find_package(Qt5 COMPONENTS Widgets Quick QuickControls2 Multimedia Charts Qml REQUIRED)
 endif()
 
 if(PROFILING)
@@ -219,7 +219,7 @@ if(BUILD_WELLE_IO)
       ${SoapySDR_LIBRARIES}
       ${MPG123_LIBRARIES}
       Threads::Threads
-      Qt5::Core Qt5::Widgets Qt5::Multimedia Qt5::Charts Qt5::Qml Qt5::Quick
+      Qt5::Core Qt5::Widgets Qt5::Multimedia Qt5::Charts Qt5::Qml Qt5::Quick Qt5::QuickControls2
     )
 
     INSTALL (TARGETS ${executableName} RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR})
Index: welle.io-2.0~beta3/src/input/soapy_sdr.cpp
===================================================================
--- welle.io-2.0~beta3.orig/src/input/soapy_sdr.cpp
+++ welle.io-2.0~beta3/src/input/soapy_sdr.cpp
@@ -76,7 +76,7 @@ bool CSoapySdr::restart()
     m_sampleBuffer.FlushRingBuffer();
     m_spectrumSampleBuffer.FlushRingBuffer();
 
-    m_device = SoapySDR::Device::make(m_driver_args);
+    m_device = SoapySDR::Device::make(m_driver_args);
     stringstream ss;
     ss << "SoapySDR driver=" << m_device->getDriverKey();
     ss << " hardware=" << m_device->getHardwareKey();
Index: welle.io-2.0~beta3/src/welle-gui/welle-gui.pro
===================================================================
--- welle.io-2.0~beta3.orig/src/welle-gui/welle-gui.pro
+++ welle.io-2.0~beta3/src/welle-gui/welle-gui.pro
@@ -2,7 +2,7 @@ include(../backend.pri)
 
 TEMPLATE = app
 TARGET = welle-io
-QT += network qml quick charts multimedia
+QT += quickcontrols2 network qml quick charts multimedia
 
 RC_ICONS   =    icon/icon.ico
 RESOURCES +=    resources.qrc
diff -Naur welle.io-2.0-beta3/src/welle-gui/main.cpp welle.io-2.0-beta3-StyleCommandLineArg/src/welle-gui/main.cpp
--- welle.io-2.0-beta3/src/welle-gui/main.cpp	2019-09-08 20:37:15.000000000 +0200
+++ welle.io-2.0-beta3-StyleCommandLineArg/src/welle-gui/main.cpp	2019-09-22 23:08:29.000000000 +0200
@@ -30,6 +30,7 @@
 #include <unistd.h>
 
 #include <QApplication>
+#include <QQuickStyle>
 #include <QCoreApplication>
 #include <QCommandLineParser>
 #include <QDebug>
@@ -99,6 +100,11 @@
         QCoreApplication::translate("main", "File name"));
     optionParser.addOption(LogFileName);
 
+    QCommandLineOption styleName("qqc-style",
+        QCoreApplication::translate("main", "The Qt Quick Controls Style to be used"),
+        QCoreApplication::translate("main", "style_name"));
+    optionParser.addOption(styleName);
+
     //	Process the actual command line arguments given by the user
     optionParser.process(app);
 
@@ -115,6 +121,13 @@
 
     CRadioController radioController(commandLineOptions);
 
+    QString styleNameValue = optionParser.value(styleName);
+    qDebug() << "styleNameValue::" << styleNameValue ;
+    if (styleNameValue != "")
+        QQuickStyle::setStyle(styleNameValue);
+    else
+        QQuickStyle::setStyle("Default");
+
     QSettings settings;
     settings.setValue("version", QString(CURRENT_VERSION));
 
