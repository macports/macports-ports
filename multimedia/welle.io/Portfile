# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               qt5 1.0
PortGroup               github 1.0
PortGroup               cmake 1.0

#PortGroup               compilers 1.0

github.setup            AlbrechtL welle.io 2.0-beta3 v
github.tarball_from     archive
name                    welle.io
categories              multimedia
maintainers             nomaintainer

description             DAB/DAB+ Software Radio
long_description        This is an open source DAB and DAB+ software defined radio (SDR)  \
                        with support for rtl-sdr (RTL2832U) and airspy. It supports  \
                        high DPI and touch displays and it runs even on cheap computers  \
                        like Raspberry Pi 2/3 and 100â‚¬ China Windows 10 tablets.

platforms               darwin
license                 GPL-2
license_noconflict      openssl

homepage                https://www.welle.io/

checksums               sha256  99acaea8386b092ebc80cd6c689ab0106a9f74ad121c04d0ae893f4e35a5a3e0

depends_lib-append      port:fftw-3-single \
                        port:faad2 \
                        port:libusb \
                        port:mpg123 \
                        port:lame \
                        port:${qt5.name}-qtquickcontrols \
                        port:${qt5.name}-qtquickcontrols2 \
                        port:${qt5.name}-qtcharts \
                        port:${qt5.name}-qtmultimedia \
                        port:${qt5.name}-qtbase \
                        port:${qt5.name}-qtdeclarative
#depends_build-append    port:${qt5.name}-qttools

default_variants    +rtlsdr +soapysdr +airspy

variant rtlsdr description {Add RTL-SDR support} {
    configure.pre_args-append \
        -DRTLSDR=ON
    depends_lib-append port:rtl-sdr
}

variant soapysdr description {Add SoapySDR support} {
    configure.pre_args-append \
        -DSOAPYSDR=ON
    depends_lib-append port:SoapySDR
}

variant airspy description {Add SoapySDR support} {
    configure.pre_args-append \
        -DAIRSPY=ON
    depends_lib-append port:airspy
}

variant morepatches description {Additional patches with bugfixes and features} {
    patchfiles-append 385-fix_rtl-sdr_setFrequency-v2.patch \
                    386-fixFavorit.patch \
                    387-StyleCommandLineArg-remplaceGitCommit-v3.patch \
                    387-fixQMLforKDE-v3-411Compatible-v2.patch \
                    400-french-v3.patch \
                    405-welle.io-2.0-beta3-langComboBox-v2.patch \
                    406-welle.io-2.0-beta3-mainTr.patch \
                    407,409-welle.io-2.0-beta3-newTr-v3.patch \
                    408-welle.io-2.0-beta3-QMLTr.patch \
                    410,413-diff-EnsembleName.patch \
                    411-radioView-wordwrapStationName,AlignAntenna,AntennaKdeSupport.patch \
                    414-Fit_audiomode_in_view.patch \
                    415-Fit_service_details.patch \
                    421-stationNameAsWindowTitle.patch \
                    428-soapyInitArgs-contreFab16.patch \
                    qqc2-style-gui-v2-ListModel-surFab16.patch \
                    updateTranslationManagement-requires405,406.patch
}

cmake.out_of_source yes
configure.pre_args-append \
    -DCMAKE_INSTALL_PREFIX=${applications_dir} 

post-extract {
    file copy -force ${filespath}/fr_FR.qm ${worksrcpath}/src/welle-gui/i18n/
}

patch.pre_args      -p1
patchfiles          CMakeLists.txt.patch

post-patch {
    reinplace "s/@EXECUTABLE@/welle-io/" ${worksrcpath}/welle-io.plist
    reinplace "s/@SHORT_VERSION@/${version}/" ${worksrcpath}/welle-io.plist
    reinplace "s/@TYPEINFO@/io.welle/" ${worksrcpath}/welle-io.plist
    reinplace "s/\$(PRODUCT_BUNDLE_IDENTIFIER)/io.welle/" ${worksrcpath}/welle-io.plist
}
