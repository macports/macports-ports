# $Id: Portfile,v 1.5 2005/08/15 23:42:10 mww Exp $

PortSystem 1.0
name		smpeg
version		0.4.4
revision	4
categories	multimedia
maintainers	mww@opendarwin.org
platforms	darwin
description	a general purpose MPEG video/audio player/library
long_description	smpeg is a general purpose MPEG video/audio player and \
			library programmed by Loki entertainment and others

homepage	http://www.lokigames.com/development/smpeg.php3
master_sites	ftp://ftp.lokigames.com/pub/open-source/smpeg/ \
			opendarwin::lt
distfiles-append	ltconfig13:lt \
				ltmain13:lt
extract.only	${distname}${extract.suffix}

checksums	${distname}${extract.suffix} md5 59c76ac704088ef5539210190c4e1fe3 \
			ltconfig13 md5 ea53f42a550c9f9e653758a8ed91574e \
			ltmain13 md5 e094ae92724c4015dbab97de151c2525

depends_lib	lib:libSDL:libsdl

patchfiles	patch-smpeg.h patch-glmovie-tile.c patch-glmovie.c
post-patch {
	file copy -force ${distpath}/ltconfig13 ${worksrcpath}/ltconfig
	file copy -force ${distpath}/ltmain13 ${worksrcpath}/ltmain.sh
}

configure.env	CC=g++
configure.args	--without-x \
		--disable-gtktest \
		--disable-gtk-player \
		--disable-static \
		--disable-sdltest \
		--mandir=${prefix}/share/man

build.target

set libname	"libsmpeg.${version}.dylib"
platform darwin 8 {
	configure.args-append	--enable-shared=no
	post-build {
		system "cd ${worksrcpath} && g++ -dynamiclib *.o audio/*.o video/*.o -o ${libname} -current_version ${version} -compatibility_version ${version} -install_name ${prefix}/lib/${libname} -L${prefix}/lib -lSDL -lSDLmain"
	}
	post-destroot {
		xinstall -m 644 ${worksrcpath}/${libname} ${destroot}${prefix}/lib
		system "cd ${destroot}${prefix}/lib && ln -s ${libname} libsmpeg.dylib"
		reinplace "s|library_names=\'\'|library_names=\'${libname}\'|g" \
			${destroot}${prefix}/lib/libsmpeg.la
	}
}
