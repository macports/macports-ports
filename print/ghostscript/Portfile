PortSystem 1.0

name			ghostscript
version			7.04
revision		0

categories		print
maintainers		digdog@opendarwin.org
platforms		darwin freebsd

default_variants	+afpl +thirdparty +fonts

variant afpl {
    version		7.04
    description		AFPL Ghostscript, An interpreter for PostScript and PDF
    long_description	Ghostscript is the well-known PostScript interpreter which is available for \
			all common and most esoteric platforms and supports many different printers \
			and some displays. \
			Versions entitled "AFPL Ghostscript" are distributed with a licence different \
			from the GPL. 
    master_sites	ftp://mirror.cs.wisc.edu/pub/mirrors/ghost/AFPL/gs704/:source
    distfiles		${distname}${extract.sufx}:source
    checksums		${distname}${extract.sufx} md5 03f287193d998c9cfaad3c25db9c7fa8
    worksrcdir		gs7.04
    pre-configure {
	cd ${workpath}/${worksrcdir}
	system "ln -sf src/configure.ac ."
	system "ln -sf src/Makefile.in ."
    }
    use_autoconf	yes
    autoconf.dir	${workpath}/${worksrcdir}
    build.target.all
    include		afpl-contents
}

variant gnu {
    version		7.05
    description		GNU Ghostscript, An interpreter for PostScript and PDF
    long_description	Ghostscript is the well-known PostScript interpreter which is available for \
			all common and most esoteric platforms and supports many different printers \
			and some displays. \
			Versions entitled "GNU Ghostscript" are distributed with the GNU General \ 
			Public License, which allows free use, and free copying and redistribution \
			under certain conditions (including, in some cases, commercial distribution).
    master_sites	ftp://mirror.cs.wisc.edu/pub/mirrors/ghost/gnu/gs705/:source
    distfiles		${distname}${extract.sufx}:source
    checksums		${distname}${extract.sufx} md5 23e6cc8c4024c56a28479fad53f9bb80
    worksrcdir		${distname}
    pre-configure {
	cd ${workpath}/${worksrcdir}
	system "ln -sf src/configure.ac ."
	system "ln -sf src/Makefile.in ."
    }
    use_autoconf	yes
    autoconf.dir	${workpath}/${worksrcdir}
    build.target.all
    include		gnu-contents
}

variant devel {
    version		7.30
    description		AFPL Ghostscript, an interpreter for PostScript and PDF
    fetch.type		cvs
    cvs.root		pserver:anonymous@cvs.ghostscript.com:/cvs/ghostscript
    cvs.module		gs7_30
    worksrcdir		gs
    use_autoconf	yes
    autoconf.dir	${workpath}/${worksrcdir}
    build.target.all
}

# Ghostscript uses these packages when running configure & compiling. I just download and
# extract them into the folder that Ghostscript required. Not sure if this could be done
# by using depends_extract (I don't know how to use dependencies as sources), when users
# already installed these pacakges, then we could just extract them directly from local
# ${distpath} without download them everytime.
variant thirdparty {
    master_sites-append	http://www.gzip.org/zlib/:zlib \
                        http://www.libpng.org/pub/png/src/:libpng \
                        http://www.ijg.org/files/:jpeg
    distfiles-append	zlib-1.1.4${extract.sufx}:zlib \
                        libpng-1.2.5${extract.sufx}:libpng \
                        jpegsrc.v6b${extract.sufx}:jpeg
    checksums-append	zlib-1.1.4${extract.sufx} md5 abc405d0bdd3ee22782d7aa20e440f08 \
                        libpng-1.2.5${extract.sufx} md5 0cec860559f2f5f7145da3c6851bacb7 \
                        jpegsrc.v6b${extract.sufx} md5 dbd5f3b47ed13132f04c685d608a7547
    post-extract {
	cd ${workpath}
	system "mv zlib-1.1.4 ${worksrcdir}/zlib"
	system "mv libpng-1.2.5 ${worksrcdir}/libpng"
	system "mv jpeg-6b ${worksrcdir}/jpeg"
    }
}

# Use AFPL fonts, cause they are same with GNU's.
variant fonts {
    master_sites-append http://mirror.cs.wisc.edu/pub/mirrors/ghost/AFPL/fonts/:fonts
    distfiles-append	ghostscript-fonts-std-6.0${extract.sufx}:fonts \
                        ghostscript-fonts-other-6.0${extract.sufx}:fonts
    checksums-append	ghostscript-fonts-std-6.0${extract.sufx} md5 8250132d6fcc6eb1419f505f06c7690b \
                        ghostscript-fonts-other-6.0${extract.sufx} md5 1a643ae62ef166562e4d422b1a601272
    post-install {	if {![file exists ${prefix}/share/fonts]} {file mkdir ${prefix}/share/fonts}
                        system "install -o root -m 644 ${workpath}/fonts/*.* ${prefix}/share/fonts/" }
    include		fonts-contents
}
