# $Id: Portfile,v 1.21 2004/08/26 16:14:44 gwright Exp $

PortSystem 1.0
name			teTeX
version			3.14159
categories		print textproc
maintainers		gwright@opendarwin.org
description		TeX and METAFONT
long_description	teTeX is a TeX distribution for UNIX compatible	\
			systems.  It contains the latest versions of	\
			TeX & friends and nearly everything you need	\
			for happy TeX'ing.  For more information have	\
			a look at the lengthy FEATURES file of the	\
			distribution.
platforms		darwin

set tetex_src		tetex-src-2.0.2.tar.gz
set tetex_texmf		tetex-texmf-2.0.2.tar.gz
set tetex_top		${prefix}/share/texmf
set tetex_texmftree	${destroot}/${tetex_top}

master_sites		ftp://tug.ctan.org/tex-archive/systems/unix/teTeX/current/distrib/ \
			ftp://cam.ctan.org/tex-archive/systems/unix/teTeX/current/distrib/ \
			ftp://dante.ctan.org/tex-archive/systems/unix/teTeX/current/distrib/ 

distfiles		${tetex_src} ${tetex_texmf}

checksums		${tetex_src}   md5 a16f6bba227d55e79aeee46fbbd82d28 \
			${tetex_texmf} md5 d3bdb96f9077e43b2115d3cc471743b3

extract.only		${tetex_src}
worksrcdir		tetex-src-2.0.2

patchfiles		patch-fmtutil

depends_lib		lib:libX11.6:XFree86

pre-configure		{ reinplace "s|fmtutil --all|fmtutil --all --cnffile ${destroot}/${tetex_top}/web2c/fmtutil.cnf|" ${workpath}/${worksrcdir}/Makefile.in

			  reinplace "s|    \$(scriptdir)/texlinks|    \$(scriptdir)/texlinks --cnffile ${destroot}/${tetex_top}/web2c/fmtutil.cnf|" ${workpath}/${worksrcdir}/Makefile.in
			}

configure.args		--prefix=${tetex_top}				\
			--infodir=${destroot}/${prefix}/share/info	\
			--mandir=${destroot}/${prefix}/share/man	\
			--disable-multiplatform

variant nox11	{ depends_lib-delete lib:libX11.6:XFree86
		  configure.args-append --without-x11 \
					--without-oxdvik \
					--without-xdvik \
					--with-mfw=no
		}

pre-destroot	{ file mkdir ${tetex_texmftree}
		  cd ${tetex_texmftree}
		  system "tar vxfz ${distpath}/${tetex_texmf}"
		}

post-destroot	{ # Modify mktex.opt to force use of varfonts
		  reinplace "s|MT_FEATURES=appendonlydir|MT_FEATURES=appendonlydir:varfonts|g" ${destroot}/${tetex_top}/web2c/mktex.cnf

		  # Repair infelicities in texmf.cnf
		  reinplace "s|${prefix}/share/texmf/share/texmf|${prefix}/share/texmf|g" ${destroot}/${tetex_top}/web2c/texmf.cnf

		  # happiness is ranlib.
		  system "ranlib ${destroot}${prefix}/lib/libkpathsea.a"

		  # Add a directory for local enhancements
		  file mkdir ${destroot}${prefix}/share/texmf-local
		  system "touch ${destroot}${prefix}/share/texmf-local/.turd"
		}

destroot.env		TEXMFCNF=${destroot}/${prefix}/share/texmf/web2c
destroot.target		install strip
destroot.destdir	prefix=${destroot}/${prefix}/ texmf=${destroot}/${tetex_top}/

post-activate	{ system "fmtutil --all" }

