--- build/cmake/openzl-deps.cmake_orig	2026-02-05 20:05:53
+++ build/cmake/openzl-deps.cmake	2026-02-05 20:52:17
@@ -39,50 +39,30 @@
 
 message(STATUS "Attempting zstd dependency resolution...")
 
-# Check if zstd is already available
-check_zstd_available(ZSTD_AVAILABLE)
-if(ZSTD_AVAILABLE)
-    message(STATUS "zstd dependency already present")
-else()
-    # Tier 1: Git Submodule (existing approach, matches Makefile)
-    message(STATUS "Tier 1: Trying git submodule...")
-    execute_process(
-        COMMAND git submodule update --init --single-branch --depth 1 deps/zstd
-        WORKING_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}"
-        RESULT_VARIABLE GIT_SUBMOD_RESULT
-        OUTPUT_QUIET ERROR_QUIET
+# --- Comment out or delete the original call ---
+# openzl_resolve_dependency(zstd ...) 
+# 1. Force ZSTD (MacPorts)
+if(NOT TARGET zstd::libzstd_static)
+    add_library(zstd::libzstd_static UNKNOWN IMPORTED GLOBAL)
+    set_target_properties(zstd::libzstd_static PROPERTIES
+        INTERFACE_INCLUDE_DIRECTORIES "/opt/local/include"
+        IMPORTED_LOCATION "/opt/local/lib/libzstd.dylib"
     )
-
-    check_zstd_available(ZSTD_AVAILABLE)
+    # This is the magic line to stop "-llibzstd"
+    set(ZSTD_LIBRARIES "/opt/local/lib/libzstd.dylib" CACHE FILEPATH "" FORCE)
+    set(zstd_LIBRARIES "/opt/local/lib/libzstd.dylib" CACHE FILEPATH "" FORCE)
 endif()
 
-# Tier 2: FetchContent + URL with Hash Verification
-if(NOT ZSTD_AVAILABLE)
-    message(STATUS "Tier 1 failed. Tier 2: Trying FetchContent with verified tarball...")
-
-    include(FetchContent)
-
-    # Clean up any partial downloads first
-    file(REMOVE_RECURSE "${CMAKE_CURRENT_SOURCE_DIR}/deps/zstd")
-    file(REMOVE_RECURSE "${CMAKE_CURRENT_SOURCE_DIR}/deps/${ZSTD_DIRNAME}")
-
-    message(STATUS "Using hash verification for tarball download")
-    FetchContent_Declare(zstd_tarball
-        URL https://github.com/facebook/zstd/releases/download/v${ZSTD_VERSION}/${ZSTD_DIRNAME}.tar.gz
-        URL_HASH SHA256=${ZSTD_TARBALL_SHA256}
-        DOWNLOAD_EXTRACT_TIMESTAMP ON
-        SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/deps/zstd"
+# 2. Force LZ4 (MacPorts)
+if(NOT TARGET lz4::lz4)
+    add_library(lz4::lz4 UNKNOWN IMPORTED GLOBAL)
+    set_target_properties(lz4::lz4 PROPERTIES
+        INTERFACE_INCLUDE_DIRECTORIES "/opt/local/include"
+        IMPORTED_LOCATION "/opt/local/lib/liblz4.dylib"
     )
-
-    FetchContent_MakeAvailable(zstd_tarball)
-    check_zstd_available(ZSTD_AVAILABLE)
+    set(LZ4_LIBRARIES "/opt/local/lib/liblz4.dylib" CACHE FILEPATH "" FORCE)
 endif()
 
-# Final check
-if(NOT ZSTD_AVAILABLE)
-    message(FATAL_ERROR "Failed to obtain zstd dependency through all available methods (git submodule, FetchContent+tarball)")
-endif()
-
 message(STATUS "zstd dependency resolved successfully")
 
 # Set zstd build options before making it available
@@ -90,10 +70,8 @@
 set(ZSTD_BUILD_CONTRIB OFF CACHE BOOL "")
 set(ZSTD_BUILD_TESTS OFF CACHE BOOL "")
 
-# Add zstd subdirectory directly instead of using FetchContent
-add_subdirectory("${CMAKE_CURRENT_SOURCE_DIR}/deps/zstd/build/cmake" zstd_build)
 # Note: find_package not needed when using add_subdirectory - targets are directly available
-list(APPEND OPENZL_LINK_LIBRARIES libzstd)
+list(APPEND OPENZL_LINK_LIBRARIES zstd::libzstd_static)
 
 find_library(MATH_LIBRARY m)
 if(MATH_LIBRARY)
