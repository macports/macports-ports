# $Id$

PortSystem        1.0

name              pbzip2
version           1.1.6
revision          2
categories        archivers
platforms         darwin
maintainers       ram openmaintainer
license           Permissive

description       parallel bzip2
long_description  PBZIP2 is a parallel implementation of the bzip2 \
  block-sorting file compressor that uses pthreads and achieves \
  near-linear speedup on SMP machines.

homepage          http://compression.ca/pbzip2/
master_sites      ${homepage}

depends_lib       port:bzip2

checksums         rmd160 179b548c72f63555a6d51d9d3bd86e3ab002e6a6 \
                  sha256 86bd6d58e5a6c13cf8c709620ebfe186fca423c2724225bb30431fa7a453aee2

configure {
  reinplace "s|man|share/man|" ${worksrcpath}/Makefile
}

variant universal {}

# yes, the Makefile actually requires $(CC) to compile C++
build.args-append CC=${configure.cxx} \
                  CFLAGS=\"${configure.cxxflags} [get_canonical_archflags cxx]\" \
                  LDFLAGS=\"${configure.ldflags} -lbz2\"

destroot.destdir  PREFIX=${destroot}${prefix}

post-destroot {
  delete ${destroot}${prefix}/bin/pbunzip2
  delete ${destroot}${prefix}/bin/pbzcat
  ln -s pbzip2 ${destroot}${prefix}/bin/pbunzip2
  ln -s pbzip2 ${destroot}${prefix}/bin/pbzcat
  set docdir ${prefix}/share/doc/${name}-${version}
  xinstall -d ${destroot}${docdir}
  xinstall -m 0644 -W ${worksrcpath} AUTHORS COPYING ChangeLog README \
    ${destroot}${docdir}
}

livecheck.type    regex
livecheck.url     ${homepage}
livecheck.regex   {pbzip2-(\d+(?:\.\d+)*).tar.gz}
