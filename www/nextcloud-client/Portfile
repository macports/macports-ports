# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               cmake 1.1
PortGroup               qt5 1.0
PortGroup               compiler_blacklist_versions 1.0
PortGroup               github 1.0
PortGroup               app 1.0

github.setup            nextcloud desktop 3.4.0 v
checksums               rmd160  dbd064a452c49ec99e9c4d8604e5326c8a8184c3 \
                        sha256  68fee269a95a35316f6f9a8aa082706703198c385c0c1ddc06e11ba05e127106 \
                        size    14279588
revision                0

name                    nextcloud-client
categories              www aqua
platforms               darwin
maintainers             nomaintainer
license                 GPL-2+
description             Desktop Syncing Client for Nextcloud
long_description \
    The Nextcloud Desktop Client is a tool to synchronize files from Nextcloud \
    server with your computer.
homepage                https://nextcloud.com/

use_xcode               yes
compiler.cxx_standard   2014

depends_lib-append      port:openssl11 port:sqlite3 port:zlib port:qtkeychain

depends_build-append    path:lib/pkgconfig/librsvg-2.0.pc:librsvg

qt5.min_version         5.12
qt5.depends_component   qtmacextras qtquickcontrols2 qtwebsockets
qt5.depends_build_component \
                        qttools

patchfiles              patch-use-system-sqlite.diff \
                        patch-add-xcodeflags.diff \
                        patch-no-deployqt.diff

configure.args-append   \
                        -DXCODEFLAGS="-IDECustomDerivedDataLocation=${workpath}/DerivedData" \
                        -DBUILD_UPDATER=OFF \
                        -DWITH_CRASHREPORTER=OFF

if {${os.major} < 13} {
    # Finder extension does not compile on 10.8
    configure.pre_args-append   -DBUILD_SHELL_INTEGRATION=OFF
}

post-destroot {
    # I don't know what this is
    # feel free to explain me..
    move ${destroot}${prefix}/PlugIns/nextcloudsync_vfs_suffix.dylib \
        ${destroot}${prefix}/lib/nextcloudsync_vfs_suffix.dylib
}

app.create yes
app.name Nextcloud
app.executable nextcloud
app.icon ${destroot}${prefix}/share/icons/hicolor/512x512/apps/Nextcloud.png
app.retina yes
