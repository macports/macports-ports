# $Id$

PortSystem			1.0

name				pear-base
version				1.6.2
categories			www php lang
platforms			darwin
maintainers			wms
description			PHP PEAR Base system (PEAR, Archive_Tar, Console_Getopt, XML_RPC)

long_description	${description}

homepage			http://pear.php.net/
master_sites		${homepage}get/
distname 			PEAR-${version}
extract.suffix		.tgz

set tar_name		Archive_Tar
set tar_ver 		1.3.2
set tar_distname 	${tar_name}-${tar_ver}
set console_name	Console_Getopt
set console_ver		1.2.3
set console_distname ${console_name}-${console_ver}
set xml_name		XML_RPC
set xml_ver			1.5.1
set xml_distname 	${xml_name}-${xml_ver}
set pear_dir		${prefix}/lib/php
set indirs			{OS PEAR}
set pear_bin		{pear peardev pecl}

distfiles-append	[suffix ${tar_distname}] \
					[suffix ${console_distname}] \
					[suffix ${xml_distname}]

checksums			[suffix ${distname}] \
						md5 8658f584d0ba2648b795fe8b1d8998c2 \
						sha1 99900fdad3f7b0078746a021d17749f6bdeec03c \
						rmd160 db3c37446c8e06149d7197ebdd3e9d720dd162ce \
					[suffix ${tar_distname}] \
						md5 17d49e837b64df4e8f9124f829b22cd1 \
						sha1 40a16c6fe6cee12d9fd87d487785db2949ffa9ff \
						rmd160 cec105d1cdefd502f209c24c217645cec723d7a2 \
					[suffix ${console_distname}] \
						md5 d7618327f9302a7191893768982de823 \
						sha1 2f4ea028f478123164c3f6588f8a505dc35915df \
						rmd160 d1624dbcb223395ded9e46285f896d6f5bb5ca74 \
					[suffix ${xml_distname}] \
						md5 1b516162ad65971b5fd04a7c279627ec \
						sha1 d28fd6d3139aa247d22428ec6b50e20a3cdaa4b4 \
						rmd160 6e8b9f4698285609d9c9d4450c59c16083607ee8

#depends_run			port:php5
					
use_configure		no

build {
	# pearcmd.php
	reinplace "s|@pear_version@|${version}|g" \
		${worksrcpath}/scripts/pearcmd.php

	# pear script
	reinplace "s|@php_bin@|${prefix}/bin/php|g" ${worksrcpath}/scripts/pear.sh
	reinplace "s|@bin_dir@|${prefix}/bin|g" ${worksrcpath}/scripts/pear.sh
	reinplace "s|@php_dir@|${pear_dir}|g" ${worksrcpath}/scripts/pear.sh
	reinplace "s|-d output_buffering=1|-d output_buffering=1 -d memory_limit=16M|g" \
		${worksrcpath}/scripts/pear.sh

	# peardev script
	reinplace "s|@php_bin@|${prefix}/bin/php|g" \
		${worksrcpath}/scripts/peardev.sh
	reinplace "s|@bin_dir@|${prefix}/bin|g" ${worksrcpath}/scripts/peardev.sh
	reinplace "s|@php_dir@|${pear_dir}|g" ${worksrcpath}/scripts/peardev.sh

	# pecl script
	reinplace "s|@php_bin@|${prefix}/bin/php|g" ${worksrcpath}/scripts/pecl.sh
	reinplace "s|@bin_dir@|${prefix}/bin|g" ${worksrcpath}/scripts/pecl.sh
	reinplace "s|@php_dir@|${pear_dir}|g" ${worksrcpath}/scripts/pecl.sh

	# Dependency2.php
	reinplace "s|@PEAR-VER@|${version}|g" ${worksrcpath}/PEAR/Dependency2.php

	# /PEAR/Command/Package.php
	reinplace "s|@package_version@|${version}|g" \
		${worksrcpath}/PEAR/Command/Package.php
	reinplace "s|@DATA-DIR@|${pear_dir}/data|g" \
		${worksrcpath}/PEAR/Command/Package.php
}

destroot {
	set docrootdir ${prefix}/share/doc

	# Install PEAR
	xinstall -d ${destroot}${pear_dir}
	foreach B ${pear_bin} {
		xinstall ${worksrcpath}/scripts/${B}.sh \
			${destroot}${prefix}/bin/${B}
	}

	foreach C {pearcmd peclcmd} {
		xinstall ${worksrcpath}/scripts/${C}.php \
			${destroot}${pear_dir}/${C}.php
	}

	foreach D ${indirs} {
		copy ${worksrcpath}/${D} ${destroot}${pear_dir}/
	}

	eval xinstall -m 0644 [glob ${worksrcpath}/*.php] ${destroot}${pear_dir}

	xinstall -d ${destroot}${docrootdir}/${distname}
	xinstall -m 0644 ${worksrcpath}/README ${destroot}${docrootdir}/${distname}


	#Install Archive_tar
	xinstall -d ${destroot}${pear_dir}/Archive
	eval xinstall -m 0644 [glob ${workpath}/${tar_distname}/Archive/*] \
		${destroot}${pear_dir}/Archive

	xinstall -d ${destroot}${docrootdir}/${tar_distname}
	xinstall -m 0644 ${workpath}/${tar_distname}/docs/Archive_Tar.txt \
		${destroot}${docrootdir}/${tar_distname}

	#Install Console_Getopt
	xinstall -d ${destroot}${pear_dir}/Console
	eval xinstall -m 0644 \
		[glob ${workpath}/${console_distname}/Console/*] \
		${destroot}${pear_dir}/Console

	#Install XML_RPC
	xinstall -d ${destroot}${pear_dir}/XML
	eval xinstall -m 0644 \
		[glob ${workpath}/${xml_distname}/*.php] \
		${destroot}${pear_dir}/XML
}

universal_variant no

livecheck.check	regex
livecheck.url	http://pear.php.net/package/PEAR/
livecheck.regex	>(\\d+(?:\\.\\d+)*)</a>

