# $Id$
PortSystem 1.0

name			awstats
version			6.5
categories		www
maintainers		wms
description		Free real-time logfile analyzer to get advanced web statistics
long_description	AWStats is short for Advanced Web Statistics. It's a free tool that \
			generates advanced web (but also ftp or mail) server statistics, \
			graphically. \
			\
			This log analyzer works as a CGI or from command line and shows you \
			all possible information that your logs contain, in a few graphical \
			web pages. It uses a partial information file to be able to process \
			large log files, often and quickly. \
			\
			It can analyze log files from IIS (W3C log format), Apache log files \
			(NCSA combined/XLF/ELF log format or common/CLF log format), WebStar \
			and most of all web, proxy, WAP, and streaming servers (and FTP \
			servers or mail logs).

homepage		http://www.awstats.org
master_sites		sourceforge
master_sites.mirror_subdir sourceforge/$name/
distname		awstats-${version}
checksums		md5 aef00b2ff5c5413bd2a868299cabd69a
platforms		darwin freebsd

depends_lib		port:perl5.8 port:apache2


variant apache {
	depends_lib-append	port:apache
	depends_lib-delete	port:apache2
}

use_configure   no
build 		{}

patch {
    cd ${worksrcpath}
    reinplace "s|/usr/local|${prefix}|g" \
        tools/awstats_buildstaticpages.pl tools/awstats_updateall.pl \
        tools/httpd_conf tools/webmin/awstats-1.6.wbm \
        wwwroot/cgi-bin/awstats.model.conf wwwroot/cgi-bin/awstats.pl
}

set docpath ${destroot}${prefix}/www/awstats

destroot {
	xinstall -m 755 -d ${destroot}${prefix}/www/awstats \
			   ${destroot}${prefix}/share/doc/awstats \
		           ${destroot}${prefix}/etc/awstats
	eval file copy [glob ${worksrcpath}/wwwroot/*] ${docpath} 
	eval file copy ${worksrcpath}/tools ${docpath}
        eval file copy [glob ${worksrcpath}/docs/*] ${destroot}${prefix}/share/doc/awstats 
	xinstall -m 755 -W ${worksrcpath} wwwroot/cgi-bin/awstats.model.conf ${destroot}${prefix}/etc/awstats
}

post-install {
	ui_msg "**********************************************************************"
	ui_msg "Add the following to your Apache httpd.conf, save, and restart Apache:"
	ui_msg ""
	ui_msg "Alias /awstatsclasses \"${prefix}/www/awstats/classes/\""
	ui_msg "Alias /awstatscss \"${prefix}/www/awstats/css/\""
	ui_msg "Alias /awstatsicons \"${prefix}/www/awstats/icons/\""
	ui_msg "ScriptAlias /awstats/ \"${prefix}/www/awstats/cgi-bin/\""
	ui_msg ""
	ui_msg "<Directory \"${prefix}/www/awstats/\">"
	ui_msg "	Options None"
	ui_msg "	AllowOverride None"
	ui_msg " 	Order allow,deny"
	ui_msg "        Allow from all"
	ui_msg "</Directory>"
	ui_msg ""
	ui_msg "Find your sample config file in ${prefix}/etc/awstats, rename it to"
	ui_msg "\"awstats.domain_name.conf\", and edit it to configure Awstats. You"
	ui_msg "can then access Awstats by pointing your browser to:"
	ui_msg ""
	ui_msg "http://yourdomain/awstats/awstats.pl"
}

