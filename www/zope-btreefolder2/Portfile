# $Id: Portfile,v 1.2 2003/09/24 03:52:31 rshaw Exp $
PortSystem 1.0
name            zope-btreefolder2
version         0.5.0
categories      www python zope
maintainers     rshaw@opendarwin.org
description     Zope folder that can contain many more objects efficiently
long_description        When you fill a Zope folder with too many \
                        objects, both Zope and your browser get \
                        overwhelmed. Zope has to load and store a large \
                        folder object, and the browser has to render \
                        large HTML tables repeatedly. Zope can store a \
                        lot of objects, but it has trouble storing a lot \
                        of objects in a single standard Zope folder.  \
                        BTreeFolder2 solves this problem by storing the \
                        objects in Zope BTrees, special structures \
                        designed for the Zope object database. BTrees \
                        can hold numerous items without loading them all \
                        into memory at once.
platforms       darwin
homepage        http://hathaway.freezope.org/Software/BTreeFolder2/
distname        BTreeFolder2-${version}
master_sites    http://hathaway.freezope.org/Software/BTreeFolder2
checksums       md5 f301851803326d774d438b35aeb2322d
depends_build   bin:python2.1:python21 \
                path:${prefix}/www/Zope:zope
configure       {}

set python      /usr/bin/env\ python2.1
set zopehome    ${prefix}/www/Zope

pre-build {
        system  "cp ${zopehome}/inst/compilezpy.py ${workpath}"
}

build {
        system  "cd ${workpath} && \
                ${python} ${workpath}/compilezpy.py"
        system  "cd ${workpath} && \
                ${python} -O ${workpath}/compilezpy.py"
}

destroot        {
        set zopebase    ${destroot}${zopehome}
        set productsdir ${zopebase}/lib/python/Products
        set zopeuser    zope
    
        # Copy Plone products into the Products directory
        system  "install -d ${productsdir}"
        system  "cp -R ${workpath}/BTreeFolder2 ${productsdir}"
        system  "cd ${zopebase} && chown -R zope lib"
        system  "cd ${zopebase} && chgrp -R www lib"
}
