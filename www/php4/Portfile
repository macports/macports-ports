PortSystem 1.0
name            php4
version         4.3.1
revision        2	
categories      www
maintainers    	bchesneau@mac.com
description     PHP: Hypertext Preprocessor
long_description 	PHP is a widely-used general-purpose scripting language that is especially suited for Web development and can be embedded into HTML. 

platforms	darwin freebsd
master_sites 	http://www.php.net/distributions/
distname	php-${version}
worksrcdir	php-${version}
checksums	md5 d4a34efe145b43ed10dbd95825686065

depends_lib	lib:libcurl.2:curl \
		lib:libiconv.2:libiconv \
		lib:libexpat.0.4:expat  \
		lib:libintl:gettext \
		lib:libjpeg.9:jpeg \
		lib:libpng3:libpng \
		lib:libmhash:mhash \
		path:${prefix}/sbin/apxs:apache

set imapversion 2002c1
				
configure.env	LDFLAGS=-L${prefix}/lib CPPFLAGS=-I${prefix}/include

configure.args	--with-apxs=${prefix}/sbin/apxs --mandir=${prefix}/share/man --infodir=${prefix}/share/info --with-config-file-path=${prefix}/etc --enable-calendar --with-iconv=${prefix} --enable-exif --enable-ftp --enable-wddx --with-zlib --with-curl=${prefix} --with-gd --with-jpeg-dir=${prefix} --with-png-dir=${prefix} --without-mysql --with-gettext=${prefix} --with-mhash=${prefix} --with-expat-dir=${prefix} --with-iconv-dir=${prefix} --with-xmlrpc --enable-filepro --enable-bcmath --with-zlib-dir=/usr

variant darwin {
	depends_lib-append	lib:libdl.1:dlcompat
}

variant mysql {
	depends_lib-append	lib:libmysqlclient:mysql
	configure.args-append	--with-mysql=${prefix}
}

variant postgresql {
	configure.env-append	LDFLAGS=-L${prefix}/lib -L${prefix}/pgsql
					
	depends_lib-append	lib:plpgsql:postgresql
	configure.args-append	--with-pgsql=${prefix}/pgsql 
}

variant imap {
	master_sites-append 	ftp://ftp.cac.washington.edu/imap/
	distfiles-append	imap.tar.Z

	configure.args-append 	--with-imap=../imap-${imapversion} --with-imap-ssl=/usr
}

pre-configure {
	if { [variant_isset imap] } {
		system "cd ${workpath}/imap-${imapversion} && \
						make osx SSLTYPE=nopwd"
		system "cd ${workpath}/${worksrcdir}"
	}
}

install.args	prefix=${destroot}${prefix}
	
post-install	{
	file mkdir ${destroot}${prefix}/etc
	system "cp ${workpath}/${worksrcdir}/php.ini-dist ${destroot}${prefix}/etc/php.ini"
}
