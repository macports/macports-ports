# $Id: Portfile,v 1.9 2005/03/16 20:26:26 mww Exp $

PortSystem 1.0

name			mod_python
version			3.1.3
revision		4
categories		www python
platforms		darwin
maintainers		mww@opendarwin.org
description		Apache2 module that embeds Python within the server.
long_description	Mod_python is an Apache 2 module that embeds the \
				Python interpreter within the server. With mod_python \
				you can write web-based applications in Python that \
				will run many times faster than traditional CGI and \
				will have access to advanced features such as ability \
				to retain database connections and other data between \
				hits and access to Apache internals.

homepage		http://www.modpython.org/
master_sites	apache:httpd/modpython
extract.suffix	.tgz
checksums		md5 2e1983e35edd428f308b0dfeb1c23bfe
patchfiles		patch-mod_python.c

depends_lib		path:${prefix}/apache2/bin/apxs:apache2 \
				path:${prefix}/bin/python2.4:python24

post-patch {
	reinplace "s|LONG_LONG|long long|g" ${worksrcpath}/src/requestobject.c
}

configure.env	LDFLAGS=-L${prefix}/lib/
configure.args	--with-apxs=${prefix}/apache2/bin/apxs \
				--with-python=${prefix}/bin/python2.4 \
				--enable-so

pre-destroot	{
	xinstall -d -m 755 ${destroot}${prefix}/apache2/modules \
		${destroot}${prefix}/share/doc
	file copy ${worksrcpath}/doc-html ${destroot}${prefix}/share/doc/${name}
}

post-install	{
	ui_msg "########################################################"
	ui_msg "# to enable mod_python add"
	ui_msg "#  LoadModule python_module modules/mod_python.so"
	ui_msg "# to your apache2 config file:"
	ui_msg "#  ${prefix}/apache2/conf/httpd.conf"
	ui_msg "########################################################"
}
