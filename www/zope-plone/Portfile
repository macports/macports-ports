# $Id: Portfile,v 1.3 2003/09/25 02:50:22 rshaw Exp $
PortSystem 1.0
name            zope-plone
version         1.0.5
categories      www python zope
maintainers     rshaw@opendarwin.org
description     A user friendly implementation of the CMF written on top of Zope
long_description        Plone is a user friendly implementation of the \
                        Content Management Framework written on top of \
                        ZOPE.  Plone is a GUI/Interface/Implementation \
                        of the CMF.  It benefits from all features of \
                        ZOPE/CMF such as: RDBMS integration, Python/Perl \
                        extensions, Object Oriented Database, Web \
                        configurable workflow, pluggable membership and \
                        authentication, Undos, Form validation, amongst \
                        many many other features.
platforms       darwin
homepage        http://www.plone.org/
distname        CMFPlone-${version}
distfiles       CMFPlone${version}${extract.sufx}
master_sites    sourceforge:plone
checksums       md5 942dbc488e6fb15c356e010076857999
depends_build   bin:python2.1:python21 \
                path:${prefix}/www/Zope:zope
depends_run     path:${prefix}/www/Zope/lib/python/Products/CMFCore:zope-cmf
configure       {}

set python      /usr/bin/env\ python2.1
set zopehome    ${prefix}/www/Zope

pre-build {
        system  "cp ${zopehome}/inst/compilezpy.py ${worksrcpath}"
}

build {
        system  "cd ${worksrcpath} && \
                ${python} ${worksrcpath}/compilezpy.py"
        system  "cd ${worksrcpath} && \
                ${python} -O ${worksrcpath}/compilezpy.py"
}

destroot        {
        set zopebase    ${destroot}${zopehome}
        set productsdir ${zopebase}/lib/python/Products
        set zopeuser    zope
    
        # Copy Plone products into the Products directory
        system  "install -d ${productsdir}"
        system  "cp -R ${worksrcpath}/CMFPlone ${productsdir}"
        system  "cp -R ${worksrcpath}/DCWorkflow ${productsdir}"
        system  "cp -R ${worksrcpath}/Formulator ${productsdir}"
        system  "cd ${zopebase} && chown -R zope lib"
        system  "cd ${zopebase} && chgrp -R www lib"

        # Install docs
        system  "install -d ${destroot}${prefix}/share/doc/Plone"
        system  "cp -r ${worksrcpath}/CMFPlone/docs/* \
                        ${destroot}${prefix}/share/doc/Plone"
}
