# $Id: Portfile,v 1.1 2004/10/22 03:46:47 jberry Exp $

PortSystem 			1.0

name				groovy
version				1.0-beta-7

categories			java lang
maintainers			jberry@opendarwin.org
platforms			darwin

description			Groovy -- a Java-based scripting language
long_description	Groovy is a new agile dynamic language for the JVM combining \
					lots of great features from languages like Python, Ruby and \
					Smalltalk and making them available to Java developers \
					using a Java-like syntax. \
					\
					Groovy is designed to help you get things done on the Java \
					platform in a quicker, more concise and fun way - bringing \
					the power of Python and Ruby inside the Java platform. \
					\
					Groovy can be used as an alternative compiler to javac to \
					generate standard Java bytecode to be used by any Java project \
					or it can be used dynamically as an alternative language such \
					as for scripting Java objects, templating or writing unit test cases.

distname			${name}-${version}-src
master_sites    	http://dist.codehaus.org/groovy/distributions/
checksums			md5 dd22133d6366de556bcaf623a8cca71b

# These patches are to enable the shell scripts to find themselves
# when invoked via a symlink.
patchfiles			patch-bin-groovy.diff \
					patch-bin-groovyc.diff \
					patch-bin-groovyConsole.diff \
					patch-bin-groovysh.diff \
					patch-bin-grok.diff

depends_build		bin:ant:apache-ant \
					bin:maven:maven
depends_lib			bin:java:kaffe \
					
use_configure		no

worksrcdir			${name}-${version}

build.cmd			maven
build.target		groovy:disable-unittests groovy:make-install

destroot {
	set target ${destroot}${prefix}/share/java/${name}
	
	# Create the target java directory
	xinstall -m 755 -d ${destroot}${prefix}/share/java
	
	# Copy in our directory tree
	file copy ${worksrcpath}/target/install ${target}
		
	# Remove .bat files
	foreach f [glob -directory ${target}/bin *.bat] { file delete $f }
	
	# Fix permissions on the scripts,
	# and at the same time add symlinks to them
	foreach f { grok groovy groovyc groovyConsole groovysh } {
		file attributes ${target}/bin/${f} -permissions +x
		system "cd ${destroot}${prefix}/bin && ln -s ../share/java/${name}/bin/${f}"
	}
}
