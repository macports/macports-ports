# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                mecab-java
version             0.98pre3
revision            1
categories          java textproc japanese
platforms           darwin
maintainers         hum openmaintainer
license             GPL-2 LGPL-2.1 BSD

description         a Java module for MeCab
long_description    ${name} is ${description}.

homepage            http://mecab.sourceforge.net/
master_sites        sourceforge:mecab/${name}/${version}

checksums           sha1    dcd5c636f76cf7040f7c3ec0380d45b6851dce03 \
                    rmd160  9214b1e3b2f24334709bdd3adc69da076c892c67

# This port requires mecab+utf8 althought the default character encoding of
# mecab is not utf-8 but euc-jp.
# It will just check the encoding of mecab in the pre-fetch phase instead of
# depends_lib, because depends_lib could not specify a variant.
#depends_lib         port:mecab

pre-fetch {
    catch {exec $prefix/bin/mecab -D} dict_info
    if {![regexp {charset:\s+utf\-8} $dict_info]} {
        ui_error "mecab-java requires MeCab for UTF-8.\
                  Please install mecab +utf8 first.\
                  If another encoding version of MeCab is already installed,\
                  you should uninstall mecab beforehand."
        return -code error "MeCab for UTF-8 is missing"
    }
}

patchfiles          patch-Makefile.diff \
                    patch-test.java.diff

post-patch {
    reinplace "s|@java_library_path@|${prefix}/lib|g" ${worksrcpath}/test.java
}

use_configure       no

variant universal {}
if {[variant_isset universal]} {
    set archflags ${configure.universal_cxxflags}
} else {
    set archflags ${configure.cxx_archflags}
}

build.args          CXX="${configure.cxx}" \
                    CXXFLAGS="${configure.cxxflags} ${archflags}"

test.run            yes

destroot    {
    xinstall -m 755 -d \
        ${destroot}${prefix}/share/java \
        ${destroot}${prefix}/share/doc/${name}
    xinstall -m 644 -W ${worksrcpath} \
        AUTHORS BSD COPYING GPL LGPL bindings.html test.java \
        ${destroot}${prefix}/share/doc/${name}
    xinstall -m 644 ${worksrcpath}/mecab.jar \
        ${destroot}${prefix}/share/java
    xinstall -m 644 ${worksrcpath}/lib${name}.dylib \
        ${destroot}${prefix}/lib
}

# a distfile folder for a newer version 0.98 exists, but is empty.
livecheck.type      none
#livecheck.type      regex
#livecheck.url       http://sourceforge.net/projects/mecab/files/mecab-java
#livecheck.regex     /${name}\/(\[0-9.\]+)/
