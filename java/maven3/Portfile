# -*- coding: utf-8; mode: tcl; tab-width: 4; truncate-lines: t; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id$

PortSystem 1.0

name            maven3
version         3.0
revision        1

categories      java devel
maintainers     blair kickstyle.net:gk5885
platforms       darwin

description     A java-based build and project management environment.
long_description \
                Maven is a Java project management and project \
                comprehension tool.  Maven is based on the \
                concept of a project object model (POM) in that \
                all the artifacts produced by Maven are a result \
                of consulting a well defined model for your \
                project.Builds, documentation, source metrics, \
                and source cross-references are all controlled by \
                your POM.  Maven 3 aims to ensure backward \
                compatibility with Maven 2, improve usability, \
                increase performance, allow safe embedding, and \
                pave the way to implement many highly demanded \
                features.

homepage        http://maven.apache.org/

master_sites    apache:maven/binaries
distname        apache-maven-${version}-bin
worksrcdir      apache-maven-${version}
checksums       md5    505560ca377b990a965c4e4f8da42daa \
                sha1   996f29b5a19e8145cb00926c68a0200dac554205 \
                rmd160 eacd100b1ac8291d0ae32a5e10914596d1d9de77

depends_build   bin:java:kaffe

use_configure   no
universal_variant no

# Source builds of maven are not possible. So, the default build is a binary
# install of the jars.
build.cmd       true

destroot {
        # Create the target java directory exists
        xinstall -m 755 -d ${destroot}${prefix}/share/java/${name}
        
        # Copy over the needed elements of our directory tree
        file copy \
                ${worksrcpath}/bin \
                ${worksrcpath}/boot \
                ${worksrcpath}/conf \
                ${worksrcpath}/lib \
                ${destroot}${prefix}/share/java/${name}
                
        # Remove extraneous bat files
        foreach f [glob -directory ${destroot}${prefix}/share/java/${name}/bin *.bat] {
                file delete $f
        }
        
        # Fix permissions on shell scripts
        foreach f { maven install_repo.sh } {
                if [file exists ${destroot}${prefix}/share/java/${name}/bin/$f] {
                        file attributes ${destroot}${prefix}/share/java/${name}/bin/$f -permissions +x
                }
        }

        # Reduce the permissions on the distribution files.
        file attributes ${destroot}${prefix}/share/java/${name}/conf -permissions 0755
        file attributes ${destroot}${prefix}/share/java/${name}/conf/settings.xml -permissions 0644
        foreach f [glob -directory ${destroot}${prefix}/share/java/${name}/boot *.jar] {
                file attributes $f -permissions 0644
        }
        foreach f [glob -directory ${destroot}${prefix}/share/java/${name}/lib *.jar] {
                file attributes $f -permissions 0644
        }
        
        # Symlink maven into the bin directory
        system "cd ${destroot}${prefix}/bin && ln -s ../share/java/${name}/bin/mvn mvn3"
}

livecheck.type  regex
livecheck.url   ${homepage}download.html
livecheck.regex apache-maven-(\[0-9.\]+)-bin\\.tar
