# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               github 1.0
PortGroup               java 1.0

github.setup            plantuml plantuml 1.2023.1 v
github.tarball_from     releases
revision                0

categories              java editors
supported_archs         noarch
license                 GPL-3+
maintainers             {judaew @judaew} openmaintainer
description             PlantUML is a tool for generating UML diagrams from \
                        textual description.
long_description        ${description}
homepage                https://plantuml.com/

distfiles               ${name}-${version}.jar

checksums               ${name}-${version}.jar \
                        rmd160  1cdffc9768a0b036384e6b23baf6c40025c7f8e4 \
                        sha256  6fc8c947c14a69a7c9be54a42bb012dfe286555edf7c346384cc35c256df4b3e \
                        size    11434710

extract.only

java.version            1.7+
java.fallback           openjdk17

use_configure           no
build {}

set javadir             ${destroot}${prefix}/share/java

destroot {
    xinstall -d -m 0755 ${javadir}/${name}
    xinstall -m 0755 ${filespath}/${name} ${destroot}${prefix}/bin
    reinplace "s|@@PREFIX@@|${prefix}|g" ${destroot}${prefix}/bin/${name}
    xinstall -m 0644 ${distpath}/${name}-${version}.jar \
        ${javadir}/${name}/${name}.jar
}

variant pdf description {Include PDF Support} {
    distfiles-append        ${name}-pdf-${version}.jar
    checksums-append        ${name}-pdf-${version}.jar \
                            rmd160  83f4f8114c014e4a985794417ff4bbc493c47caa \
                            sha256  39b362b83d257b914e106bda22bde397e2e2c7be17be9b28fd822ac871861c0b \
                            size    26453464

    post-destroot {
        xinstall -m 0644 ${distpath}/${name}-pdf-${version}.jar \
            ${javadir}/${name}/${name}-pdf.jar
    }
}

variant jlatexmath description {Plantuml language extension to allow use AsciiMath or JLaTeXMath notation} {
    master_sites-append http://beta.plantuml.net/
    distfiles-append    ${name}-jlatexmath.zip

    checksums-append    ${name}-jlatexmath.zip \
                        rmd160  bf99090e005f0d5e027427b41b40b69d7d2fc872 \
                        sha256  e041164c6dce5dec3377242a0664c1855d863094dd51c28880888f59820fc7e2 \
                        size    3837373

    depends_extract     port:unzip

    post-destroot {
        system "cd ${javadir}/${name} && ${prefix}/bin/unzip ${distpath}/${name}-jlatexmath.zip"
    }
}

notes "
graphviz port is optional -- you don't need this if you only need sequence
and activity diagrams. Otherwise, install with

    sudo port install graphviz

JLatexMath support is optional -- you don't need this if you don't use
JLaTeXMath notation. Otherwise, enable with

    sudo port install plantuml +jlatexmath
"
