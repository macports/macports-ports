# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem      1.0

name            openjfx17
version         17.0.6
revision        0

set build       1

categories      java devel
maintainers     {outlook.com:usersword123 @usersxx} openmaintainer
platforms       darwin
license         GPL-2
supported_archs x86_64 arm64

description     OpenJFX17

long_description OpenJFX is an open source, next generation client application platform \
                 for desktop, mobile and embedded systems built on Java for use with JDK 17. \
                 It is a modern, efficient, and fully featured toolkit for developing rich client \
                 applications.

homepage        https://openjdk.org/projects/openjfx/

depends_build   port:openjdk17-bootstrap \
                port:gradle \
                port:apache-ant \
                port:ksh \
                port:cmake \
                port:ninja

master_sites    https://git.openjdk.org/jfx17u/archive/refs/tags 
distname        ${version}+${build}
checksums       rmd160  52ac262b1f9ce52c7cc378abbaa9672313b81abf \
                sha256  e754df000201cb3164e20f2d68f4634f38f984f3aebb5b719d63ecaf61a625c6 \
                size    60228532

worksrcdir      jfx17u-${version}-${build}

pre-patch {
    system -W ${worksrcpath} "test -d \"/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk\" && cd ${worksrcpath} && patch -p0 < ${portpath}/files/xcode-cli.diff || cd ${worksrcpath}"
}

patchfiles      

post-patch {
    xinstall -m 755 -d ${worksrcpath}/Home
}

use_configure   no

set jdk_path /Library/Java/JavaVirtualMachines/openjdk17-bootstrap/Contents/Home
set ant_path ${prefix}/share/java/apache-ant
set gradle_home_path ${worksrcpath}/Home

build {
    system -W ${worksrcpath} "export GRADLE_USER_HOME=\"${gradle_home_path}\" && export JAVA_HOME=\"${jdk_path}\" && export JDK_HOME=\"${jdk_path}\" && ${prefix}/bin/ksh ./gradlew"
}

destroot.violate_mtree yes

set target /Library/Java/Extensions/openjfx17

destroot {
    xinstall -m 755 -d ${destroot}${target}
    copy ${worksrcpath}/build/sdk/legal   ${destroot}${target}/legal
    copy ${worksrcpath}/build/sdk/lib     ${destroot}${target}/lib
    copy ${worksrcpath}/build/modular-sdk ${destroot}${target}/modular-sdk
}

notes "
To use ${name}, install any of openjdk17 port
"

# openjfx17 releases depend on openjdk17 releases
livecheck.type      regex
livecheck.url       https://github.com/openjdk/jdk17u/tags
livecheck.regex     jdk-(17\.\[0-9.\]+)-ga
