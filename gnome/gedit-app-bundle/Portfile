# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               gobject_introspection 1.0


name                    gedit-app-bundle
version                 3.22.1
categories              gnome editors
platforms               darwin
maintainers             hotmail.co.uk:ethansherriff openmaintainer
homepage                https://wiki.gnome.org/Apps/Gedit
license                 GPL-2+
set branch              [join [lrange [split ${version} .] 0 1] .]

description             An App bundle for gedit.
long_description        ${description}. A full copy of gtk3 and all \
                        dependents are copied into a self-containted \
                        app bundle that is intended to be suitable for \
                        distribution as a stand-alone application.

fetch.type              git
git.url                 https://git.gnome.org/browse/gedit.git
git.branch              ${version}

post-fetch {
    system -W ${worksrcpath} "git submodule update --init"
}

depends_build-append    port:autoconf \
                        port:automake \
                        port:gedit \
                        port:gettext \
                        port:glib2 \
                        port:gnome-themes-standard \
                        port:gnome-common \
                        port:gsettings-desktop-schemas \
                        port:gspell \
                        port:gtk-doc \
                        port:gtk-mac-bundler \
                        port:gtk3 \
                        port:gtksourceview3 \
                        port:intltool \
                        port:libpeas \
                        port:libtool \
                        port:libxml2 \
                        port:yelp-tools

patchfiles              patch-gedit-app.diff

if {[file exists ${prefix}/lib/enchant/libenchant_aspell.so]} {
    patchfiles-append patch-gedit-app-speller.diff
}

gobject_introspection   yes

# We need to configure to generate an Info.plist
configure.cmd           ./autogen.sh

# broaden this out so all Mac systems can at least try to run it - works OK on 10.6
post-configure {
    reinplace "s|10.7|${macosx_deployment_target}|g" ${worksrcpath}/osx/bundle/data/Info.plist
}

build {
    system -W ${worksrcpath} "MACPORTS_PREFIX=${prefix} ${prefix}/bin/gtk-mac-bundler osx/bundle/data/gedit.bundle"
}

destroot {
    copy ${worksrcpath}/osx/bundle/data/Gedit.app ${destroot}${applications_dir}
}
