# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0
PortGroup           meson  1.0

name                dia

github.setup        GNOME Dia ebe22e0e99ee581c278c6c6bd2ed216fe07ea3a7
version             0.98.0-2026-01-09
revision            0

checksums           rmd160  920850019bebbaf18d27b897fc2aa6e1059c7118 \
                    sha256  23fc43b91b5c77e22e79cfcde367d0dd49867db67e12220a1d9114d8fb6d5b22 \
                    size    11704183

maintainers         nomaintainer
license             GPL-2+
categories          gnome graphics
description         A diagram creation program.

long_description    Dia is a GTK+ based diagram creation program and is \
                    roughly inspired by the commercial Windows program \
                    'Visio,' though more geared towards informal diagrams \
                    for casual use. It can be used to draw many different \
                    kinds of diagrams and currently has special objects to \
                    help draw entity relationship diagrams, UML diagrams, \
                    flowcharts, network diagrams, and many other diagrams. \
                    It is also possible to add support for new shapes by \
                    writing simple XML files, using a subset of SVG to draw \
                    the shape.

homepage            https://wiki.gnome.org/Apps/Dia

depends_build       port:cmake \
                    port:meson \
                    port:pkgconfig \

depends_lib         port:appstream \
                    port:cairo \
                    port:dblatex \
                    port:desktop-file-utils \
                    port:gdk-pixbuf2 \
                    port:gettext \
                    port:graphene \
                    port:gtk3 \
                    port:libxml2 \
                    port:libxslt \
                    port:pango \
                    port:poppler \
                    port:shared-mime-info \

post-patch {
    reinplace s/isspecial/char_isspecial/ ${worksrcpath}/objects/GRAFCET/boolequation.c
    reinplace "s|python3-embed|python3|g" ${worksrcpath}/plug-ins/python/meson.build
# issue report: https://gitlab.gnome.org/GNOME/dia/-/issues/576
    reinplace "s|!finite|!isfinite|g"     ${worksrcpath}/lib/arrows.c
}

post-destroot {
    delete ${destroot}${prefix}/bin/xml2-config
    delete ${destroot}${prefix}/bin/xmlcatalog
    delete ${destroot}${prefix}/bin/xmllint
    delete ${destroot}${prefix}/include/libxml2
    delete ${destroot}${prefix}/lib/cmake
    delete ${destroot}${prefix}/lib/libxml2.dylib
    delete ${destroot}${prefix}/lib/pkgconfig/libxml-2.0.pc
}

post-activate {
    system "${prefix}/bin/update-mime-database ${prefix}/share/mime"
    system "${prefix}/bin/gtk-update-icon-cache -f -t ${prefix}/share/icons/hicolor"
    system "${prefix}/bin/update-desktop-database ${prefix}/share/applications"
}

livecheck.type      gnome-with-unstable
