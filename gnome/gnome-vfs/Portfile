# $Id: Portfile,v 1.27 2005/08/19 17:04:59 olegb Exp $
PortSystem 1.0
name		gnome-vfs
version		2.10.1
description	This is the GNOME Virtual File System.
long_description        This is the GNOME Virtual File System. \
			GNOME VFS is currently used as one of the \
			foundations of the Nautilus file manager.
maintainers	gnome-darwinports@opendarwin.org
categories	gnome
platforms	darwin 
homepage	http://www.gnome.org/
master_sites    gnome:sources/gnome-vfs/2.10/
checksums	md5 88b520e5de748a310a2aef62fc095c8b
depends_lib	lib:gnome-mime-magic:gnome-mime-data lib:libiconv.2:libiconv
patchfiles	patch_gnome-vfs-cdrom.c patch_gnome-vfs-utils.c \
		patch_file-metod.c patch_bzip2-method.c patch_pty-open.c
use_bzip2 	yes
configure.args  --mandir=${prefix}/share/man --enable-ipv6 --disable-static 
configure.env   CPPFLAGS="-L${prefix}/lib -I${prefix}/include" \
		LDFLAGS="-lresolv" CC=gcc-4.0 CXX=g++-4.0

post-patch {
	reinplace "s|data_dirs = \"/usr|data_dirs = \"${prefix}/share:/usr|g" \
		${worksrcpath}/libgnomevfs/xdgmime.c \
		${worksrcpath}/libgnomevfs/gnome-vfs-mime-info.c 
	reinplace "s|\"/etc/fstab\"|\"/etc/fstab.hd\"|g" \
        	${worksrcpath}/libgnomevfs/gnome-vfs-unix-mounts.c
}

pre-build {
	reinplace "s|-lkrb5support||g" \
		${worksrcpath}/Makefile ${worksrcpath}/daemon/Makefile \
		${worksrcpath}/devel-docs/Makefile ${worksrcpath}/doc/Makefile \
		${worksrcpath}/devel-docs/gnome-vfs-tutorial/Makefile \
		${worksrcpath}/imported/Makefile ${worksrcpath}/imported/neon/Makefile \
		${worksrcpath}/libgnomevfs/Makefile ${worksrcpath}/modules/Makefile \
		${worksrcpath}/monikers/Makefile ${worksrcpath}/programs/Makefile \
		${worksrcpath}/schemas/Makefile 
}

platform darwin 6 {
        configure.env-delete LDFLAGS="-lresolv" 

	post-patch-append {
	        reinplace "s|#include <arpa/nameser.h>|#include <arpa/nameser.h>\\
			#ifndef T_SRV\\
			#define T_SRV 33\\
			#endif|g" \
	       	         ${worksrcpath}/libgnomevfs/gnome-vfs-dns-sd.c 
	        reinplace "s|#include <limits.h>|#include <limits.h>\\
			#if \!defined getc_unlocked \\&\\& \!defined HAVE_GETC_UNLOCKED\\
			#define getc_unlocked(fp) getc (fp)\\
			#endif|g" \
                	${worksrcpath}/libgnomevfs/xdgmimemagic.c
        	reinplace "s|socklen_t|int|g" ${worksrcpath}/modules/ftp-method.c
	}
}

