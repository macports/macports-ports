# $Id$

PortSystem          1.0

name                dovecot
epoch               20060722
version             1.1.16
set branch          [join [lrange [split ${version} .] 0 1] .]
categories          mail
maintainers         jberry openmaintainer
platforms           darwin

description         Secure, fast imap and pop3 server
long_description    Dovecot is an IMAP and POP3 server for Linux/UNIX-like \
                    systems, written with security primarily in mind. Although \
                    it's written in C, it uses several coding techniques to \
                    avoid most of the common pitfalls.

homepage            http://dovecot.org/

master_sites        ${homepage}releases/${branch}
checksums           md5     2e20c761416b16aa0fe9cac260ca0d2d \
                    sha1    3aa7f386559f244b3a9addad27c4845c554e545b \
                    rmd160  53122e86f217e33f24b52559fece5ace35689eb4

depends_build       port:pkgconfig
depends_lib         port:libiconv \
                    port:zlib \
                    port:openssl

configure.args      --sysconfdir=${prefix}/etc/dovecot \
                    --localstatedir=${prefix}/var \
                    --with-ioloop=kqueue \
                    --with-ssl=openssl \
                    --with-ssldir=${prefix}/etc/ssl

configure.cppflags  -I${prefix}/include/openssl

post-destroot   {
    # Create the dovecot user and group
    addgroup dovecot
    set gid [existsgroup dovecot]
    adduser dovecot gid=${gid} realname=Dovecot
}

variant postgres description {Enable PostgreSQL support} {
    depends_lib-append  port:postgresql80
    configure.args-append       --with-pgsql
    configure.ldflags-append    -L${prefix}/lib/pgsql8
    configure.cppflags-append   -I${prefix}/include/pgsql8
}

variant mysql5 description {Enable MySQL support} {
    depends_lib-append          path:bin/mysql_config5:mysql5
    configure.args-append       --with-mysql
    configure.ldflags-append    -L${prefix}/lib/mysql5/mysql
    configure.cppflags-append   -I${prefix}/include/mysql5/mysql
}

variant ldap description {Enable LDAP support} {
                    configure.args-append   --with-ldap
                    depends_lib-append  port:openldap
}

startupitem.create      yes
startupitem.executable  ${prefix}/sbin/dovecot
startupitem.pidfile     auto ${prefix}/var/run/dovecot/master.pid

livecheck.type  regex
livecheck.url   ${homepage}download.html
livecheck.regex "${name}-(\\d+\\.\\d+(\\.\\d+)?).tar.gz"

