PortSystem 1.0
name		postfix
version		1.1.11
categories	mail
maintainers	eric@opendarwin.org
description	Fast and robust mail transfer agent
platforms	darwin
master_sites	ftp://ftp.porcupine.org/mirrors/postfix-release/official/ \
		ftp://ftp.tux.org/pub/net/postfix/official/ \
		ftp://ftp.utoronto.ca/mirror/packages/postfix/official/
checksums	md5 b34bb2b5018327c19456a77814141208
patchfiles	patch-mail_params.h patch-main.cf patch-sample-misc.cf \
		patch-sys_defs.h

configure	{ cd ${worksrcpath}
		  reinplace "s|__PREFIX|${prefix}|g" src/util/sys_defs.h
		  reinplace "s|__PREFIX|${prefix}|g" conf/main.cf
		  reinplace "s|__PREFIX|${prefix}|g" src/global/mail_params.h
		  reinplace "s|__PREFIX|${prefix}|g" conf/sample-misc.cf }

build.target.all

depends_run path:/Library/StartupItems/DarwinPortsStartup:DarwinPortsStartup

install		{ adduser postfix realname=Postfix\ Server
		  addgroup maildrop
		  cd ${worksrcpath}
		  system "/bin/sh postfix-install -non-interactive \
		    config_directory=${prefix}/etc/postfix \
		    daemon_directory=${prefix}/libexec \
		    command_directory=${prefix}/sbin \
		    queue_directory=${prefix}/var/spool/postfix \
		    manpage_directory=${prefix}/man \
		    sendmail_path=${prefix}/sbin/sendmail \
		    newaliases_path=${prefix}/bin/newaliases \
		    mailq_path=${prefix}/bin/mailq \
		    sample_directory=${prefix}/share/postfix/sample \
		    readme_directory=${prefix}/share/postfix/readme"
		  system "install -o root -m 755 -d ${prefix}/etc/rc.d"
		  system "install -o root -m 755 -c \
		    ${portpath}/files/postfix.sh ${prefix}/etc/rc.d"
		  reinplace "s|__PREFIX|${prefix}|g" \
		    ${prefix}/etc/rc.d/postfix.sh }

include		contents
