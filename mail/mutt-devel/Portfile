# $Id: Portfile,v 1.10 2005/09/05 06:04:23 yeled Exp $

PortSystem 1.0
name		mutt-devel
version		1.5.10
categories	mail
maintainers	mij@opendarwin.org
description	Mongrel of Mail User Agents (part Elm, Pine, Mush, mh, etc)
homepage	http://www.mutt.org/
platforms	darwin linux

long_description Mutt -- "The Mongrel of Mail User Agents" (part Elm, part \
		 Pine, part mh, part slrn, part everything else) is an \
		 interactive screen-oriented mailer program that supersedes \
		 Elm, Pine, mail and mailx.  Features include color support, \
		 message threading, MIME support (including RFC1522 support \
		 for encoded headers), customizable key bindings, POP3, \
		 Delivery Status Notification (DSN) support, and PGP/MIME.

master_sites	ftp://ftp.mutt.org/mutt/devel/
distname	mutt-${portversion}i
checksums	${distfiles} md5 59400d12c6b5b3d122531000e53d1914
patch.args	-p1

worksrcdir	mutt-${portversion}

depends_lib		port:gettext port:libiconv

configure.args	--disable-warnings \
		--mandir=${prefix}/share/man \
		--with-docdir=${prefix}/share/doc/mutt \
    	--with-libiconv-prefix=${prefix}

variant idn {
    configure.args-append	--with-idn=${prefix}
    depends_lib-append		port:libidn port:zlib
}

variant linux {
    configure.env		CFLAGS=-I/usr/kerberos/include
}

variant pop	{ configure.args-append --enable-pop }
variant imap	{ configure.args-append --enable-imap }
variant ssl	{ 	configure.args-append --with-ssl 
				depends_lib-append port:openssl }
variant debug	{ configure.args-append --enable-debug }
# use file size attribute instead of access time
variant buffy { configure.args-append --enable-buffy-size }

variant cvs {
    fetch.type 		cvs
    cvs.root 		:pserver:anonymous@cvs.mutt.org:/home/roessler/cvs
    cvs.module 		mutt
    cvs.password	anonymous 
    worksrcdir		mutt
    configure.cmd	${worksrcpath}/prepare
	depends_build-append	port:autoconf
}

variant compress {
    configure.args-append	--enable-compressed
    patch_sites-append		http://www.spinnaker.de/mutt/compressed/
    patchfiles-append		patch-1.5.10.rr.compressed.1.gz
    checksums-append		patch-1.5.10.rr.compressed.1.gz md5 \
					10f698f45a437184f198c7dd37bb86c6
}

variant headercache {
    depends_lib-append		port:db4
    configure.args-append	--enable-hcache --without-gdbm 
    configure.env-append	CPPFLAGS="-I${prefix}/include/db4" \
		    				LDFLAGS="-L${prefix}/lib -L/usr/lib"
}

variant nntp {
    configure.args-append	--enable-nntp
    patch_sites-append		http://www.mutt.org.ua/download/mutt-1.5.10/
    patchfiles-append		patch-1.5.10.vvv.nntp.gz
    checksums-append		patch-1.5.10.vvv.nntp.gz md5 \
					ac9a4c8bf25a96648bb08cde4ced4c05
}

variant deepif {
    patch_sites-append http://home.uchicago.edu/~dgc/sw/mutt/
    patchfiles-append	patch-1.5.1.dgc.deepif.1
    checksums-append		patch-1.5.1.dgc.deepif.1 md5 \
					d106063ac67b8afe107ed62abff79976
}

variant trash {
# add purge patch without asking
    patch_sites-append http://cedricduval.free.fr/mutt/patches/download/
    patchfiles-append	patch-1.5.10.cd.trash_folder.3.4 \
						patch-1.5.5.1.cd.purge_message.3.4
    checksums-append	patch-1.5.10.cd.trash_folder.3.4 md5 \
						0d0dc2e8167107414d145fc735cd87ba \
						patch-1.5.5.1.cd.purge_message.3.4 md5 \
						396c8c0d1439217c0ee1322aae761f92
}

#variant attach {
# http://home.uchicago.edu/~dgc/sw/mutt/patch-1.5.1.dgc.attach.5
#}

# whoa! messy FAIL
#variant unbind conflicts {
#    patch_sites-append http://home.uchicago.edu/~dgc/sw/mutt/
#    patchfiles-append patch-1.5.1.dgc.unbind.1
#    checksums-append	patch-1.5.1.dgc.unbind.1 md5 \
#					067f4702e17e0a80322b940bf206690d
#}

variant date_conditional requires deepif {
# original, but now dgc hosts it with -p1
#    patch_sites-append http://www.schrab.com/aaron/mutt/
    patch_sites-append http://home.uchicago.edu/~dgc/sw/mutt/
    patchfiles-append	patch-1.5.8.ats.date_conditional.1
    checksums-append	patch-1.5.8.ats.date_conditional.1 md5 \
					83479a011390802b3f9f1c0f95b15199
}

# needs dgc to update for manual.txt FAILS
#variant xlabel {
#    patch_sites-append http://home.uchicago.edu/~dgc/sw/mutt/
#    patchfiles-append	patch-1.5.8.dgc.xlabel_ext.7 patch-1.5.8.dgc.xlabel_sort.1
#    checksums-append	patch-1.5.8.dgc.xlabel_ext.7 md5 \
#						5c7f55d7b1d4d72b2db6e91d195c5d87 \
#						patch-1.5.8.dgc.xlabel_sort.1 md5 \
#						04d42552ff57c73df47303ed6da30260 
#}

variant serversearch {
		ui_msg ""
		ui_msg "warning - the patch for +serversearch is beta quality code."
		ui_msg "it replaces the search (key: /) with server-side imap searching."
		ui_msg ""
		patchfiles-append patch-1.5.10.bc.imapsearch.1
}
