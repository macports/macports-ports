# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           perl5 1.0
name                mailqfmt
version             0.6
revision            6
categories          mail
license             GPL-2
maintainers         nomaintainer
homepage            http://home.pages.de/~mandree/postfix/
description         Postfix mailq file reformatter
long_description    mailqfmt reformats postfix mail queue with single \
                    lines entries that are easier to parse
platforms           darwin
master_sites        ${homepage}
distfiles           ${name}.pl

checksums           rmd160  d5e24479642537db03f3ab82eee380fefce1bdf9 \
                    sha256  11e6410cdc811cebc8212b73eeaad2386cb15569b526d73376d35a69bda54b95

perl5.branches      5.26

depends_lib-append  port:postfix \
                    port:p${perl5.major}-libwww-perl

extract {
      file copy ${distpath}/mailqfmt.pl ${workpath}/mailqfmt
}

post-patch { 
    reinplace "s|/usr/bin/perl|${prefix}/bin/perl${perl5.major}|g" ${workpath}/mailqfmt

    if {![variant_isset apple_postfix]} {
        reinplace "s|/usr/bin/mailq|${prefix}/bin/mailq|g" ${workpath}/mailqfmt
    }
}

use_configure       no
build               {}

destroot {
    xinstall -m 755 -d ${destroot}${prefix}/bin
    xinstall -m 755 ${workpath}/mailqfmt ${destroot}${prefix}/bin/mailqfmt
}

variant apple_postfix description {uses the mail queues of macosx postfix} {
    depends_lib-delete  port:postfix
}

livecheck.url       ${homepage}/${name}.pl
livecheck.regex     {mailqfmt.pl,v ([\d.]+)}
