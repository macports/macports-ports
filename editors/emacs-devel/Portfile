# $Id$

PortSystem      1.0

name            emacs-devel
version         22.0.97
categories      editors
platforms       darwin freebsd
maintainers     nox
description     The GNU Emacs text editor, bleeding edge version
long_description \
    GNU Emacs is a self-documenting, customizable, extensible real-time     \
    display editor. Users new to Emacs will be able to use basic features   \
    fairly rapidly by studying the tutorial and using the self-documentation\
    features. Emacs also has an extensive interactive manual browser. It is \
    easily extensible since its editing commands are written in Lisp.

homepage        http://www.gnu.org/software/emacs/
master_sites    ftp://alpha.gnu.org/gnu/emacs/pretest/ \
                http://alpha.gnu.org/gnu/emacs/pretest/

distname        emacs-${version}

checksums       md5 bfcda2615b9761d1dc546e1c907c584a \
                sha1 60a50581ac93fc850225a929cc0c04dec0e51f36 \
                rmd160 3bd5abe6fdf4e1574b6fda4b2e85cfbf171fbab4

patch.pre_args  -p1
patchfiles      patch-src-s-darwin.h.diff

configure.args  --mandir=${prefix}/share/man \
                --infodir=${prefix}/share/info \
                --without-x

depends_lib     port:ncurses

build.target    bootstrap

post-destroot {
    cd ${destroot}${prefix}
    xinstall -d share/emacs/${version}/leim
    if {[variant_isset carbon]} {
        global version
        delete bin/emacs bin/emacs-${version}
    }
}

variant x11 description {Enable X11 interface through Lucid widgets} {
    configure.args-delete   --without-x
    configure.args-append   --with-x-toolkit=lucid \
                            --without-carbon \
                            --with-xpm \
                            --with-jpeg \
                            --with-tiff \
                            --with-gif \
                            --with-png
    depends_lib-append      lib:libX11:XFree86 \
                            lib:libXpm:XFree86 \
                            lib:libjpeg:jpeg \
                            lib:libtiff:tiff \
                            lib:libungif:libungif \
                            lib:libpng:libpng
}

variant motif requires x11 description {Enable Motif interface} {
    configure.args-delete   --with-x-toolkit=lucid
    configure.args-append   --with-x-toolkit=motif
    depends_lib-append      lib:libXm:openmotif
}

variant gtk requires x11 conflicts motif description {Enable GTK interface} {
    configure.args-delete   --with-x-toolkit=lucid
    configure.args-append   --with-x-toolkit=gtk
    depends_lib-append      lib:libgtk.2:gtk2 \
                            lib:libglib.2:glib2
}

variant carbon conflicts x11 description {Enable Carbon interface} {
    configure.args-append   --with-carbon \
                            --enable-carbon-app=/Applications/MacPorts
}

variant atsui requires carbon description {Use Apple Type Services for Unicode Imaging} {
    configure.cflags-append -DUSE_ATSUI
}

livecheck.check regex
livecheck.url   http://ftp.gnu.org/gnu/emacs/pretest/?M=D
livecheck.regex emacs-(\\d+\\.\\d+\\.\\d+)
