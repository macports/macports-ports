# $Id$

PortSystem      1.0

name            xemacs
version         21.4.21
categories      editors
platforms       darwin
maintainers     nomaintainer
description     A highly customizable open source text editor.

long_description \
    XEmacs is a highly customizable open source text editor and application development \
    system. It is protected under the GNU Public License and related to other versions of \
    Emacs, in particular GNU Emacs.

homepage        http://www.xemacs.org
master_sites    ftp://ftp.xemacs.org/pub/xemacs/xemacs-21.4/:stable \
                http://ftp.xemacs.org/pub/xemacs/xemacs-21.4/:stable \
                ftp://ftp.xemacs.org/pub/xemacs/xemacs-21.5/:beta \
                http://ftp.xemacs.org/pub/xemacs/xemacs-21.5/:beta \
                http://mirrors.ibiblio.org/pub/mirrors/xemacs/xemacs-21.5/:beta \
                http://members.shaw.ca/akochoi-xemacs/Old%20Website/diff/:carbonport \
                ftp://ftp.xemacs.org/pub/xemacs/packages/:sumo \
                http://ftp.xemacs.org/pub/xemacs/packages/:sumo \
                http://mirrors.ibiblio.org/pub/mirrors/xemacs/packages/:sumo

distfiles       ${name}-${version}${extract.suffix}:stable

checksums       ${name}-${version}${extract.suffix} \
                    md5 87b051f12d1bb344ca4da1907100f1b5 \
                    sha1 fe9216148ae90c9f4c8b904a987319026676c535 \
                    rmd160 6dd212dd926cd7a8cb5ac905fb41ef787065bef5

configure.args  --mandir=${prefix}/share/man \
                --without-postgresql \
                --without-ldap \
                --with-sound=none \
                --pdump \
                --site-prefixes=${prefix} \
                --with-tty \
                --with-dialogs=athena \
                --with-widgets=athena \
                --with-athena=3d

depends_lib     port:libpng \
                port:Xaw3d

destroot.args   prefix=${destroot}${prefix} mandir=${destroot}${prefix}/share/man/man1

set xemacs_lib      ${destroot}${prefix}/lib/xemacs-${version}
set sumo_date       2007-04-27
set sumo_dist       ${name}-sumo-${sumo_date}${extract.suffix}
set mule_sumo_dist  ${name}-mule-sumo-${sumo_date}${extract.suffix}

post-destroot {
    if {![variant_isset carbon_beta]} {
        destroot.keepdirs ${destroot}${prefix}/lib/xemacs
    }
}

variant mule {
    depends_lib-append      port:gettext

    configure.args-append   --with-mule

    if {[variant_isset sumo]} {
        distfiles-append    ${mule_sumo_dist}:sumo
        checksums-append    ${mule_sumo_dist} \
                                md5 6fc22d133a44b15108f3533b4ec3198d \
                                sha1 76b5fae416a02a556cc3c5d167abe9b8a6513d20 \
                                rmd160 05efb557b8742dd33d6472d2e149e787fe12b837

        post-destroot {
            ui_info "Installing mule-sumo distribution into destroot"
            xinstall -d -m 0755 ${xemacs_lib}
            system "cp -Rp ${worksrcpath}/../mule-packages ${xemacs_lib}"
        }
    }
}

variant sumo {
    distfiles-append    ${sumo_dist}:sumo
    checksums-append    ${sumo_dist} \
                            md5 d285432a14905ec5662cbf3789d98a9a \
                            sha1 2e3d6d68b769441b0d3f4ed0221b4c994159ded2 \
                            rmd160 8b162d041a1b06d5c45a77ec1750a00bdf9f5872

    post-destroot {
        ui_info "Installing sumo distribution into destroot"
        system "cp -Rp ${worksrcpath}/../xemacs-packages ${xemacs_lib}"
    }
}

# This variant must appear last in this file, since it overrides and
# modifies some of the values set in the above variants.
variant carbon_beta {
    if {![variant_isset mule]} {
        ui_msg "\nThe carbon_beta variant requires that you use the mule variant.\n"
        exit 1
    }

    distfiles-delete    ${name}-${version}${extract.suffix}
    version             21.5.26
    set carbonport_name ${name}-${version}-carbon-b5.diff
    distfiles-append    ${name}-${version}${extract.suffix}:beta \
                        ${carbonport_name}.bz2:carbonport

    checksums-append \
        ${name}-${version}${extract.suffix} \
            md5 e0cd4521e8857a16f6cd675bb4c1039b \
            sha1 f2bdb0ba704f730d8151bfa83da5157b6b96f0a0 \
        ${carbonport_name}.bz2 \
            md5 f77988f09d4a2c95d54c1eb113805b50 \
            sha1 881871b9c8dc3cb1c35df4263cbe944a37fbf928

    extract.only-delete ${carbonport_name}.bz2

    post-extract {
         system "cp ${distpath}/${name}-${version}-carbon-b5.diff.bz2 ${workpath}"
         system "cd ${workpath} && bzip2 -d ${name}-${version}-carbon-b5.diff.bz2"
         system "cd ${workpath} && patch -p1 -d ${distname} <${name}-${version}-carbon-b5.diff"
    }

    depends_lib
    configure   {}

    build.cmd   cd ${worksrcpath}/carbon/ && sh ./build-app.sh
    build.args  {}

    destroot.args   {}

    set xemacs_lib  ${destroot}/Applications/MacPorts/XEmacs.app/Contents/Resources/lib/xemacs/

    post-destroot   {
        xinstall -d -m 0755 ${destroot}/Applications/MacPorts
        system "cp -Rp ${worksrcpath}/carbon/XEmacs.app ${destroot}/Applications/MacPorts/"
    }
}

