# $Id: Portfile,v 1.39 2005/05/04 06:47:40 jkh Exp $

PortSystem 1.0
name		emacs
version		21.4a
categories	editors
maintainers	jkh@opendarwin.org
description	The GNU Emacs text editor
long_description	GNU Emacs is a self-documenting, customizable, extensible real-time display editor. \
			Users new to Emacs will be able to use basic features fairly rapidly \
			by studying the tutorial and using the self-documentation features. \
			Emacs also has an extensive interactive manual browser.	 It is easily \
			extensible since its editing commands are written in Lisp.
platforms	darwin freebsd
master_sites	gnu
checksums	md5 8f9d97cbd126121bd5d97e5e31168a87
configure.args	--without-x
destroot.args	prefix=${destroot}/${prefix}
patchfiles	patch-src-xterm.c

worksrcdir	emacs-21.4

configure.env	\
	LDFLAGS="-L${prefix}/lib" \
	CFLAGS="-I${prefix}/include" \
	CPPFLAGS="-I${prefix}/include"

post-destroot {
	cd ${destroot}${prefix}
	file delete info/dir
	file delete share/info
	file rename info share/info
	system "rm -rf share/man"
	file rename man share/man
	file mkdir share/emacs/$version/leim
	if {[variant_isset carbon]} {
		global destroot prefix version

		file delete bin/emacs
		file delete bin/emacs-$version
	}
}

variant darwin {
	patchfiles-append	apple-patches ange-ftp.el.diff patch-unexec
	patch.pre_args	-p1
}

variant devel {
	version 22.0.50
	fetch.type	cvs
	cvs.root	:ext:anoncvs@savannah.gnu.org:/cvsroot/emacs
	cvs.module	emacs
	cvs.env		CVS_RSH=ssh
	worksrcdir	emacs
	build.target	bootstrap
	patchfiles-delete	apple-patches ange-ftp.el.diff patch-src-xterm.c
	patchfiles-append	patch-src-xterm-devel.c patch-src-s-darwin.h
}

variant x11 {
	configure.args --with-x --with-x-toolkit=lucid --without-carbon \
		       --with-xpm --with-jpeg --with-tiff --with-gif --with-png
	depends_lib-append  lib:libX11:XFree86 lib:libXpm:XFree86 \
			    lib:libjpeg:jpeg lib:libtiff:tiff \
			    lib:libungif:ungif lib:libpng:libpng
}

variant gtk requires devel x11 {
	configure.args-append --with-x-toolkit=gtk
	depends_lib-append  lib:libgtk.2:gtk2 lib:libglib.2:glib2
}

# Overrides darwin
variant carbon requires devel conflicts x11 {
	configure.args-append	--with-carbon --enable-carbon-app=${destroot}/Applications/DarwinPorts
	patchfiles-delete	patch-unexec patch-src-xterm-devel.c
}
