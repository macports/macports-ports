# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           python 1.0
PortGroup           app 1.0

name                zim
version             0.67
platforms           darwin
categories          editors
maintainers         nomaintainer
license             GPL-2

description         Personal desktop wiki
long_description \
    Zim is a graphical text editor used to maintain a collection of wiki pages. \
    Each page can contain links to other pages, simple formatting and images. \
    Pages are stored in a folder structure, like in an outliner, and can have \
    attachments. Creating a new page is as easy as linking to a nonexistent \
    page. All data is stored in plain text files with wiki formatting. Various \
    plugins provide additional functionality, like a task list manager, an \
    equation editor, a tray icon, and support for version control.

homepage            http://zim-wiki.org
master_sites        ${homepage}/downloads/
distname            zim-${version}

checksums           rmd160  49d1d483942736c26db6a9ba55e09b12cb297416 \
                    sha256  b37cef3d4906aa263abccb1493929a7ea6b9e8d11a50ed92cd437e8f93ffabbd

python.default_version  27
python.link_binaries    no

depends_run-append  port:desktop-file-utils

set app.icon        icons/zim48.png
set app.executable  ${workpath}/zim-app

depends_lib-append  port:py${python.version}-gobject \
                    port:py${python.version}-pygtk \
                    port:py${python.version}-xdg

use_configure       no
build               {}

destroot.destdir-append --install-data=${prefix} \
                        --skip-xdg-cmd

pre-destroot {
    xinstall -m 755 ${filespath}/zim ${destroot}${prefix}/bin
    reinplace "s|__PREFIX__|${prefix}|g" ${destroot}${prefix}/bin/zim
    reinplace "s|__PYTHON_BINDIR__|${python.prefix}/bin|g" ${destroot}${prefix}/bin/zim
    file copy ${filespath}/zim-app ${workpath}/zim-app
    reinplace "s|__PREFIX__|${prefix}|g" ${workpath}/zim-app
    reinplace "s|__PYTHON_BINDIR__|${python.prefix}/bin|g" ${workpath}/zim-app
}

post-activate {
    exec update-desktop-database
    exec update-mime-database ${destroot}${prefix}/share/mime 2> /dev/null
}

universal_variant   no
