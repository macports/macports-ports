# $Id$

PortSystem		1.0

name			scite
version			1.74
categories		editors
platforms		darwin
maintainers		nox
description		SciTE is a SCIntilla based Text Editor.

long_description \
	Originally built to demonstrate Scintilla, it has grown to be a generally \
	useful editor with facilities for building and running programs. It is best \
	used for jobs with simple configurations.

homepage		http://scintilla.sourceforge.net/SciTE.html
master_sites	sourceforge:scintilla
distname		${name}[strsed ${version} {g/\.//}]
extract.suffix	.tgz

depends_build	port:pkgconfig
depends_lib		port:gtk2

checksums		md5 09ad25f1fa6dab3feec41dba2480047f \
				sha1 64066ed557c15821a50955b86acdda0d32e0a472 \
				rmd160 a4547865bf2884108fbfbc8eaae1c7d1200ddd47

worksrcdir		${name}/gtk

patchfiles		patch-scintilla-gtk-makefile \
				patch-scite-gtk-makefile 

post-patch {
	cd ${workpath}/scintilla
	reinplace -E "s/#ifdef (PLAT_MACOSX|__APPLE__)/#if PLAT_MACOSX/" include/Platform.h src/Editor.cxx
}

use_configure	no

build.args		prefix=${prefix} GTK2=yes

pre-build {
	cd ${workpath}/scintilla/gtk
	
	if {[variant_isset universal]} {
		foreach {arch} {i386 ppc} {
			system "make GTK2=yes UNIVERSAL_CFLAGS=\"-isysroot /Developer/SDKs/MacOSX10.4u.sdk -arch ${arch}\""

			file mkdir ../bin/${arch}
			move ../bin/scintilla.a ../bin/${arch}/scintilla.a

			system "make clean"
		}

		cd ../bin
		system "lipo -create -arch i386 i386/scintilla.a -arch ppc ppc/scintilla.a -output scintilla.a"
	} else {
		system "make GTK2=yes"
	}
}

destroot.destdir prefix=${destroot}${prefix}

post-destroot {
	xinstall -m 0444 ${worksrcpath}/../doc/scite.1 ${destroot}${prefix}/share/man/man1
}

variant universal {
	post-patch {
		cd ${workpath}

		reinplace -E "/^CXXBASEFLAGS/s|\$| \$(UNIVERSAL_CFLAGS)|" scintilla/gtk/makefile
		reinplace -E "/^CXXBASEFLAGS/s|\$| ${configure.universal_cflags}|" \
			scite/gtk/makefile
	}

	build.args-append "UNIVERSAL_LDFLAGS=\"${configure.universal_ldflags}\""
}

livecheck.distname SciTE

