# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               compiler_blacklist_versions 1.0
PortGroup               github 1.0
PortGroup               qmake5 1.0

github.setup            texstudio-org texstudio 4.8.1
revision                0
categories              editors
license                 GPL-2+
maintainers             nomaintainer

description             TeX editor

long_description        TeXstudio is a TeX editor forked off Texmaker.

homepage                https://www.texstudio.org/

checksums               rmd160  b998a4970001c1ba74df86d974f1f53ead056313 \
                        sha256  2d024c4af9304265bdb1dd57b0af382e2d7ce9e4ce368e01b2d9751916d5be99 \
                        size    116026662

depends_lib-append      port:poppler-qt5 \
                        port:hunspell \
                        port:quazip

# dvipng is used to preview math equations, etc.
depends_run-append      port:dvipng

qt5.depends_component   qtscript qtsvg qttools

pre-patch {
    # DOS to UNIX line endings so we can patch
    reinplace "s|\r||g" ${worksrcpath}/texstudio.pro
}

patchfiles              patch-texstudio.pro.diff

# https://github.com/texstudio-org/texstudio/issues/3706
compiler.blacklist-append \
                        {clang}

# https://github.com/texstudio-org/texstudio/issues/3707
configure.args-append   NO_POPPLER_PREVIEW=1

configure.args-append   USE_SYSTEM_QUAZIP=1 USE_SYSTEM_HUNSPELL=1

universal_variant       no

destroot {
    copy ${worksrcpath}/texstudio.app ${destroot}${applications_dir}
    ln -s ${applications_dir}/texstudio.app/Contents/MacOS/texstudio ${destroot}${prefix}/bin/texstudio
}
