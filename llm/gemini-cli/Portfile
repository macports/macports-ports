# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           npm 1.0

name                gemini-cli
version             0.24.5
revision            0

categories          llm
platforms           darwin
maintainers         {breun @breun} openmaintainer
license             Apache-2
supported_archs     x86_64 arm64

description         Use Google Gemini from your terminal
long_description    Gemini CLI is an open-source AI agent that brings the power of Google Gemini directly into your terminal.

homepage            https://geminicli.com

npm.rootname        @google/${name}
distname            ${name}-${version}

checksums           rmd160  3d7819a957932da08ac4007e916c3eec4b9420b3 \
                    sha256  6e94035c5da025b4dc1d5e84bdc1dae0658662ed7f5201b3d04c1ebb7708c5d3 \
                    size    3317191

post-destroot {
    # Remove files for non-Darwin operating systems
    delete {*}[glob ${destroot}${prefix}/lib/node_modules/${npm.rootname}/node_modules/import-in-the-middle/test/fixtures/native-modules/linux*]
    delete {*}[glob ${destroot}${prefix}/lib/node_modules/${npm.rootname}/node_modules/import-in-the-middle/test/fixtures/native-modules/win*]
    delete {*}[glob ${destroot}${prefix}/lib/node_modules/${npm.rootname}/node_modules/node-pty/prebuilds/win*]
    delete {*}[glob ${destroot}${prefix}/lib/node_modules/${npm.rootname}/node_modules/node-pty/third_party/conpty/*/win*]
    delete {*}[glob ${destroot}${prefix}/lib/node_modules/${npm.rootname}/node_modules/tree-sitter-bash/prebuilds/linux*]
    delete {*}[glob ${destroot}${prefix}/lib/node_modules/${npm.rootname}/node_modules/tree-sitter-bash/prebuilds/win*]

    # Remove files for other CPU architectures
    if {${configure.build_arch} eq "x86_64"} {
        delete ${destroot}${prefix}/lib/node_modules/${npm.rootname}/node_modules/@lydell/node-pty-darwin-arm64
        delete ${destroot}${prefix}/lib/node_modules/${npm.rootname}/node_modules/node-pty/prebuilds/darwin-arm64
        delete ${destroot}${prefix}/lib/node_modules/${npm.rootname}/node_modules/tree-sitter-bash/prebuilds/darwin-arm64
    } elseif {${configure.build_arch} eq "arm64"} {
        delete ${destroot}${prefix}/lib/node_modules/${npm.rootname}/node_modules/import-in-the-middle/test/fixtures/native-modules/darwin-x64.js
        delete ${destroot}${prefix}/lib/node_modules/${npm.rootname}/node_modules/node-pty/prebuilds/darwin-x64
        delete ${destroot}${prefix}/lib/node_modules/${npm.rootname}/node_modules/tree-sitter-bash/prebuilds/darwin-x64
    }
}
