# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           npm 1.0

name                gemini-cli
version             0.27.3
revision            0

categories          llm
platforms           darwin
maintainers         {breun @breun} openmaintainer
license             Apache-2
supported_archs     x86_64 arm64

description         Use Google Gemini from your terminal
long_description    Gemini CLI is an open-source AI agent that brings the power of Google Gemini directly into your terminal.

homepage            https://geminicli.com

npm.rootname        @google/${name}
distname            ${name}-${version}

checksums           rmd160  ea941c61d0b657fbfe18353c84215a47416d5f19 \
                    sha256  f6fa917da1a215adb09480f13006dbedcb2ebe8d0e05c3db5bbb1f1bceda1509 \
                    size    3867277

post-destroot {
    set node_modules_dir ${destroot}${prefix}/lib/node_modules/${npm.rootname}/node_modules

    # Remove files for non-Darwin operating systems
    delete {*}[glob ${node_modules_dir}/import-in-the-middle/test/fixtures/native-modules/linux*]
    delete {*}[glob ${node_modules_dir}/import-in-the-middle/test/fixtures/native-modules/win*]
    delete {*}[glob ${node_modules_dir}/node-pty/prebuilds/win*]
    delete {*}[glob ${node_modules_dir}/node-pty/third_party/conpty/*/win*]
    delete {*}[glob ${node_modules_dir}/tree-sitter-bash/prebuilds/linux*]
    delete {*}[glob ${node_modules_dir}/tree-sitter-bash/prebuilds/win*]

    # Remove files for other CPU architectures
    if {${configure.build_arch} eq "x86_64"} {
        delete ${node_modules_dir}/@lydell/node-pty-darwin-arm64
        delete ${node_modules_dir}/node-pty/prebuilds/darwin-arm64
        delete ${node_modules_dir}/tree-sitter-bash/prebuilds/darwin-arm64
    } elseif {${configure.build_arch} eq "arm64"} {
        delete ${node_modules_dir}/import-in-the-middle/test/fixtures/native-modules/darwin-x64.js
        delete ${node_modules_dir}/node-pty/prebuilds/darwin-x64
        delete ${node_modules_dir}/tree-sitter-bash/prebuilds/darwin-x64
    }
}
