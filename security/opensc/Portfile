# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem              1.0
PortGroup               github 1.0

name                    opensc
github.setup            OpenSC OpenSC 0.16.0
categories              security
platforms               darwin
license                 LGPL-2.1
maintainers             schenkel.net:leonardo openmaintainer

description             Tools and libraries for smart cards
long_description        OpenSC provides a set of libraries and utilities to \
                        work with smart cards. Its main focus is on cards that \
                        support cryptographic operations, and facilitate their \
                        use in security applications such as authentication, \
                        mail encryption and digital signatures. \
                        OpenSC implements the PKCS#11 API so applications \
                        supporting this API (such as Mozilla Firefox and \
                        Thunderbird) can use it. \
                        On the card OpenSC implements the PKCS#15 standard and \
                        aims to be compatible with every software/card that \
                        does so, too.

github.tarball_from     releases
checksums               rmd160  f785df816560493baceb71e2197346c724fc0834 \
                        sha256  3ac8c29542bb48179e7086d35a1b8907a4e86aca3de3323c2f48bd74eaaf5729


depends_build           port:docbook-xsl port:libxslt port:pkgconfig
depends_lib             path:lib/libcrypto.dylib:openssl port:zlib

default_variants        +readline

patchfiles-append       patch-bash_completion.diff patch-libressl.diff
patch.pre_args          -p1

use_autoreconf          yes
configure.args-append   --disable-doc
configure.args-append   --disable-readline
configure.args-append   --disable-static
configure.args-append   --enable-pcsc
configure.args-append   --enable-sm
configure.args-append   --with-pkcs11-provider=${prefix}/lib/opensc-pkcs11.so

pre-configure {
    reinplace -W ${worksrcpath} \
        "s|No Git revision info available|OpenSC-${version} (MacPorts)|g" \
        configure.ac configure
}
post-destroot {
    system "${worksrcpath}/MacOSX/libtool-bundle ${destroot}${prefix}/lib/opensc-pkcs11.so ${destroot}${prefix}/lib"
}

variant doc description "Build documentation" {
    configure.args-replace  --disable-doc --enable-doc
}
variant readline description "Enable readline support" {
    depends_lib-append      port:readline
    configure.args-replace  --disable-readline --enable-readline
}
