# $Id$

PortSystem      1.0
name            FDclone
version         2.09e
categories      sysutils shells
maintainers     takanori@macports.org
description     File & Directory Maintenance Tool
long_description \
                ${description}
homepage        http://hp.vector.co.jp/authors/VA012337/soft/fd/index.html
master_sites    http://hp.vector.co.jp/authors/VA012337/soft/fd/ \
                ftp://ftp.unixusers.net/src/fdclone/
platforms       darwin
distname        FD-${version}
checksums       md5 5da73295a1a8529f12044aa126a4efe9 \
                sha1 fcbb19f23d5ab8aca1d130a509d94b19a962d467 \
                rmd160 7baa09e4d32c41538e9654236167cb5f5c1f9936

depends_lib     port:ncurses

set editor      ""
set pager       ""

patchfiles      nojmaninstall.patch
post-patch {
    foreach f [glob ${worksrcpath}/*.c] {
        reinplace "s|\\(#include <unistd\.h>\\)|\\1\\\n#include <sys/types\.h>|" ${f}
    }
    reinplace "s|\$(PREFIX)/man|\$(DATATOP)/man|g" ${worksrcpath}/Makefile.in
    reinplace "s|\$(CC) __MEM__|\$(CC) \$(CFLAGS) __MEM__|g" ${worksrcpath}/Makefile.in
}

configure {
    if {[variant_isset nojpnmes]} {
        system "echo \"#define _NOJPNMES\" >> ${worksrcpath}/config.hin"
    }

    if {${editor} != ""} { reinplace "s|\"vi\"|\"${editor}\"|g" ${worksrcpath}/fd.h }
    if {${pager} != ""} { reinplace "s|\"more%K\"|\"${pager}\"|g" ${worksrcpath}/fd.h }

    if {[variant_isset autosort]} {
        reinplace "s|SORTTYPE\t0|SORTTYPE\t1|" ${worksrcpath}/fd.h
        reinplace "s|DISPLAYMODE\t0|DISPLAYMODE\t3|" ${worksrcpath}/fd.h
        reinplace "s|SORTTREE\t0|SORTTREE\t1|" ${worksrcpath}/fd.h
    }
}

build.args      CONFDIR=${prefix}/etc PREFIX=${prefix} CFLAGS="${configure.cflags}" CPPFLAGS="${configure.cppflags} -I${prefix}/include/ncurses" LDFLAGS="${configure.ldflags} -lncurses"

destroot.args   BUILD=${destroot} PREFIX=${prefix}
post-destroot {
    xinstall -m 755 -d ${destroot}${prefix}/share/doc/${name}
    foreach f {FAQ* HISTORY* Install* LICENSES* README* TECHKNOW* ToAdmin* *.cat} {
        eval xinstall -m 644 [glob ${worksrcpath}/${f}] ${destroot}${prefix}/share/doc/${name}
    }
    xinstall -m 644 ${worksrcpath}/_fdrc ${destroot}${prefix}/etc/fd2rc.dist
}

variant universal {
    build.args  CONFDIR=${prefix}/etc PREFIX=${prefix} CFLAGS="${configure.cflags} ${configure.universal_cflags}" CPPFLAGS="${configure.cppflags} -I${prefix}/include/ncurses" LDFLAGS="${configure.ldflags} ${configure.universal_ldflags} -lncurses"
}
variant nojpnmes {}
variant emacs conflicts vim {set editor emacs}
variant vim conflicts emacs {set editor vim}
variant lv conflicts less jless {set pager lv}
variant less conflicts lv jless {set pager less}
variant jless conflicts lv less {set pager jless}
variant autosort {}

livecheck.check regex
livecheck.url   ${homepage}
livecheck.regex FD-(\[0-9.a-z\]+)\\.tar
