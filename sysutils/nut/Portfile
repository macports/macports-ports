# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                nut
version             2.6.0
categories          sysutils
platforms           darwin
maintainers         nomaintainer

description         Network based UPS monitoring tool

long_description    Network UPS Tools is a collection of programs \
                    which provide a common interface for monitoring \
                    and administering UPS hardware.

homepage            http://www.networkupstools.org/
master_sites        ${homepage}source/[join [lrange [split ${version} .] 0 1] .]/

checksums           sha1    4ab7b220f50a088a65e59831c217a7be714a198c \
                    rmd160  d42ef82eec3ee40fa841d92bf400c7f76eb9cdfe

depends_build       port:pkgconfig

depends_lib         port:libusb-compat \
                    port:neon

set userName        _nut
set groupName       _nut
set stateDir        ${prefix}/var/db/ups
destroot.keepdirs   ${destroot}${stateDir}

configure.args      --with-serial=no \
                    --with-usb=auto \
                    --with-snmp=no \
                    --with-hal=auto \
                    --with-cgi=no \
                    --with-neonxml=no \
                    --with-ssl=yes \
                    --with-ipv6=no \
                    --with-statepath=${stateDir} \
                    --with-pidpath=${prefix}/var/run \
                    --with-hotplug-dir=${prefix}/etc/nut/hotplug \
                    --with-udev-dir=${prefix}/etc/nut/udev \
                    --with-user=${userName} \
                    --with-group=${groupName}


pre-destroot {
    addgroup ${groupName}
    set gid [existsgroup ${groupName}]
    adduser ${userName} gid=${gid}
    xinstall -d -m 0770 -g ${groupName} -o ${userName} ${destroot}${stateDir}
}

## variant snmp {
##      configure.args-append   --with-snmp=yes
##      configure.args-delete   --with-snmp=no
##      depends_lib-append      port:net-snmp
## }

livecheck.type      regex
livecheck.regex     {: ([0-9.]+) released}
