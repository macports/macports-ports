# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               golang 1.0

go.setup                github.com/fluxcd/flux2 2.1.0 v
go.offline_build        no
github.tarball_from     archive
revision                0
name                    flux

checksums               rmd160  7ee3a03579e34b61826887213a1a2f0f1b0f3698 \
                        sha256  5fd7e703f5724c9beae8adabe17b823c5cd4a381ac6f88dfff3ff3713ed08883 \
                        size    328384

homepage                https://fluxcd.io/
description             Flux CLI
long_description        Flux is a tool for keeping Kubernetes clusters in sync \
                        with sources of configuration (like Git repositories), \
                        and automating updates to configuration when there is  \
                        new code to deploy.

categories              sysutils
license                 Apache-2
maintainers             nomaintainer

depends_build-append    port:kustomize \
                        port:realpath

build.env-append        VERSION=${version}
build.cmd               make
build.target            build

destroot {
    set bin_path ${destroot}${prefix}/bin/${name}
    xinstall -m 0755 ${worksrcpath}/bin/${name} ${bin_path}

    set bash_completion ${destroot}${prefix}/share/bash-completion/completions
    xinstall -m 0755 -d ${bash_completion}
    exec ${bin_path} completion bash > ${bash_completion}/${name}

    set zsh_completion ${destroot}${prefix}/share/zsh/site-functions
    xinstall -m 0755 -d ${zsh_completion}
    exec ${bin_path} completion zsh > ${zsh_completion}/_${name}

    set fish_completion ${destroot}${prefix}/share/fish/vendor_completions.d
    xinstall -m 0755 -d ${fish_completion}
    exec ${bin_path} completion fish > ${fish_completion}/${name}.fish
}
