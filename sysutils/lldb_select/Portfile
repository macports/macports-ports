# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim: fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           select 1.0

name                lldb_select
version             1
revision            0
categories          sysutils
supported_archs     noarch
platforms           any
license             BSD
maintainers         {judaew @judaew} openmaintainer
description         common files for selecting default lldb version
long_description    llvm_select installs files that allow 'port select' to \
                    switch the default version of lldb \
                    It symlinks the standard llvm executables \
                    in the MacPorts prefix to the selected version.
homepage            https://www.macports.org/

distfiles
use_configure       no
build               {}
destroot            {}

if {$subport eq $name} {
    select.entries      {lldb base} \
                        {lldb none}
}

foreach v {15 16 17 18 19 20 21} {
    subport lldb_select-${v} {
        set lldbver $v
    }
}
if {$subport ne $name} {
    if {$lldbver in {18 19 20 21}} {
        revision    1
    }
    depends_run port:lldb_select
    select.entries  [list lldb mp-lldb-${lldbver}]
    pre-activate {
        if {[file exists ${prefix}/etc/select/lldb/mp-lldb-${lldbver}]} {
            set owner [registry_file_registered ${prefix}/etc/select/lldb/mp-lldb-${lldbver}]
            if {[string match lldb-${lldbver}* $owner]} {
                registry_deactivate_composite $owner "" [list ports_nodepcheck 1]
            }
        }
    }
}

livecheck.type    none

if {${os.platform} eq "darwin" && ${os.major} < 11} {
    # Having the stdlib set to libc++ on 10.6 causes a dependency on a
    # macports-clang compiler to be added, which would be a dep cycle.
    configure.cxx_stdlib
}
