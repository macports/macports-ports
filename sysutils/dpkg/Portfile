# $Id: Portfile,v 1.4 2003/03/03 07:14:58 mij Exp $

PortSystem 1.0
name			dpkg
version			1.9.21
platforms		darwin
categories		sysutils archivers
maintainers		landonf@opendarwin.org
description		Debian package maintenance system

master_sites		http://ftp.debian.org/debian/pool/main/d/dpkg/
checksums		md5 fbd279854e724103fec3358c76d47c69
distname		${portname}_${portversion}
worksrcdir		${portname}-${portversion}

configure.args		--with-included-gettext --without-sgml-doc

post-patch {
	system "ln -s ${worksrcpath}/intl/libgnuintl.h ${worksrcpath}/intl/libintl.h"
	# dpkg-shlibs
	reinplace s|/etc/dpkg/|${prefix}/etc/dpkg/| ${worksrcpath}/scripts/dpkg-shlibdeps.pl
	# dpkg-source
	reinplace s|/etc/dpkg/|${prefix}/etc/dpkg/| ${worksrcpath}/scripts/dpkg-source.1

	# update-alternatives
	reinplace s|/etc/alternatives|${prefix}/etc/alternatives|g ${worksrcpath}/scripts/update-alternatives.pl
	reinplace s|/etc|${prefix}/etc|g ${worksrcpath}/scripts/update-alternatives.8

	# update-rc.d
	reinplace s|/etc/|${prefix}/etc/|g ${worksrcpath}/scripts/update-rc.d.pl
	reinplace s|/etc/|${prefix}/etc/|g ${worksrcpath}/scripts/update-rc.d.8
}

pre-install { file mkdir ${destroot}${prefix}/share/doc/dpkg }

variant darwin {
	patchfiles-append patch-dpkg-deb_Makefile.in patch-optlib_Makefile.in \
			  patch-split_Makefile.in patch-utils_Makefile.in \
			  patch-utils_start-stop-daemon.c patch-configure \
			  patch-main_Makefile.in patch-dselect_Makefile.in
}

