# $Id$

PortSystem 1.0

name		zeroinstall-injector-devel
version		0.30
platforms	darwin freebsd linux
categories	sysutils
maintainers	afb@macports.org
description	The Zero Install Injector (0launch)
long_description \
The Zero Install Injector makes it easy for users to install software without \
needing root privileges. It takes the URL of a program and runs it (downloading \
it first if necessary). Any dependencies of the program are fetched in the same \
way. The user controls which version of the program and its dependencies to \
use.

homepage	http://0install.net
master_sites	sourceforge
master_sites.mirror_subdir	zero-install
extract.suffix	.tar.gz.gpg
checksums	md5 c539dc6ffa39f18700220f5565d8eac3 \
		sha1 c3cdc1bec37f62f9dbd8e938590a6097a259904a \
		rmd160 eff6aee9b81ce8aa9a92272de6526ac6753f3fd0

depends_lib	port:python25 bin:gpg:gnupg
depends_run	port:py25-gtk port:py25-xml bin:sudo:sudo

fetch.type	svn
svn.url		https://zero-install.svn.sourceforge.net/svnroot/zero-install/trunk/0launch
worksrcdir	0launch	

patchfiles	patch-setup.py patch-arch.py patch-unpack.py \
		patch-distro.py

use_configure	no
post-configure {
	reinplace s,/var/cache/0install.net,${prefix}/var/cache/0install.net, \
	          ${worksrcpath}/zeroinstall/zerostore/__init__.py
}

build.cmd	${prefix}/bin/python2.5 setup.py
build.target		build

destroot.cmd	${prefix}/bin/python2.5 setup.py
destroot.destdir	--prefix=${prefix} --skip-build --root=${destroot}

livecheck.name	zero-install
livecheck.distname	injector

# This is not used by default, but is required if you want to
# set up sharing of downloads later.
post-destroot {
	adduser		zeroinst shell=/sbin/nologin
	xinstall -d ${destroot}${prefix}/var/cache/0install.net/implementations
	file attributes ${destroot}${prefix}/var/cache/0install.net -owner zeroinst 
	file attributes ${destroot}${prefix}/var/cache/0install.net/implementations -owner zeroinst 
}
destroot.keepdirs	${destroot}${prefix}/var/cache/0install.net/implementations
