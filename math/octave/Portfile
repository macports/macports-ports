# $Id: Portfile,v 1.20 2006/06/21 21:27:45 mww Exp $

PortSystem 1.0
name		octave
version		2.9.9
revision	0
categories	math science
maintainers     andre@splunk.com
platforms	darwin
description     a Matlab-like environment for numerical analysis
long_description	\
		Octave provides a convenient command line interface	\
		for solving linear and nonlinear problems numerically,	\
		using a language that is mostly compatible with Matlab.	\
		It is easily extensible and customizable via		\
		user-defined functions or using dynamically loaded	\
		modules written in e.g. C++, C or Fortran.

homepage	http://www.octave.org
master_sites	ftp://ftp.octave.org/pub/octave/bleeding-edge/

use_bzip2	yes
checksums	md5 a76a6d88f414285472896a63e4282b7f

patch.args	-p1
patchfiles	patch-configure-uglydefs

depends_build   bin:texinfo:texinfo	\
		bin:tex:teTeX

depends_lib     lib:libreadline.5:readline	\
		port:hdf5			\
		port:fftw-3

depends_run	bin:gnuplot:gnuplot	\
		port:gcc34

configure.env   F77="g77-dp-3.4"	\
		FLIBS="-lg2c"		\
		CC="gcc-dp-3.4"		\
		CXX="g++-dp-3.4"	\
		CFLAGS="-O2"		\
		CXXFLAGS="-O2"		\
		LDFLAGS="-L${prefix}/lib" \
		CPPFLAGS="-I${prefix}/include"

configure.args	--enable-shared	\
		--enable-dl	\
		--disable-static \
		--with-hdf5	\
		--with-fftw	\
		--without-mpi	\
		--infodir=${prefix}/share/info \
		--mandir=${prefix}/share/man
 
destroot.destdir	prefix=${destroot}${prefix}

platform darwin 8 powerpc {
	depends_run-delete	port:gcc34
	depends_run-append	port:gcc40
	configure.env-delete	CC="gcc-dp-3.4"
	configure.env-delete	CXX="g++-dp-3.4"
	configure.env-delete	F77="g77-dp-3.4"

	configure.env-delete	FLIBS="-lg2c"

	configure.env-append	CC="gcc-dp-4.0"
	configure.env-append	CXX="g++-dp-4.0"
	configure.env-append	F77="gfortran-dp-4.0"
	configure.env-append	FLIBS="-lgfortran"

	configure.args-append	--with-blas="-framework Accelerate"
}


platform darwin 8 i386 {
	depends_run-delete	port:gcc34
	depends_run-append	port:gcc42

	configure.env-delete	CC="gcc-dp-3.4"
	configure.env-delete	CXX="g++-dp-3.4"
	configure.env-delete	F77="g77-dp-3.4"
	configure.env-delete	FLIBS="-lg2c"

	configure.env-append	CC="gcc-dp-4.2"
	configure.env-append	CXX="g++-dp-4.2"
	configure.env-append	F77="gfortran-dp-4.2"

	configure.args-delete   --disable-static
	configure.args-delete   --enable-dl
	configure.args-delete   --enable-shared
	configure.args-append	--with-blas="-framework Accelerate"
}

default_variants +test
variant test	{ depends_build-append	bin:runtest:dejagnu
		  test.run	yes
		  test.target	check
		}

