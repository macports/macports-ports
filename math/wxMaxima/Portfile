# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0

PortGroup           active_variants 1.1
PortGroup           cmake 1.1
PortGroup           compiler_blacklist_versions 1.0
PortGroup           wxWidgets 1.0
PortGroup           github 1.0

github.setup        wxMaxima-developers wxmaxima 23.05.1 Version-
revision            0
checksums           rmd160  195fbba20e3cd1b83e19b3e3b76f1ea8f60e267c \
                    sha256  0c26d1439f5aba30cae94d5718d9c35bf83490953cc8696c371658ed13fd57c1 \
                    size    16220058

name                wxMaxima
maintainers         @MSoegtropIMC
license             GPL-2
# openssl is a dependency of curl in cmake, so build only
license_noconflict  openssl
categories          math aqua
description         Graphical user interface for Maxima based on wxWidgets
long_description    Maxima is a Computer Algebra System (CAS) and wxMaxima is a work book style \
                    graphical front end for it based on wxWidgets

github.tarball_from archive

universal_variant   no

compiler.cxx_standard \
                    2014

# https://github.com/wxMaxima-developers/wxmaxima/issues/1784
compiler.blacklist-append \
                    {clang < 1316} \
                    macports-clang-3.* \
                    {macports-clang-[4-9].0} \
                    {macports-clang-1[0-2]}

# Note: as of Match 2020 (1b00466)the build with wxWidgets-3.2 has serious issues with scrolling
wxWidgets.use       wxWidgets-3.2

depends_lib-append  port:${wxWidgets.port} \
                    lib:lib/libomp/libomp.dylib:libomp \
                    port:maxima

depends_run-append  port:gnuplot

post-patch {
    reinplace -W ${worksrcpath} "s|OSX_MACPORTS_PREFIX \"/opt/local\"|OSX_MACPORTS_PREFIX \"${prefix}\" // patched by MacPorts|" src/Dirstructure.h
    reinplace -W ${worksrcpath} "s|OSX_MACPORTS_PREFER 0|OSX_MACPORTS_PREFER 1 // patched by MacPorts|" src/Dirstructure.h
}

configure.cppflags-append \
                    -I${prefix}/include/libomp

configure.args      -DCMAKE_BUILD_TYPE=Release \
                    -DCCACHE_PROGRAM= \
                    -DUSE_CPPCHECK=YES \
                    -DwxWidgets_CONFIG_EXECUTABLE:FILEPATH=${wxWidgets.wxconfig}

destroot {
    copy ${build.dir}/src/wxmaxima.app ${destroot}${applications_dir}/wxMaxima.app
}

notes "
wxMaxima is installed under '${applications_dir}/wxMaxima.app'.\
You can start it from there via Finder.\
If you want to add wxMaxima to the Dock, start it via Finder,\
right-click the icon in Dock and select 'Options/Keep in Dock'.

wxMaxima should be able to find maxima and gnuplot at the MacPorts install\
folder '${prefix}/bin/' and also at a few non-MacPorts locations.\
In case you have issues with finding maxima, open wxMaxima Preferences and\
under the second tab (maxima) enter your path to the maxima executable and\
in the last tab (startup) add this command:
  gnuplot_command:\"<yourgnuplotpath>/gnuplot\"$
You might have to restart wxMaxima for this to take effect.

wxMaxima and Maxima startup files can typically be found in:
  ~/.maxima

ATTENTION: On macOS BigSur there is an issue with wxWidgets, which has the\
effect that wxMaxima does not start. In order to fix this, run these\
commands:
  sudo port -f uninstall wxWidgets-3.2
  sudo port -v -s install wxWidgets-3.2
If this does not help, you need to update Xcode.
"

github.livecheck.regex  {([a-z0-9.]+)}
