# $Id $

PortSystem 1.0
name		octave-forge
version		2006.07.09
revision	1
categories	math science
maintainers     nomaintainer@macports.org
platforms	darwin
description     Additional script and function files for Octave.
long_description	\
		The GNU Octave Repository is a central location for the   \
		the collaborative development of packages for GNU Octave. \
		The The octave-forge package contains the source for all  \
		the the functions plus build and install scripts.

homepage	http://octave.sourceforge.net/
master_sites	sourceforge:octave

checksums	md5 94a844d1e41aca9580fde00e023e4e5b

depends_build	port:gcc40

depends_lib	port:ginac	\
		port:gsl	\
		port:jpeg	\
		port:libpng	\
		port:octave

patch	{
	# touch extra/mex/NOINSTALL because it's already in octave 2.9.9
	close [open "${worksrcpath}/extra/mex/NOINSTALL" w]

	# touch extra/Windows/NOINSTALL for hopefully obvious reasons :-)
	close [open "${worksrcpath}/extra/Windows/NOINSTALL" w]
}

configure.env   F77="gfortran-dp-4.0"	\
		CFLAGS="-O2"		\
		CXXFLAGS="-O2"		\
		LDFLAGS="-L${prefix}/lib" \
		CPPFLAGS="-I${prefix}/include"

configure.args	--enable-shared	\
		--enable-dl	\
		--disable-static \
		--infodir=${prefix}/share/info \
		--mandir=${prefix}/share/man \
                --with-mpath=${prefix}/share/octave-forge/m \
                --with-opath=${prefix}/share/octave-forge/oct

platform darwin 8 i386 {
	if {![variant_isset g95]} {
		depends_build-delete	port:gcc40
		depends_build-append	port:gcc42

		configure.env-delete	F77="gfortran-dp-4.0"
		configure.env-append	F77="gfortran-dp-4.2"
		configure.env-append	CC="gcc-dp-4.2"
		configure.env-append	CXX="g++-dp-4.2"

		post-patch {
			reinplace "s|-ObjC|-x objective-c|" \
				"${worksrcpath}/extra/MacOSX/Makefile"
		}
	}
}

default_variants +test
variant test	{ test.run	yes
		  test.target	check
		}

variant g95 {
	depends_build-delete port:gcc40
	depends_build-append port:g95

	configure.env-delete F77="gfortran-dp-4.0"
	configure.env-append F77="${prefix}/bin/g95"
	configure.env-append CC="/usr/bin/cc"
	configure.env-append CXX="/usr/bin/c++"
}
