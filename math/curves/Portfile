# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0
PortGroup           java 1.0
PortGroup           legacysupport 1.1
PortGroup           compiler_blacklist_versions 1.0

github.setup        teodimoff curves 12d23e6a5b79267321d171d7220061e3a2a82565
version             20210919
revision            1

checksums           rmd160  b7966ccb4e6117ef7475f0d94d37816f67de22ab \
                    sha256  26ad39b0e8e0b195b5b21b6eb0871a60b1c4a6d6787fcf1e513467a28437112c \
                    size    7775650

categories          math graphics
platforms           darwin
supported_archs     noarch
license             Apache-2
maintainers         {@catap korins.ky:kirill} openmaintainer

description         Curves provide mapping a point from 1D to 2D hilbert space.
long_description    Curves provide Hilbert mapping of a point from 1D to 2D hilbert space. \
                    This means that points closer together from one dimentional space are closer in the other. \
                    In other words it preserves locality.

# Required java version
java.version        1.8+
# LTS JDK port to install if required java not found
java.fallback       openjdk11

patch.pre_args      -p1
patchfiles          fix-build.patch

use_configure       no

# Scala-Native requires clang 6+ or apple's clang 8+
compiler.blacklist  *gcc* {clang < 800} {macports-clang-3.[0-9]} {macports-clang-[4-5].0}

# needs MAP_ANONYMOUS, linkat and symlinkat
legacysupport.newest_darwin_requires_legacy 14

legacysupport.use_mp_libcxx yes

build.env-append    SBT_OPTS=-Duser.home=${workpath}/.home \
                    CLANG_PATH=${configure.cc} \
                    CLANGPP_PATH=${configure.cxx}

build.cmd           ${prefix}/bin/sbt
build.target        hashdrawNative/nativeLink

build.pre_args-prepend \
                    "'set (hashdraw.native / nativeCompileOptions) := \"${configure.cppflags}\".split(\" \").toSeq'" \
                    "'set (hashdraw.native / nativeLinkingOptions) := \"${configure.ldflags}\".split(\" \").toSeq'"

depends_build-append \
                    port:sbt

depends_lib-append  port:libsdl2

set curves_out ${worksrcpath}/example/hashdraw/native/target/scala-2.13/hashdraw-out

destroot {
    set bindir ${destroot}${prefix}/bin
    xinstall -m 0755 -d ${bindir}
    xinstall -m 0755 ${curves_out} ${bindir}/${name}
}

test.run            yes
test.cmd            ${curves_out}
test.target         -h

github.livecheck.branch main
