# $Id: Portfile,v 1.1 2004/03/12 06:53:08 rshaw Exp $
PortSystem 1.0

name			p5-razor-agents
version			2.36
categories		perl mail
maintainers		rshaw@opendarwin.org
description		a distributed, collaborative, spam detection and filter network
long_description	Vipul's Razor is a distributed, collaborative, spam \
					detection and filtering network. Through user \
					contribution, Razor establishes a distributed and \
					constantly updating catalogue of spam in propagation \
					that is consulted by email clients to filter out \
					known spam.  Detection is done with statistical and \
					randomized signatures that efficiently spot mutating \
					spam content. User input is validated through \
					reputation assignments based on consensus on report \
					and revoke assertions which in turn is used for \
					computing confidence values associated with \
					individual signatures.
homepage		http://razor.sourceforge.net/
master_sites	sourceforge
distname		razor-agents-${version}
checksums		md5 5deaae3ea2300bf480b6904f8a69a7f1
platforms		darwin

# Use Perl from DarwinPorts explicitly 
set perl		${prefix}/bin/perl
set perllib		[lindex [glob -nocomplain ${prefix}/lib/perl5/5.8*] end]
if {[catch {set perlarch [lindex [split [exec ${perl} -V:archname] {'}] 1]}]} {
	set perlarch	${os.platform}
}
set perlarchlib	${perllib}/${perlarch}

depends_build	path:${perl}:perl5.8

# Depends on these Perl modules
depends_lib		path:${perllib}/File/Copy.pm:perl5.8 \
				path:${perllib}/Getopt/Long.pm:perl5.8 \
				path:${perllib}/URI/Escape.pm:pl-uri \
				path:${perlarchlib}/Digest/SHA1.pm:pl-digest-sha1 \
				path:${perllib}/File/Spec.pm:perl5.8 \
				path:${perlarchlib}/Time/HiRes.pm:perl5.8 \
				path:${perllib}/Net/Ping.pm:perl5.8 \
				path:${perlarchlib}/Net/DNS.pm:pl-net-dns \
				path:${perlarchlib}/Digest/Nilsimsa.pm:pl-digest-nilsimsa

configure.cmd		${perl}
configure.pre_args	Makefile.PL
configure.args		INSTALLDIRS=perl

test.run			yes

destroot.target		pure_install
post-destroot {
	foreach packlist [exec find ${destroot}${perllib} -name .packlist] {
		ui_info "Fixing packlist ${packlist}"
		reinplace "s|${destroot}||" ${packlist}
	}
	foreach script {razor-admin razor-check razor-report razor-revoke} {
		ui_info "Creating link ${destroot}${prefix}/bin/${script}"
		system "ln -fs razor-client ${destroot}${prefix}/bin/${script}"
	}
}

