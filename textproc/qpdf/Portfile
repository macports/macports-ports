# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0
PortGroup           cmake 1.1
PortGroup           conflicts_build 1.0

github.setup        qpdf qpdf 11.0.0 v
checksums           rmd160  4d37f8ae55027f1441a863a9324afd17d21ad6ef \
                    sha256  8d99e98893f68f52ca3b579770e7e6f4c96612084d6a0e7e05854a6d631b8fe6 \
                    size    18452218

categories          textproc pdf
license             Apache-2
maintainers         {mps @Schamschula} openmaintainer

description         content-preserving PDF transformation system
long_description    QPDF is a command-line program that does structural, \
                    content-preserving transformations on PDF files.

homepage            http://qpdf.sourceforge.net/
github.tarball_from releases

depends_lib         path:include/turbojpeg.h:libjpeg-turbo \
                    port:libxml2 \
                    port:libxslt \
                    port:zlib

compiler.cxx_standard   2014
cmake.build_type        Release
configure.args          -DUSE_IMPLICIT_CRYPTO=0 \
                        -DREQUIRE_CRYPTO_NATIVE=1 \
                        -DREQUIRE_CRYPTO_GNUTLS=0 \
                        -DREQUIRE_CRYPTO_OPENSSL=0

# qPDF-11 builds with CMake which will use allready-installed
# headers if they are available, unfortunately. So you cannot
# simply `port update` if qPDF-10 is installed, sadly.
conflicts_build ${name}

platform darwin 8 {
    depends_build-append \
                        port:gmake
    build.cmd           gmake
}

variant gnutls description {Build against gnutls} {
    depends_lib-append      path:lib/pkgconfig/gnutls.pc:gnutls
    configure.args-delete   -DREQUIRE_CRYPTO_GNUTLS=0
    configure.args-append   -DREQUIRE_CRYPTO_GNUTLS=1
}

variant openssl description {Build against openssl} {
    depends_lib-append      port:openssl
    configure.args-delete   -DREQUIRE_CRYPTO_OPENSSL=0
    configure.args-append   -DREQUIRE_CRYPTO_OPENSSL=1
}

if {![variant_isset openssl]} {
    default_variants    +gnutls
}

livecheck.type      regex
livecheck.regex     release-${name}-(\[0-9.\]+)${extract.suffix}
