# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               java 1.0

name                    epubcheck
version                 4.2.2
categories              textproc
platforms               darwin
license                 BSD 3-Clause \"New\" or \"Revised\" License
maintainers             nomaintainer
supported_archs         noarch

description             EPUB validator

long_description        EPUBCheck is a tool to validate the \
                        conformance of EPUB publications against the \
                        EPUB specifications. EPUBCheck can be run as a \
                        standalone command-line tool or used as a Java \
                        library.

homepage                https://github.com/w3c/epubcheck
master_sites            https://github.com/w3c/epubcheck/releases/download/v${version}

distname                ${name}-${version}

use_zip                 yes

checksums               sha256  029ee9cda237a42e0d4c1a2b8771a440a4a6326449db843510b16a3c61045463 \
                        rmd160  cebf60866877013c2a9170605548d139fd16a232 \
                        size    11990465

java.version            1.7+
java.fallback           openjdk13

depends_run             bin:java:kaffe

extract.post_args       ""

use_configure           no

build {}

destroot {
    # path to the epubcheck java files (without ${destroot}):
    
    set epubcheck ${prefix}/share/java/epubcheck

    # install the template epubcheck script from files:
    
    xinstall ${filespath}/epubcheck.in ${destroot}${prefix}/bin/epubcheck
    
    # set the correct path to epubcheck.jar in the epubcheck script:
    
    reinplace "s|@@EPUBCHECK@@|${epubcheck}|g" \
        ${destroot}${prefix}/bin/epubcheck
        
    # install the epubcheck java files:
    
    xinstall -d ${destroot}${epubcheck}/lib
    
    xinstall ${worksrcpath}/${name}.jar ${destroot}${epubcheck}/${name}.jar
    xinstall {*}[glob ${worksrcpath}/*.txt]  ${destroot}${epubcheck}
    xinstall {*}[glob ${worksrcpath}/lib/*]  ${destroot}${epubcheck}/lib
}
