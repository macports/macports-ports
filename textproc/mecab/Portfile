# $Id$

PortSystem      1.0
name            mecab
version         0.94
categories      textproc japanese
maintainers     rsky0711@gmail.com
platforms       darwin
description     MeCab is a yet another part-of-speech and morphological analyzer.
long_description ${description}
homepage        http://mecab.sourceforge.net/

set dic_name    mecab-ipadic
set dic_version 2.7.0-20060707
set dictionary  ${dic_name}-${dic_version}
set charset     euc-jp

distfiles-append ${dictionary}${extract.suffix}

master_sites    sourceforge:mecab
checksums \
        ${distname}${extract.suffix} \
                md5    ffb1352e35fe6bdf55c2377a1898eff2 \
                sha1   2c8bf13fa92b2fb33b7b396255b8b4930ff1d31e \
                rmd160 f49bcb6e41d2ff47e2e698a438fc927c2d304da2 \
        ${dictionary}${extract.suffix} \
                md5    45b9f822700ad4eceb6722d6edcc2a46 \
                sha1   373be900f9be22957636acc54f120fea013f8818 \
                rmd160 cf2f7ad97e50cae6d0a9e9f13bc9328aeab33304

depends_lib     port:libiconv

patchfiles      patch-configure.diff

configure.args  --mandir=${prefix}/share/man \
                --with-libiconv-prefix=${prefix}
configure.env   CPPFLAGS="-I${prefix}/include" LDFLAGS="-L${prefix}/lib"

post-extract {
    # Makefile.in (dictionary)
    reinplace "s|@MECAB_DICT_INDEX@|${destroot}${prefix}/libexec/mecab/mecab-dict-index|g" \
        ${workpath}/${dictionary}/Makefile.in
}

post-destroot {
    system "cd ${workpath}/${dictionary}; \
        ./configure \
            --with-mecab-config=${destroot}${prefix}/bin/mecab-config \
            --with-charset=${charset} && \
        DYLD_LIBRARY_PATH=\"${destroot}${prefix}/lib\" ${build.cmd} && \
        ${destroot.cmd} install ${destroot.destdir}"
}

post-activate {
    system "ranlib ${prefix}/lib/libmecab.a"
}

platform darwin 7 {
    configure.env-append    MACOSX_DEPLOYMENT_TARGET=10.3
}

platform darwin 8 {
    configure.env-append    MACOSX_DEPLOYMENT_TARGET=10.4 \
                            CC=/usr/bin/gcc-4.0 CXX=/usr/bin/g++-4.0
}

variant sjis conflicts utf8 utf8only {
    set charset shift_jis
}

variant utf8 conflicts sjis utf8only {
    set charset utf-8
}

variant utf8only conflicts sjis utf8 {
    set charset utf-8
    configure.args-append   --enable-utf8-only
}
