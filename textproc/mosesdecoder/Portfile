# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           github 1.0

github.setup        moses-smt mosesdecoder 4fd980c386b79b1c65baf89c1c19b79db734b8eb
version             20121005

categories          textproc
maintainers         hum openmaintainer

description         a statistical machine translation system

long_description    Moses is a statistical machine translation system that \
                    allows you to automatically train translation models for \
                    any language pair. All you need is a collection of \
                    translated texts (parallel corpus). An efficient search \
                    algorithm finds quickly the highest probability translation \
                    among the exponential number of choices.

homepage            http://www.statmt.org/moses/
platforms           darwin
license             LGPL

fetch.type          git

depends_lib         port:boost \
                    port:zlib

patchfiles          patch_jam-files_sanity.jam.diff

use_configure       no

build.cmd           ./bjam
build.target
build.args          --with-macports=${prefix}

set libexec_dir     ${prefix}/libexec/${name}

destroot.args       ${build.args} \
                    --bindir=${destroot}${libexec_dir} \
                    --includedir=${destroot}${prefix}/include/${name}
destroot.destdir    --prefix=${destroot}${prefix}

post-destroot {
    # install scripts.
    set scripts_dir ${prefix}/share/${name}/scripts
    set args "${build.args} --install-scripts=${destroot}${scripts_dir}"
    system -W ${worksrcpath}/scripts "../bjam ${args}"
    # fix bin path in scripts/training/train-model.perl
    reinplace "s|\$SCRIPTS_ROOTDIR/\\.\\./bin/|${libexec_dir}/|g" \
        ${destroot}${scripts_dir}/training/train-model.perl
    # link some binaries to bin.
    foreach file {moses moses_chart} {
        ln -s ${libexec_dir}/${file} ${destroot}${prefix}/bin/${file}
    }
}

livecheck.type      none
