# -*- coding: utf-8; mode: tcl; tab-width: 4; truncate-lines: t; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id$

PortSystem 1.0

name                pandoc
version             1.2.1
categories          textproc
maintainers         berkeley.edu:jgm
description         General markup converter
long_description    \
    Pandoc is a command-line tool for converting from one markup format \
    to another.  It can read markdown and (subsets of) reStructuredText, \
    HTML, and LaTeX, and it can write markdown, reStructuredText, HTML, \
    LaTeX, ConTeXt, DocBook, RTF, groff man pages, and S5 HTML slide shows.

homepage            http://johnmacfarlane.net/pandoc/
platforms           darwin
master_sites        http://pandoc.googlecode.com/files/
checksums           md5     b57900f883823d5b24029c4768aa2d12 \
                    sha1    c567cdd45ff1501293308d67690876bf06ea9091 \
                    rmd160  a969daeddb2ab16ec58e2a1c09e91d164e3942a6
depends_build       port:ghc port:hs-haddock port:hs-zip-archive port:hs-utf8-string
depends_lib         port:gmp

use_configure       no
build.args          PREFIX=${prefix} GHC=${prefix}/bin/ghc GHC_PKG=${prefix}/bin/ghc-pkg
build.target        build-all

test.run	    yes

destroot            {
  # install pandoc executable, libraries, and library documentation:
  system "(cd ${worksrcpath}; ./setup copy --destdir=${destroot})"
  # strip the pandoc binary:
  system "strip ${destroot}${prefix}/bin/pandoc"
  # create scripts to register libraries in post-activate phase:
  system "(cd ${worksrcpath}; ./setup register --gen-script)"
  system "(cd ${worksrcpath}; ./setup unregister --gen-script)"
  # install register/unregister scripts:
  xinstall -d ${destroot}${prefix}/libexec/${name}-${version}
  xinstall -m 755 ${worksrcpath}/register.sh \
    ${destroot}${prefix}/libexec/${name}-${version}
  xinstall -m 755 ${worksrcpath}/unregister.sh \
    ${destroot}${prefix}/libexec/${name}-${version}
  # install shell scripts:
  xinstall -m 755 -W ${worksrcpath} html2markdown hsmarkdown markdown2pdf \
    ${destroot}${prefix}/bin
  # install user documentation and man pages:
  xinstall -d ${destroot}${prefix}/share/doc/${name}
  xinstall -m 644 -W ${worksrcpath} README README.html COPYRIGHT BUGS \
    ${destroot}${prefix}/share/doc/${name}
  xinstall -m 644 -W ${worksrcpath}/man/man1 pandoc.1 hsmarkdown.1 \
    markdown2pdf.1 html2markdown.1 ${destroot}${prefix}/share/man/man1
}
 
post-activate       {
  # Register the library with the ghc package database:
  system "${prefix}/libexec/${name}-${version}/register.sh"
}

#pre-deactivate     {
#  system "${prefix}/libexec/${name}-${version}/unregister.sh"
#}
