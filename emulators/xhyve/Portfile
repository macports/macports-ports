# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0

github.setup        mist64 xhyve 1f1dbe3 
revision            0
categories          emulators
platforms           darwin
supported_archs     x86_64
license             BSD
maintainers         nomaintainer
description         a lightweight OS X virtualization solution
long_description \
    The xhyve hypervisor is a port of bhyve to OS X. \
    It is built on top of Hypervisor.framework in OS X 10.10 Yosemite and higher, \
    runs entirely in userspace, and has no other dependencies. \
    It can run FreeBSD and vanilla Linux distributions and \
    may gain support for other guest operating systems in the future.

checksums           rmd160 766688a633d636294430dc32986e85073ea1f194 \
                    sha256 cb0394e40fb85b5d2ebebbe7acbeca5020d4b9cf61ba099a99c98c4500d2464f

patchfiles          no-Werror.patch

post-patch {
    reinplace "s|test/|${prefix}/share/${name}/test/|" ${worksrcpath}/${name}run.sh
    reinplace "s|build/${name}|${prefix}/bin/${name}|" ${worksrcpath}/${name}run.sh
}

use_configure       no

build.args          CC="${configure.cc}" \
                    LD="${configure.cc}" \
                    V=1

destroot {
    xinstall -m 755 -W ${worksrcpath} build/${name} ${destroot}${prefix}/bin
    xinstall -d -m 755 ${destroot}${prefix}/libexec/${name}
    xinstall -m 755 -W ${worksrcpath} ${name}run.sh ${destroot}${prefix}/libexec/${name}/${name}run.sh.sample
    xinstall -d -m 755 ${destroot}${prefix}/share/${name}
    xinstall -c -m 644 ${worksrcpath}/xhyve.1 ${destroot}${prefix}/share/man/man1
    file copy ${worksrcpath}/test ${destroot}${prefix}/share/${name}
}

notes "
    The shell script to run xhyve is installed as ${prefix}/libexec/${name}/${name}run.sh.sample.
    Copy the script for editing. ${name}run.sh.sample will be overwritten when the port is updated.
"
