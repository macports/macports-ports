# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0
PortGroup           legacysupport 1.1
PortGroup           openssl 1.0

# clock_gettime
legacysupport.newest_darwin_requires_legacy 15

categories          emulators
maintainers         @IComplainInComments
license             IBM Corporation
description         TPM emulator
long_description    Libtpms-based TPM emulator with socket, character device, and Linux CUSE interface.
github.setup        stefanberger swtpm 0.10.1 v
homepage            https://github.com/stefanberger/swtpm
github.tarball_from archive
checksums           rmd160  6de58b85fc0242e49adbf22ba6a9468f0c08980c \
                    sha256  f8da11cadfed27e26d26c5f58a7b8f2d14d684e691927348906b5891f525c684 \
                    size    415992

# Thanks @barracuda156 for the help!

depends_build-append \
                    port:autoconf \
                    port:automake \
                    port:libtool \
                    path:bin/pkg-config:pkgconfig

depends_lib-append  port:base64 \
                    port:gawk \
                    path:lib/pkgconfig/gnutls.pc:gnutls \
                    port:json-glib \
                    port:libtpms \
                    port:socat

configure.pre_args-append \
                    --with-openssl \
                    --prefix=${prefix}

configure.args-append \
                    --disable-silent-rules

configure.cflags-append \
                    -Wno-implicit-function-declaration \
                    -Wno-int-conversion

configure.cmd       ./autogen.sh

configure.optflags  -O2

configure.cmd       ./autogen.sh

compiler.blacklist-append \
                    *gcc-4.*

build.target
