# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem      1.0
PortGroup       github 1.0
PortGroup       cmake 1.1

github.setup    open-simh simh c5d1f8c5ef589de877a1934f2f264105d64d0ee5
github.tarball_from archive
name            opensimh

version         20250808
revision        1

checksums       rmd160  5507f2145e091937f98345e4063106845e76e056 \
                sha256  da503160ff9c31c35e70dcacb30aac82e17bbf7f2c8b9ce29a8d1aaaaa21ad65 \
                size    31350496

categories      emulators

# Note: pmetzger explicitly authorizes all maintainers to make any
# reasonable changes to this port without a three day wait.
maintainers     {pmetzger @pmetzger} openmaintainer

license         X11

description     A highly portable, multi-system simulator.

long_description    SIMH is a framework and family of computer simulators, \
                    with the primary goal of enabling the preservation \
                    of knowledge contained in, and providing the ability \
                    to execute and experience, old and historic software \
                    via simulation of the hardware on which it ran.

homepage        http://opensimh.org/

conflicts       simh

depends_lib     port:brotli \
                port:bzip2 \
                port:freetype \
                port:libedit \
                port:libpcap \
                port:libpng \
                port:libsdl2 \
                port:libsdl2_ttf \
                port:ncurses \
                port:pcre \
                port:pkgconfig \
                port:zlib

patchfiles      zlib-not-static.diff

set bindir      ${worksrcpath}/BIN

pre-build {
    file mkdir ${bindir}
}

destroot {
    foreach binary [glob -tails -directory ${bindir} *] {
        xinstall -c -m 755 ${bindir}/${binary} ${destroot}${prefix}/bin/simh-${binary}
    }
}

test.run        yes
test.cmd        ctest

notes "
The following OpenSIMH simulators are known to be currently\
broken in this snapsot:

infoserver100 infoserver1000 infoserver150vxt microvax1 microvax3100\
microvax3100e vax vax730 vax750 vax780 vax8200 vax8600\
vaxstation3100m30 vaxstation3100m38

The port will be updated when they are fixed.

open-simh executables have been installed with a 'simh-' prefix, for example:
   simh-microvax3900
"

livecheck.type  none
