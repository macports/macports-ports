# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
PortSystem 1.0

name            gxemul
version         0.7.0
categories      emulators
platforms       darwin
maintainers     nomaintainer
description     A simulator for ARM, MIPS, Motorola 88K, PowerPC, and SuperH.
long_description        \
GXemul is a framework for full-system computer architecture emulation. \
Several real machines have been implemented within the framework, \
consisting of processors (ARM, MIPS, Motorola 88K, PowerPC, and SuperH) \
and surrounding hardware components such as framebuffers, interrupt \
controllers, busses, disk controllers, and serial controllers.

# There is also a sourceforge hosted subversion repo at https://sourceforge.net/projects/gxemul/
homepage        https://gavare.se/gxemul/
master_sites    https://gavare.se/gxemul/src/

checksums       md5     2546e5143ec5eef45242ea9c5579f15c \
                sha256  79c4437c6f8ca904f46d33ac36062a65fdcf4a92a248478e408ab11295cf8e83 \
                rmd160  590a2ab904c2999552e33da42f1724d44efb9342 \
                size    5985021

depends_build   port:pkgconfig
depends_lib     port:xorg-libX11

# The configure script describes itself as "minimal, hardcoded for gxemul", so it will
# exit with an error if you send configure command line arguments you might be used to
configure.pre_args
configure.universal_args

# force usage of port libraries
post-configure {
        set x11_cflags [exec ${prefix}/bin/pkg-config --cflags-only-I x11]
        set x11_ldflags [exec ${prefix}/bin/pkg-config --libs x11]
        set makefiles [exec find ${worksrcpath} -name Makefile]
        foreach makefile $makefiles {
            reinplace "s|XLIB=.*$|XLIB=${x11_ldflags}|g" ${makefile}
            reinplace "s|XINCLUDE=.*$|XINCLUDE=${x11_cflags}|g" ${makefile}
        }
}

# no default install in the makefile
destroot {
        xinstall -c -m 755 ${worksrcpath}/gxemul ${destroot}${prefix}/bin
        xinstall -c -m 644 ${worksrcpath}/man/gxemul.1 ${destroot}${prefix}/share/man/man1
}
