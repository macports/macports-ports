# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               github 1.0
PortGroup               xcode 1.0

github.setup            mulle-nat mulle-xcode-to-cmake 0.6.5
categories              devel
platforms               darwin
maintainers             {kencu @kencu} openmaintainer
license                 GPL-3+

description             Tool to convert Xcode projects to cmake CMakeLists.txt
long_description        ${description}

checksums               rmd160  1c10be8c3db1a0c867296a68fd32b79e1f35bc40 \
                        sha256  bc0280fbaa6906e1c9fa1fb0ae3ed4586731727be392c082f2f6ce5c30469829

platform darwin powerpc {
    ui_error "This port presently causes a crash on PowerPC during build."
    ui_error "I would appreciate any assistance in fixing this."
    return -code error "incompatible OS X version"
}

# replace containString, available only on 10.10 or later
if { ${os.platform} eq "darwin" && ${os.major} < 13 } {
    patchfiles-append       patch-containsString.diff
}

# delete unrecognized flags on gcc
if { ${os.platform} eq "darwin" && ${os.major} < 11 } {
    patchfiles-append       patch-strip-unrecognized-flags.diff
}

xcode.project           mulle-xcode-to-cmake.xcodeproj
xcode.configuration     Release
xcode.build.settings    SYMROOT=build
xcode.target            mulle-xcode-to-cmake

destroot {
    copy ${worksrcpath}/build/Release/mulle-xcode-to-cmake \
         ${destroot}${prefix}/bin
}

test.run                yes
test.cmd                ${worksrcpath}/build/Release/mulle-xcode-to-cmake
test.target
test.args               -h
