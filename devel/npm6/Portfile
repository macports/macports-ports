# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           npm 1.0

npm.setup           6.14.13
revision            1
maintainers         {ciserlohn @ci42} openmaintainer

# Please keep the sha1 - users can use it to validate sha values
# published on npmjs.org for the package
checksums           sha1    e88bcb6c48209869c40b5cedad8a1508e58e6f30 \
                    rmd160  029ad30ceb83ba144d7c3599dfcc903abcdc010e \
                    sha256  29f58763d9bc29291ff513bcef1c1a2d75e09f8ff882010c43b4b7dcdb56ab9c \
                    size    5758507

patchfiles          patch-lib-update.js.diff

post-patch {
    regsub -all {/} "^${prefix}/lib" {\\\/} npm_path_jsregex
    reinplace "s|@@NPM_PATH_JSREGEX@@|${npm_path_jsregex}|g" ${worksrcpath}/lib/update.js

    foreach f [concat ${worksrcpath}/bin/npm-cli.js \
                   ${worksrcpath}/bin/npx-cli.js \
                   ${worksrcpath}/node_modules/JSONStream/bin.js \
                   ${worksrcpath}/node_modules/errno/build.js \
                   ${worksrcpath}/node_modules/errno/cli.js \
                   ${worksrcpath}/node_modules/is-ci/bin.js \
                   ${worksrcpath}/node_modules/mkdirp/bin/cmd.js \
                   ${worksrcpath}/node_modules/node-gyp/bin/node-gyp.js \
                   ${worksrcpath}/node_modules/nopt/bin/nopt.js \
                   ${worksrcpath}/node_modules/opener/bin/opener-bin.js \
                   ${worksrcpath}/node_modules/qrcode-terminal/bin/qrcode-terminal.js \
                   ${worksrcpath}/node_modules/rc/cli.js \
                   ${worksrcpath}/node_modules/rimraf/bin.js \
                   ${worksrcpath}/node_modules/semver/bin/semver \
                   ${worksrcpath}/node_modules/sshpk/bin/sshpk-conv \
                   ${worksrcpath}/node_modules/sshpk/bin/sshpk-sign \
                   ${worksrcpath}/node_modules/sshpk/bin/sshpk-verify \
                   ${worksrcpath}/node_modules/uuid/bin/uuid \
                   ${worksrcpath}/node_modules/which/bin/which \
                   ${worksrcpath}/scripts/docs-build.js \
                   ${worksrcpath}/scripts/maketest \
                   ${worksrcpath}/scripts/relocate.sh] {
        reinplace "s|/usr/bin/env node|${prefix}/bin/node|" ${f}
    }
}

