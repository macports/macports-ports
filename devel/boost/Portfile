# $Id: Portfile,v 1.3 2005/04/07 03:24:42 jkh Exp $
PortSystem		1.0

name			boost
version			1.32.0
categories		devel
maintainers		rshaw@opendarwin.org
description		Collection of portable C++ source libraries
long_description 	Boost provides free portable peer-reviewed C++ \
			libraries. The emphasis is on portable libraries \
			which work well with the C++ Standard Library.
homepage		http://www.boost.org
master_sites		sourceforge
distname		${name}_[strsed ${version} {g/[.]/_/}]
use_bzip2		yes
checksums		md5 e1d1fc7b8fc8c51df4564c2188ca51cb
platforms		darwin

depends_build		bin:bjam:boost-jam

patchfiles		patch-Jamfile \
				patch-libs-python-build-Jamfile \
				patch-libs-serialization-build-Jamfile \
				patch-libs-test-build-Jamfile \
				patch-tools-build-v1-allyourbase.jam \
				patch-tools-build-v1-darwin-tools.jam \
				patch-tools-build-v1-python.jam \
				patch-darwin-tools.jam

# Note: Boost will not build properly on Jaguar (to my knowledge)
platform darwin {
	build.env-append	MACOSX_DEPLOYMENT_TARGET=10.3
	build.args-append	-sTOOLS=darwin

	destroot.env-append	MACOSX_DEPLOYMENT_TARGET=10.3
	destroot.args-append	-sTOOLS=darwin
	post-destroot {
		cd ${destroot}${prefix}/lib
		set libver [join [lrange [split ${version} {.}] 0 1] {_}]
		foreach lib [glob *-${libver}.a *-${libver}.dylib] {
			set libname [join [lrange [split [file rootname ${lib}] {-}] 0 end-1] {-}]
			set libext [file extension ${lib}]
			set liblink "${libname}${libext}"
			if {![catch {set libtype [file type ${liblink}]}]} {
				if {${libtype} == "link"} {
					file delete -force ${liblink}
				}
			}
			system "ln -s ${lib} ${liblink}"
		}
	}
}

use_configure		no

build.cmd		bjam
build.pre_args		--prefix=${prefix}
build.args		--without-python \
				-sgPYTHON_CONFIG_CHECKED=true \
				-sgNO_PYTHON_INSTALL=true

destroot.cmd		bjam
destroot.pre_args	--prefix=${destroot}${prefix}
destroot.args		--without-python \
				-sgPYTHON_CONFIG_CHECKED=true \
				-sgNO_PYTHON_INSTALL=true
destroot.post_args	install
post-destroot {
	set incdirver [join [lrange [split ${version} {.}] 0 1] {_}]
	system "ln -fs boost-${incdirver}/boost ${destroot}${prefix}/include/boost"
}

variant python {
	set pyversion	2.4

	depends_lib		lib:libpython${pyversion}:python[strsed ${pyversion} {g/[.]//}]

	build.args-delete	--without-python \
					-sgPYTHON_CONFIG_CHECKED=true \
					-sgNO_PYTHON_INSTALL=true
	build.args-append	-sPYTHON_ROOT=${prefix} \
					-sPYTHON_VERSION=${pyversion} \
					--with-python-root=${prefix}

	destroot.args-delete	--without-python \
					-sgPYTHON_CONFIG_CHECKED=true \
					-sgNO_PYTHON_INSTALL=true
	destroot.args-append	-sPYTHON_ROOT=${prefix} \
					-sPYTHON_VERSION=${pyversion} \
					--with-python-root=${prefix}
}

