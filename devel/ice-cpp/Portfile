# $Id$

PortSystem 1.0
name		ice-cpp
version		3.2.1
revision	1
categories	devel
maintainers	blair
description	Fast, object-oriented RPC for C++, Java, Python, Ruby, PHP

long_description \
	The Internet Communications Engine (Ice) is a modern alternative to \
	object middleware such as CORBA or COM/DCOM/COM+, with support for \
	C++, C#, Java, PHP, Python, Ruby and Visual Basic. \
	Ice consists of the following packages. \
	Slice: The Specification Language for Ice.  Slice establishes a \
	contract between clients and servers, and is also used to describe \
	persistent data. \
	Slice Compilers: Slice specifications are compiled into various \
	programming languages. Ice supports C++, Java, C#, Visual Basic, PHP, \
	Python and Ruby.  Ice clients and servers work together, regardless \
	of the programming language. \
	Ice: The Ice core library manages all the communication tasks using a \
	highly efficient protocol (including protocol compression and support \
	for both TCP and UDP), provides a flexible thread pool for \
	multi-threaded servers. \
	This Port provides the C++ runtime libraries, the core Slice files \
	and slice2cpp.  It also includes the slice compilers for all the \
	other languages: slice2cs, slice2java, slice2py, slice2rb and slice2vb.

homepage	http://www.zeroc.com/
master_sites	http://www.zeroc.com/download/Ice/3.2/
distname	Ice-${version}
checksums	md5 77bb04788747d0f4f7ef35f7a4c2800f \
		sha1  69fc7dbdff81d7d9300b57f6e495914f3c9e5c19 \
		rmd160  c3394486ba13e94c2491b0dc48dc19c3e7565ecd
platforms	darwin

depends_lib	port:db45 \
		port:expat \
		port:openssl \
		port:readline

patchfiles	patch-config.Make.rules \
		patch-config.Make.rules.Darwin \
		patch-ServantLocator.locate-can-throw-user-exceptions

use_configure	no

build.target	prefix="${prefix}" \
		embedded_runpath_prefix="${prefix}" \
		OPTIMIZE="yes" \
		BZIP2_HOME="${prefix}" \
		DB_HOME="${prefix}" \
		EXPAT_HOME="${prefix}" \
		OPENSSL_HOME="${prefix}" \
		READLINE_HOME="${prefix}" \
		USE_READLINE=yes \
		all
		
test.run	yes
test.target	test

destroot.target	prefix="${destroot}${prefix}" \
		embedded_runpath_prefix="${prefix}" \
		OPTIMIZE="yes" \
		BZIP2_HOME="${prefix}" \
		DB_HOME="${prefix}" \
		EXPAT_HOME="${prefix}" \
		OPENSSL_HOME="${prefix}" \
		READLINE_HOME="${prefix}" \
		USE_READLINE=yes \
		install

post-destroot {
	cd ${destroot}${prefix}

	file rename include ice
	xinstall -d -m 755 include
	file rename ice include/

	xinstall -d -m 755 share/ice
	file rename slice share/ice/
	file rename config share/ice/

	xinstall -m 755 -d share/doc/${name}
	file rename doc/reference share/doc/${name}/reference
	file rename ICE_LICENSE share/doc/${name}/
	file rename LICENSE share/doc/${name}/

	cd ${destroot}${prefix}/share/doc/${name}
	foreach f {CHANGES INSTALL.MACOSX README} {
		file copy ${worksrcpath}/${f} .
	}

	if {[variant_isset demo_source_code]} {
		file copy ${worksrcpath}/demo .
	}
}

platform darwin 7 {
	build.env-append	CPP=/usr/bin/cpp-3.3 \
				CC=/usr/bin/gcc-3.3 \
				CXX=/usr/bin/g++-3.3
}

platform darwin 8 {
	build.env-append	CPP=/usr/bin/cpp-4.0 \
				CC=/usr/bin/gcc-4.0 \
				CXX=/usr/bin/g++-4.0
}

variant demo_source_code {
}
