# $Id: Portfile,v 1.14 2004/05/12 10:51:28 jkh Exp $

PortSystem 1.0
name		mono
version		0.91
categories	devel
platforms	darwin
maintainers	mww@opendarwin.org
description	Implementation of the .NET Development Framework
long_description	Mono is an effort to create an open source \
			implementation of the .NET Development Framework \
			including a C# compiler.

homepage	http://www.go-mono.com
master_sites	http://www.go-mono.com/archive/beta1/
checksums	md5 eea86524624bd0e02fb90cec71fd0673
patchfiles	patch_ltmain.sh

depends_lib	bin:pkg-config:pkgconfig \
		lib:libintl.3:gettext \
		lib:libglib.2:glib2 \
		lib:libicui18n:icu \
		lib:libgc:boehmgc-devel

configure.env	CPPFLAGS="-I${prefix}/include" \
		LDFLAGS="-L${prefix}/lib"
configure.args	--with-gc=boehm --enable-threads=pthreads

destroot.destdir	DESTDIR=${destroot}

pre-build {
	reinplace s,^\\(mono_runtime.*mono\\),#\\1, ${worksrcpath}/runtime/net_1_1/Makefile
	reinplace s,^#\\(mono_runtime.*mint\\),\\1, ${worksrcpath}/runtime/net_1_1/Makefile
}

variant darwin {
	configure.args-append	--without-sigaltstack
	destroot.env	DYLD_LIBRARY_PATH=${worksrcpath}/mono/mini/.libs:${worksrcpath}/mono/interpreter/.libs
}

post-destroot	{
	set doc	${worksrcpath}/docs
	file mkdir ${destroot}${prefix}/share/doc/${name}
	file copy ${doc}/assembly-bundle ${doc}/embedded-api ${doc}/exceptions \
		${doc}/gc-issues ${doc}/jit-thoughts ${doc}/jit-trampolines \
		${doc}/object-layout ${doc}/stack-alignment \
		${doc}/unmanaged-calls ${worksrcpath}/AUTHORS \
		${worksrcpath}/COPYING.LIB ${worksrcpath}/ChangeLog \
		${worksrcpath}/NEWS ${worksrcpath}/README \
		${destroot}${prefix}/share/doc/${name}
}
