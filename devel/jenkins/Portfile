# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           java 1.0

name                jenkins
version             2.401.3
revision            0
categories          devel java
maintainers         {gmail.com:slashapp @slashapp} openmaintainer

homepage            https://jenkins.io
description         The leading open source automation server,\
                    Jenkins provides hundreds of plugins to support building,\
                    deploying and automating any project.
long_description    ${description}

platforms           any
supported_archs     noarch
license             MIT

master_sites        https://get.jenkins.io/war-stable/${version}/
distfiles           ${name}.war

checksums           rmd160  0a762953129148086beced9450a364467a136b40 \
                    sha256  a798a0c5481a8ffb0320d9121f6cf49dc575c369028daae17a4dd398b69e000d \
                    size    98398119

java.version        11+
java.fallback       openjdk11

use_configure       no
extract {}
build {}
test {}

set jenkins_home_dir    ${prefix}/var/lib/${name}
set jenkins_exec_dir    ${prefix}/libexec/${name}
set jenkins_exec        ${jenkins_exec_dir}/${distfiles}
set jenkins_host        127.0.0.1
set jenkins_port        8080

destroot {
    xinstall -d -m 0755 ${destroot}${jenkins_home_dir}
    xinstall -d -m 0755 ${destroot}${jenkins_exec_dir}

    copy ${distpath}/${distfiles}  ${destroot}${jenkins_exec}

    destroot.keepdirs-append \
        ${destroot}${jenkins_home_dir} \
        ${destroot}${jenkins_exec_dir}
}

startupitem.create yes
startupitem.executable java \
    -Duser.home=${jenkins_home_dir} \
    -jar ${jenkins_exec} \
    --httpListenAddress=${jenkins_host} \
    --httpPort=${jenkins_port}

notes "
To configure Jenkins service, edit parameters follows:

  refer to the documentation https://jenkins.io/doc/book/installing/initial-settings/

  \$ sudo vi /Library/LaunchDaemons/org.macports.${name}.plist

Once the service is enabled, Jenkins will:

  - listen by default on: http://localhost:8080
"

livecheck.url "https://www.jenkins.io/download/"
livecheck.regex {war-stable/([0-9.]+)/jenkins}
