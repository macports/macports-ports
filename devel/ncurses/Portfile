# $Id$

PortSystem 1.0

name            ncurses
version         5.7
revision        1
categories      devel
platforms       darwin freebsd
license         MIT
maintainers     jmr openmaintainer
description     emulation of curses in System V Release 4.0
long_description \
    The Ncurses (new curses) library is a free software emulation of    \
    curses in System V Release 4.0, and more. It uses Terminfo format,  \
    supports pads and color and multiple highlights and forms           \
    characters and function-key mapping, and has all the other          \
    SYSV-curses enhancements over BSD Curses.

homepage        http://www.gnu.org/software/ncurses/ncurses.html
master_sites    gnu

checksums       md5     cce05daf61a64501ef6cd8da1f727ec6 \
                sha1    8233ee56ed84ae05421e4e6d6db6c1fe72ee6797 \
                rmd160  a19ca026d32255f5a4d22eb006d65182041e0234

# required for terminfo
depends_run     port:ncursesw

# from http://www.opensource.apple.com/source/ncurses/ncurses-27/patches/
patchfiles      ungetch_guard.diff

configure.cppflags
configure.ldflags
configure.args  --with-shared \
                --disable-rpath \
                --without-debug  \
                --without-ada \
                --enable-safe-sprintf \
                --enable-sigwinch \
                --without-progs \
                --mandir=${prefix}/share/delete-me \
                --with-manpage-format=normal

platform darwin 10 {
    configure.args-delete --enable-safe-sprintf
}
platform darwin 11 {
    configure.args-delete --enable-safe-sprintf
}

post-destroot {
    # terminfo & manpages also do come with ncursesw
    delete ${destroot}${prefix}/lib/terminfo ${destroot}${prefix}/share
}

platform freebsd {
    depends_build-append    lib:libncursesw:ncursesw
    destroot.env-append     LD_LIBRARY_PATH=${prefix}/lib
}

if {[variant_isset universal]} {
    configure.args-append --with-chtype=int

    # check that this doesn't start breaking anything with new versions
    post-configure {
        reinplace s/1UL/1U/g "${worksrcpath}/include/curses.head"
        system "cd ${worksrcpath} && ed - include/curses.head < ${filespath}/include_curses.head.ed"
    }
}

use_parallel_build yes
