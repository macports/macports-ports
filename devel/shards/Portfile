# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0

github.setup        crystal-lang shards 0.12.0 v
github.tarball_from archive

categories          devel
platforms           darwin
license             Apache-2
maintainers         {@conradwt gmail.com:conradwt} openmaintainer

description         Crystal application dependency manager

long_description    Shards is a dependency manager for the Crystal Programming Language.

depends_lib         port:crystal

set molinillo_ver   0.1.0
set molinillo_dist  crystal-molinillo-${molinillo_ver}

master_sites        ${master_sites}:shards \
                    https://github.com/crystal-lang/crystal-molinillo/archive/v${molinillo_ver}:molinillo
distfiles           ${distfiles}:shards \
                    ${molinillo_dist}${extract.suffix}:molinillo

checksums           ${distname}${extract.suffix} \
                    rmd160  67116f2b6bf078616e3c3befa97b51ea99f61e8d \
                    sha256  f6803ffb58b9dd5e78c3c3ec273941c0f6278d75427937aeb77e37244cd5cad9 \
                    size    52205 \
                    ${molinillo_dist}${extract.suffix} \
                    rmd160  6337c57c2f164a1b11c9d553a800b4c03fed6989 \
                    sha256  1ecc7a8bf52a3bfdc0134d4c58f1155ef204a22a3fed151ac2d4ba6a9e9e0a15 \
                    size    23932

pre-fetch {
    if {${os.major} < 16} {
        ui_error "${name} @${version} requires macOS 10.12 or newer."
        return -code error "incompatible macOS version"
    }
}

post-extract {
    file mkdir ${worksrcpath}/lib
    file copy ${workpath}/${molinillo_dist} ${worksrcpath}/lib/molinillo
}

use_configure       no

build.args          CRFLAGS=--release

destroot.args       PREFIX=${prefix}

test.run            yes
