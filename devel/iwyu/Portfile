# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem           1.0
PortGroup            cmake 1.1

name                 iwyu
version              0.21
categories           devel
license              GPL-3
maintainers          nomaintainer
platforms            darwin
description          A tool for use with clang to analyze #includes in C and C++ source files
long_description     "Include what you use" means this: for every symbol (type, function variable, \
                     or macro) that you use in foo.cc, either foo.cc or foo.h should #include a .h \
                     file that exports the declaration of that symbol. The include-what-you-use \
                     tool is a program that can be built with the clang libraries in order to \
                     analyze #includes of source files to find include-what-you-use violations, \
                     and suggest fixes for them. \
                     \
                     The main goal of include-what-you-use is to remove superfluous #includes. It \
                     does this both by figuring out what #includes are not actually needed for \
                     this file (for both .cc and .h files), and replacing #includes with \
                     forward-declares when possible.
homepage             https://include-what-you-use.org/

distname             include-what-you-use
distfiles            ${distname}-${version}.src${extract.suffix}
master_sites         https://include-what-you-use.org/downloads/
checksums            rmd160  c3e60deb26e8d2ffc6c1714d955d153dad3132d7 \
                     sha256  6a351919ff89bda7c95c895472601868db3daab96a958b38e0362890d58760b6 \
                     size    776165

depends_build-append port:clang-17
depends_run-append   port:clang-17

patch.pre_args       -p1
patchfiles           0001-install-scripts-without-language-extension.patch

configure.args-append  -DClang_DIR:PATH=${prefix}/libexec/llvm-17/lib/cmake/clang \
                       -DLLVM_DIR:PATH=${prefix}/libexec/llvm-17/lib/cmake/llvm
cmake.install_rpath-append  ${prefix}/libexec/llvm-17/lib

livecheck.type       regex
livecheck.url        ${master_sites}
livecheck.regex      {include-what-you-use (\d+(\.\d+)*) \(}
