# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0
PortGroup           python 1.0

name                git-remote-hg
github.setup        mnauw git-remote-hg 1.0.4 v
github.tarball_from archive
revision            0

categories          devel python
supported_archs     noarch
platforms           {darwin any}
maintainers         {landonf @landonf} openmaintainer
license             GPL-2
description         Transparent bidirectional bridge between Git and Mercurial for Git
long_description    {*}${description}.

checksums           rmd160  4738123fa3c4ef4594f26902b93c783f077c8053 \
                    sha256  0645042e42295c978fff5c73828dd030d565de2d4daae87f0ed788aade699fdc \
                    size    66859

python.default_version 312

depends_build-append \
                    port:asciidoc

depends_lib-append  port:mercurial

post-patch {
    reinplace "1 s|/usr/bin/env python.*|${python.bin}|g" \
        ${worksrcpath}/git-remote-hg

    reinplace -E "s|^(prefix\[\[:space:\]\].*.?=).*|\\1 ${prefix}|g" \
        ${worksrcpath}/Makefile
}

post-build {
    system -W "${worksrcpath}" "env PYTHON=${python.bin} make"
}

post-destroot {
    system -W "${worksrcpath}" \
        "make install-doc DESTDIR=${destroot} PREFIX=${prefix}"
}

test.run            yes
