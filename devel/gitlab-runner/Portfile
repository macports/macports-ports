# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0

name                gitlab-runner
version             15.2.1

categories          devel
platforms           darwin
supported_archs     x86_64 arm64
maintainers         nomaintainer
license             MIT

description         GitLab Runner
long_description    GitLab Runner is the open source project that is used to \
                    run your jobs and send the results back to GitLab. It is \
                    used in conjunction with GitLab CI, the open-source \
                    continuous integration service included with GitLab that \
                    coordinates the jobs.

homepage            https://docs.gitlab.com/runner/

master_sites        https://gitlab.com/gitlab-org/gitlab-runner/-/releases/v${version}/downloads/binaries/

switch ${build_arch} {
    x86_64 {
        distname            gitlab-runner-darwin-amd64
        checksums           rmd160  7bdfd8bde4bec0fe7b9e21c965fdf90bfdee4577 \
                            sha256  a1315aff96997c1ac9e84ad38617cfba7d1a8f628920f5a94884c168efb7fb6b \
                            size    49973200
    }
    arm64 {
        distname            gitlab-runner-darwin-arm64
        checksums           rmd160  5b3121c39636c93f5e395d3f04329b7abf44822c \
                            sha256  81d1ead766b26b0452195424ef059a2d2780164d095900530de5a05508322f1d \
                            size    51837138
    }
    default {
        known_fail yes
        pre-fetch {
            ui_error "${subport} @ ${version} only supported for architectures ${supported_archs}"
            return -code error "Unsupported architecture: ${build_arch}"
        }
    }
}

distfiles           ${distname}
extract {}
use_configure       no
build {}

destroot {
    xinstall -m 0755 ${distpath}/${distname} ${destroot}${prefix}/bin/${name}
}

livecheck.url   https://gitlab.com/gitlab-org/gitlab-runner/-/tags
livecheck.regex v(\\d+\\.\\d+\\.\\d+)
