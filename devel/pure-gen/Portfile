# $Id$

PortSystem                      1.0
PortGroup                       pure 1.0

pure.setup                      gen 0.8
categories                      devel
platforms                       darwin
maintainers                     ryandesign
license                         GPLv3

description                     a Pure C bindings generator

long_description                ${name} is ${description}.

checksums                       md5     ca7a9b9c8e5818534994edc430ca3b65 \
                                sha1    72eabf019fc66cea4c22d259e2517eacaa4a1701 \
                                rmd160  631b894767607ef7034a99e1bd608013cb527252

depends_build-append            path:bin/ghc:ghc \
                                port:hs-language-c

# pure-gen uses gcc at runtime to parse C headers but the
# -fdirectives-only option it needs is only available in gcc 4.3 and up.
variant gcc43 conflicts gcc44 description {Use gcc43 for runtime C header parsing} {
    depends_run-append          path:bin/gcc-mp-4.3:gcc43
}
variant gcc44 conflicts gcc43 description {Use gcc44 for runtime C header parsing} {
    depends_run-append          path:bin/gcc-mp-4.4:gcc44
}
if {![variant_isset gcc43] && ![variant_isset gcc44]} {
    if {${os.platform} == "darwin" && ${os.major} < 9} {
        # gcc44 doesn't build for me on Tiger
        default_variants +gcc43
    } else {
        default_variants +gcc44
    }
}

patchfiles-append               patch-pure-gen.pure.diff
post-patch {
    reinplace "s|@CC@|${configure.cc}|g" ${worksrcpath}/pure-gen.pure
}

build.args-append               LIBRARY_PATH=${prefix}/lib
