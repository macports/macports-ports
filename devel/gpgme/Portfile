# $Id: Portfile,v 1.17 2006/08/16 07:23:32 blb Exp $

PortSystem			1.0
name				gpgme
version				1.1.2
revision			2
categories			devel security crypto
maintainers			darwinports@opendarwin.org
description			A library for easy acces to GnuPG.
long_description \
	GnuPG Made Easy (GPGME) is a library designed to make access \
	to GnuPG easier for applications. It provides a High-Level \
	Crypto API for encryption, decryption, signing, signature \
	verification and key management. Currently it uses GnuPG \
	as its backend but the API isn't restricted to this engine \
	in fact we have already developed a backend for CMS (S/MIME).

platforms			darwin 

homepage			http://www.gnupg.org/related_software/gpgme/
master_sites		http://ftp.gnupg.org/gcrypt/gpgme/ \
					http://mirrors.rootmode.com/ftp.gnupg.org/gpgme/ \
					ftp://ftp.gnupg.org/gcrypt/gpgme/
use_bzip2			yes

checksums			sha1 ebf8c278e967588acd7c416bd14bfe35615b7e81

depends_lib			port:gnupg port:pth port:libgpg-error

post-patch {
	reinplace "s|thread_modules=\"\"|thread_modules=\"pthread\"|" ${worksrcpath}/gpgme/gpgme-config.in
}

configure.env		CPPFLAGS="-I${prefix}/include" LDFLAGS="-L${prefix}/lib"
configure.args		--infodir=${prefix}/share/info \
					--mandir=${prefix}/share/man \
					--with-gpg=${prefix}/bin/gpg --enable-static

test.run	yes
test.target	check

post-destroot {
	xinstall -m 755 -d ${destroot}${prefix}/share/doc/${name}
	xinstall -m 644 -W ${worksrcpath} AUTHORS COPYING COPYING.LESSER \
		ChangeLog INSTALL NEWS README THANKS TODO \
		${destroot}${prefix}/share/doc/${name}
}

variant darwin {
	patchfiles-append	patch-assuan_assuan.h patch-assuan_funopen.c
}

platform darwin 7 {
	configure.env-append	LIBS="-lpth"
}

