# $Id$

PortSystem	1.0

name		nspr
version		4.6.6
categories	devel
maintainers	nomaintainer
platforms	darwin
description	A platform-neutral API for system level and libc like functions.

long_description ${description}

homepage	http://www.mozilla.org/projects/nspr
master_sites	http://ftp.mozilla.org/pub/mozilla.org/nspr/releases/v${version}/src/ \
		ftp://ftp.mozilla.org/pub/mozilla.org/nspr/releases/v${version}/src/
checksums	md5 ba49bc35e2068f54893d3ea7031ad59c

worksrcdir      ${worksrcpath}/mozilla/nsprpub

patchfiles	nspr-4.6.1-config-1.patch \
		nspr-4.6.1-lang.patch \
		nspr-4.6.1-prtime.patch

post-patch {
	reinplace "s|@executable_path|${prefix}/lib|g" \
		${worksrcpath}/configure
}

configure.args	--prefix=${prefix} \
		--disable-debug

build {system "cd ${worksrcdir} && make"}

destroot {
	xinstall -m 755 -d ${destroot}${prefix}/bin
	xinstall -m 755 ${worksrcpath}/config/nspr-config ${destroot}${prefix}/bin

	xinstall -m 755 -d ${destroot}${prefix}/lib
	eval xinstall -m 644 [glob ${worksrcpath}/dist/lib/*] \
		${destroot}${prefix}/lib

	xinstall -m 755 -d ${destroot}${prefix}/include/${name}
	eval xinstall -m 644 [glob ${worksrcpath}/dist/include/${name}/*.h] \
                ${destroot}${prefix}/include/${name}

	xinstall -m 755 -d ${destroot}${prefix}/include/${name}/md
        eval xinstall -m 644 [glob ${worksrcpath}/dist/include/${name}/md/*.h] \
                ${destroot}${prefix}/include/${name}/md

	xinstall -m 755 -d ${destroot}${prefix}/include/${name}/private
        eval xinstall -m 644 [glob ${worksrcpath}/dist/include/${name}/private/*.h] \
                ${destroot}${prefix}/include/${name}/private

	xinstall -m 755 -d ${destroot}${prefix}/include/${name}/obsolete
        eval xinstall -m 644 [glob ${worksrcpath}/dist/include/${name}/obsolete/*.h] \
                ${destroot}${prefix}/include/${name}/obsolete
}

platform darwin 9	{
	patchfiles-append	patch-nspr-4.6.6-pthread_kill.diff
}
