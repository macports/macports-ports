# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem 1.0
PortGroup           cxx11 1.1

name                qscintilla2

version             2.10.1
checksums           rmd160 5dbddfdaf826e95251589a41696d5786b497e86f \
                    sha256 97f98a9d91f908db6ce37fecc6d241d955b388a1c487173b60726cba9a3dfa64

categories          devel
license             GPL-3
maintainers         {mcalhoun @MarcusCalhoun-Lopez} openmaintainer
description         QScintilla is a port to Qt of Neil Hodgson's Scintilla C++ editor control.
homepage            http://www.riverbankcomputing.com/software/qscintilla/
platforms           darwin

long_description    QScintilla is a port to Qt of Neil Hodgson's Scintilla C++ editor control. \
                	As well as features found in standard text editing components,		       \
                	QScintilla includes features especially useful when editing and		       \
                	debugging source code. These include support for syntax styling,	       \
                	error indicators, code completion and call tips. The selection		       \
                	margin can contain markers like those used in debuggers to indicate	       \
                	breakpoints and the current line. Styling choices are more open		       \
                	than with many editors, allowing the use of proportional fonts,		       \
                	bold and italics, multiple foreground and background colours and	       \
                	multiple fonts.

distname            QScintilla_gpl-${version}
master_sites        sourceforge:pyqt

if { ${subport} eq ${name} } {
    PortGroup  qmake5 1.0

    worksrcdir ${worksrcdir}/Qt4Qt5

    qt5.depends_component qtmacextras

    configure.args-append CONFIG+=absolute_library_soname

    configure.args-append CONFIG+=c++11
}

subport ${name}-designer {
    PortGroup  qmake5 1.0

    description       Qt Designer plugin for port ${name}
    long_description  ${description}

    worksrcdir ${worksrcdir}/designer-Qt4Qt5

    qt5.depends_component qttools
    depends_lib-append        \
        port:${name}

    qt5.debug_variant no
}

set python_versions {27 34 35 36}

foreach pver ${python_versions} {
    subport py${pver}-${name} {
        PortGroup  qmake5 1.0

        description       Python bindings for port ${name}
        long_description  ${description}

        worksrcdir ${worksrcdir}/Python

        depends_lib-append        \
            port:${name}          \
            port:python${pver}    \
            port:py${pver}-sip    \
            port:py${pver}-pyqt5

        # allow configure.py to respect --spec=... argument
        patchfiles-append patch-configure.py.diff

        set python_ver_dot [join [split ${pver} ""] "."]

        configure.python ${prefix}/bin/python${python_ver_dot}

        # --prefix is not recognized
        configure.pre_args

        configure.cmd       ${configure.python} configure.py
        configure.args-append                   \
            --pyqt=PyQt5                        \
            --sip=${prefix}/bin/sip-${python_ver_dot}          \
            --qmake=${qt_qmake_cmd}

        qt5.spec_cmd --spec=

        # --disable-dependency-tracking is not recognized
        configure.universal_args-delete --disable-dependency-tracking

        post-destroot {
            move \
                ${destroot}${qt_data_dir}/qsci/api/python/QScintilla2.api \
                ${destroot}${qt_data_dir}/qsci/api/python/QScintilla2-Python${python_ver_dot}.api
        }
    }
}

livecheck.type      regex
livecheck.url       ${homepage}download
livecheck.regex     >QScintilla\[_-\]gpl-\(\[0-9.\]+\)${extract.suffix}<
