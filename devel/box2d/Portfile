# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                box2d
version             2.0.1
categories          devel

maintainers         stromnov openmaintainer

description         Box2D Physics Engine

long_description    ${description}

platforms           darwin

homepage            http://www.box2d.org/
master_sites        googlecode:box2d
distname            Box2D_v${version}
use_zip             yes

checksums           md5     d50faffbfa52a284466e91fc1eda2a3a \
                    sha1    27a1a0bd08c81bbf661fa008645ee5c538bb2767 \
                    rmd160  4a1e4b62c814b9a562d1ca6b580bfec83a7ad8a9

patchfiles          patch-Source-Makefile.diff

worksrcdir          ${distname}/Box2D

use_configure       no

build.args-append   -C Source

post-patch {
    reinplace "s|@@PREFIX@@|${prefix}|g" ${worksrcpath}/Source/Makefile
    reinplace "s|@@COMPATIBILITY_VERSION@@|2.0.0|g" ${worksrcpath}/Source/Makefile
    reinplace "s|@@VERSION@@|${version}|g" ${worksrcpath}/Source/Makefile
}

destroot {
    xinstall -m 644 -W ${worksrcpath}/Source/Gen/float \
        libbox2d.a ${destroot}${prefix}/lib/
    xinstall -m 755 -W ${worksrcpath}/Source/Gen/float \
        libbox2d.dylib ${destroot}${prefix}/lib/

    xinstall -m 755 -d ${destroot}${prefix}/include/box2d/
    xinstall -m 644 -W ${worksrcpath}/Include \
        Box2D.h ${destroot}${prefix}/include/box2d/
    reinplace "s|\.\./Source/||g" ${destroot}${prefix}/include/box2d/Box2D.h

    foreach incdir {Collision Collision/Shapes Common Dynamics Dynamics/Contacts Dynamics/Joints} {
        xinstall -m 755 -d ${destroot}${prefix}/include/box2d/${incdir}
        eval xinstall -m 644 [glob ${worksrcpath}/Source/${incdir}/*.h] \
            ${destroot}${prefix}/include/box2d/${incdir}
    }
}
