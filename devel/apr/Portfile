# $Id: Portfile,v 1.9 2003/03/03 06:18:01 mij Exp $

PortSystem 1.0
name		apr
version		0.9.1
categories	devel
maintainers	rooneg@electricjellyfish.net
description	the apache group's portability library
long_description	The Apache Portable Runtime is a library of C data structures and routines, forming a system portability layer that covers as many operating systems as possible, including Unices, Win32, BeOS, and OS/2.  
homepage	http://apr.apache.org/
platforms	darwin

master_sites	http://www.apache.org/dist/apr/
distfiles 	apr-0.9.1.tar.gz apr-util-0.9.1.tar.gz

depends_lib	lib:libexpat.0:expat lib:libiconv.2:libiconv

checksums 	apr-0.9.1.tar.gz md5 862ab3e00695f065235f6f25ea6cbace \
		apr-util-0.9.1.tar.gz md5 fb1a1e360a2b643ab447e993975e3397

extract	{
		cd ${workpath}
		system "tar zxvf ${distpath}/apr-${portversion}${extract.sufx}"
		system "tar zxvf ${distpath}/apr-util-${portversion}${extract.sufx}"
		system "mv apr-${portversion} apr"
		system "mv apr-util-${portversion} apr-util"
}

configure {
		system "cd ${workpath} && patch -p0 < ../files/patch-apu-conf.m4"
		system "cd ${workpath}/apr && ./configure --prefix=${prefix} --with-installbuilddir=${prefix}/share/apr/build"
		system "cd ${workpath}/apr-util && ./buildconf"
		system "cd ${workpath}/apr-util && env CPPFLAGS=-I${prefix}/include LDFLAGS=-L${prefix}/lib ./configure --prefix=${prefix} --with-apr=${workpath}/apr --with-expat=${prefix}"
}

build {
		system "cd ${workpath}/apr && make"
		system "cd ${workpath}/apr-util && make"
}

install {
		system "cd ${workpath}/apr && make install prefix=${destroot}${prefix}"
		system "cd ${workpath}/apr-util && make install prefix=${destroot}${prefix}"
}

