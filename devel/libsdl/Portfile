# $Id: Portfile,v 1.9 2005/01/24 06:36:20 rshaw Exp $
PortSystem		1.0
name			libsdl
version			1.2.8
revision		2
categories		devel multimedia
maintainers		rshaw@opendarwin.org
description		Cross-platform multi-media development API
long_description	Simple DirectMedia Layer is a cross-platform \
					multimedia library designed to provide fast access \
					to the graphics framebuffer and audio device. It is \
					used by MPEG playback software, emulators, and many \
					popular games, including the award winning Linux \
					port of "Civilization: Call To Power." Simple \
					DirectMedia Layer supports Linux, Win32, BeOS, \
					MacOS, Solaris, IRIX, and FreeBSD.
platforms		darwin freebsd
master_sites	http://www.libsdl.org/release/
distname		SDL-${version}
checksums		md5 37aaf9f069f9c2c18856022f35de9f8c

post-patch {
	# This include causes a compile error on tiger, and doesn't seem to be needed on panther
	reinplace "s| -I/System/Library/Frameworks/Kernel.framework/Headers/||" ${worksrcpath}/src/joystick/darwin/Makefile.in
}

configure.args	--enable-shared \
				--mandir=${prefix}/share/man

post-destroot	{
	xinstall -m 0755 -d ${destroot}${prefix}/share/doc/${name}
	xinstall -m 0644 -W ${worksrcpath} BUGS COPYING CREDITS INSTALL README \
		README-SDL.txt README.MacOSX TODO docs.html \
		${destroot}${prefix}/share/doc/${name}
	xinstall -m 0755 -d ${destroot}${prefix}/share/doc/${name}/docs
	xinstall -m 0644 -W ${worksrcpath}/docs index.html \
		${destroot}${prefix}/share/doc/${name}/docs
	system "cp -R ${worksrcpath}/docs/html ${destroot}${prefix}/share/doc/${name}/docs"
}

variant nostatic {
	configure.args-append	--disable-static
}

platform darwin {
	post-extract {
		system "cd ${worksrcpath} && tar -xvzf Xcode.tar.gz"
	}
	post-patch {
		reinplace "s|~/Library/Frameworks|./build/Frameworks|g" \
			${worksrcpath}/Xcode/SDL/SDL.pbproj/project.pbxproj
		reinplace "s|/Library/Frameworks|../SDL/build/Frameworks|g" \
			${worksrcpath}/Xcode/SDLTest/SDLTest.pbproj/project.pbxproj
	}
	post-build {
		build.dir		"${worksrcpath}/Xcode/SDL"
		build.type		pbx
		build.target	-buildstyle Deployment -target Framework
		system "[command build]"
		cd ${worksrcpath}/Xcode/SDL
		system "install_name_tool -id /Library/Frameworks/SDL.framework/SDL \
			build/Frameworks/SDL.framework/SDL"
		build.dir		"${worksrcpath}/Xcode/SDLTest"
		build.type		pbx
		build.target	-buildstyle Deployment -target All
		system "[command build]"
		cd ${worksrcpath}/Xcode/SDLTest
		foreach exe [glob build/*.app/Contents/MacOS/*] {
			system "install_name_tool -change @executable_path/../Frameworks/SDL.framework/Versions/A/SDL \
				/Library/Frameworks/SDL.framework/SDL ${exe}"
		}
	}
	destroot.dir	${worksrcpath}
	destroot.cmd	make
	post-destroot {
		cd "${worksrcpath}/Xcode/SDL/build/Frameworks"
		xinstall -d -m 0755 ${destroot}/Library/Frameworks
		system "cp -R SDL.framework ${destroot}/Library/Frameworks"
		cd "${worksrcpath}/Xcode/SDLTest/build"
		xinstall -d -m 0755 ${destroot}/Developer/Examples/SDL/Tests
		foreach app [glob *.app] {
			system "cp -R ${app} ${destroot}/Developer/Examples/SDL/Tests"
		}
		cd "${worksrcpath}/Xcode/Project Stationary"
		xinstall -d -m 0755 ${destroot}/Developer/Examples/SDL
		system "cp -R * ${destroot}/Developer/Examples/SDL"
	}
}

platform darwin 6 {
	depends_lib-append	lib:libdl:dlcompat
	configure.env		CPPFLAGS="-I${prefix}/include" \
						LDFLAGS="-L${prefix}/lib"
}

