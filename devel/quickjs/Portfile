# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem       1.0
PortGroup        github 1.0

name             quickjs

categories       devel
license          MIT
maintainers      nomaintainer
description      A small and embeddable Javascript engine
long_description ${name} is a small and embeddable Javascript engine. It \
    supports the ES2023 specification including modules, asynchronous \
    generators, proxies and BigInt.
homepage         https://bellard.org/quickjs/

subport          ${name}-devel {}

if {${subport} eq ${name}} {
    conflicts       ${name}-devel
    github.setup    bellard ${name} 3f81070e573e3592728dbbbd04c84c498b20d6dc
    # Change github.tarball_from to 'releases' or 'archive' next update
    github.tarball_from tarball
    version         20240113
    revision        0
    checksums       rmd160  0132951d0f78c50b10ade905ef82226ebbd23b64 \
                    sha256  e8162d9e721c3d2846d8d0bef862c539b6e2853fbaf8e536f8e5c4d5dce548c8 \
                    size    612907
} else {
    # quickjs-devel
    conflicts       ${name}
    github.setup    bellard ${name} 00b709dfff9d858b53edfd9cb8a185b120e0cbd8
    # Change github.tarball_from to 'releases' or 'archive' next update
    github.tarball_from tarball
    version         20250405
    revision        0
    checksums       rmd160 58aa581442bc5943729db9f9fbd468a2d602d67b \
                    sha256 21692df389cdbe47147ced9b657380808c15dd9cb869cee75e5dde582986fb35 \
                    size   560560
    post-extract {
        # `VERSION` is only updated for "real" releases.
        reinplace "s|2024.01.13|${version}|" ${worksrcpath}/VERSION
    }
}

use_configure    no

destroot.destdir PREFIX=${destroot}${prefix}

post-destroot {
    file mkdir ${destroot}${prefix}/lib/pkgconfig
    copy ${filespath}/${name}.pc ${destroot}${prefix}/lib/pkgconfig
    reinplace "s|@@PREFIX@@|${prefix}|" ${destroot}${prefix}/lib/pkgconfig/${name}.pc
    reinplace "s|@@VERSION@@|${version}|" ${destroot}${prefix}/lib/pkgconfig/${name}.pc
}
