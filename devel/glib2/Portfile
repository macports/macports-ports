# $Id$

PortSystem          1.0

name                glib2
version             2.12.13
categories          devel
maintainers         ryandesign
homepage            http://www.gtk.org/
platforms           darwin
distname            glib-${version}
use_bzip2           yes

description \
	Library with data structure functions and other constructs

long_description \
	Glib is a library which includes support routines for \
	C, such as lists, trees, hashes, memory allocation, and \
	many other things.

master_sites \
	ftp://ftp.gtk.org/pub/glib/[strsed ${version} {/\.[0-9]*$//}] \
	gnome:sources/glib/[strsed ${version} {/\.[0-9]*$//}]

checksums \
	md5 d76124236e4e216e8c0861341e967a76 \
	sha1 81ce0e53f5583be970623d12523c785a392647bf \
	rmd160 0d13e73cb2173e7d63ce188fdb77746cca3b04d6

patchfiles \
	patch-glib-2.0.pc.in \
	patch-glib__gutils.c \
	patch-glib_gi18n.h

depends_build \
	port:pkgconfig

depends_lib \
	port:gettext \
	port:libiconv

configure.ldflags-append \
	-bind_at_load

configure.cflags-append \
	-funroll-loops \
	-fstrict-aliasing

configure.args \
	--mandir=${prefix}/share/man

platform puredarwin {
	depends_run bin:perl:perl5.8
}

post-patch {
	reinplace "s|data_dirs = \"/usr|data_dirs = \"${prefix}/share:/usr|g" ${worksrcpath}/glib/gutils.c
	reinplace "s|path = \"/bin|path = \"${prefix}/bin:/bin|g" ${worksrcpath}/glib/gutils.c ${worksrcpath}/glib/gspawn.c
}

post-destroot {
	file delete ${destroot}${prefix}/lib/charset.alias
}

platform darwin 6 {
	depends_lib-append lib:libdl:dlcompat
	post-configure {
		reinplace "s|#define HAVE_WCHAR_T 1|#undef HAVE_WCHAR_T|" \
			${worksrcpath}/config.h
	}
}

livecheck.check     freshmeat
livecheck.name      glib
