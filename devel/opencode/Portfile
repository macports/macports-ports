# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0

github.setup        sst opencode 1.0.141 v

revision            0
categories          devel
license             MIT
maintainers         @diogom93 openmaintainer

description         Terminal AI coding agent
long_description    OpenCode is an open-source AI coding agent \
                    built for the terminal, with a native TUI, \
                    provider-agnostic model support and strong \
                    integration with modern developer workflows.

homepage            https://opencode.ai/

supported_archs     arm64 x86_64

github.tarball_from archive
fetch.type          git

depends_build       port:bun

patchfiles          bun-version.diff

checksums           rmd160  ac2eaa72e680d7c433688c601d3fcd3d5ed8261a \
                    sha256  84c04fba88e2be8b0bba2f2cd05d96f76d3891ead1603646eecbfc627d75f4d4 \
                    size    48587896

if {${build_arch} eq "x86_64"} {
    set arch "x64"
} elseif {${build_arch} eq "arm64"} {
    set arch "arm64"
}

configure.cmd       bun
configure.args      install
configure.pre_args

build.dir           ${worksrcpath}/packages/opencode/scripts
build.cmd           bun
build.env           OPENCODE_VERSION=${version}
build.args          run build --single
build.target

destroot {
    xinstall -d ${destroot}${prefix}/bin
    xinstall -m 755 ${worksrcpath}/packages/opencode/dist/opencode-darwin-${arch}/bin/opencode ${destroot}${prefix}/bin/
}
