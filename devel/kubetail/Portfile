# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0

github.setup        kubetail-org kubetail 0.9.0 cli/v
revision            1

master_sites        https://github.com/${github.author}/${github.project}/releases/download/${github.tag_prefix}${github.version}/

extract.suffix      .tar.xz
distfiles           kubetail-cli_${version}.orig${extract.suffix}
worksrcdir          kubetail-cli-${version}

supported_archs     arm64 x86_64

categories          devel
license             Apache-2
maintainers         {kubetail.com:andres @amorey} openmaintainer

description         Real-time logging tool for Kubernetes
long_description    Kubetail is a general-purpose logging tool for Kubernetes, optimized \
                    for tailing logs across multi-container workloads in real-time. With \
                    Kubetail, you can view logs from all the containers in a workload \
                    merged into a single, chronological timeline, in a browser or a \
                    terminal.

checksums           kubetail-cli_${version}.orig.tar.xz \
                    rmd160  98616e4b7c6e69985b7076a4b9c9d6506075a4d7 \
                    sha256  a0a4ab9f6aa1c0a3e3e79b9cb1eb0379dd0c84d0d258f4327b509608c93d887a \
                    size    12074260

use_configure       no

depends_build-append port:go

build {
    system -W ${worksrcpath}/modules/cli "GOWORK=off ${prefix}/bin/go build -mod=vendor -ldflags '-s -w -X github.com/kubetail-org/kubetail/modules/cli/cmd.version=${version}' -o ../../bin/kubetail ."
}

destroot {
    xinstall -m 0755 ${worksrcpath}/bin/kubetail ${destroot}${prefix}/bin/kubetail

    xinstall -d ${destroot}${prefix}/share/doc/${name}
    if {[file exists ${worksrcpath}/LICENSE]} {
        xinstall -m 0644 ${worksrcpath}/LICENSE ${destroot}${prefix}/share/doc/${name}/
    }
}
