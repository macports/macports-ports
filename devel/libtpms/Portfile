# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0

categories          devel
maintainers         @IComplainInComments
license             IBM Corporation
description         Emulation of a Trusted Platform Module Library
long_description    The libtpms library provides software emulation of a Trusted Platform Module (TPM 1.2 and TPM 2.0)
github.setup        stefanberger libtpms 0.10.1 v
homepage            https://github.com/stefanberger/libtpms
github.tarball_from archive
checksums           rmd160  99cb0bf53839a8dc3b11fc0a5b9090fe55602183 \
                    sha256  ebc24f3191d90f6cf0b4d4200cd876db4bd224b3c565708bbea0a82ee275e0fb \
                    size    1399253

# Thanks @barracuda156 for the help!

depends_lib         port:automake \
                    port:autoconf \
                    port:libtool \
                    path:bin/pkg-config:pkgconfig \
                    port:openssl3

configure.pre_args  --with-openssl \
                    --with-tpm2 \
                    --prefix=${prefix}

configure.args-append \
                    --disable-silent-rules

configure.cflags    -Wno-implicit-function-declaration \
                    -Wno-int-conversion


configure.cmd       ./autogen.sh

# VerifyConfiguration.h:72: error: expected declaration specifiers or '...' before '(' token
compiler.blacklist-append \
                    *gcc-4.*

# RunCommand.c:105:1: error: 'noreturn' function does return [-Werror]
# cc1: note: unrecognized command-line option '-Wno-self-assign' may have been intended to silence earlier diagnostics
if {[string match *gcc* ${configure.compiler}]} {
    patchfiles-append \
                    patch-gcc.diff
}

build.target