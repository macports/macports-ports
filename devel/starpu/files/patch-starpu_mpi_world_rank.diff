--- src/common/utils.c.orig	2023-04-27 17:17:42.000000000 +0800
+++ src/common/utils.c	2023-05-16 05:48:30.000000000 +0800
@@ -531,6 +531,10 @@
 		char *host=NULL, *srv_hosts;
 		srv_hosts = strdup(force_mpi_hostnames);
 		int rank;
+#ifdef STARPU_HAVE_DARWIN
+		_STARPU_DISP("Detection of MPI rank disabled on darwin, assuming rank is 0");
+		rank = 0;
+#else
 		if (starpu_mpi_world_rank)
 		{
 			rank = starpu_mpi_world_rank();
@@ -540,7 +544,7 @@
 			_STARPU_DISP("StarPU-MPI unavailable, the rank of this process is 0");
 			rank = 0;
 		}
-
+#endif
 		if (force_mpi_hostnames != NULL)
 		{
 			host = strtok(srv_hosts, " ");
