# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               github 1.0

github.setup            gitkraken gk-cli 3.1.51 v
name                    gk
github.tarball_from     releases

categories              devel
license                 CCBY-3
installs_libs           no
maintainers             {@sergiolms}\
                        openmaintainer

supported_archs         x86_64 arm64

description             Official CLI for GitKraken
long_description        ${name} is GitKraken on the command line. It makes working across multiple \
                        repos easier with Workspaces, provides access to pull requests and \
                        issues from multiple services (GitHub, GitLab, Bitbucket, etc.), \
                        and seamlessly connects with GitKraken Client and GitLens in VS Code \
                        to visualize git information when you need it.

if {${build_arch} eq "x86_64"} {
    # file name is "amd64" for x86_64
    set arch_filename   amd64
    checksums           rmd160  321d7022a5e5988449ce53f6ebc7e140ef0edd9a \
                        sha256  021bb059664391555cd9a3a8d7fc223c7243a658c53a473e488527d5db486b77 \
                        size    8040316
} else {
    # arm64
    set arch_filename ${build_arch}
    checksums           rmd160  027782940672bf2bb8622fa4cbb36697d2519ebc \
                        sha256  1a865777821f73bc8b21543eed3f7ab471a244c930e4d571024c43a53511fc5b \
                        size    7339938
}

distfiles               ${name}_${version}_darwin_${arch_filename}.zip
extract.mkdir           yes
use_zip                 yes

use_configure           no
build                   {}

destroot {
    xinstall -m 0755 ${worksrcpath}/gk ${destroot}${prefix}/bin
    # All supported shells: bash, fish, powershell, zsh
    set comp_path(bash) ${destroot}${prefix}/share/bash-completion/completions/${name}
    set comp_path(fish) ${destroot}${prefix}/share/fish/completions/${name}.fish
    set comp_path(zsh)  ${destroot}${prefix}/share/zsh/site-functions/_${name}
    foreach shell {bash fish zsh} {
        xinstall -d [file dirname $comp_path(${shell})]
        system -W ${worksrcpath} "./${name} completion ${shell} > $comp_path(${shell})"
    }
}

github.livecheck.regex  {([0-9.]+)}
