# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               github 1.0

github.setup            gitkraken gk-cli 3.1.32 v
name                    gk
github.tarball_from     releases

categories              devel
license                 CCBY-3
installs_libs           no
maintainers             {@sergiolms}\
                        openmaintainer

supported_archs         x86_64 arm64

description             Official CLI for GitKraken
long_description        ${name} is GitKraken on the command line. It makes working across multiple \
                        repos easier with Workspaces, provides access to pull requests and \
                        issues from multiple services (GitHub, GitLab, Bitbucket, etc.), \
                        and seamlessly connects with GitKraken Client and GitLens in VS Code \
                        to visualize git information when you need it.

if {${build_arch} eq "x86_64"} {
    # file name is "amd64" for x86_64
    set arch_filename   amd64
    checksums           rmd160  385af4155ae9fec56516ebb7787fc29d07957958 \
                        sha256  76409aebc15b78c7d06cdc362b588957df3a6cec220db36fac8df90ec05577c2 \
                        size    7921935
} else {
    # arm64
    set arch_filename ${build_arch}
    checksums           rmd160  3725a5e876b355bb955661269a940d2bf70e5288 \
                        sha256  447bc3b06bce7ceeda87f883c2bea6fe07dc9d7a7bcebdeee3cfb55c4c1f7f11 \
                        size    7342232
}

distfiles               ${name}_${version}_darwin_${arch_filename}.zip
extract.mkdir           yes
use_zip                 yes

use_configure           no
build                   {}

destroot {
    xinstall -m 0755 ${worksrcpath}/gk ${destroot}${prefix}/bin
    # All supported shells: bash, fish, powershell, zsh
    set comp_path(bash) ${destroot}${prefix}/share/bash-completion/completions/${name}
    set comp_path(fish) ${destroot}${prefix}/share/fish/completions/${name}.fish
    set comp_path(zsh)  ${destroot}${prefix}/share/zsh/site-functions/_${name}
    foreach shell {bash fish zsh} {
        xinstall -d [file dirname $comp_path(${shell})]
        system -W ${worksrcpath} "./${name} completion ${shell} > $comp_path(${shell})"
    }
}

github.livecheck.regex  {([0-9.]+)}
