# $Id$

PortSystem 1.0
name		emacs-app
version		23.0.0_NS-9.0rc3
revision	1
categories	aqua editors
maintainers	css@macports.org
description	The GNU Emacs text editor (Cocoa version)

long_description	GNU Emacs is a self-documenting, customizable,      \
	extensible real-time display editor. This is a port of the latest   \
	GNU Emacs source to the OpenStep (or NeXTstep) APIs, as implemented \
	by Cocoa on OS X. It differs from Carbon ports of GNU Emacs in that \
	it makes a more concerted attempt from the ground up to follow OS X \
	desktop and UI conventions.

# Note that this distribution can support GNUstep as well, but that
# configuration is untested at this time.

platforms	darwin
homepage	http://emacs-app.sourceforge.net/
master_sites	sourceforge
distname	emacs-${version}
extract.suffix	.tar.bz2
use_bzip2	yes
checksums	md5 b080af75ab03cfe49aa3bf00695cdab8 \
		sha1 5a19b28cd4d2e66c7639e0130ef6d6351d7fbf35

depends_lib	port:coreutils \
		port:pkgconfig \
		port:texinfo

# The current distribution contains its own build script, so use that
# rather than trying to manually manage the various steps of the build
# process. Perhaps a future version of this Portfile could handle the
# compile script's commands directly.

use_automake	no
use_autoconf	no
use_configure	no

# Eventually build the port without the provided script...
# configure.args	--with-ns --without-x --prefix=${destroot}/Applications/MacPorts/Emacs.app/Contents/Resources

# Don't attempt to build universal on darwin 7, so apply a patch
# to modify the compile script.
platform darwin 7 {
	patchfiles-append	patch-compile.diff
}

platform darwin 8 {
	if {$xcodeversion == "2.1"} {
		set xcodebuilddir build/Deployment
	}
}

build.dir	${worksrcpath}/nextstep
build.cmd	./compile
build.target

# Due to the fact that the script compiles and installs everything
# into the source directory, the destroot phase must manually copy the
# resulting application package.

#pre-configure {
#	reinplace "s|--with-ns|--with-ns --without-freetype|g" ${worksrcpath}/nextstep/compile
#}

destroot {
	xinstall -m 755 -d ${destroot}/Applications/MacPorts
	file copy ${worksrcpath}/nextstep/build/Emacs.app \
		${destroot}/Applications/MacPorts
	file copy ${filespath}/site-start.el \
		${destroot}/Applications/MacPorts/Emacs.app/Contents/Resources/site-lisp
}

post-destroot {
	reinplace "s|__PREFIX__|${prefix}|g" \
		${destroot}/Applications/MacPorts/Emacs.app/Contents/Resources/site-lisp/site-start.el
}
