# $Id: Portfile,v 1.8 2005/01/01 14:28:11 olegb Exp $
PortSystem 1.0
name		abiword2aqua
version		2.2.2
description	A word processor with aqua support.
long_description        A word processor with aqua support.
maintainers	olegb@opendarwin.org
categories	aqua editors
platforms	darwin 
homepage	http://www.abisource.com/
master_sites    sourceforge:abiword
checksums	md5 b6d950f627557c3a9dd8f6616e93adc8
distname	AbiWord-${version}-MacOSX-src
patchfiles	patch-build_all.sh
#this port needs DP versions of some basic stuff
depends_build	bin:convert:ImageMagick lib:XXX:zlib lib:XXX:libiconv \
		lib:XXX:gettext lib:XXX:glib2 lib:libwpd-1.7:libwpd
build.env	CPPFLAGS="-L${prefix}/lib -I${prefix}/include" \
                CFLAGS="-no-cpp-precomp"
use_configure	no
build.cmd	./build_all.sh
use_bzip2	yes
build.target	{}
pre-configure	{ 
	reinplace "s|convert|${prefix}/bin/convert|g" \
	${worksrcpath}/abi/src/wp/ap/xp/ToolbarIcons/Makefile 
	file copy -force ${worksrcpath}/../../files/Info.plist ${worksrcpath}/abipbx/ 
	reinplace "s|/sw/lib|${prefix}/lib|g" \
	${worksrcpath}/abipbx/abipbx.pbproj/project.pbxproj
	reinplace "s|/sw/include|${prefix}/include|g" \
	${worksrcpath}/abipbx/abipbx.pbproj/project.pbxproj
	reinplace "s|/sw/lib|${prefix}/lib|g" \
	${worksrcpath}/abipbx/abipbx2.pbproj/project.pbxproj
	reinplace "s|/sw/include|${prefix}/include|g" \
	${worksrcpath}/abipbx/abipbx2.pbproj/project.pbxproj
	reinplace "s|/sw/lib|${prefix}/lib|g" \
	${worksrcpath}/abi/ac-helpers/abi-detect-platform.m4
	reinplace "s|/sw/include|${prefix}/include|g" \
	${worksrcpath}/abipbx/finishlibs.sh
	reinplace "s|/sw/lib|${prefix}/lib|g" \
	${worksrcpath}/abipbx/preparelibs.sh
	reinplace "s|libintl.1.dylib|libintl.3.dylib|g" \
	${worksrcpath}/abipbx/preparelibs.sh
	reinplace "s|libintl.1.dylib|libintl.3.dylib|g" \
	${worksrcpath}/abipbx/abipbx2.pbproj/project.pbxproj
	reinplace "s|sw/|${prefix}/|g" \
	${worksrcpath}/wvpbx/wvpbx2.pbproj/project.pbxproj
	reinplace "s|sw/|${prefix}/|g" \
	${worksrcpath}/wv/INSTALL
	reinplace "s|sw/|${prefix}/|g" \
	${worksrcpath}/wvpbx/preparelibs.sh
	reinplace "s|sw/|${prefix}/|g" \
	${worksrcpath}/abipbx/finishlibs.sh
	reinplace "s|libintl.1|libintl.3|g" \
	${worksrcpath}/wvpbx/preparelibs.sh
	reinplace "s|libintl.1|libintl.3|g" \
	${worksrcpath}/wvpbx/wvpbx2.pbproj/project.pbxproj
	reinplace "s|sw/|${prefix}/|g" \
        ${worksrcpath}/enchantpbx/preparelibs.sh
	reinplace "s|libintl.1|libintl.3|g" \
	${worksrcpath}/enchantpbx/preparelibs.sh
	reinplace "s|sw/|${prefix}/|g" \
	${worksrcpath}/enchantpbx/enchantpbx.xcode/project.pbxproj

	system "cd ${worksrcpath} && touch README-MacOSX.pdf"
}
post-destroot { 
	file mkdir ${destroot}/Applications/DarwinPorts
	file copy -force ${worksrcpath}/BUILD/AbiWord.app ${destroot}/Applications/DarwinPorts/ 
}
