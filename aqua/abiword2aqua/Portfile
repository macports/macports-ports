# $Id: Portfile,v 1.2 2004/10/15 20:05:02 olegb Exp $
PortSystem 1.0
name		abiword2aqua
version		2.1.90
description	A word processor with aqua support.
long_description        A word processor with aqua support.
maintainers	olegb@opendarwin.org
categories	aqua editors
platforms	darwin 
homepage	http://www.abisource.com/
master_sites    sourceforge:abiword
checksums	md5 b8e95fdbc077aed14f20b7deb2f5bb88
distname	AbiWord-${version}-MacOSX-src
#this port needs DP versions of some basic stuff
depends_build	bin:convert:ImageMagick lib:XXX:zlib lib:XXX:libiconv \
		lib:XXX:gettext lib:XXX:glib2
build.env	CPPFLAGS="-L${prefix}/lib -I${prefix}/include" \
                CFLAGS="-no-cpp-precomp"
use_configure	no
build.cmd	./build_all.sh
use_bzip2	yes
build.target	{}
pre-configure	{ 
		reinplace "s|convert|${prefix}/bin/convert|g" \
		${worksrcpath}/abi/src/wp/ap/xp/ToolbarIcons/Makefile 
		file copy -force ${worksrcpath}/../../files/Info.plist ${worksrcpath}/abipbx/ 
		reinplace "s|/sw/lib|${prefix}/lib|g" \
		${worksrcpath}/abipbx/abipbx.pbproj/project.pbxproj
		reinplace "s|/sw/include|${prefix}/include|g" \
		${worksrcpath}/abipbx/abipbx.pbproj/project.pbxproj
		reinplace "s|/sw/lib|${prefix}/lib|g" \
		${worksrcpath}/abipbx/abipbx2.pbproj/project.pbxproj
		reinplace "s|/sw/include|${prefix}/include|g" \
		${worksrcpath}/abipbx/abipbx2.pbproj/project.pbxproj
		reinplace "s|/sw/lib|${prefix}/lib|g" \
		${worksrcpath}/abi/ac-helpers/abi-detect-platform.m4
		reinplace "s|/sw/include|${prefix}/include|g" \
		${worksrcpath}/abipbx/finishlibs.sh
		reinplace "s|/sw/lib|${prefix}/lib|g" \
		${worksrcpath}/abipbx/preparelibs.sh
		reinplace "s|libintl.1.dylib|libintl.3.dylib|g" \
		${worksrcpath}/abipbx/preparelibs.sh
		reinplace "s|libintl.1.dylib|libintl.3.dylib|g" \
                ${worksrcpath}/abipbx/abipbx2.pbproj/project.pbxproj

		system "cd ${worksrcpath} && touch README-MacOSX.pdf"
}
post-destroot { 
		file mkdir ${destroot}/Applications/DarwinPorts
		file copy -force ${worksrcpath}/BUILD/AbiWord.app ${destroot}/Applications/DarwinPorts/ 
}
